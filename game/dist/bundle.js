(()=>{"use strict";class e{static get CANVAS_HEIGHT(){return e.TILE_SIZE*e.CANVAS_TILE_HEIGHT}static get CANVAS_WIDTH(){return e.TILE_SIZE*e.CANVAS_TILE_WIDTH}static get ASPECT_RATIO(){return e.CANVAS_TILE_HEIGHT/e.CANVAS_TILE_WIDTH}static get TOTAL_RENDERING_LAYERS(){return e.OBJECT_RENDERING_LAYERS+e.UI_RENDERING_LAYERS}static get FIRST_UI_RENDER_LAYER(){return e.OBJECT_RENDERING_LAYERS}static get LAST_UI_RENDER_LAYER(){return e.OBJECT_RENDERING_LAYERS+e.UI_RENDERING_LAYERS-1}static get UI_COLLISION_LAYER(){return e.OBJECT_COLLISION_LAYERS-1}static get CANVAS_CENTER_TILE_Y(){return this.CANVAS_TILE_HEIGHT/2}static get CANVAS_CENTER_TILE_X(){return this.CANVAS_TILE_WIDTH/2}static get CANVAS_CENTER_PIXEL_X(){return e.CANVAS_WIDTH/2}static get CANVAS_CENTER_PIXEL_Y(){return e.CANVAS_HEIGHT/2}}e.CANVAS_TILE_HEIGHT=18,e.CANVAS_TILE_WIDTH=32,e.TILE_SIZE=16,e.OBJECT_RENDERING_LAYERS=16,e.UI_RENDERING_LAYERS=16,e.OBJECT_COLLISION_LAYERS=16,e.CONTEXT_IMAGE_SMOOTHING_ENABLED=!1;class t{static renderSprite(t,i,s,o,n,r,a,h,l={}){var d,c;let p=a?a*e.TILE_SIZE:e.TILE_SIZE,g=h?h*e.TILE_SIZE:e.TILE_SIZE,u=null!==(d=l.scale)&&void 0!==d?d:1,m=null!==(c=l.rotation)&&void 0!==c?c:0,b=l.opacity&&l.opacity<1,y=0!==m,v=b||y;if(v&&(t.save(),b&&(t.globalAlpha=Math.max(0,l.opacity)),y)){let i=Math.floor((n+a/2)*e.TILE_SIZE)+.5,s=Math.floor((r+h/2)*e.TILE_SIZE)+.5;t.translate(i,s),t.rotate(m*Math.PI/180),t.translate(-i,-s)}let f=Math.floor(p/2),w=Math.floor(g/2);l.centered&&t.translate(-f,-w),t.drawImage(i,s*e.TILE_SIZE,o*e.TILE_SIZE,p,g,Math.floor(n*e.TILE_SIZE),Math.floor(r*e.TILE_SIZE),p*u,g*u),l.centered&&t.translate(f,w),v&&t.restore()}static renderSubsection(t,i,s,o,n,r){let a=Math.floor(s*e.TILE_SIZE),h=Math.floor(o*e.TILE_SIZE),l=Math.floor(n*e.TILE_SIZE),d=Math.floor(r*e.TILE_SIZE);i.drawImage(t.canvas,a,h,l-a,d-h,0,0,i.canvas.width,i.canvas.height)}static renderCircle(t,i,s,o={}){t.beginPath(),t.arc(i*e.TILE_SIZE+e.TILE_SIZE/2,s*e.TILE_SIZE+e.TILE_SIZE/2,e.TILE_SIZE/2,0,2*Math.PI),t.stroke(),t.fillStyle=o.colour||"saddlebrown",t.fill()}static fillRectangle(t,i,s,o,n,r={}){t.strokeStyle=r.colour?r.colour:"black",t.fillStyle=r.colour?r.colour:"black",t.beginPath(),t.rect(Math.floor(i*e.TILE_SIZE)+.5,Math.floor(s*e.TILE_SIZE)+.5,o*("tile"===r.type?e.TILE_SIZE:1)-1,n*("tile"===r.type?e.TILE_SIZE:1)-1),t.stroke(),t.fill()}static strokeRectangle(t,i,s,o,n,r={}){var a;t.strokeStyle=null!==(a=r.colour)&&void 0!==a?a:"black",t.lineWidth=1;let h="tile"===r.type?Math.floor(i*e.TILE_SIZE):i,l="tile"===r.type?Math.floor(s*e.TILE_SIZE):s,d="tile"===r.type?Math.floor(o*e.TILE_SIZE):o,c="tile"===r.type?Math.floor(n*e.TILE_SIZE):n;t.strokeRect(h+.5,l+.5,d-1,c-1)}static clearCanvas(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}static createCanvas(t,i){const s=document.createElement("canvas");return s.width=t?t*e.TILE_SIZE:e.CANVAS_WIDTH,s.height=i?i*e.TILE_SIZE:e.CANVAS_HEIGHT,s}static getContext(t){let i=t.getContext("2d");return i.imageSmoothingEnabled=e.CONTEXT_IMAGE_SMOOTHING_ENABLED,i}static positionToPixelPosition(t){return t*e.TILE_SIZE}static renderText(t,i,s,o,n={}){let r=n.size?n.size:16,a=n.colour?n.colour:"black",h=n.font?n.font:"Helvetica";t.font=`${r}px ${h}`,t.fillStyle=`${a}`,t.fillText(i,s*e.TILE_SIZE,o*e.TILE_SIZE)}static textToArray(e,t,i={}){var s,o;let n=null!==(s=i.size)&&void 0!==s?s:16,r=null!==(o=i.colour)&&void 0!==o?o:"black",a=i.font?i.font:"Helvetica",h=document.createElement("canvas").getContext("2d");h.font=`${n}px ${a}`,h.fillStyle=`${r}`;let l=e.split(" "),d="",c=[];for(let e=0;e<l.length;e++){let i=`${d} ${l[e]}`;h.measureText(i).width>=t?(c.push(i),d=""):l.length-1!==e?d=i.trim():c.push(i)}return c}}var i;!function(e){e.Left="left",e.Middle="middle",e.Right="right"}(i||(i={}));class s{static isKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)if(this.keyboard[t])return!0;return!1}static setKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)this.keyboard[t]=!0}static clearKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)this.keyboard[t]=!1}static isMousePressed(e=i.Left){return this.mouse.click[e]}static clearMousePressed(e=i.Left){this.mouse.click[e]=!1}}s.keyboard={},s.mouse={click:{left:!1,middle:!1,right:!1},position:{x:0,y:0},wheel:{event:new WheelEvent("")},latestEvent:new MouseEvent("")};class o{static getMousePosition(t,i){let s,o=t.getBoundingClientRect(),n={height:o.height,width:o.width},r={clientX:i.clientX,clientY:i.clientY};if(t.width>t.height){s=t.width/o.width,n.height=t.height/s;let e=o.height-n.height;r.clientY-=e/2}else{s=t.height/o.height,n.width=t.width/s;let e=o.width-n.width;r.clientX-=e/2}let a=t.width/n.width,h=t.height/n.height;return{x:(r.clientX-o.left)*a/e.TILE_SIZE,y:(r.clientY-o.top)*h/e.TILE_SIZE}}static setCursor(e,t){e.style.cursor=`url("${t}"), auto`}static get isFullscreen(){return null!==document.fullscreenElement}static isMouseWithinBoundary(e,t,i,s,o){return e.x>=t&&e.x<=t+s&&e.y>=i&&e.y<=i+o}static isMouseWithinObject(e){return!!this.isMouseWithinBoundary(s.mouse.position,e.boundingBox.world.left,e.boundingBox.world.top,e.width,e.height)}static wasObjectClicked(e){return!!s.mouse.click.left&&!!this.isMouseWithinObject(e)}}class n{constructor(e){this.scene=e,this.globals={}}destroy(){}}class r{constructor(e,t){this.x=e,this.y=t}get roundedX(){return Math.round(this.x)}get roundedY(){return Math.round(this.y)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){let e=this.magnitude;return 0===e?new r(0,0):new r(this.x/e,this.y/e)}add(e){return new r(this.x+e.x,this.y+e.y)}subtract(e){return new r(this.x-e.x,this.y-e.y)}multiply(e){return new r(this.x*e,this.y*e)}divide(e){return new r(this.x/e,this.y/e)}}const a=!1;class h{constructor(e,t){var i,s,o,n,h,l,d,c,p,g;this.scene=e,this.id=crypto.randomUUID(),this.width=1,this.height=1,this.children=new Map,this.parent=void 0;const u=this;this.mainContext=this.scene.renderContext,this.transform={position:{local:new r(0,0),get world(){return u.calculateWorldPosition()}},scale:1,rotation:0},this.collision={enabled:a,layer:0},this.renderer={enabled:!1,layer:0,opacity:1,scale:1},this.flags={awake:!1,update:!0,render:!0,destroy:!1},this.transform.position.local.x=null!==(i=t.positionX)&&void 0!==i?i:this.transform.position.local.x,this.transform.position.local.y=null!==(s=t.positionY)&&void 0!==s?s:this.transform.position.local.y,this.collision.enabled=null!==(o=t.collisionEnabled)&&void 0!==o?o:a,this.collision.layer=null!==(n=t.collisionLayer)&&void 0!==n?n:0,this.renderer.enabled=null!==(h=t.renderEnabled)&&void 0!==h?h:this.renderer.enabled,this.renderer.layer=null!==(l=t.renderLayer)&&void 0!==l?l:this.renderer.layer,this.renderer.opacity=null!==(d=t.renderOpacity)&&void 0!==d?d:this.renderer.opacity,this.renderer.scale=null!==(c=t.renderScale)&&void 0!==c?c:this.renderer.scale,this.width=null!==(p=t.width)&&void 0!==p?p:this.width,this.height=null!==(g=t.height)&&void 0!==g?g:this.height,void 0!==t.onAwake&&(this.onAwake=t.onAwake),void 0!==t.onUpdate&&(this.onUpdate=t.onUpdate),void 0!==t.onRender&&(this.onRender=t.onRender),void 0!==t.onDestroy&&(this.onDestroy=t.onDestroy)}awake(){this.flags.awake||(this.flags.awake=!0,void 0!==this.onAwake&&this.onAwake())}update(e){this.flags.update&&void 0!==this.onUpdate&&this.onUpdate(e)}render(e){this.renderer.enabled&&this.flags.render&&void 0!==this.onRender&&this.onRender(e)}destroy(){this.flags.destroy=!0,this.children.forEach((e=>{e.destroy()}))}get boundingBox(){return{local:h.calculateBoundingBox(this.transform.position.local.x,this.transform.position.local.y,this.width,this.height),world:h.calculateBoundingBox(this.transform.position.world.x,this.transform.position.world.y,this.width,this.height)}}debuggerRenderBoundary(e){t.strokeRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"red",type:"tile"})}debuggerRenderBackground(i){t.fillRectangle(i,this.boundingBox.world.left,this.boundingBox.world.top,Math.floor(this.width*e.TILE_SIZE),Math.floor(this.height*e.TILE_SIZE),{colour:"red"})}isCollidingWith(e){return this.isWithinHorizontalBounds(e)&&this.isWithinVerticalBounds(e)}isWithinHorizontalBounds(e){return e.boundingBox.world.left>=this.boundingBox.world.left&&e.boundingBox.world.left<=this.boundingBox.world.right||e.boundingBox.world.right>=this.boundingBox.world.left&&e.boundingBox.world.right<=this.boundingBox.world.right}isWithinVerticalBounds(e){return e.boundingBox.world.top>=this.boundingBox.world.top&&e.boundingBox.world.top<=this.boundingBox.world.bottom||e.boundingBox.world.bottom>=this.boundingBox.world.top&&e.boundingBox.world.bottom<=this.boundingBox.world.bottom}static calculateBoundingBox(e,t,i,s){let o=i/2,n=s/2;return{top:t-n,right:e+o,bottom:t+n,left:e-o}}addChild(e){this.children.set(e.id,e),e.parent=this,this.scene.addObject(e)}removeChild(e){void 0!==this.children.get(e.id)&&e.destroy()}removeAllChildren(){this.children.forEach((e=>{this.removeChild(e)}))}get rootParent(){return l(this)}calculateWorldPosition(){return void 0===this.parent?new r(this.transform.position.local.x,this.transform.position.local.y):new r(this.transform.position.local.x+this.parent.transform.position.world.x,this.transform.position.local.y+this.parent.transform.position.world.y)}}function l(e){return void 0===e.parent?e:l(e.parent)}class d extends h{constructor(e,t){super(e,t),this.scene=e,this.isColliding=!1,this.renderer.enabled=!0,t.width&&(this.width=t.width),t.height&&(this.height=t.height)}onUpdate(e){this.updateCollision()}onRender(e){let i=this.isColliding?"green":"red";t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:i,type:"tile"})}updateCollision(){if(this.collision.enabled){for(const[,e]of this.scene.objects)if(e!==this&&this.boundingBox.world.left<e.boundingBox.world.right&&this.boundingBox.world.right>e.boundingBox.world.left&&this.boundingBox.world.top<e.boundingBox.world.bottom&&this.boundingBox.world.bottom>e.boundingBox.world.top)return void(this.isColliding=!0);this.isColliding=!1}}}class c extends h{constructor(e,t){super(e,t),this.scene=e,this.timer=0,this.grow=!0,this.renderer.enabled=!0}onUpdate(e){this.timer+=e,this.timer>2&&(this.grow=!this.grow,this.timer=0),this.transform.position.local.x+=(this.grow?1:-1)*e,this.transform.position.local.y+=(this.grow?1:-1)*e}onRender(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"red",type:"tile"})}}class p{static get engineMapList(){return document.getElementById("map-list")||null}static get engineObjectList(){return document.getElementById("object-list")||null}static get engineObjectDetails(){return document.getElementById("object-details")||null}static get engineControls(){return{gridLines:document.getElementById("btnGridLines"),gridNumbers:document.getElementById("btnGridNumbers"),breakpoint:document.getElementById("btnBreakpoint"),fps:document.getElementById("btnFps"),objectCount:document.getElementById("btnObjectCount"),timingFrame:document.getElementById("btnTimingFrame"),timingFrameBackground:document.getElementById("btnTimingFrameBackground"),timingFrameRender:document.getElementById("btnTimingFrameRender"),timingFrameUpdate:document.getElementById("btnTimingFrameUpdate"),canvasLayers:document.getElementById("btnCanvasLayers"),fullscreen:document.getElementById("btnFullscreen"),renderBoundary:document.getElementById("btnRenderBoundary"),renderBackground:document.getElementById("btnRenderBackground")}}static initHelpers(){window.o=e=>window.engine.scene.objects.get(e)}static changeScene(e){window.engine.changeScene(e)}static changeMap(e){window.engine.scene.changeMap(e)}}p.TEST_MAPS=[{name:"collision test",map:class extends n{constructor(e){super(e),this.scene=e,this.height=18,this.width=30,this.backgroundLayers=[],this.objects=[],this.initialiseNotColliding(),this.initialiseColliding()}initialiseNotColliding(){this.objects.push(new d(this.scene,{positionX:1.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:2.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:2.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:4.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:2.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:4.5})),this.objects.push(new d(this.scene,{positionX:2.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:4.5})),this.objects.push(new d(this.scene,{positionX:4.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:5.5,collisionEnabled:!0}))}initialiseColliding(){this.objects.push(new d(this.scene,{positionX:7.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:8,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:2,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:2,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:8,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:5.5})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:5.5})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:7.5})),this.objects.push(new d(this.scene,{positionX:2,positionY:7.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:7.5})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:8,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.001,positionY:7.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:6,positionY:8.5})),this.objects.push(new d(this.scene,{positionX:8.499,positionY:7.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:8.5})),this.objects.push(new d(this.scene,{positionX:5.001,positionY:10.999,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:6,positionY:10})),this.objects.push(new d(this.scene,{positionX:8.499,positionY:10.999,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:10})),this.objects.push(new d(this.scene,{positionX:18,positionY:5,width:6,height:6,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:5})),this.objects.push(new d(this.scene,{positionX:21.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.5,positionY:8.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:8.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.5,positionY:8.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:14,width:6,height:6})),this.objects.push(new d(this.scene,{positionX:14.501,positionY:10.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18.001,positionY:10.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.499,positionY:10.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.501,positionY:14,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:14,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.499,positionY:14,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.501,positionY:17.499,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:17.499,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.499,positionY:17.499,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:15,width:5,height:1,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:15,width:1,height:5})),this.objects.push(new d(this.scene,{positionX:9.5,positionY:15,width:5,height:1})),this.objects.push(new d(this.scene,{positionX:9.5,positionY:15,width:1,height:5,collisionEnabled:!0}))}}},{name:"object hierarchy test",map:class extends n{constructor(e){super(e),this.scene=e,this.height=18,this.width=30,this.backgroundLayers=[],this.objects=[];const t=new c(this.scene,{positionX:1,positionY:1}),i=new c(this.scene,{positionX:1,positionY:1}),s=new c(this.scene,{positionX:1,positionY:1}),o=new c(this.scene,{positionX:1,positionY:1});this.scene.addObject(t),t.addChild(i),i.addChild(s),s.addChild(o)}}}];class g{constructor(i,s,o,n,r,a){this.container=i,this.engineMapList=o,this.engineObjectList=n,this.engineObjectDetails=r,this.engineControls=a,this.CANVAS_HEIGHT=e.CANVAS_HEIGHT,this.CANVAS_WIDTH=e.CANVAS_WIDTH,this.delta=0,this.lastRenderTimestamp=0,this.flags={frame:{interrupted:!1,log:{start:!1,end:!1,delta:!1,timestamp:!1,backgroundDuration:!1,awakeDuration:!1,updateDuration:!1,renderDuration:!1,destroyDuration:!1}}},this.debug={enabled:!0,stats:{fps:!1,fpsCounter:0,objectCount:!1},breakpoint:{frame:!1},ui:{grid:{lines:!1,numbers:!1},canvasLayers:!1},object:{renderBoundary:!1,renderBackground:!1}},this.gamepad=void 0,this.editorTimer=0,this.debug.enabled&&(this.initialiseDebuggerState(),this.initialiseDebuggerListeners()),this.displayCanvas=this.createCanvas(),this.displayContext=t.getContext(this.displayCanvas),this.renderCanvas=this.createCanvas(),this.renderContext=t.getContext(this.renderCanvas),i.append(this.displayCanvas),document.addEventListener("visibilitychange",(e=>{"visible"===document.visibilityState?(console.log("tab is active"),this.flags.frame.interrupted=!0):console.log("tab is inactive")})),document.addEventListener("fullscreenchange",(e=>{})),document.addEventListener("fullscreenerror",(e=>{})),this.initialiseMouseListeners(),this.initialiseKeyboardListeners(),this.intialiseGamepadListeners(),this.changeScene(s),window.requestAnimationFrame(this.firstFrame.bind(this))}createCanvas(){const e=t.createCanvas();return e.addEventListener("contextmenu",(e=>{e.preventDefault()})),e}changeScene(e){this.scene=Reflect.construct(e,[this])}firstFrame(e){this.setDelta(e),window.requestAnimationFrame(this.frame.bind(this))}interruptedFrame(e){console.log("frameInterrupted"),this.lastRenderTimestamp=e,this.flags.frame.interrupted=!1,window.requestAnimationFrame(this.frame.bind(this))}frame(e){this.flags.frame.log.start&&console.log("[frame] start"),this.debug.breakpoint.frame,this.flags.frame.interrupted?window.requestAnimationFrame(this.interruptedFrame.bind(this)):(this.setDelta(e),this.flags.frame.log.timestamp&&console.log(`[timestamp] ${e}`),this.flags.frame.log.delta&&console.log(`[delta] ${this.delta}`),t.clearCanvas(this.renderContext),this.scene.frame(this.delta),t.clearCanvas(this.displayContext),this.displayContext.drawImage(this.renderCanvas,0,0),this.debug.stats.fps&&(this.debug.stats.fpsCounter&&this.renderStats(0,"FPS",`${Math.round(1e3/(performance.now()-this.debug.stats.fpsCounter))} FPS`),this.debug.stats.fpsCounter=e),this.debug.stats.objectCount&&this.renderStats(1,"Objects",`${this.scene.objects.size} objects`),this.renderGrid(),this.scene.flaggedForMapChange&&this.scene.changeMap(this.scene.flaggedForMapChange),this.editorTimer+=this.delta,this.editorTimer>1&&(this.editor(),this.editorTimer=0),window.requestAnimationFrame(this.frame.bind(this)),this.flags.frame.log.end&&console.log("[frame] end"))}setDelta(e){this.delta=(e-this.lastRenderTimestamp)/1e3,this.lastRenderTimestamp=e}renderStats(t,i,s){this.displayContext.fillStyle="red",this.displayContext.font="12px serif",this.displayContext.fillText(s,this.CANVAS_WIDTH-50,(t+1)*e.TILE_SIZE)}renderGrid(){if((this.debug.ui.grid.lines||this.debug.ui.grid.numbers)&&t.fillRectangle(this.displayContext,0,0,this.CANVAS_WIDTH,this.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.25)"}),this.debug.ui.grid.lines)for(let i=0;i<this.CANVAS_WIDTH;i+=e.TILE_SIZE)for(let s=0;s<this.CANVAS_HEIGHT;s+=e.TILE_SIZE)t.strokeRectangle(this.displayContext,i,s,e.TILE_SIZE,e.TILE_SIZE,{colour:"black"});if(this.debug.ui.grid.numbers)for(let t=0;t<e.CANVAS_TILE_WIDTH;t++)for(let i=0;i<e.CANVAS_TILE_HEIGHT;i++)this.displayContext.fillStyle="black",this.displayContext.font="8px helvetica",this.displayContext.fillText(`${t}`,t*e.TILE_SIZE+1,i*e.TILE_SIZE+8),this.displayContext.fillText(`${i}`,t*e.TILE_SIZE+6,i*e.TILE_SIZE+14)}initialiseDebuggerState(){if(void 0!==this.engineControls&&this.engineControls.renderBoundary){const e=JSON.parse(localStorage.getItem("object.renderBoundary"));this.engineControls.renderBoundary.checked=e,this.debug.object.renderBoundary=e}}initialiseDebuggerListeners(){void 0!==this.engineControls&&(this.engineControls.gridLines&&this.engineControls.gridLines.addEventListener("click",(()=>{this.debug.ui.grid.lines=!this.debug.ui.grid.lines})),this.engineControls.gridNumbers&&this.engineControls.gridNumbers.addEventListener("click",(()=>{this.debug.ui.grid.numbers=!this.debug.ui.grid.numbers})),this.engineControls.breakpoint&&this.engineControls.breakpoint.addEventListener("click",(()=>{this.debug.breakpoint.frame=!this.debug.breakpoint.frame})),this.engineControls.fps&&this.engineControls.fps.addEventListener("click",(()=>{this.debug.stats.fps=!this.debug.stats.fps})),this.engineControls.objectCount&&this.engineControls.objectCount.addEventListener("click",(()=>{this.debug.stats.objectCount=!this.debug.stats.objectCount})),this.engineControls.timingFrame&&this.engineControls.timingFrame.addEventListener("click",(()=>{this.flags.frame.log.delta=!this.flags.frame.log.delta})),this.engineControls.timingFrameBackground&&this.engineControls.timingFrameBackground.addEventListener("click",(()=>{this.flags.frame.log.backgroundDuration=!this.flags.frame.log.backgroundDuration})),this.engineControls.timingFrameRender&&this.engineControls.timingFrameRender.addEventListener("click",(()=>{this.flags.frame.log.renderDuration=!this.flags.frame.log.renderDuration})),this.engineControls.timingFrameUpdate&&this.engineControls.timingFrameUpdate.addEventListener("click",(()=>{this.flags.frame.log.updateDuration=!this.flags.frame.log.updateDuration})),this.engineControls.canvasLayers&&this.engineControls.canvasLayers.addEventListener("click",(()=>{this.debug.ui.canvasLayers=!this.debug.ui.canvasLayers})),this.engineControls.renderBoundary&&this.engineControls.renderBoundary.addEventListener("click",(()=>{this.debug.object.renderBoundary=!this.debug.object.renderBoundary,localStorage.setItem("object.renderBoundary",JSON.stringify(this.debug.object.renderBoundary))})),this.engineControls.renderBackground&&this.engineControls.renderBackground.addEventListener("click",(()=>{this.debug.object.renderBackground=!this.debug.object.renderBackground})),this.engineControls.fullscreen&&this.engineControls.fullscreen.addEventListener("click",(()=>{this.displayCanvas.requestFullscreen().catch((e=>{throw new Error(e)}))})))}initialiseKeyboardListeners(){console.log("[listener added] keydown"),document.addEventListener("keydown",(e=>{if(e.preventDefault(),e.repeat)return;console.log("[keydown]",e);let t=e.key.toLocaleLowerCase();s.setKeyPressed(t)})),console.log("[listener added] keyup"),document.addEventListener("keyup",(e=>{if(e.preventDefault(),e.repeat)return;console.log("[keyup]",e);let t=e.key.toLocaleLowerCase();s.clearKeyPressed(t)}))}initialiseMouseListeners(){console.log("[listener added] mousemove"),this.displayCanvas.addEventListener("mousemove",(e=>{s.mouse.position=o.getMousePosition(this.displayCanvas,e),s.mouse.latestEvent=e})),console.log("[listener added] mousedown"),this.displayCanvas.addEventListener("mousedown",(e=>{switch(console.log("[mousedown]",e),e.button){case 0:s.mouse.click.left=!0;break;case 1:s.mouse.click.middle=!0;break;case 2:s.mouse.click.right=!0}})),console.log("[listener added] mouseup"),this.displayCanvas.addEventListener("mouseup",(e=>{switch(console.log("[mouseup]",e),e.button){case 0:s.mouse.click.left=!1;break;case 1:s.mouse.click.middle=!1;break;case 2:s.mouse.click.right=!1}})),console.log("[listener added] touchstart"),this.displayCanvas.addEventListener("touchstart",(e=>{console.log("[touchstart]",e),s.mouse.click.left=!0})),console.log("[listener added] touchend"),this.displayCanvas.addEventListener("touchend",(e=>{console.log("[touchend]",e),s.mouse.click.left=!1})),console.log("[listener added] wheel"),this.displayCanvas.addEventListener("wheel",(e=>{console.log("[wheel]",e),s.mouse.wheel.event=e}))}intialiseGamepadListeners(){window.addEventListener("gamepadconnected",(e=>{console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.gamepad.index,e.gamepad.id,e.gamepad.buttons.length,e.gamepad.axes.length),this.gamepad=e.gamepad})),window.addEventListener("gamepaddisconnected",(e=>{this.gamepad=void 0}))}editor(){if(null===this.engineObjectList||null===this.engineMapList)return;let e=document.createElement("ul");this.engineMapList.innerHTML="",this.engineMapList.appendChild(e),[...p.TEST_MAPS].forEach((t=>{let i=document.createElement("li");i.innerHTML=t.name,e.appendChild(i),i.addEventListener("click",(()=>{p.changeMap(t.map)}))}));let t=document.createElement("ul");this.engineObjectList.innerHTML="",this.engineObjectList.appendChild(t),this.scene.objects.forEach((e=>{let i=document.createElement("li");i.innerHTML=e.constructor.name,t.appendChild(i),i.addEventListener("click",(()=>{this.engineSelectedObjectId=e.id,this.updateEngineObjectDetails()}))}))}updateEngineObjectDetails(){if(void 0===this.engineSelectedObjectId)return;if(null===this.engineObjectDetails)return;let e=this.scene.objects.get(this.engineSelectedObjectId);if(void 0===e)return;const t=this.engineObjectDetails.querySelector("#object-details-header"),i=this.engineObjectDetails.querySelector("#object-details-content");t.innerHTML=`<h3>${e.constructor.name}</h3>`,i.innerHTML="",Object.keys(e).forEach((t=>{"transform"===t?(i.innerHTML+=u(e.transform.position.local,"x"),i.innerHTML+=u(e.transform.position.local,"y")):i.innerHTML+=u(e,t)})),console.log(e)}}function u(e,t){let i="";return i+='<div style="display:flex; padding: 0.25rem 0;">',i+=`<span style="margin-right: auto;">${t}</span>`,i+=`<code>${e[t]}</code>`,i+="</div>",i}class m{static initialise(e){Object.keys(e.images).forEach((t=>{this.images[t]=new Image,this.images[t].src=e.images[t]})),Object.keys(e.audio).forEach((t=>{this.audio[t]=new Audio(e.audio[t])}))}}m.images={},m.audio={};const b={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},y=[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],v={index:0,tiles:[y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y]};class f{static randomIntFromRange(e,t){return Math.floor(this.randomNumberFromRange(e,t))}static randomNumberFromRange(e,t){return Math.random()*(t-e+1)+e}static randomStartingDelta(e){return Math.random()*(null!=e?e:1)}}class w{get position(){return{x:this.targetX,y:this.targetY}}get target(){return{x:this.targetX,y:this.targetY}}constructor(e,t,i,s){this.positionX=e,this.positionY=t,this.targetX=i,this.targetY=s}}class x{static moveTowardsPosition(e,t){return e.targetX>e.positionX?(e.positionX+=t,e.targetX<e.positionX&&(e.positionX=e.targetX)):e.targetX<e.positionX?(e.positionX-=t,e.targetX>e.positionX&&(e.positionX=e.targetX)):e.targetY>e.positionY?(e.positionY+=t,e.targetY<e.positionY&&(e.positionY=e.targetY)):e.targetY<e.positionY&&(e.positionY-=t,e.targetY>e.positionY&&(e.positionY=e.targetY)),new w(e.positionX,e.positionY,e.targetX,e.targetY)}static moveTowardsOtherEntity(e,t){return t.positionX>e.positionX?e.targetX+=1:t.positionX<e.positionX?e.targetX-=1:t.positionY>e.positionY?e.targetY+=1:t.positionY<e.positionY&&(e.targetY-=1),new w(e.positionX,e.positionY,e.targetX,e.targetY)}static moveInRandomDirection(e){switch(f.randomIntFromRange(1,4)){case 1:e.targetX+=1;break;case 2:e.targetX-=1;break;case 3:e.targetY+=1;break;case 4:e.targetY-=1}return new w(e.positionX,e.positionY,e.targetX,e.targetY)}static frameSpeed(e,t){return e*t}static MoveTowards(e,t,i){let s=t.subtract(e),o=s.normalized.multiply(i);return o.magnitude>s.magnitude&&(o=s),o}}class I extends h{constructor(e,t){var i,s;super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.movementSpeed=.5,this.renderer.enabled=!0,this.tileset=t.tileset,this.spriteX=t.spriteX,this.spriteY=t.spriteY,this.spriteHeight=t.spriteHeight,this.spriteWidth=t.spriteWidth,this.destroyAtTarget=null!==(i=t.destroyAtTarget)&&void 0!==i&&i,this.movementSpeed=null!==(s=t.movementSpeed)&&void 0!==s?s:.5}onUpdate(e){this.updatePosition(e)}updatePosition(e){if(this.transform.position.local.x===this.targetX&&this.transform.position.local.y===this.targetY)return void(this.destroyAtTarget&&this.destroy());let t=new w(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=this.movementSpeed*e,s=x.moveTowardsPosition(t,i);this.transform.position.local.x=s.positionX,this.transform.position.local.y=s.positionY}onRender(e){t.renderSprite(e,m.images[this.tileset],this.spriteX,this.spriteY,this.transform.position.world.x,this.transform.position.world.y,this.spriteWidth,this.spriteWidth,{centered:!0})}}class E extends h{constructor(e,t){super(e,t),this.scene=e,this.newItemTimer=0}onUpdate(e){this.updateGenerateNewItem(e)}updateGenerateNewItem(t){if(this.newItemTimer+=t,this.newItemTimer<3)return;if(this.scene.objects.size>15)return;let i=f.randomIntFromRange(0,this.scene.map.height);this.scene.addObject(new I(this.scene,{positionX:e.CANVAS_TILE_WIDTH,positionY:i,targetX:-1,targetY:i,tileset:"tileset_egg",spriteX:1,spriteY:0,destroyAtTarget:!0})),this.newItemTimer=0}}var S,T,_;!function(e){e.Chicken="Chicken",e.Egg="Egg",e.WheatSeeds="WheatSeeds",e.Wheat="Wheat",e.TomatoSeeds="TomatoSeeds",e.Tomato="Tomato",e.Hoe="Hoe",e.WateringCan="WateringCan",e.Chest="Chest"}(S||(S={})),function(e){e.Player="Player",e.Anywhere="Anywhere",e.None="None"}(T||(T={})),function(e){e.Confirm="e",e.ConfirmAlt=" "}(_||(_={}));const C="tileset_dialogue_box",Y=()=>{};class L extends h{constructor(t,i){var s,o,n,r,a;super(t,i),this.scene=t,this.height=3,this.width=e.CANVAS_TILE_WIDTH,this.textboxWidth=e.CANVAS_TILE_WIDTH-8,this.textboxBorder=2,this.textSize=10,this.textSegments=[],this.textIndex=0,this.characterIndex=0,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.completionTimer=0,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,void 0===i.positionX&&(this.transform.position.local.x=0),void 0===i.positionY&&(this.transform.position.local.y=e.CANVAS_TILE_HEIGHT-this.height),this.showOverlay=null===(s=i.showOverlay)||void 0===s||s,this.text=null!==(o=i.text)&&void 0!==o?o:"...",this.onComplete=null!==(n=i.onComplete)&&void 0!==n?n:Y,this.portrait=i.portrait,this.name=i.name,this.completionDuration=i.completionDuration,this.scrollText=null===(r=i.scrollText)||void 0===r||r,this.scrollSpeed=null!==(a=i.scrollSpeed)&&void 0!==a?a:48,this.initText()}initText(){this.textSegments=t.textToArray(this.text,(this.textboxWidth-4)*e.TILE_SIZE,{size:this.textSize})}onUpdate(e){void 0!==this.completionDuration?this.updateTimer(e):this.updateConfirm(),this.scrollText&&this.updateScrollText(e),this.updatePortraitAnimation(e)}onRender(e){this.showOverlay&&this.renderOverlay(e),this.hasPortrait&&this.renderPortrait(e),this.generateTextbox(e),this.hasNamePlate&&this.renderNamePlate(e),this.renderText(e)}updateTimer(e){this.completionTimer+=e,this.completionTimer>=this.completionDuration&&(this.onComplete&&this.onComplete(),this.destroy())}updateScrollText(e){this.currentText.length>this.characterIndex&&(this.characterIndex+=this.scrollSpeed*e)}updateConfirm(){if(s.isKeyPressed([_.Confirm,_.ConfirmAlt])||s.isMousePressed(i.Left)){if(this.scrollText&&this.currentText.length>this.characterIndex)return this.characterIndex=this.currentText.length,s.clearKeyPressed([_.Confirm,_.ConfirmAlt]),void s.clearMousePressed(i.Left);this.textIndex+=2,this.characterIndex=0,this.textSegments.length<=this.textIndex&&(this.onComplete&&this.onComplete(),this.destroy()),s.clearKeyPressed([_.Confirm,_.ConfirmAlt]),s.clearMousePressed(i.Left)}}renderOverlay(i){t.fillRectangle(i,0,0,e.CANVAS_WIDTH,e.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.5)"})}generateTextbox(i){let s=this.textboxWidth,o=(e.CANVAS_TILE_WIDTH-s)/2;t.renderSprite(i,m.images[C],0,0,o,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,m.images[C],0,1,o,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,m.images[C],0,1,o,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,m.images[C],0,2,o,e.CANVAS_TILE_HEIGHT-1);for(let n=1;n<s-1;n++)t.renderSprite(i,m.images[C],1,0,o+n,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,m.images[C],1,1,o+n,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,m.images[C],1,1,o+n,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,m.images[C],1,2,o+n,e.CANVAS_TILE_HEIGHT-1);t.renderSprite(i,m.images[C],2,0,o+s-1,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,m.images[C],2,1,o+s-1,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,m.images[C],2,1,o+s-1,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,m.images[C],2,2,o+s-1,e.CANVAS_TILE_HEIGHT-1)}renderText(i){if(this.textLine1){let s=this.scrollText?this.textLine1.substring(0,this.characterIndex):this.textLine1;t.renderText(i,s,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-2-.25,{size:this.textSize})}if(this.textLine2){let s=this.scrollText?this.textLine2.substring(0,this.characterIndex-this.textLine1.length):this.textLine2;t.renderText(i,s,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-1-.25,{size:this.textSize})}}renderPortrait(e){t.renderSprite(e,m.images[this.portrait.tileset],this.portrait.x,this.portrait.y,3,9,void 0,void 0,{scale:8})}renderNamePlate(i){t.fillRectangle(i,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1,e.CANVAS_TILE_HEIGHT-4,6*e.TILE_SIZE,1*e.TILE_SIZE,{colour:"#e8cfa6"}),t.renderText(i,this.name,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-3-.25,{size:this.textSize})}updatePortraitAnimation(e){this.animationTimer=(this.animationTimer+e)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}get hasPortrait(){return void 0!==this.portrait}get hasNamePlate(){return void 0!==this.name}get textLine1(){return this.textSegments[this.textIndex]}get textLine2(){return this.textSegments[this.textIndex+1]}get currentText(){let e="";return this.textLine1&&(e+=this.textLine1),this.textLine2&&(e+=this.textLine2),e}}const X={x:1,y:1},k=[S.TomatoSeeds,S.WheatSeeds];var A;!function(e){e[e.Empty=0]="Empty",e[e.Watered=1]="Watered",e[e.Growing=2]="Growing",e[e.FullyGrown=3]="FullyGrown",e[e.Spoiled=4]="Spoiled"}(A||(A={}));const j={[S.WheatSeeds]:{[A.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:0},[A.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:0},[A.Spoiled]:void 0},[S.TomatoSeeds]:{[A.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:1},[A.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:1},[A.Spoiled]:void 0}};class M extends h{constructor(e,t){super(e,t),this.scene=e,this.spriteX=X.x,this.spriteY=X.y,this.counterDry=0,this.counterGrow=0,this.counterSpoil=0,this.currentlyGrowing=void 0,this.renderer.enabled=!0,this.renderer.layer=6,this.cropStage=A.Empty,t.growing&&(this.collision.enabled=!0,this.cropStage=t.growing.stage,this.currentlyGrowing=t.growing.itemType)}onDirtPlaced(e){let t=this.scene.getObjects({position:{x:this.transform.position.world.x-1,y:this.transform.position.world.y}}),i=this.scene.getObjects({position:{x:this.transform.position.world.x+1,y:this.transform.position.world.y}}),s=(t.filter((e=>e instanceof M)).length,i.filter((e=>e instanceof M)).length,X);this.spriteX=s.x,this.spriteY=s.y}interact(){switch(this.cropStage){case A.Empty:return void this.interactStageEmpty();case A.Watered:return void this.interactStageWatered();case A.Growing:return void this.interactStageGrowing();case A.FullyGrown:return void this.interactStageFullyGrown()}}interactStageEmpty(){this.scene.globals.disable_player_inputs=!0;let e=new L(this.scene,{text:"It's a beautiful patch of dirt, brimming with potential.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageWatered(){this.scene.globals.disable_player_inputs=!0;let e=new L(this.scene,{text:"The patch of dirt is watered, better plant something before it dries up.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageGrowing(){this.scene.globals.disable_player_inputs=!0;let e=new L(this.scene,{text:"The plant is growing nicely, it will be ready for harvest soon.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageFullyGrown(){let e=!1;switch(this.currentlyGrowing){case S.TomatoSeeds:e=!!this.scene.addToInventory(S.Tomato);break;case S.WheatSeeds:e=!!this.scene.addToInventory(S.Wheat)}e&&this.destroy()}get isEmpty(){return void 0===this.currentlyGrowing}onUpdate(e){this.cropStage===A.Empty||this.cropStage===A.Watered?this.counterDry+=e:this.cropStage===A.Growing?this.counterGrow+=e:this.cropStage===A.FullyGrown&&(this.counterSpoil+=e),this.isEmpty&&this.counterDry>15?this.destroy():this.cropStage===A.Growing&&this.counterGrow>5?this.cropStage=A.FullyGrown:this.cropStage===A.FullyGrown&&this.counterSpoil>86400&&(this.cropStage=A.Spoiled)}onRender(e){this.renderDirt(e),this.renderCrop(e)}renderDirt(e){let i=(this.cropStage,A.Empty,"tileset_dirt");t.renderSprite(e,m.images[i],this.spriteX,this.spriteY,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0}),this.cropStage!==A.Empty&&t.fillRectangle(e,this.boundingBox.local.left,this.boundingBox.local.top,1,1,{colour:"#00000011",type:"tile"})}renderCrop(e){if(this.cropStage===A.Empty||this.cropStage===A.Watered)return;if(this.currentlyGrowing!==S.TomatoSeeds&&this.currentlyGrowing!==S.WheatSeeds)return;let i=j[this.currentlyGrowing][this.cropStage];void 0!==i&&t.renderSprite(e,m.images[i.tileset],i.spriteX,i.spriteY,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0})}actionWater(){this.cropStage===A.Empty&&(this.counterDry=0,this.cropStage=A.Watered)}actionPlant(){let e=this.scene.selectedInventoryItem;void 0!==e&&k.includes(e.type)&&this.cropStage===A.Watered&&(this.collision.enabled=!0,this.currentlyGrowing=e.type,this.cropStage=A.Growing,this.scene.removeFromInventoryByIndex(this.scene.globals.hotbar_selected_index,1))}}const R={[S.Chicken]:1,[S.Egg]:9,[S.WheatSeeds]:9,[S.Wheat]:9,[S.TomatoSeeds]:9,[S.Tomato]:9,[S.Hoe]:1,[S.WateringCan]:1,[S.Chest]:1},D={tileset:"tileset_ui",spriteX:15,spriteY:5},B={[S.Chicken]:{tileset:"tileset_chicken",spriteX:0,spriteY:0},[S.Egg]:{tileset:"tileset_egg",spriteX:0,spriteY:0},[S.WheatSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:0},[S.Wheat]:{tileset:"tileset_plants",spriteX:5,spriteY:0},[S.TomatoSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:1},[S.Tomato]:{tileset:"tileset_plants",spriteX:5,spriteY:1},[S.Hoe]:{tileset:"tileset_tools",spriteX:4,spriteY:4},[S.WateringCan]:{tileset:"tileset_tools",spriteX:0,spriteY:0},[S.Chest]:{tileset:"tileset_chest",spriteX:1,spriteY:1}},H=T.None,O={[S.Chicken]:T.Player,[S.Egg]:T.Player,[S.WheatSeeds]:T.Player,[S.Wheat]:T.Player,[S.TomatoSeeds]:T.Player,[S.Tomato]:T.Player,[S.Hoe]:T.Player,[S.WateringCan]:T.Player,[S.Chest]:T.Anywhere},N={[S.Chicken]:0,[S.Egg]:0,[S.WheatSeeds]:5,[S.Wheat]:10,[S.TomatoSeeds]:5,[S.Tomato]:10,[S.Hoe]:0,[S.WateringCan]:0,[S.Chest]:0};class F{constructor(e,t){var i,s,o;this.scene=e,this.type=t.type,this.maxStackSize=null!==(i=R[this.type])&&void 0!==i?i:1,this.sprite=null!==(s=B[this.type])&&void 0!==s?s:D,this.radius=null!==(o=O[this.type])&&void 0!==o?o:H,void 0!==t.currentStackSize?this.currentStackSize=t.currentStackSize>this.maxStackSize?this.maxStackSize:t.currentStackSize:this.currentStackSize=1}}class W extends h{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER+1,this.inventoryIndex=i.inventoryIndex}onUpdate(e){this.updateClicked()}onRender(e){this.renderContainer(e),this.renderItem(e),this.renderStackSize(e)}updateClicked(){void 0===this.parent.itemDraggingIndex&&s.isMousePressed()&&o.isMouseWithinObject(this)&&void 0!==this.item&&this.parent.startDraggingItem(this.inventoryIndex)}renderContainer(e){t.renderSprite(e,m.images.tileset_ui,.5,3.5,this.transform.position.world.x,this.transform.position.world.y,this.width,this.height,{centered:!0})}renderItem(e){void 0!==this.sprite&&t.renderSprite(e,m.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderStackSize(e){void 0!==this.item&&1!==this.item.maxStackSize&&t.renderText(e,`${this.item.currentStackSize}`,this.transform.position.world.x+.25,this.transform.position.world.y+.75,{size:12,colour:"black"})}get item(){return this.scene.globals.inventory[this.inventoryIndex]}get sprite(){if(void 0!==this.item)return B[this.item.type]}}class P extends h{constructor(t,i){var s;super(t,i),this.scene=t,this.config=i,this.collision.enabled=!0,this.renderer.layer=null!==(s=i.renderLayer)&&void 0!==s?s:e.FIRST_UI_RENDER_LAYER,this.renderer.enabled=!0}onRender(i){t.fillRectangle(i,this.transform.position.world.x,this.transform.position.world.y,this.width*e.TILE_SIZE,this.height*e.TILE_SIZE,{colour:this.colour})}get colour(){return this.config.hexColourCode}}class G{}var z,V;G.ArrowRight={White:{Default:{x:15,y:0},Pressed:{x:16,y:0}}},G.ArrowLeft={White:{Default:{x:15,y:1},Pressed:{x:16,y:1}}},G.ArrowUp={White:{Default:{x:15,y:2},Pressed:{x:16,y:2}}},G.ArrowDown={White:{Default:{x:15,y:3},Pressed:{x:16,y:3}}},G.CheckMark={Green:{Default:{x:15,y:4},Pressed:{x:16,y:4}}},G.Cross={Red:{Default:{x:15,y:5,width:1,height:1},Pressed:{x:16,y:5,width:1,height:1}}},G.Button={White:{Default:{x:3.5,y:.5,width:2,height:2},Pressed:{x:6.5,y:.5,width:2,height:2}}},function(e){e[e.Default=0]="Default",e[e.Down=1]="Down",e[e.Up=2]="Up"}(z||(z={}));class U extends h{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.state=z.Default,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER+1}onUpdate(e){switch(this.state){case z.Default:this.updateDefault();break;case z.Down:this.updateDown();break;case z.Up:this.updateUp()}}onRender(e){this.renderButtonContainer(e),this.renderButtonIcon(e)}updateDefault(){s.isMousePressed()&&o.isMouseWithinObject(this)&&(this.state=z.Down)}updateDown(){s.isMousePressed()||(o.isMouseWithinObject(this)?this.state=z.Up:this.state=z.Default)}updateUp(){this.parent.destroy()}renderButtonContainer(e){const i=this.state===z.Default?G.Button.White.Default:G.Button.White.Pressed;t.renderSprite(e,m.images.tileset_basic,i.x,i.y,this.transform.position.world.x,this.transform.position.world.y,i.width,i.height,{centered:!0})}renderButtonIcon(e){const i=this.state===z.Default?G.Cross.Red.Default:G.Cross.Red.Pressed;t.renderSprite(e,m.images.tileset_basic,i.x,i.y,this.transform.position.world.x,this.transform.position.world.y,i.width,i.height,{centered:!0})}}!function(e){e.Close="tab"}(V||(V={}));class Z extends h{constructor(t,i){super(t,i),this.scene=t,this.chest=void 0,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER+2,this.collision.layer=e.UI_COLLISION_LAYER,this.scene.globals.disable_player_inputs=!0,this.chest=i.chest}onAwake(){const t=[];for(let e=0;e<5;e++)for(let i=0;i<5;i++){const s=5*e+i;t.push(new W(this.scene,{positionX:2*i,positionY:2*e,inventoryIndex:s}))}t.forEach((e=>this.addChild(e))),this.addChild(new U(this.scene,{positionX:8,positionY:-2})),this.addChild(new P(this.scene,{positionX:-this.rootParent.transform.position.world.x,positionY:-this.rootParent.transform.position.world.y,hexColourCode:"#00000099",width:e.CANVAS_TILE_WIDTH,height:e.CANVAS_TILE_HEIGHT}))}onUpdate(e){this.updateDragging(),this.updateClose()}onRender(e){this.renderInventoryItemGrabbed(e)}onDestroy(){this.scene.globals.disable_player_inputs=!1,this.chest&&this.chest.actionClose()}get inventory(){return this.scene.globals.inventory}updateDragging(){if(void 0===this.itemDraggingIndex)return;if(!0===s.mouse.click.left)return;const e={position:{x:s.mouse.position.x,y:s.mouse.position.y},typeMatch:[W]},t=this.scene.getObject(e);t?(this.scene.globals.inventory[this.itemDraggingIndex]=this.scene.globals.inventory[t.inventoryIndex],this.scene.globals.inventory[t.inventoryIndex]=this.itemDragging):this.scene.globals.inventory[this.itemDraggingIndex]=this.itemDragging,this.itemDragging=void 0,this.itemDraggingIndex=void 0}updateClose(){s.isKeyPressed(V.Close)&&(s.clearKeyPressed(V.Close),this.destroy())}renderInventoryItemGrabbed(e){void 0!==this.itemDragging&&this.renderInventoryItem(e,this.itemDragging.sprite.tileset,this.itemDragging.currentStackSize,this.itemDragging.maxStackSize,this.itemDragging.sprite.spriteX,this.itemDragging.sprite.spriteY,s.mouse.position.x-.5,s.mouse.position.y-.5)}renderInventoryItem(e,i,s,o,n,r,a,h){t.renderSprite(e,m.images[i],n,r,a,h),o>1&&t.renderText(e,`${s}`,a+.75,h+1,{size:8,colour:"black"})}startDraggingItem(e){this.itemDragging=this.scene.globals.inventory[e],this.itemDraggingIndex=e,this.scene.globals.inventory[e]=void 0}}const K={tileset:"tileset_chicken",x:0,y:0},$="tileset_chest";class q extends h{constructor(e,t){super(e,t),this.scene=e,this.isOpen=!1,this.inventory=[],this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8}onRender(e){this.renderSprite(e)}interact(){this.actionOpen()}actionOpen(){this.isOpen=!0,this.scene.addObject(new Z(this.scene,{positionX:0,positionY:0,chest:this}))}actionClose(){this.isOpen=!1}renderSprite(e){this.isOpen?t.renderSprite(e,m.images[$],13,.5,this.transform.position.world.x,this.transform.position.world.y-.5,1,2,{centered:!0}):t.renderSprite(e,m.images[$],1,.5,this.transform.position.world.x,this.transform.position.world.y-.5,1,2,{centered:!0})}}class J extends h{constructor(t,i){super(t,i),this.scene=t,this.height=2,this.width=10,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,this.collision.layer=e.UI_COLLISION_LAYER}onUpdate(e){}onRender(e){!0!==this.scene.globals.disable_player_inputs&&(this.renderBackground(e),this.renderContainers(e),this.renderItems(e,this.inventory.slice(0,this.hotbarSize)),this.renderHotbarSelector(e))}renderHotbarSelector(e){const i=this.boundingBox.world.left+1+2*this.hotbarSelectedIndex,s=this.boundingBox.world.top+1;t.renderSprite(e,m.images.tileset_ui,9,9,i,s,2,2,{centered:!0})}renderBackground(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"saddlebrown",type:"tile"})}renderContainers(e){for(let i=0;i<5;i++)t.renderSprite(e,m.images.tileset_ui,.5,3.5,this.boundingBox.world.left+1+2*i,this.boundingBox.world.top+1,2,2,{centered:!0})}renderItems(e,t){for(let i=0;i<5;i++){let s=t[i];void 0!==s&&this.renderInventoryItem(e,s.sprite.tileset,s.currentStackSize,s.maxStackSize,s.sprite.spriteX,s.sprite.spriteY,this.boundingBox.world.left+1+2*i,this.boundingBox.world.top+1)}}renderInventoryItem(e,i,s,o,n,r,a,h){t.renderSprite(e,m.images[i],n,r,a,h,1,1,{centered:!0}),o>1&&t.renderText(e,`${s}`,a+.75,h+1,{size:8,colour:"black"})}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}get hotbarSize(){return this.scene.globals.hotbar_size}get hotbarSelectedIndex(){return this.scene.globals.hotbar_selected_index}}var Q,ee;!function(e){e.UP="w",e.DOWN="s",e.LEFT="a",e.RIGHT="d"}(Q||(Q={})),function(e){e.Inventory="tab",e.Interact="e",e.InteractAlt=" "}(ee||(ee={}));class te extends h{constructor(e,t){super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.movementSpeed=4,this.animations={[Q.RIGHT]:[{x:7,y:10},{x:10,y:10}],[Q.LEFT]:[{x:7,y:7},{x:10,y:7}],[Q.UP]:[{x:7,y:4},{x:10,y:4}],[Q.DOWN]:[{x:7,y:1},{x:10,y:1}]},this.animationsIdle={[Q.RIGHT]:[{x:1,y:10},{x:4,y:10}],[Q.LEFT]:[{x:1,y:7},{x:4,y:7}],[Q.UP]:[{x:1,y:4},{x:4,y:4}],[Q.DOWN]:[{x:1,y:1},{x:4,y:1}]},this.hotbar=void 0,this.direction=Q.DOWN,this.directionTime=0,this.directionTimer=0,this.animationIndex=0,this.isIdle=!0,this.movementEnabled=!1,this.hotbarEnabled=!1,this.leftClickEnabled=!1,this.inventoryEnabled=!1,this.interactButtonEnabled=!1,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=10,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.enableMovement(),this.enableInteractKeys(),this.enableInventoryKeys(),this.enableOtherKeys()}enableMovement(){this.movementEnabled=!0}enableOtherKeys(){this.hotbarEnabled=!0,this.leftClickEnabled=!0}enableInventoryKeys(){this.inventoryEnabled=!0}enableInteractKeys(){this.interactButtonEnabled=!0}onAwake(){this.addHotbar()}onUpdate(e){this.updateMovement(e),this.updateAnimations(e),this.updateHotbarViaKey(),this.updateHotbarViaWheel(),this.updateLeftClick(),this.updateButtonInteract(),this.updateOpenInventory(),this.latestScrollTimestamp=s.mouse.wheel.event.timeStamp}onRender(e){this.renderSprite(e),this.renderCursor(e)}updateMovement(e){!0!==this.scene.globals.disable_player_inputs&&!1!==this.movementEnabled&&(this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){if(this.targetX!==this.transform.position.world.x||this.targetY!==this.transform.position.world.y)return;if(!s.isKeyPressed([Q.RIGHT,Q.LEFT,Q.UP,Q.DOWN]))return;let t,i=new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY);if(s.isKeyPressed(Q.RIGHT)?(i.targetX+=1,t=Q.RIGHT):s.isKeyPressed(Q.LEFT)?(i.targetX-=1,t=Q.LEFT):s.isKeyPressed(Q.UP)?(i.targetY-=1,t=Q.UP):s.isKeyPressed(Q.DOWN)&&(i.targetY+=1,t=Q.DOWN),this.direction!==t?(this.direction=t,this.directionTime=0,this.directionTimer=0):this.directionTimer+=e,this.directionTimer<.05)return;const o={boundingBox:h.calculateBoundingBox(i.target.x,i.target.y,this.width,this.height),objectIgnore:new Map([[this,!0]])};this.scene.getObject(o)||this.scene.isOutOfBounds(i.targetX,i.targetY)||(this.targetX=i.targetX,this.targetY=i.targetY)}updateAnimations(e){this.targetX!==this.transform.position.world.x||this.targetY!==this.transform.position.world.y?this.isIdle=!1:this.isIdle=!0,this.isIdle?this.directionTime<.5?this.animationIndex=0:this.animationIndex=1:this.directionTime<.25?this.animationIndex=0:this.directionTime<.5?this.animationIndex=1:this.directionTime<.75?this.animationIndex=0:this.animationIndex=1,this.directionTime=(this.directionTime+e)%1}processMovement(e){if(this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y){let t=new w(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=x.moveTowardsPosition(t,x.frameSpeed(this.movementSpeed,e));this.transform.position.local.x=i.positionX,this.transform.position.local.y=i.positionY}}updateButtonInteract(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.interactButtonEnabled)return;if(!s.isKeyPressed([ee.Interact,ee.InteractAlt]))return;s.clearKeyPressed([ee.Interact,ee.InteractAlt]);let e=this.transform.position.world.x,t=this.transform.position.world.y;switch(this.direction){case Q.UP:t-=1;break;case Q.RIGHT:e+=1;break;case Q.DOWN:t+=1;break;case Q.LEFT:e-=1}const i={position:{x:e,y:t},objectIgnore:new Map([[this,!0]])};let o=this.scene.getObject(i);void 0!==o&&function(e){return"interact"in e}(o)&&o.interact()}getPositionFacing(){let e=Math.floor(this.transform.position.world.x),t=Math.floor(this.transform.position.world.y);return this.direction===Q.RIGHT?{x:e+1,y:t}:this.direction===Q.LEFT?{x:e-1,y:t}:this.direction===Q.UP?{x:e,y:t-1}:this.direction===Q.DOWN?{x:e,y:t+1}:void 0}updateHotbarViaKey(){!0!==this.scene.globals.disable_player_inputs&&!1!==this.hotbarEnabled&&(!0!==s.isKeyPressed("1")?!0!==s.isKeyPressed("2")?!0!==s.isKeyPressed("3")?!0!==s.isKeyPressed("4")?!0!==s.isKeyPressed("5")||(this.scene.globals.hotbar_selected_index=4):this.scene.globals.hotbar_selected_index=3:this.scene.globals.hotbar_selected_index=2:this.scene.globals.hotbar_selected_index=1:this.scene.globals.hotbar_selected_index=0)}updateHotbarViaWheel(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.hotbarEnabled)return;if(this.latestScrollTimestamp===s.mouse.wheel.event.timeStamp)return;const e=this.scene.globals.hotbar_selected_index;s.mouse.wheel.event.deltaY>0?e===this.scene.globals.hotbar_size-1?this.scene.globals.hotbar_selected_index=0:this.scene.globals.hotbar_selected_index++:s.mouse.wheel.event.deltaY<0&&(0===e?this.scene.globals.hotbar_selected_index=this.scene.globals.hotbar_size-1:this.scene.globals.hotbar_selected_index--)}updateOpenInventory(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.inventoryEnabled)return;let e=[ee.Inventory];!1!==s.isKeyPressed(e)&&(this.scene.addObject(new Z(this.scene,{positionX:12,positionY:5})),s.clearKeyPressed(e))}updateLeftClick(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.leftClickEnabled)return;if(!s.isMousePressed(i.Left))return;s.clearMousePressed(i.Left);const e=this.scene.selectedInventoryItem;if(void 0===e)return;if(e.radius===T.None)return;const t=Math.round(s.mouse.position.x+this.scene.globals.camera.startX),o=Math.round(s.mouse.position.y+this.scene.globals.camera.startY);if(e.radius===T.Player&&Math.abs(t-this.transform.position.world.roundedX)>1||Math.abs(o-this.transform.position.world.roundedY)>1)return;const n={position:{x:t,y:o}},r=this.scene.getObject(n);if(void 0===r)switch(e.type){case S.Hoe:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),o=new M(e,{positionX:t,positionY:i});e.addObject(o)}(this.scene);case S.WateringCan:return void function(e){e.globals.disable_player_inputs=!0;const t=new L(e,{text:"There is nothing to water...",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(t)}(this.scene);case S.Chicken:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),o=new oe(e,{positionX:t,positionY:i});e.addObject(o),e.removeFromInventoryByIndex(e.selectedInventoryIndex,1)}(this.scene);case S.Egg:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),o=new ie(e,{positionX:t,positionY:i});e.addObject(o),e.removeFromInventoryByIndex(e.selectedInventoryIndex,1)}(this.scene);case S.TomatoSeeds:case S.WheatSeeds:return void function(e){e.globals.disable_player_inputs=!0;const t=new L(e,{text:"Seeds can only be placed in watered dirt.",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(t)}(this.scene);case S.Chest:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),o=new q(e,{positionX:t,positionY:i});e.addObject(o),e.removeFromInventoryByIndex(e.selectedInventoryIndex,1)}(this.scene);default:return}else switch(e.type){case S.WateringCan:switch(!0){case r instanceof M:return void function(e,t){t.actionWater()}(this.scene,r);case r instanceof oe:return void function(e,t){e.globals.disable_player_inputs=!0;const i=new L(e,{text:"Hey could you not water me please...",portrait:K,name:"Chicken",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(i)}(this.scene);default:return}case S.TomatoSeeds:case S.WheatSeeds:return 1==r instanceof M?void function(e,t){if(t.cropStage===A.Watered)t.actionPlant();else{e.globals.disable_player_inputs=!0;const t=new L(e,{text:"Seeds can only be placed in watered dirt.",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(t)}}(this.scene,r):void 0;case S.Tomato:case S.Wheat:return 1==r instanceof oe?void function(e,t){t.actionGiveItem()}(this.scene,r):void 0;default:return}}renderSprite(e){let i=this.isIdle?this.animationsIdle:this.animations;t.renderSprite(e,m.images.tileset_player,i[this.direction][this.animationIndex].x,i[this.direction][this.animationIndex].y,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderCursor(e){if(!0===this.scene.globals.disable_player_inputs)return;if(!this.leftClickEnabled)return;let i=Math.round(s.mouse.position.x+this.scene.globals.camera.startX),o=Math.round(s.mouse.position.y+this.scene.globals.camera.startY),n=this.scene.selectedInventoryItem;void 0!==n&&n.radius!==T.None&&(i===this.transform.position.world.roundedX&&o===this.transform.position.world.roundedY||n.radius===T.Player&&Math.abs(i-this.transform.position.world.roundedX)>1||Math.abs(o-this.transform.position.world.roundedY)>1||t.fillRectangle(e,i-.5,o-.5,1,1,{colour:"#0000ff33",type:"tile"}))}addHotbar(){this.hotbar||(this.hotbar=new J(this.scene,{positionX:16,positionY:16}),this.scene.addObject(this.hotbar))}removeHotbar(){void 0!==this.hotbar&&this.hotbar.destroy()}}class ie extends h{constructor(e,t){super(e,t),this.scene=e,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.hatchTimer=0,this.hatchTimerMax=7,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=7}onUpdate(e){this.updateAnimation(e),this.updateHatch(e)}onRender(e){t.renderSprite(e,m.images.tileset_egg,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0})}updateAnimation(e){this.animationTimer=(this.animationTimer+e)%1,this.animationIndex=0}updateHatch(e){if(this.hatchTimer+=e,this.hatchTimer<this.hatchTimerMax)return;const t=this.scene.getObject({typeMatch:[te]}),i=new oe(this.scene,{positionX:this.transform.position.world.x,positionY:this.transform.position.world.y,follows:t});this.destroy(),this.scene.addObject(i)}interact(){void 0!==this.scene.addToInventory(S.Egg)&&this.destroy()}}const se={tileset:"tileset_chicken",x:0,y:0};class oe extends h{constructor(e,t){var i,s;super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=f.randomStartingDelta(4),this.animationIndex=0,this.movementSpeed=2,this.movementTimer=f.randomStartingDelta(2),this.movementDelay=2,this.eggTimer=f.randomStartingDelta(2),this.eggTimerMax=7,this.eggMax=200,this.isMovingThisFrame=!1,this.isEdgyTeen=!1,this.interactionCount=0,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.canLayEggs=null!==(i=t.canLayEggs)&&void 0!==i&&i,this.isEdgyTeen=3===f.randomIntFromRange(0,3),this.canMove=null!==(s=t.canMove)&&void 0!==s&&s,this.following=t.follows,console.log(this.onRender)}onUpdate(e){this.isMovingThisFrame=!1,this.updateMovement(e),this.updateAnimation(e),this.updateEgg(e)}onRender(e){t.renderSprite(e,m.images.tileset_chicken,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}updateAnimation(e){this.animationTimer=(this.animationTimer+e)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}updateMovement(e){this.canMove&&(this.movementTimer+=e,this.movementTimer>this.movementDelay&&this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){let t;this.movementTimer=0,t=this.following?x.moveTowardsOtherEntity(new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY),{positionX:this.following.transform.position.world.x,positionY:this.following.transform.position.world.y}):x.moveInRandomDirection(new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY));const i={position:{x:t.targetX,y:t.targetY},objectIgnore:new Map([[this,!0]])};this.scene.getObject(i)||this.scene.isOutOfBounds(t.targetX,t.targetY)||(this.targetX=t.targetX,this.targetY=t.targetY)}processMovement(e){if(this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y){let t=new w(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=x.moveTowardsPosition(t,x.frameSpeed(this.movementSpeed,e));this.transform.position.local.x=i.positionX,this.transform.position.local.y=i.positionY,this.isMovingThisFrame=!0}}updateEgg(e){if(!this.canLayEggs)return;if(this.eggTimer+=e,this.eggTimer<this.eggTimerMax)return;if(!this.isMovingThisFrame)return;if(this.scene.getObjects({typeMatch:[oe,ie]}).length>this.eggMax)return;let t;t=this.transform.position.world.x>this.targetX||this.transform.position.world.y>this.targetY?Math.ceil:Math.floor,this.scene.addObject(new ie(this.scene,{positionX:t(this.transform.position.world.x),positionY:t(this.transform.position.world.y)})),this.eggTimer=0}interact(){this.interactDefault()}interactDefault(){this.scene.globals.disable_player_inputs=!0;let e="";if(this.isEdgyTeen)switch(this.interactionCount%3){case 0:e="GET OUT OF MY ROOM MOM! GODDDD!!1!";break;case 1:e="UGHHHH! YOU ARE LIKE SO EMBARRASSING!1!11!";break;case 2:e="OMG!1!1 JUST LIKE LEAVE ME ALONE!1!11!!"}else switch(this.interactionCount%3){case 0:e="bock bock ... can i help you? ... cluck cluck ...";break;case 1:e="cluck cluck ... you're sort of annoying you know that? ... bock bock ...";break;case 2:e="bock cluck ... is... is this a simulation? ... cluck bock ..."}let t=new L(this.scene,{text:e,portrait:se,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(t),this.interactionCount++}actionGiveItem(){switch(this.scene.selectedInventoryItem.type){case S.Tomato:return void this.actionGiveTomato();case S.Wheat:return void this.actionGiveWheat()}}actionGiveTomato(){this.scene.globals.disable_player_inputs=!0;let e=new L(this.scene,{text:"I LOooOooOoOooOoOVE TOMATOES!",portrait:se,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}),t=this.scene.globals.inventory.indexOf(this.scene.selectedInventoryItem);this.scene.removeFromInventoryByIndex(t,1),this.scene.addObject(e)}actionGiveWheat(){this.scene.globals.disable_player_inputs=!0;let e=new L(this.scene,{text:"I HAAAAAAAAAAAAAAAATE WHEAT!",portrait:se,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(e)}}const ne={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},re=[ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne],ae={index:0,tiles:[[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re],[...re]]},he={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},le={...he,animationFrames:[{spriteX:2,spriteY:1}]},de={...he,animationFrames:[{spriteX:1,spriteY:2}]},ce={...he,animationFrames:[{spriteX:2,spriteY:2}]},pe={...he,animationFrames:[{spriteX:5,spriteY:1}]},ge={index:1,tiles:[[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,pe,le,le,le,le,le,le,ce],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,pe,le,le,le,ce],[void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,de],[void 0,void 0,void 0,void 0,de],[le,le,le,le,ce]]};class ue extends h{constructor(e,t){super(e,t),this.scene=e,this.collision.enabled=!0}}const me={tileset:"tileset_grass",animationFrameDuration:1,animationFrames:[],animationMap:[1]},be={...me,animationFrames:[{spriteX:1,spriteY:1}]},ye={...me,animationFrames:[{spriteX:2,spriteY:1}]},ve=[be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,be,{...me,animationFrames:[{spriteX:1,spriteY:2}]}],fe={index:1,tiles:[ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,ve,[ye,ye,ye,ye,ye,ye,ye,ye,ye,ye,ye,ye,ye,ye,ye,ye,ye,ye,{...me,animationFrames:[{spriteX:2,spriteY:2}]}]]};class we{constructor(e,t){this.tileset=e,this.frames=t,this.duration=t.reduce(((e,t)=>e+t.duration),0)}currentFrame(e){let t=e%this.duration,i=0;for(let e=0;e<this.frames.length;e++)if(i+=this.frames[e].duration,t<i)return this.frames[e];return this.frames[0]}}const xe={tileset:"tileset_chicken",x:0,y:0},Ie={idle:new we("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}]),moving:new we("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}])};class Ee extends h{constructor(e,t){var i,s,o,n,r;super(e,t),this.scene=e,this.state="idle",this.targetX=-1,this.targetY=-1,this.animation={index:0,timer:0},this.movementTimer=f.randomStartingDelta(2),this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.canMove=null!==(i=t.canMove)&&void 0!==i&&i,this.following=t.follows,this.dialogue=t.dialogue,this.animations=null!==(s=t.animations)&&void 0!==s?s:Ie,this.movementSpeed=null!==(o=t.movementSpeed)&&void 0!==o?o:2,this.movementDelay=null!==(n=t.movementDelay)&&void 0!==n?n:void 0,this.name=null!==(r=t.name)&&void 0!==r?r:"???"}onUpdate(e){this.updateMovement(e),this.updateAnimationTimer(e)}onRender(e){let i=this.animations[this.state],s=i.currentFrame(this.animation.timer);t.renderSprite(e,m.images[i.tileset],s.spriteX,s.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{opacity:this.renderer.opacity,scale:this.renderer.scale,centered:!0})}updateAnimationTimer(e){this.animation.timer=(this.animation.timer+e)%this.animations[this.state].duration}updateMovement(e){this.canMove&&(this.movementTimer+=e,(void 0===this.movementDelay&&this.movementTimer>this.movementSpeed||this.movementTimer>this.movementDelay)&&this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){let t;this.movementTimer=0,t=this.following?x.moveTowardsOtherEntity(new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY),{positionX:this.following.transform.position.world.x,positionY:this.following.transform.position.world.y}):x.moveInRandomDirection(new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY));const i={position:{x:t.targetX,y:t.targetY},objectIgnore:new Map([[this,!0]])};this.scene.getObject(i)||this.scene.isOutOfBounds(t.targetX,t.targetY)||(this.targetX=t.targetX,this.targetY=t.targetY)}processMovement(e){if(this.targetX!==this.transform.position.world.x||this.targetY!==this.transform.position.world.y){let t=new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY),i=x.moveTowardsPosition(t,x.frameSpeed(this.movementSpeed,e));this.transform.position.world.x=i.positionX,this.transform.position.world.y=i.positionY}}interact(){if(void 0===this.dialogue)return;let e=new L(this.scene,{text:this.dialogue,portrait:xe,name:this.name});this.scene.addObject(e)}}class Se extends h{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,this.price=i.price,this.type=i.type}onUpdate(e){this.updateClicked()}onRender(e){this.renderContainer(e),this.renderItem(e),this.renderPrice(e)}updateClicked(){s.isMousePressed()&&o.isMouseWithinObject(this)&&(s.clearMousePressed(i.Left),this.price>this.scene.globals.gold||(this.scene.addToInventory(this.type)&&(this.scene.globals.gold-=this.price),this.parent.refreshShopState()))}renderContainer(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"white",type:"tile"})}renderItem(e){t.renderSprite(e,m.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderPrice(e){t.renderText(e,`$${this.price}`,this.transform.position.world.x,this.transform.position.world.y+1,{size:12,colour:"black",font:"MS Gothic"})}get sprite(){return B[this.type]}}class Te extends h{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,this.type=i.type,this.count=i.count,this.index=i.index}onUpdate(e){this.updateClicked()}onRender(e){this.renderContainer(e),this.renderItem(e),this.renderPrice(e),this.renderStackSize(e)}get price(){return N[this.type]}updateClicked(){s.isMousePressed()&&o.isMouseWithinObject(this)&&(s.clearMousePressed(i.Left),this.scene.globals.gold+=this.price,this.scene.removeFromInventoryByIndex(this.index,1),this.parent.refreshShopState())}renderContainer(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"white",type:"tile"})}renderItem(e){t.renderSprite(e,m.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderPrice(e){t.renderText(e,`$${this.price}`,this.transform.position.world.x-1,this.transform.position.world.y,{size:12,colour:"black",font:"MS Gothic"})}renderStackSize(e){t.renderText(e,`${this.count}`,this.transform.position.world.x,this.transform.position.world.y+1,{size:12,colour:"black",font:"MS Gothic"})}get sprite(){return B[this.type]}}var _e;!function(e){e.Close="tab"}(_e||(_e={}));const Ce=[{type:S.TomatoSeeds,price:5},{type:S.WheatSeeds,price:5},{type:S.Hoe,price:50},{type:S.WateringCan,price:50}];class Ye extends h{constructor(t,i){super(t,i),this.scene=t,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,this.collision.layer=e.UI_COLLISION_LAYER,this.onLeave=i.onLeave}onAwake(){this.refreshShopState()}onUpdate(e){this.updateButtonClose(),this.updateClickClose()}onRender(e){this.renderBackground(e),this.renderShopBackground(e),this.renderShopTitle(e),this.renderInventoryBackground(e),this.renderInventoryTitle(e),this.renderTotalGold(e),this.renderLeaveButton(e)}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}updateButtonClose(){s.isKeyPressed(_e.Close)&&(s.clearKeyPressed(_e.Close),this.close())}updateClickClose(){s.isMousePressed(i.Left)&&o.isMouseWithinBoundary(s.mouse.position,21.5,12,4.5,1.5)&&(s.clearMousePressed(i.Left),this.close())}close(){this.destroy(),this.onLeave&&this.onLeave()}renderBackground(e){t.fillRectangle(e,0,0,32,18,{colour:"#00000055",type:"tile"})}renderShopBackground(e){t.fillRectangle(e,1,1,14,10,{colour:"brown",type:"tile"})}renderShopTitle(e){t.fillRectangle(e,4,.25,8,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,"Shop (buy)",6,1.25,{size:12,colour:"black",font:"MS Gothic"})}renderInventoryBackground(e){t.fillRectangle(e,17,1,14,11.75,{colour:"brown",type:"tile"})}renderInventoryTitle(e){t.fillRectangle(e,20,.25,8,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,"Inventory (sell)",21,1.25,{size:12,colour:"black",font:"MS Gothic"})}renderTotalGold(e){t.fillRectangle(e,26.5,12,4.5,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,`Gold: ${this.scene.globals.gold}`,27,13,{size:12,colour:"black",font:"MS Gothic"})}renderLeaveButton(e){t.fillRectangle(e,21.5,12,4.5,1.5,{colour:"grey",type:"tile"}),t.renderText(e,"Leave",22.5,13,{size:12,colour:"black",font:"MS Gothic"})}refreshShopState(){this.removeAllChildren();for(let e=0;e<Ce.length;e++){const t=Ce[e],i=new Se(this.scene,{positionX:this.transform.position.world.x+3+2.5*e,positionY:this.transform.position.world.y+3,price:t.price,type:t.type});this.addChild(i)}const e=this.scene.globals.hotbar_size;for(let t=0;t<5;t++)for(let i=0;i<4;i++){const s=t+5*i+e,o=this.inventory[s];if(void 0===o)continue;const n=new Te(this.scene,{positionX:this.transform.position.world.x+19+2.5*t,positionY:this.transform.position.world.y+3+2.5*i,type:o.type,count:o.currentStackSize,index:s});this.addChild(n)}}}const Le={tileset:"tileset_player",x:1,y:1},Xe={idle:new we("tileset_player",[{spriteX:1,spriteY:1,duration:.5},{spriteX:4,spriteY:1,duration:.5}]),moving:new we("tileset_player",[])};class ke extends Ee{constructor(e,t){t.animations=Xe,super(e,t),this.scene=e,this.firstConversation=!0}onUpdate(e){super.onUpdate(e)}interact(){this.scene.globals.disable_player_inputs=!0,this.firstConversation?this.startStageFirstConversation():this.startStageGreeting()}startStageFirstConversation(){this.scene.addObject(new L(this.scene,{text:"Hi, I don't think we've met. I'm the shop keeper. I have farming supplies for sale and will buy most things you grow.",portrait:Le,name:"???",onComplete:()=>{this.firstConversation=!1,this.startStageGreeting()}}))}startStageGreeting(){this.scene.globals.disable_player_inputs=!0,this.scene.addObject(new L(this.scene,{text:"Welcome to my shop, how can I help?",portrait:Le,name:"Shopkeeper",onComplete:()=>{this.scene.addObject(new Ye(this.scene,{positionX:0,positionY:0,onLeave:this.leaveShopCallback}))}}))}leaveShopCallback(){this.scene.addObject(new L(this.scene,{text:"Thanks, come again any time!",portrait:Le,name:"Shopkeeper",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}))}}class Ae{}Ae.TopLeft={x:1,y:0},Ae.TopRight={x:3,y:0},Ae.BottomLeft={x:1,y:2},Ae.BottomRight={x:3,y:2},Ae.LeftHorizontal={x:1,y:3},Ae.MiddleHorizontal={x:2,y:3},Ae.RightHorizontal={x:3,y:3},Ae.TopVertical={x:0,y:0},Ae.MiddleVertical={x:0,y:1},Ae.BottomVertical={x:0,y:2},Ae.FencePost={x:0,y:3},Ae.Open={x:.5,y:3};class je extends h{constructor(e,t){super(e,t),this.scene=e,this.type=Ae.FencePost,this.open=!1,this.collision.enabled=!0,this.renderer.enabled=!0,t.type&&(this.type=t.type)}onRender(e){t.renderSprite(e,m.images.tileset_fence,this.open?Ae.Open.x:this.type.x,this.open?Ae.Open.y:this.type.y,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0})}interact(){}}const Me=e.CANVAS_TILE_WIDTH/2,Re=e.CANVAS_TILE_HEIGHT/2;class De extends h{constructor(t,i){var s,o,n,r,a;super(t,i),this.scene=t,this.animationTimer=0,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,this.animationType=null!==(s=i.animationType)&&void 0!==s?s:"block",this.animationDirection=null!==(o=i.animationDirection)&&void 0!==o?o:"in",this.animationLength=null!==(n=i.animationLength)&&void 0!==n?n:1,this.animationCenterX=null!==(r=i.animationCenterX)&&void 0!==r?r:Me,this.animationCenterY=null!==(a=i.animationCenterY)&&void 0!==a?a:Re}onUpdate(e){this.animationTimer+=e,this.animationTimer>this.animationLength&&this.destroy()}get animationPercentage(){return this.animationTimer/this.animationLength}onRender(e){switch(this.animationType){case"block":this.renderAnimationBlock(e);break;case"circle":this.renderAnimationCircle(e)}}renderAnimationBlock(i){let s="in"===this.animationDirection?1-this.animationPercentage:this.animationPercentage;t.fillRectangle(i,0,0,e.CANVAS_WIDTH,e.CANVAS_HEIGHT,{colour:`rgba(0, 0, 0, ${s})`})}renderAnimationCircle(t){let i="in"===this.animationDirection?this.animationPercentage:1-this.animationPercentage,s=this.animationCenterX-this.scene.globals.camera.startX,o=this.animationCenterY-this.scene.globals.camera.startY;t.fillStyle="black",t.beginPath(),t.arc(s*e.TILE_SIZE,o*e.TILE_SIZE,e.CANVAS_WIDTH*i,0,2*Math.PI),t.rect(e.CANVAS_WIDTH,0,-1*e.CANVAS_WIDTH,e.CANVAS_HEIGHT),t.fill()}}const Be={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},He={...Be,animationFrames:[{spriteX:9.5,spriteY:4}]},Oe={...Be,animationFrames:[{spriteX:10.5,spriteY:4}]},Ne={...Be,animationFrames:[{spriteX:8.5,spriteY:5}]},Fe={...Be,animationFrames:[{spriteX:9.5,spriteY:5}]},We={...Be,animationFrames:[{spriteX:10.5,spriteY:5}]},Pe={index:1,tiles:[[],[],[],[],[],[],[],[],[],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ne,{...Be,animationFrames:[{spriteX:8.5,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,He,Fe,{...Be,animationFrames:[{spriteX:9.5,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,Oe,We,{...Be,animationFrames:[{spriteX:10.5,spriteY:6}]}],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]},Ge=()=>{};class ze extends h{constructor(e,t){var i,s;super(e,t),this.scene=e,this.timer=0,this.intervalsComplete=0,this.duration=null!==(i=t.duration)&&void 0!==i?i:1,this.onInterval=null!==(s=t.onInterval)&&void 0!==s?s:Ge,this.maxIntervals=t.maxIntervals}onUpdate(e){this.timer+=e,this.timer>=this.duration&&(this.onInterval(),this.timer-=this.duration,this.intervalsComplete++,this.maxIntervals&&this.intervalsComplete>=this.maxIntervals&&this.destroy())}}class Ve extends h{constructor(t,i){super(t,i),this.scene=t,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER}onUpdate(e){o.wasObjectClicked(this)&&(s.clearMousePressed(i.Left),document.fullscreenElement||document.webkitIsFullScreen?document.exitFullscreen():this.scene.displayContext.canvas.requestFullscreen().then((()=>{})).catch((e=>{throw new Error(e)})))}onRender(e){t.renderSprite(e,m.images.tileset_fullscreen,this.isFullscreen?1:0,0,this.boundingBox.world.left,this.boundingBox.world.top)}get isFullscreen(){return!(!document.fullscreenElement&&!document.webkitIsFullScreen)}}class Ue extends h{constructor(i,s){var o;super(i,s),this.scene=i,this.customerRenderer=i=>{const s=this.cameraOffsetX/this.zoom,o=this.cameraOffsetY/this.zoom;let n=this.object.transform.position.world.x-s,r=this.object.transform.position.world.y-o,a=this.object.transform.position.world.x+(s+1),h=this.object.transform.position.world.y+(o+1);n<0?(n=0,a=n+e.CANVAS_TILE_WIDTH):a>this.scene.map.width&&(a=this.scene.map.width,n=a-e.CANVAS_TILE_WIDTH),r<0?(r=0,h=r+e.CANVAS_TILE_HEIGHT):h>this.scene.map.height&&(h=this.scene.map.height,r=h-e.CANVAS_TILE_HEIGHT),this.scene.globals.camera.startX=n,this.scene.globals.camera.startY=r,this.scene.globals.camera.endX=a,this.scene.globals.camera.endY=h,i.background.forEach((e=>{t.renderSubsection(e,this.mainContext,n,r,a,h)})),i.objects.forEach(((i,s)=>{s>=e.FIRST_UI_RENDER_LAYER?t.renderSubsection(i,this.mainContext,0,0,e.CANVAS_TILE_WIDTH,e.CANVAS_TILE_HEIGHT):t.renderSubsection(i,this.mainContext,n,r,a,h)}))},this.cameraOffsetX=e.CANVAS_TILE_WIDTH/2-.5,this.cameraOffsetY=e.CANVAS_TILE_HEIGHT/2-.5,this.object=s.object,this.zoom=null!==(o=s.zoom)&&void 0!==o?o:1,this.scene.setCustomRenderer(this.customerRenderer)}onDestroy(){this.scene.removeCustomerRenderer()}}class Ze extends n{constructor(e){super(e),this.scene=e,this.height=100,this.width=100,this.backgroundLayers=[ae,fe,ge,Pe],this.objects=[],o.setCursor(this.scene.displayContext.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.objects.push(new Ve(e,{positionX:31,positionY:1}));let t=new te(e,{positionX:10,positionY:9});this.objects.push(t),this.objects.push(new ke(e,{positionX:10,positionY:10})),this.objects.push(new oe(e,{positionX:10,positionY:13,follows:t,canLayEggs:!0,canMove:!0}));for(let t=0;t<4;t++)for(let i=0;i<16;i++)this.objects.push(new M(e,{positionX:2+i,positionY:2+t,growing:{stage:A.FullyGrown,itemType:S.WheatSeeds}}));for(let t=0;t<6;t++)for(let i=0;i<3;i++)this.objects.push(new M(e,{positionX:6+i,positionY:10+t,growing:{stage:A.FullyGrown,itemType:S.WheatSeeds}}));for(let t=0;t<4;t++)for(let i=0;i<4;i++)this.objects.push(new M(e,{positionX:21+i,positionY:6+t,growing:{stage:A.FullyGrown,itemType:S.WheatSeeds}}));for(let t=0;t<6;t++)for(let i=0;i<13;i++)this.objects.push(new M(e,{positionX:12+i,positionY:10+t,growing:{stage:A.FullyGrown,itemType:S.WheatSeeds}}));for(let t=0;t<8;t++)for(let i=0;i<1;i++){let s=7===t||0===t?Ae.FencePost:Ae.MiddleVertical;this.objects.push(new je(e,{positionX:4+i,positionY:7+t,type:s}))}for(let t=0;t<19;t++)for(let i=0;i<1;i++){let i=18===t?Ae.FencePost:Ae.MiddleVertical;this.objects.push(new je(e,{positionX:27,positionY:0+t,type:i}))}for(let t=0;t<1;t++)for(let t=0;t<28;t++){let i=27===t?Ae.BottomRight:Ae.MiddleHorizontal;this.objects.push(new je(e,{positionX:0+t,positionY:18,type:i}))}this.objects.push(new je(e,{positionX:25,positionY:0,type:Ae.MiddleVertical}),new je(e,{positionX:26,positionY:0,type:Ae.FencePost})),this.objects.push(new je(e,{positionX:25,positionY:2,type:Ae.MiddleVertical})),this.objects.push(new je(e,{positionX:25,positionY:1,type:Ae.MiddleVertical})),this.objects.push(new je(e,{positionX:19,positionY:3,type:Ae.TopLeft}),new je(e,{positionX:20,positionY:3,type:Ae.MiddleHorizontal}),new je(e,{positionX:21,positionY:3,type:Ae.MiddleHorizontal}),new je(e,{positionX:22,positionY:3,type:Ae.MiddleHorizontal}),new je(e,{positionX:23,positionY:3,type:Ae.MiddleHorizontal}),new je(e,{positionX:24,positionY:3,type:Ae.MiddleHorizontal}),new je(e,{positionX:25,positionY:3,type:Ae.BottomRight})),this.objects.push(new je(e,{positionX:19,positionY:4,type:Ae.MiddleVertical})),this.objects.push(new je(e,{positionX:19,positionY:5,type:Ae.MiddleVertical})),this.objects.push(new je(e,{positionX:19,positionY:6,type:Ae.MiddleVertical})),this.objects.push(new je(e,{positionX:4,positionY:7,type:Ae.TopLeft}),new je(e,{positionX:5,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:6,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:7,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:8,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:9,positionY:7,type:Ae.RightHorizontal}),new je(e,{positionX:11,positionY:7,type:Ae.LeftHorizontal}),new je(e,{positionX:12,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:13,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:14,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:15,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:16,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:17,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:18,positionY:7,type:Ae.MiddleHorizontal}),new je(e,{positionX:19,positionY:7,type:Ae.BottomRight})),this.objects.push(),this.objects.push(),this.objects.push(),this.objects.push(),this.objects.push(),this.objects.push(),this.objects.push(new je(e,{positionX:0,positionY:14,type:Ae.MiddleHorizontal}),new je(e,{positionX:1,positionY:14,type:Ae.MiddleHorizontal}),new je(e,{positionX:2,positionY:14,type:Ae.MiddleHorizontal}),new je(e,{positionX:3,positionY:14,type:Ae.MiddleHorizontal})),this.objects.push(),this.objects.push(new je(e,{positionX:0,positionY:16,type:Ae.FencePost})),this.objects.push(new je(e,{positionX:0,positionY:17,type:Ae.FencePost})),this.objects.push(new je(e,{positionX:0,positionY:18,type:Ae.FencePost})),this.objects.push(),this.objects.push(),this.objects.push(new ue(e,{positionX:25,positionY:1.5,height:4})),this.objects.push(new ue(e,{positionX:19,positionY:5.5,height:4})),this.objects.push(new ue(e,{positionX:22.5,positionY:4,width:6})),this.objects.push(new ue(e,{positionX:6.5,positionY:8,width:6})),this.objects.push(new ue(e,{positionX:15,positionY:8,width:9})),this.objects.push(new ue(e,{positionX:4,positionY:11.5,height:6})),this.objects.push(new ue(e,{positionX:2.25,positionY:15,width:4.5})),this.objects.push(new Ue(e,{object:t})),this.objects.push(new De(e,{animationCenterX:t.transform.position.world.x,animationCenterY:t.transform.position.world.y,animationType:"circle",animationLength:3})),this.objects.push(new ze(this.scene,{duration:4.5,onInterval:()=>{let e=f.randomIntFromRange(19,28),t=f.randomIntFromRange(0,2),i="",s=0,o=0;0===t||1===t?(i="tileset_egg",s=1,o=0):(i="tileset_chicken",s=0,o=-.25),this.scene.addObject(new I(this.scene,{positionX:40,positionY:e,targetX:-1,targetY:e,tileset:i,spriteX:s,spriteY:o,destroyAtTarget:!0}))}}))}}class Ke{constructor(e){this.client=e,this.backgroundLayersAnimationTimer={},this.objects=new Map,this.globals={camera:{startX:0,startY:0,endX:0,endY:0}},this.flaggedForMapChange=void 0,this.renderingContext={background:[],objects:[]},this.backgroundLayerAnimationFrame={},this.renderContext=this.client.renderContext,this.displayContext=this.client.displayContext}frame(e){var t;this.awake(),this.background(e),this.update(e),this.render(e),this.customRenderer?this.customRenderer(this.renderingContext):((t=this).globals.camera.startX=0,t.globals.camera.startY=0,t.globals.camera.endX=0,t.globals.camera.endY=0,t.renderingContext.background.forEach((e=>{t.renderContext.drawImage(e.canvas,0,0)})),t.renderingContext.objects.forEach((e=>{t.renderContext.drawImage(e.canvas,0,0)}))),this.destroy(e)}awake(){this.client.flags.frame.log.awakeDuration&&console.time("[frame] awake");for(let[,e]of this.objects)e.awake();this.client.flags.frame.log.awakeDuration&&console.timeEnd("[frame] awake")}background(e){this.client.flags.frame.log.backgroundDuration&&console.time("[frame] background"),this.backgroundLayers.forEach(((i,s)=>{let o=this.renderingContext.background[s];t.clearCanvas(o);for(let s=0;s<this.map.width+1;s++)for(let n=0;n<this.map.height+1;n++){let r,a=i.tiles[s]?i.tiles[s][n]:void 0;if(void 0!==a){if(1===a.animationFrames.length)r=a.animationFrames[0];else{let t;void 0===this.backgroundLayersAnimationTimer[i.index]&&(this.backgroundLayersAnimationTimer[i.index]={}),void 0===this.backgroundLayersAnimationTimer[i.index][s]&&(this.backgroundLayersAnimationTimer[i.index][s]={}),t=void 0===this.backgroundLayersAnimationTimer[i.index][s][n]?0:this.backgroundLayersAnimationTimer[i.index][s][n]+e,t>a.animationFrameDuration&&(t%=a.animationFrameDuration);for(let e=0;e<a.animationMap.length;e++)if(t<=a.animationMap[e]){r=a.animationFrames[e];break}this.backgroundLayersAnimationTimer[i.index][s][n]=t}t.renderSprite(o,m.images[a.tileset],r.spriteX,r.spriteY,s-.5,n-.5)}}})),this.client.flags.frame.log.backgroundDuration&&console.timeEnd("[frame] background")}update(e){this.client.flags.frame.log.updateDuration&&console.time("[frame] update");for(let[,t]of this.objects)t.update(e);this.client.flags.frame.log.updateDuration&&console.timeEnd("[frame] update")}render(e){this.client.flags.frame.log.renderDuration&&console.time("[frame] render"),this.renderingContext.objects.forEach((e=>{t.clearCanvas(e)}));for(let[,e]of this.objects)this.client.debug.object.renderBackground&&e.debuggerRenderBackground(this.renderingContext.objects[e.renderer.layer]),e.render(this.renderingContext.objects[e.renderer.layer]),this.client.debug.object.renderBoundary&&e.debuggerRenderBoundary(this.renderingContext.objects[e.renderer.layer]);this.client.flags.frame.log.renderDuration&&console.timeEnd("[frame] render")}destroy(e){this.client.flags.frame.log.destroyDuration&&console.time("[frame] destroy");for(let[,e]of this.objects)e.flags.destroy&&this.removeObjectById(e.id);this.client.flags.frame.log.destroyDuration&&console.timeEnd("[frame] destroy")}addObject(e){this.objects.set(e.id,e)}removeObjectById(e){const t=this.objects.get(e);void 0!==t&&(t.onDestroy&&t.onDestroy(),this.objects.delete(e),t.parent&&t.parent.children.delete(t.id))}getObject(e={},t=!0){for(const[,i]of this.objects)if($e(i,e,t))return i}getObjects(e={},t=!0){const i=[];for(const[,s]of this.objects)$e(s,e,t)&&i.push(s);return i}isOutOfBounds(e,t){return e>this.map.width-1||t>this.map.height-1||e<0||t<0}removeAllObjects(){for(const[e]of this.objects)this.removeObjectById(e)}removeAllBackgroundLayers(){this.backgroundLayers=[]}setUpRenderingContexts(){this.renderingContext={background:[],objects:[]};for(let e=0;e<this.backgroundLayers.length;e++){let i=this.createCanvas();this.renderingContext.background[e]=t.getContext(i)}for(let i=0;i<e.TOTAL_RENDERING_LAYERS;i++){let e=this.createCanvas();this.renderingContext.objects[i]=t.getContext(e)}}createCanvas(){let e=t.createCanvas(this.map.width,this.map.height);return this.client.debug.ui.canvasLayers&&this.client.container.append(e),e}flagForMapChange(e){this.flaggedForMapChange=e}changeMap(e){void 0!==this.map&&this.map.destroy(),this.removeAllObjects(),this.removeAllBackgroundLayers(),console.log("[Scene] changing map to",e),this.map=Reflect.construct(e,[this]),this.backgroundLayers.push(...this.map.backgroundLayers),this.map.objects.forEach((e=>this.objects.set(e.id,e))),this.setUpRenderingContexts(),this.flaggedForMapChange=void 0}changeScene(e){this.client.changeScene(e)}setCustomRenderer(e){this.customRenderer=e}removeCustomerRenderer(){this.customRenderer=void 0}}function $e(t,i,s=!0){var o,n,r,a;if((void 0===(null===(o=i.collision)||void 0===o?void 0:o.enabled)||t.collision.enabled===i.collision.enabled)&&(!(null===(n=i.collision)||void 0===n?void 0:n.layerMatch)||i.collision.layerMatch.get(t.collision.layer))&&(void 0!==(null===(r=i.collision)||void 0===r?void 0:r.layerIgnore)||!s||t.collision.layer!==e.UI_COLLISION_LAYER)&&(!(null===(a=i.collision)||void 0===a?void 0:a.layerIgnore)||!i.collision.layerIgnore.get(t.collision.layer))&&(!i.typeMatch||i.typeMatch.some((e=>t instanceof e)))&&(!i.typeIgnore||!i.typeIgnore.some((e=>t instanceof e)))&&(!i.objectMatch||i.objectMatch.get(t))&&(!i.objectIgnore||!i.objectIgnore.get(t))&&(!i.boundingBox||function(e,t){return t.boundingBox.left<e.boundingBox.world.right&&t.boundingBox.right>e.boundingBox.world.left&&t.boundingBox.top<e.boundingBox.world.bottom&&t.boundingBox.bottom>e.boundingBox.world.top}(t,i))&&(!i.position||function(e,t){return t.position.x<e.boundingBox.world.right&&t.position.x>e.boundingBox.world.left&&t.position.y<e.boundingBox.world.bottom&&t.position.y>e.boundingBox.world.top}(t,i)))return t}class qe extends Ke{constructor(e){super(e),this.globals={...this.globals,inventory:[new F(this,{type:S.Hoe}),new F(this,{type:S.WateringCan}),new F(this,{type:S.WheatSeeds,currentStackSize:5}),void 0,void 0,new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken}),new F(this,{type:S.Chicken})],inventory_size:25,hotbar_size:5,hotbar_selected_index:0,disable_player_inputs:!1,gold:999},this.changeMap(Ze)}inventoryFirstStackWithRoom(e){for(let t=0;t<this.globals.inventory_size;t++){const i=this.globals.inventory[t];if(void 0!==i&&i.type===e&&!(i.currentStackSize>=i.maxStackSize))return t}}inventoryFirstFreeSlot(){for(let e=0;e<this.globals.inventory_size;e++)if(void 0===this.globals.inventory[e])return e}addToInventory(e){const t=this.inventoryFirstStackWithRoom(e);if(void 0!==t){const e=this.globals.inventory[t];return e.currentStackSize++,e}const i=this.inventoryFirstFreeSlot();if(void 0!==i){const t=new F(this,{type:e});return this.globals.inventory[i]=t,t}}inventoryHasRoom(e){return!!this.inventoryFirstStackWithRoom(e)||!!this.inventoryFirstFreeSlot()}removeFromInventoryByIndex(e,t){const i=this.globals.inventory[e];if(void 0!==i&&!(i.currentStackSize<t))return i.currentStackSize-=t,0===i.currentStackSize&&(this.globals.inventory[e]=void 0),i}get selectedInventoryItem(){return this.globals.inventory[this.globals.hotbar_selected_index]}get selectedInventoryIndex(){return this.globals.hotbar_selected_index}}class Je extends h{constructor(e,t){super(e,t),this.scene=e,this.width=6,this.height=2,this.clicked=!1,this.renderer.enabled=!0}onUpdate(e){this.updateClickStart(),this.updateClickEnd()}onRender(e){this.renderStartButton(e)}renderStartButton(e){t.renderSprite(e,m.images.tileset_button,this.clicked?6:0,2,this.transform.position.world.x,this.transform.position.world.y,this.width,this.height,{centered:!0})}updateClickStart(){o.wasObjectClicked(this)&&(this.clicked=!0)}updateClickEnd(){!0!==s.mouse.click.left&&!1!==this.clicked&&(o.isMouseWithinObject(this)?this.scene.changeScene(qe):this.clicked=!1)}}const Qe=e.CANVAS_TILE_HEIGHT,et=e.CANVAS_TILE_WIDTH;class tt extends n{constructor(e){super(e),this.scene=e,this.height=Qe,this.width=et,this.backgroundLayers=[v],this.objects=[],o.setCursor(this.scene.displayContext.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.objects.push(new Je(e,{renderLayer:15,positionX:16,positionY:9})),this.objects.push(new E(e,{}))}}class it extends Ke{constructor(e){super(e),this.client=e,this.changeMap(tt)}}!function(){var e;const t=new URLSearchParams(window.location.search).get("scene"),i=null!==(e={"main-menu":it,game:qe}[t])&&void 0!==e?e:it;m.initialise({images:{tileset_sample:"assets/16x16.png",tileset_grass:"assets/sample/Tilesets/Grass.png",tileset_hills:"assets/sample/Tilesets/Hills.png",tileset_water:"assets/sample/Tilesets/Water.png",tileset_player:"assets/sample/Characters/Basic Charakter Spritesheet.png",tileset_chicken:"assets/sample/Characters/Free Chicken Sprites.png",tileset_fence:"assets/sample/Tilesets/Fences.png",tileset_egg:"assets/sample/Characters/Egg_And_Nest.png",tileset_house:"assets/sample/Tilesets/Wooden House.png",tileset_dirt:"assets/sample/Tilesets/Tilled_Dirt.png",tileset_button:"assets/sample/UI Big Play Button.png",tileset_ui:"assets/sample/Sprite sheet for Basic Pack.png",tileset_wood_bridge:"assets/sample/Objects/Wood_Bridge.png",tileset_chest:"assets/sample/Objects/Chest.png",tileset_plants:"assets/sample/Objects/Basic_Plants.png",tileset_dialogue_box:"assets/sample/Dialouge UI/dialog box.png",tileset_tools:"assets/sample/Characters/Tools.png",tileset_fullscreen:"assets/custom/fullscreen.png",tileset_basic:"assets/sample/Sprite sheet for Basic Pack.png"},audio:{}}),p.initHelpers(),window.engine=new g(document.getElementById("render-area"),i,p.engineMapList,p.engineObjectList,p.engineObjectDetails,p.engineControls)}()})();