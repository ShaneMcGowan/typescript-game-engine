(()=>{"use strict";class t{static get CANVAS_HEIGHT(){return t.TILE_SIZE*t.CANVAS_TILE_HEIGHT}static get CANVAS_WIDTH(){return t.TILE_SIZE*t.CANVAS_TILE_WIDTH}static get ASPECT_RATIO(){return t.CANVAS_TILE_HEIGHT/t.CANVAS_TILE_WIDTH}static get TOTAL_RENDERING_LAYERS(){return t.OBJECT_RENDERING_LAYERS+t.UI_RENDERING_LAYERS}static get FIRST_UI_RENDER_LAYER(){return t.OBJECT_RENDERING_LAYERS}static get LAST_UI_RENDER_LAYER(){return t.OBJECT_RENDERING_LAYERS+t.UI_RENDERING_LAYERS-1}static get UI_COLLISION_LAYER(){return t.OBJECT_COLLISION_LAYERS-1}static get CANVAS_CENTER_TILE_Y(){return this.CANVAS_TILE_HEIGHT/2}static get CANVAS_CENTER_TILE_X(){return this.CANVAS_TILE_WIDTH/2}static get CANVAS_CENTER_PIXEL_X(){return t.CANVAS_WIDTH/2}static get CANVAS_CENTER_PIXEL_Y(){return t.CANVAS_HEIGHT/2}}t.CANVAS_TILE_HEIGHT=18,t.CANVAS_TILE_WIDTH=32,t.TILE_SIZE=16,t.OBJECT_RENDERING_LAYERS=16,t.UI_RENDERING_LAYERS=16,t.OBJECT_COLLISION_LAYERS=16,t.CONTEXT_IMAGE_SMOOTHING_ENABLED=!1,t.DEFAULT_FONT_SIZE=16,t.DEFAULT_FONT_COLOUR="black",t.DEFAULT_FONT_FAMILY="Helvetica";class e{static renderSprite(e,i,s,o,n,r,a,h,l={}){var d,c;let p=a?a*t.TILE_SIZE:t.TILE_SIZE,g=h?h*t.TILE_SIZE:t.TILE_SIZE,u=null!==(d=l.scale)&&void 0!==d?d:1,m=null!==(c=l.rotation)&&void 0!==c?c:0,b=l.opacity&&l.opacity<1,y=0!==m,v=b||y;if(v&&(e.save(),b&&(e.globalAlpha=Math.max(0,l.opacity)),y)){let i=Math.floor((n+a/2)*t.TILE_SIZE)+.5,s=Math.floor((r+h/2)*t.TILE_SIZE)+.5;e.translate(i,s),e.rotate(m*Math.PI/180),e.translate(-i,-s)}let f=Math.floor(p/2),w=Math.floor(g/2);l.centered&&e.translate(-f,-w),e.drawImage(i,s*t.TILE_SIZE,o*t.TILE_SIZE,p,g,Math.floor(n*t.TILE_SIZE),Math.floor(r*t.TILE_SIZE),p*u,g*u),l.centered&&e.translate(f,w),v&&e.restore()}static renderSubsection(e,i,s,o,n,r){let a=Math.floor(s*t.TILE_SIZE),h=Math.floor(o*t.TILE_SIZE),l=Math.floor(n*t.TILE_SIZE),d=Math.floor(r*t.TILE_SIZE);i.drawImage(e.canvas,a,h,l-a,d-h,0,0,i.canvas.width,i.canvas.height)}static renderCircle(e,i,s,o={}){e.beginPath(),e.arc(i*t.TILE_SIZE+t.TILE_SIZE/2,s*t.TILE_SIZE+t.TILE_SIZE/2,t.TILE_SIZE/2,0,2*Math.PI),e.stroke(),e.fillStyle=o.colour||"saddlebrown",e.fill()}static fillRectangle(e,i,s,o,n,r={}){e.strokeStyle=r.colour?r.colour:"black",e.fillStyle=r.colour?r.colour:"black",e.beginPath(),e.rect(Math.floor(i*t.TILE_SIZE)+.5,Math.floor(s*t.TILE_SIZE)+.5,o*("tile"===r.type?t.TILE_SIZE:1)-1,n*("tile"===r.type?t.TILE_SIZE:1)-1),e.stroke(),e.fill()}static strokeRectangle(e,i,s,o,n,r={}){var a;e.strokeStyle=null!==(a=r.colour)&&void 0!==a?a:"black",e.lineWidth=1;let h="tile"===r.type?Math.floor(i*t.TILE_SIZE):i,l="tile"===r.type?Math.floor(s*t.TILE_SIZE):s,d="tile"===r.type?Math.floor(o*t.TILE_SIZE):o,c="tile"===r.type?Math.floor(n*t.TILE_SIZE):n;e.strokeRect(h+.5,l+.5,d-1,c-1)}static clearCanvas(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}static createCanvas(e,i){const s=document.createElement("canvas");return s.width=e?e*t.TILE_SIZE:t.CANVAS_WIDTH,s.height=i?i*t.TILE_SIZE:t.CANVAS_HEIGHT,s}static getContext(e){let i=e.getContext("2d");return i.imageSmoothingEnabled=t.CONTEXT_IMAGE_SMOOTHING_ENABLED,i}static positionToPixelPosition(e){return e*t.TILE_SIZE}static renderText(e,i,s,o,n={}){let r=n.size?n.size:t.DEFAULT_FONT_SIZE,a=n.colour?n.colour:t.DEFAULT_FONT_COLOUR,h=n.font?n.font:t.DEFAULT_FONT_FAMILY;e.font=`${r}px ${h}`,e.fillStyle=`${a}`,e.fillText(i,s*t.TILE_SIZE,o*t.TILE_SIZE)}static textToArray(t,e,i={}){var s,o;let n=null!==(s=i.size)&&void 0!==s?s:16,r=null!==(o=i.colour)&&void 0!==o?o:"black",a=i.font?i.font:"Helvetica",h=document.createElement("canvas").getContext("2d");h.font=`${n}px ${a}`,h.fillStyle=`${r}`;let l=t.split(" "),d="",c=[];for(let t=0;t<l.length;t++){let i=`${d} ${l[t]}`;h.measureText(i).width>=e?(c.push(i),d=""):l.length-1!==t?d=i.trim():c.push(i)}return c}}var i;!function(t){t.Left="left",t.Middle="middle",t.Right="right"}(i||(i={}));class s{static isKeyPressed(t){Array.isArray(t)||(t=[t]);for(const e of t)if(this.keyboard[e])return!0;return!1}static setKeyPressed(t){Array.isArray(t)||(t=[t]);for(const e of t)this.keyboard[e]=!0}static clearKeyPressed(t){Array.isArray(t)||(t=[t]);for(const e of t)this.keyboard[e]=!1}static isMousePressed(t=i.Left){return this.mouse.click[t]}static clearMousePressed(t=i.Left){this.mouse.click[t]=!1}}s.keyboard={},s.mouse={click:{left:!1,middle:!1,right:!1},position:{x:0,y:0},wheel:{event:new WheelEvent("")},latestEvent:new MouseEvent("")};class o{static getMousePosition(e,i){let s,o=e.getBoundingClientRect(),n={height:o.height,width:o.width},r={clientX:i.clientX,clientY:i.clientY};if(e.width>e.height){s=e.width/o.width,n.height=e.height/s;let t=o.height-n.height;r.clientY-=t/2}else{s=e.height/o.height,n.width=e.width/s;let t=o.width-n.width;r.clientX-=t/2}let a=e.width/n.width,h=e.height/n.height;return{x:(r.clientX-o.left)*a/t.TILE_SIZE,y:(r.clientY-o.top)*h/t.TILE_SIZE}}static setCursor(t,e){t.style.cursor=`url("${e}"), auto`}static get isFullscreen(){return null!==document.fullscreenElement}static isMouseWithinBoundary(t,e,i,s,o){return t.x>=e&&t.x<=e+s&&t.y>=i&&t.y<=i+o}static isMouseWithinObject(t){return!!this.isMouseWithinBoundary(s.mouse.position,t.boundingBox.world.left,t.boundingBox.world.top,t.width,t.height)}static wasObjectClicked(t){return!!s.mouse.click.left&&!!this.isMouseWithinObject(t)}}class n{constructor(t){this.scene=t,this.globals={}}destroy(){}}class r{constructor(t,e){this.x=t,this.y=e}get roundedX(){return Math.round(this.x)}get roundedY(){return Math.round(this.y)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){let t=this.magnitude;return 0===t?new r(0,0):new r(this.x/t,this.y/t)}add(t){return new r(this.x+t.x,this.y+t.y)}subtract(t){return new r(this.x-t.x,this.y-t.y)}multiply(t){return new r(this.x*t,this.y*t)}divide(t){return new r(this.x/t,this.y/t)}}const a=!1;class h{constructor(t,e){var i,s,o,n,h,l,d,c,p,g;this.scene=t,this.id=crypto.randomUUID(),this.width=1,this.height=1,this.children=new Map,this.parent=void 0;const u=this;this.mainContext=this.scene.renderContext,this.transform={position:{local:new r(0,0),get world(){return u.calculateWorldPosition()}},scale:1,rotation:0},this.collision={enabled:a,layer:0},this.renderer={enabled:!1,layer:0,opacity:1,scale:1},this.flags={awake:!1,update:!0,render:!0,destroy:!1},this.transform.position.local.x=null!==(i=e.positionX)&&void 0!==i?i:this.transform.position.local.x,this.transform.position.local.y=null!==(s=e.positionY)&&void 0!==s?s:this.transform.position.local.y,this.collision.enabled=null!==(o=e.collisionEnabled)&&void 0!==o?o:a,this.collision.layer=null!==(n=e.collisionLayer)&&void 0!==n?n:0,this.renderer.enabled=null!==(h=e.renderEnabled)&&void 0!==h?h:this.renderer.enabled,this.renderer.layer=null!==(l=e.renderLayer)&&void 0!==l?l:this.renderer.layer,this.renderer.opacity=null!==(d=e.renderOpacity)&&void 0!==d?d:this.renderer.opacity,this.renderer.scale=null!==(c=e.renderScale)&&void 0!==c?c:this.renderer.scale,this.width=null!==(p=e.width)&&void 0!==p?p:this.width,this.height=null!==(g=e.height)&&void 0!==g?g:this.height,void 0!==e.onAwake&&(this.onAwake=e.onAwake),void 0!==e.onUpdate&&(this.onUpdate=e.onUpdate),void 0!==e.onRender&&(this.onRender=e.onRender),void 0!==e.onDestroy&&(this.onDestroy=e.onDestroy)}awake(){this.flags.awake||(this.flags.awake=!0,void 0!==this.onAwake&&this.onAwake())}update(t){this.flags.update&&void 0!==this.onUpdate&&this.onUpdate(t)}render(t){this.renderer.enabled&&this.flags.render&&void 0!==this.onRender&&this.onRender(t)}destroy(){this.flags.destroy=!0,this.children.forEach((t=>{t.destroy()}))}get boundingBox(){return{local:h.calculateBoundingBox(this.transform.position.local.x,this.transform.position.local.y,this.width,this.height),world:h.calculateBoundingBox(this.transform.position.world.x,this.transform.position.world.y,this.width,this.height)}}debuggerRenderBoundary(t){e.strokeRectangle(t,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"red",type:"tile"})}debuggerRenderBackground(i){e.fillRectangle(i,this.boundingBox.world.left,this.boundingBox.world.top,Math.floor(this.width*t.TILE_SIZE),Math.floor(this.height*t.TILE_SIZE),{colour:"red"})}isCollidingWith(t){return this.isWithinHorizontalBounds(t)&&this.isWithinVerticalBounds(t)}isWithinHorizontalBounds(t){return t.boundingBox.world.left>=this.boundingBox.world.left&&t.boundingBox.world.left<=this.boundingBox.world.right||t.boundingBox.world.right>=this.boundingBox.world.left&&t.boundingBox.world.right<=this.boundingBox.world.right}isWithinVerticalBounds(t){return t.boundingBox.world.top>=this.boundingBox.world.top&&t.boundingBox.world.top<=this.boundingBox.world.bottom||t.boundingBox.world.bottom>=this.boundingBox.world.top&&t.boundingBox.world.bottom<=this.boundingBox.world.bottom}static calculateBoundingBox(t,e,i,s){let o=i/2,n=s/2;return{top:e-n,right:t+o,bottom:e+n,left:t-o}}addChild(t){this.children.set(t.id,t),t.parent=this,this.scene.addObject(t)}removeChild(t){void 0!==this.children.get(t.id)&&t.destroy()}removeAllChildren(){this.children.forEach((t=>{this.removeChild(t)}))}get rootParent(){return l(this)}calculateWorldPosition(){return void 0===this.parent?new r(this.transform.position.local.x,this.transform.position.local.y):new r(this.transform.position.local.x+this.parent.transform.position.world.x,this.transform.position.local.y+this.parent.transform.position.world.y)}}function l(t){return void 0===t.parent?t:l(t.parent)}class d extends h{constructor(t,e){super(t,e),this.scene=t,this.isColliding=!1,this.renderer.enabled=!0,e.width&&(this.width=e.width),e.height&&(this.height=e.height)}onUpdate(t){this.updateCollision()}onRender(t){let i=this.isColliding?"green":"red";e.fillRectangle(t,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:i,type:"tile"})}updateCollision(){if(this.collision.enabled){for(const[,t]of this.scene.objects)if(t!==this&&this.boundingBox.world.left<t.boundingBox.world.right&&this.boundingBox.world.right>t.boundingBox.world.left&&this.boundingBox.world.top<t.boundingBox.world.bottom&&this.boundingBox.world.bottom>t.boundingBox.world.top)return void(this.isColliding=!0);this.isColliding=!1}}}class c extends h{constructor(t,e){super(t,e),this.scene=t,this.timer=0,this.grow=!0,this.renderer.enabled=!0}onUpdate(t){this.timer+=t,this.timer>2&&(this.grow=!this.grow,this.timer=0),this.transform.position.local.x+=(this.grow?1:-1)*t,this.transform.position.local.y+=(this.grow?1:-1)*t}onRender(t){e.fillRectangle(t,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"red",type:"tile"})}}class p{static get engineMapList(){return document.getElementById("map-list")||null}static get engineObjectList(){return document.getElementById("object-list")||null}static get engineObjectDetails(){return document.getElementById("object-details")||null}static get engineControls(){return{gridLines:document.getElementById("btnGridLines"),gridNumbers:document.getElementById("btnGridNumbers"),breakpoint:document.getElementById("btnBreakpoint"),fps:document.getElementById("btnFps"),objectCount:document.getElementById("btnObjectCount"),timingFrame:document.getElementById("btnTimingFrame"),timingFrameBackground:document.getElementById("btnTimingFrameBackground"),timingFrameRender:document.getElementById("btnTimingFrameRender"),timingFrameUpdate:document.getElementById("btnTimingFrameUpdate"),canvasLayers:document.getElementById("btnCanvasLayers"),fullscreen:document.getElementById("btnFullscreen"),renderBoundary:document.getElementById("btnRenderBoundary"),renderBackground:document.getElementById("btnRenderBackground")}}static initHelpers(){window.o=t=>window.engine.scene.objects.get(t)}static changeScene(t){window.engine.changeScene(t)}static changeMap(t){window.engine.scene.changeMap(t)}}p.TEST_MAPS=[{name:"collision test",map:class extends n{constructor(t){super(t),this.scene=t,this.height=18,this.width=30,this.backgroundLayers=[],this.objects=[],this.initialiseNotColliding(),this.initialiseColliding()}initialiseNotColliding(){this.objects.push(new d(this.scene,{positionX:1.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:2.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:2.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:4.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:2.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:4.5})),this.objects.push(new d(this.scene,{positionX:2.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:4.5})),this.objects.push(new d(this.scene,{positionX:4.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:5.5,collisionEnabled:!0}))}initialiseColliding(){this.objects.push(new d(this.scene,{positionX:7.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:8,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:2,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:2,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:8,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:5.5})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:5.5})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:7.5})),this.objects.push(new d(this.scene,{positionX:2,positionY:7.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:7.5})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:8,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.001,positionY:7.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:6,positionY:8.5})),this.objects.push(new d(this.scene,{positionX:8.499,positionY:7.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:8.5})),this.objects.push(new d(this.scene,{positionX:5.001,positionY:10.999,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:6,positionY:10})),this.objects.push(new d(this.scene,{positionX:8.499,positionY:10.999,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:10})),this.objects.push(new d(this.scene,{positionX:18,positionY:5,width:6,height:6,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:5})),this.objects.push(new d(this.scene,{positionX:21.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.5,positionY:8.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:8.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.5,positionY:8.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:14,width:6,height:6})),this.objects.push(new d(this.scene,{positionX:14.501,positionY:10.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18.001,positionY:10.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.499,positionY:10.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.501,positionY:14,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:14,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.499,positionY:14,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.501,positionY:17.499,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:17.499,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.499,positionY:17.499,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:15,width:5,height:1,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:15,width:1,height:5})),this.objects.push(new d(this.scene,{positionX:9.5,positionY:15,width:5,height:1})),this.objects.push(new d(this.scene,{positionX:9.5,positionY:15,width:1,height:5,collisionEnabled:!0}))}}},{name:"object hierarchy test",map:class extends n{constructor(t){super(t),this.scene=t,this.height=18,this.width=30,this.backgroundLayers=[],this.objects=[];const e=new c(this.scene,{positionX:1,positionY:1}),i=new c(this.scene,{positionX:1,positionY:1}),s=new c(this.scene,{positionX:1,positionY:1}),o=new c(this.scene,{positionX:1,positionY:1});this.scene.addObject(e),e.addChild(i),i.addChild(s),s.addChild(o)}}}];class g{constructor(i,s,o,n,r,a){this.container=i,this.engineMapList=o,this.engineObjectList=n,this.engineObjectDetails=r,this.engineControls=a,this.CANVAS_HEIGHT=t.CANVAS_HEIGHT,this.CANVAS_WIDTH=t.CANVAS_WIDTH,this.delta=0,this.lastRenderTimestamp=0,this.flags={frame:{interrupted:!1,log:{start:!1,end:!1,delta:!1,timestamp:!1,backgroundDuration:!1,awakeDuration:!1,updateDuration:!1,renderDuration:!1,destroyDuration:!1}}},this.debug={enabled:!0,stats:{fps:!1,fpsCounter:0,objectCount:!1},breakpoint:{frame:!1},ui:{grid:{lines:!1,numbers:!1},canvasLayers:!1},object:{renderBoundary:!1,renderBackground:!1}},this.gamepad=void 0,this.editorTimer=0,this.debug.enabled&&(this.initialiseDebuggerState(),this.initialiseDebuggerListeners()),this.displayCanvas=this.createCanvas(),this.displayContext=e.getContext(this.displayCanvas),this.renderCanvas=this.createCanvas(),this.renderContext=e.getContext(this.renderCanvas),i.append(this.displayCanvas),document.addEventListener("visibilitychange",(t=>{"visible"===document.visibilityState?(console.log("tab is active"),this.flags.frame.interrupted=!0):console.log("tab is inactive")})),document.addEventListener("fullscreenchange",(t=>{})),document.addEventListener("fullscreenerror",(t=>{})),this.initialiseMouseListeners(),this.initialiseKeyboardListeners(),this.intialiseGamepadListeners(),this.changeScene(s),window.requestAnimationFrame(this.firstFrame.bind(this))}createCanvas(){const t=e.createCanvas();return t.addEventListener("contextmenu",(t=>{t.preventDefault()})),t}changeScene(t){this.scene=Reflect.construct(t,[this])}firstFrame(t){this.setDelta(t),window.requestAnimationFrame(this.frame.bind(this))}interruptedFrame(t){console.log("frameInterrupted"),this.lastRenderTimestamp=t,this.flags.frame.interrupted=!1,window.requestAnimationFrame(this.frame.bind(this))}frame(t){this.flags.frame.log.start&&console.log("[frame] start"),this.debug.breakpoint.frame,this.flags.frame.interrupted?window.requestAnimationFrame(this.interruptedFrame.bind(this)):(this.setDelta(t),this.flags.frame.log.timestamp&&console.log(`[timestamp] ${t}`),this.flags.frame.log.delta&&console.log(`[delta] ${this.delta}`),e.clearCanvas(this.renderContext),this.scene.frame(this.delta),e.clearCanvas(this.displayContext),this.displayContext.drawImage(this.renderCanvas,0,0),this.debug.stats.fps&&(this.debug.stats.fpsCounter&&this.renderStats(0,"FPS",`${Math.round(1e3/(performance.now()-this.debug.stats.fpsCounter))} FPS`),this.debug.stats.fpsCounter=t),this.debug.stats.objectCount&&this.renderStats(1,"Objects",`${this.scene.objects.size} objects`),this.renderGrid(),this.scene.flaggedForMapChange&&this.scene.changeMap(this.scene.flaggedForMapChange),this.editorTimer+=this.delta,this.editorTimer>1&&(this.editor(),this.editorTimer=0),window.requestAnimationFrame(this.frame.bind(this)),this.flags.frame.log.end&&console.log("[frame] end"))}setDelta(t){this.delta=(t-this.lastRenderTimestamp)/1e3,this.lastRenderTimestamp=t}renderStats(e,i,s){this.displayContext.fillStyle="red",this.displayContext.font="12px serif",this.displayContext.fillText(s,this.CANVAS_WIDTH-50,(e+1)*t.TILE_SIZE)}renderGrid(){if((this.debug.ui.grid.lines||this.debug.ui.grid.numbers)&&e.fillRectangle(this.displayContext,0,0,this.CANVAS_WIDTH,this.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.25)"}),this.debug.ui.grid.lines)for(let i=0;i<this.CANVAS_WIDTH;i+=t.TILE_SIZE)for(let s=0;s<this.CANVAS_HEIGHT;s+=t.TILE_SIZE)e.strokeRectangle(this.displayContext,i,s,t.TILE_SIZE,t.TILE_SIZE,{colour:"black"});if(this.debug.ui.grid.numbers)for(let e=0;e<t.CANVAS_TILE_WIDTH;e++)for(let i=0;i<t.CANVAS_TILE_HEIGHT;i++)this.displayContext.fillStyle="black",this.displayContext.font="8px helvetica",this.displayContext.fillText(`${e}`,e*t.TILE_SIZE+1,i*t.TILE_SIZE+8),this.displayContext.fillText(`${i}`,e*t.TILE_SIZE+6,i*t.TILE_SIZE+14)}initialiseDebuggerState(){if(void 0!==this.engineControls&&this.engineControls.renderBoundary){const t=JSON.parse(localStorage.getItem("object.renderBoundary"));this.engineControls.renderBoundary.checked=t,this.debug.object.renderBoundary=t}}initialiseDebuggerListeners(){void 0!==this.engineControls&&(this.engineControls.gridLines&&this.engineControls.gridLines.addEventListener("click",(()=>{this.debug.ui.grid.lines=!this.debug.ui.grid.lines})),this.engineControls.gridNumbers&&this.engineControls.gridNumbers.addEventListener("click",(()=>{this.debug.ui.grid.numbers=!this.debug.ui.grid.numbers})),this.engineControls.breakpoint&&this.engineControls.breakpoint.addEventListener("click",(()=>{this.debug.breakpoint.frame=!this.debug.breakpoint.frame})),this.engineControls.fps&&this.engineControls.fps.addEventListener("click",(()=>{this.debug.stats.fps=!this.debug.stats.fps})),this.engineControls.objectCount&&this.engineControls.objectCount.addEventListener("click",(()=>{this.debug.stats.objectCount=!this.debug.stats.objectCount})),this.engineControls.timingFrame&&this.engineControls.timingFrame.addEventListener("click",(()=>{this.flags.frame.log.delta=!this.flags.frame.log.delta})),this.engineControls.timingFrameBackground&&this.engineControls.timingFrameBackground.addEventListener("click",(()=>{this.flags.frame.log.backgroundDuration=!this.flags.frame.log.backgroundDuration})),this.engineControls.timingFrameRender&&this.engineControls.timingFrameRender.addEventListener("click",(()=>{this.flags.frame.log.renderDuration=!this.flags.frame.log.renderDuration})),this.engineControls.timingFrameUpdate&&this.engineControls.timingFrameUpdate.addEventListener("click",(()=>{this.flags.frame.log.updateDuration=!this.flags.frame.log.updateDuration})),this.engineControls.canvasLayers&&this.engineControls.canvasLayers.addEventListener("click",(()=>{this.debug.ui.canvasLayers=!this.debug.ui.canvasLayers})),this.engineControls.renderBoundary&&this.engineControls.renderBoundary.addEventListener("click",(()=>{this.debug.object.renderBoundary=!this.debug.object.renderBoundary,localStorage.setItem("object.renderBoundary",JSON.stringify(this.debug.object.renderBoundary))})),this.engineControls.renderBackground&&this.engineControls.renderBackground.addEventListener("click",(()=>{this.debug.object.renderBackground=!this.debug.object.renderBackground})),this.engineControls.fullscreen&&this.engineControls.fullscreen.addEventListener("click",(()=>{this.displayCanvas.requestFullscreen().catch((t=>{throw new Error(t)}))})))}initialiseKeyboardListeners(){console.log("[listener added] keydown"),document.addEventListener("keydown",(t=>{if(t.preventDefault(),t.repeat)return;console.log("[keydown]",t);let e=t.key.toLocaleLowerCase();s.setKeyPressed(e)})),console.log("[listener added] keyup"),document.addEventListener("keyup",(t=>{if(t.preventDefault(),t.repeat)return;console.log("[keyup]",t);let e=t.key.toLocaleLowerCase();s.clearKeyPressed(e)}))}initialiseMouseListeners(){console.log("[listener added] mousemove"),this.displayCanvas.addEventListener("mousemove",(t=>{s.mouse.position=o.getMousePosition(this.displayCanvas,t),s.mouse.latestEvent=t})),console.log("[listener added] mousedown"),this.displayCanvas.addEventListener("mousedown",(t=>{switch(console.log("[mousedown]",t),t.button){case 0:s.mouse.click.left=!0;break;case 1:s.mouse.click.middle=!0;break;case 2:s.mouse.click.right=!0}})),console.log("[listener added] mouseup"),this.displayCanvas.addEventListener("mouseup",(t=>{switch(console.log("[mouseup]",t),t.button){case 0:s.mouse.click.left=!1;break;case 1:s.mouse.click.middle=!1;break;case 2:s.mouse.click.right=!1}})),console.log("[listener added] touchstart"),this.displayCanvas.addEventListener("touchstart",(t=>{console.log("[touchstart]",t),s.mouse.click.left=!0})),console.log("[listener added] touchend"),this.displayCanvas.addEventListener("touchend",(t=>{console.log("[touchend]",t),s.mouse.click.left=!1})),console.log("[listener added] wheel"),this.displayCanvas.addEventListener("wheel",(t=>{console.log("[wheel]",t),s.mouse.wheel.event=t}))}intialiseGamepadListeners(){window.addEventListener("gamepadconnected",(t=>{console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",t.gamepad.index,t.gamepad.id,t.gamepad.buttons.length,t.gamepad.axes.length),this.gamepad=t.gamepad})),window.addEventListener("gamepaddisconnected",(t=>{this.gamepad=void 0}))}editor(){if(null===this.engineObjectList||null===this.engineMapList)return;let t=document.createElement("ul");this.engineMapList.innerHTML="",this.engineMapList.appendChild(t),[...p.TEST_MAPS].forEach((e=>{let i=document.createElement("li");i.innerHTML=e.name,t.appendChild(i),i.addEventListener("click",(()=>{p.changeMap(e.map)}))}));let e=document.createElement("ul");this.engineObjectList.innerHTML="",this.engineObjectList.appendChild(e),this.scene.objects.forEach((t=>{let i=document.createElement("li");i.innerHTML=t.constructor.name,e.appendChild(i),i.addEventListener("click",(()=>{this.engineSelectedObjectId=t.id,this.updateEngineObjectDetails()}))}))}updateEngineObjectDetails(){if(void 0===this.engineSelectedObjectId)return;if(null===this.engineObjectDetails)return;let t=this.scene.objects.get(this.engineSelectedObjectId);if(void 0===t)return;const e=this.engineObjectDetails.querySelector("#object-details-header"),i=this.engineObjectDetails.querySelector("#object-details-content");e.innerHTML=`<h3>${t.constructor.name}</h3>`,i.innerHTML="",Object.keys(t).forEach((e=>{"transform"===e?(i.innerHTML+=u(t.transform.position.local,"x"),i.innerHTML+=u(t.transform.position.local,"y")):i.innerHTML+=u(t,e)})),console.log(t)}}function u(t,e){let i="";return i+='<div style="display:flex; padding: 0.25rem 0;">',i+=`<span style="margin-right: auto;">${e}</span>`,i+=`<code>${t[e]}</code>`,i+="</div>",i}class m{static initialise(t){Object.keys(t.images).forEach((e=>{this.images[e]=new Image,this.images[e].src=t.images[e]})),Object.keys(t.audio).forEach((e=>{this.audio[e]=new Audio(t.audio[e])})),Object.keys(t.fonts).forEach((e=>{const i=new FontFace(e,`url(${t.fonts[e]})`);this.fonts[e]=i,i.load().then((()=>{document.fonts.add(i)})).catch((t=>{console.log(`[initialise assets]: ${t}`)}))}))}}m.images={},m.audio={},m.fonts={};const b={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},y=[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],v={index:0,tiles:[y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y]};class f{static randomIntFromRange(t,e){return Math.floor(this.randomNumberFromRange(t,e))}static randomNumberFromRange(t,e){return Math.random()*(e-t+1)+t}static randomStartingDelta(t){return Math.random()*(null!=t?t:1)}}class w{get position(){return{x:this.targetX,y:this.targetY}}get target(){return{x:this.targetX,y:this.targetY}}constructor(t,e,i,s){this.positionX=t,this.positionY=e,this.targetX=i,this.targetY=s}}class x{static moveTowardsPosition(t,e){return t.targetX>t.positionX?(t.positionX+=e,t.targetX<t.positionX&&(t.positionX=t.targetX)):t.targetX<t.positionX?(t.positionX-=e,t.targetX>t.positionX&&(t.positionX=t.targetX)):t.targetY>t.positionY?(t.positionY+=e,t.targetY<t.positionY&&(t.positionY=t.targetY)):t.targetY<t.positionY&&(t.positionY-=e,t.targetY>t.positionY&&(t.positionY=t.targetY)),new w(t.positionX,t.positionY,t.targetX,t.targetY)}static moveTowardsOtherEntity(t,e){return e.positionX>t.positionX?t.targetX+=1:e.positionX<t.positionX?t.targetX-=1:e.positionY>t.positionY?t.targetY+=1:e.positionY<t.positionY&&(t.targetY-=1),new w(t.positionX,t.positionY,t.targetX,t.targetY)}static moveInRandomDirection(t){switch(f.randomIntFromRange(1,4)){case 1:t.targetX+=1;break;case 2:t.targetX-=1;break;case 3:t.targetY+=1;break;case 4:t.targetY-=1}return new w(t.positionX,t.positionY,t.targetX,t.targetY)}static frameSpeed(t,e){return t*e}static MoveTowards(t,e,i){let s=e.subtract(t),o=s.normalized.multiply(i);return o.magnitude>s.magnitude&&(o=s),o}}class I extends h{constructor(t,e){var i,s;super(t,e),this.scene=t,this.targetX=-1,this.targetY=-1,this.movementSpeed=.5,this.renderer.enabled=!0,this.tileset=e.tileset,this.spriteX=e.spriteX,this.spriteY=e.spriteY,this.spriteHeight=e.spriteHeight,this.spriteWidth=e.spriteWidth,this.destroyAtTarget=null!==(i=e.destroyAtTarget)&&void 0!==i&&i,this.movementSpeed=null!==(s=e.movementSpeed)&&void 0!==s?s:.5}onUpdate(t){this.updatePosition(t)}updatePosition(t){if(this.transform.position.local.x===this.targetX&&this.transform.position.local.y===this.targetY)return void(this.destroyAtTarget&&this.destroy());let e=new w(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=this.movementSpeed*t,s=x.moveTowardsPosition(e,i);this.transform.position.local.x=s.positionX,this.transform.position.local.y=s.positionY}onRender(t){e.renderSprite(t,m.images[this.tileset],this.spriteX,this.spriteY,this.transform.position.world.x,this.transform.position.world.y,this.spriteWidth,this.spriteWidth,{centered:!0})}}class E extends h{constructor(t,e){super(t,e),this.scene=t,this.newItemTimer=0}onUpdate(t){this.updateGenerateNewItem(t)}updateGenerateNewItem(e){if(this.newItemTimer+=e,this.newItemTimer<3)return;if(this.scene.objects.size>15)return;let i=f.randomIntFromRange(0,this.scene.map.height);this.scene.addObject(new I(this.scene,{positionX:t.CANVAS_TILE_WIDTH,positionY:i,targetX:-1,targetY:i,tileset:"tileset_egg",spriteX:1,spriteY:0,destroyAtTarget:!0})),this.newItemTimer=0}}var S,T,_;!function(t){t.Chicken="Chicken",t.Egg="Egg",t.WheatSeeds="WheatSeeds",t.Wheat="Wheat",t.TomatoSeeds="TomatoSeeds",t.Tomato="Tomato",t.Hoe="Hoe",t.WateringCan="WateringCan",t.Chest="Chest"}(S||(S={})),function(t){t.Player="Player",t.Anywhere="Anywhere",t.None="None"}(T||(T={})),function(t){t.Confirm="e",t.ConfirmAlt=" "}(_||(_={}));const C="tileset_dialogue_box",Y=()=>{};class L extends h{constructor(e,i){var s,o,n,r,a;super(e,i),this.scene=e,this.height=3,this.width=t.CANVAS_TILE_WIDTH,this.textboxWidth=t.CANVAS_TILE_WIDTH-8,this.textboxBorder=2,this.textSize=16,this.textSegments=[],this.textIndex=0,this.characterIndex=0,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.completionTimer=0,this.renderer.enabled=!0,this.renderer.layer=t.FIRST_UI_RENDER_LAYER,void 0===i.positionX&&(this.transform.position.local.x=0),void 0===i.positionY&&(this.transform.position.local.y=t.CANVAS_TILE_HEIGHT-this.height),this.showOverlay=null===(s=i.showOverlay)||void 0===s||s,this.text=null!==(o=i.text)&&void 0!==o?o:"...",this.onComplete=null!==(n=i.onComplete)&&void 0!==n?n:Y,this.portrait=i.portrait,this.name=i.name,this.completionDuration=i.completionDuration,this.scrollText=null===(r=i.scrollText)||void 0===r||r,this.scrollSpeed=null!==(a=i.scrollSpeed)&&void 0!==a?a:48,this.initText()}initText(){this.textSegments=e.textToArray(this.text,(this.textboxWidth-4)*t.TILE_SIZE,{size:this.textSize})}onUpdate(t){void 0!==this.completionDuration?this.updateTimer(t):this.updateConfirm(),this.scrollText&&this.updateScrollText(t),this.updatePortraitAnimation(t)}onRender(t){this.showOverlay&&this.renderOverlay(t),this.hasPortrait&&this.renderPortrait(t),this.generateTextbox(t),this.hasNamePlate&&this.renderNamePlate(t),this.renderText(t)}updateTimer(t){this.completionTimer+=t,this.completionTimer>=this.completionDuration&&(this.onComplete&&this.onComplete(),this.destroy())}updateScrollText(t){this.currentText.length>this.characterIndex&&(this.characterIndex+=this.scrollSpeed*t)}updateConfirm(){if(s.isKeyPressed([_.Confirm,_.ConfirmAlt])||s.isMousePressed(i.Left)){if(this.scrollText&&this.currentText.length>this.characterIndex)return this.characterIndex=this.currentText.length,s.clearKeyPressed([_.Confirm,_.ConfirmAlt]),void s.clearMousePressed(i.Left);this.textIndex+=2,this.characterIndex=0,this.textSegments.length<=this.textIndex&&(this.onComplete&&this.onComplete(),this.destroy()),s.clearKeyPressed([_.Confirm,_.ConfirmAlt]),s.clearMousePressed(i.Left)}}renderOverlay(i){e.fillRectangle(i,0,0,t.CANVAS_WIDTH,t.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.5)"})}generateTextbox(i){let s=this.textboxWidth,o=(t.CANVAS_TILE_WIDTH-s)/2;e.renderSprite(i,m.images[C],0,0,o,t.CANVAS_TILE_HEIGHT-4),e.renderSprite(i,m.images[C],0,1,o,t.CANVAS_TILE_HEIGHT-3),e.renderSprite(i,m.images[C],0,1,o,t.CANVAS_TILE_HEIGHT-2),e.renderSprite(i,m.images[C],0,2,o,t.CANVAS_TILE_HEIGHT-1);for(let n=1;n<s-1;n++)e.renderSprite(i,m.images[C],1,0,o+n,t.CANVAS_TILE_HEIGHT-4),e.renderSprite(i,m.images[C],1,1,o+n,t.CANVAS_TILE_HEIGHT-3),e.renderSprite(i,m.images[C],1,1,o+n,t.CANVAS_TILE_HEIGHT-2),e.renderSprite(i,m.images[C],1,2,o+n,t.CANVAS_TILE_HEIGHT-1);e.renderSprite(i,m.images[C],2,0,o+s-1,t.CANVAS_TILE_HEIGHT-4),e.renderSprite(i,m.images[C],2,1,o+s-1,t.CANVAS_TILE_HEIGHT-3),e.renderSprite(i,m.images[C],2,1,o+s-1,t.CANVAS_TILE_HEIGHT-2),e.renderSprite(i,m.images[C],2,2,o+s-1,t.CANVAS_TILE_HEIGHT-1)}renderText(i){if(this.textLine1){let s=this.scrollText?this.textLine1.substring(0,this.characterIndex):this.textLine1;e.renderText(i,s,(t.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,t.CANVAS_TILE_HEIGHT-2-.25,{size:this.textSize})}if(this.textLine2){let s=this.scrollText?this.textLine2.substring(0,this.characterIndex-this.textLine1.length):this.textLine2;e.renderText(i,s,(t.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,t.CANVAS_TILE_HEIGHT-1-.25,{size:this.textSize})}}renderPortrait(t){e.renderSprite(t,m.images[this.portrait.tileset],this.portrait.x,this.portrait.y,3,9,void 0,void 0,{scale:8})}renderNamePlate(i){e.fillRectangle(i,(t.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1,t.CANVAS_TILE_HEIGHT-4,6*t.TILE_SIZE,1*t.TILE_SIZE,{colour:"#e8cfa6"}),e.renderText(i,this.name,(t.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,t.CANVAS_TILE_HEIGHT-3-.25,{size:this.textSize})}updatePortraitAnimation(t){this.animationTimer=(this.animationTimer+t)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}get hasPortrait(){return void 0!==this.portrait}get hasNamePlate(){return void 0!==this.name}get textLine1(){return this.textSegments[this.textIndex]}get textLine2(){return this.textSegments[this.textIndex+1]}get currentText(){let t="";return this.textLine1&&(t+=this.textLine1),this.textLine2&&(t+=this.textLine2),t}}const X={x:1,y:1},A=[S.TomatoSeeds,S.WheatSeeds];var k;!function(t){t[t.Empty=0]="Empty",t[t.Watered=1]="Watered",t[t.Growing=2]="Growing",t[t.FullyGrown=3]="FullyGrown",t[t.Spoiled=4]="Spoiled"}(k||(k={}));const j={[S.WheatSeeds]:{[k.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:0},[k.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:0},[k.Spoiled]:void 0},[S.TomatoSeeds]:{[k.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:1},[k.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:1},[k.Spoiled]:void 0}};class M extends h{constructor(t,e){super(t,e),this.scene=t,this.spriteX=X.x,this.spriteY=X.y,this.counterDry=0,this.counterGrow=0,this.counterSpoil=0,this.currentlyGrowing=void 0,this.renderer.enabled=!0,this.renderer.layer=6,this.cropStage=k.Empty,e.growing&&(this.collision.enabled=!0,this.cropStage=e.growing.stage,this.currentlyGrowing=e.growing.itemType)}onDirtPlaced(t){let e=this.scene.getObjects({position:{x:this.transform.position.world.x-1,y:this.transform.position.world.y}}),i=this.scene.getObjects({position:{x:this.transform.position.world.x+1,y:this.transform.position.world.y}}),s=(e.filter((t=>t instanceof M)).length,i.filter((t=>t instanceof M)).length,X);this.spriteX=s.x,this.spriteY=s.y}interact(){switch(this.cropStage){case k.Empty:return void this.interactStageEmpty();case k.Watered:return void this.interactStageWatered();case k.Growing:return void this.interactStageGrowing();case k.FullyGrown:return void this.interactStageFullyGrown()}}interactStageEmpty(){this.scene.globals.disable_player_inputs=!0;let t=new L(this.scene,{text:"It's a beautiful patch of dirt, brimming with potential.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(t)}interactStageWatered(){this.scene.globals.disable_player_inputs=!0;let t=new L(this.scene,{text:"The patch of dirt is watered, better plant something before it dries up.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(t)}interactStageGrowing(){this.scene.globals.disable_player_inputs=!0;let t=new L(this.scene,{text:"The plant is growing nicely, it will be ready for harvest soon.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(t)}interactStageFullyGrown(){let t=!1;switch(this.currentlyGrowing){case S.TomatoSeeds:t=!!this.scene.addToInventory(S.Tomato);break;case S.WheatSeeds:t=!!this.scene.addToInventory(S.Wheat)}t&&this.destroy()}get isEmpty(){return void 0===this.currentlyGrowing}onUpdate(t){this.cropStage===k.Empty||this.cropStage===k.Watered?this.counterDry+=t:this.cropStage===k.Growing?this.counterGrow+=t:this.cropStage===k.FullyGrown&&(this.counterSpoil+=t),this.isEmpty&&this.counterDry>15?this.destroy():this.cropStage===k.Growing&&this.counterGrow>5?this.cropStage=k.FullyGrown:this.cropStage===k.FullyGrown&&this.counterSpoil>86400&&(this.cropStage=k.Spoiled)}onRender(t){this.renderDirt(t),this.renderCrop(t)}renderDirt(t){let i=(this.cropStage,k.Empty,"tileset_dirt");e.renderSprite(t,m.images[i],this.spriteX,this.spriteY,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0}),this.cropStage!==k.Empty&&e.fillRectangle(t,this.boundingBox.local.left,this.boundingBox.local.top,1,1,{colour:"#00000011",type:"tile"})}renderCrop(t){if(this.cropStage===k.Empty||this.cropStage===k.Watered)return;if(this.currentlyGrowing!==S.TomatoSeeds&&this.currentlyGrowing!==S.WheatSeeds)return;let i=j[this.currentlyGrowing][this.cropStage];void 0!==i&&e.renderSprite(t,m.images[i.tileset],i.spriteX,i.spriteY,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0})}actionWater(){this.cropStage===k.Empty&&(this.counterDry=0,this.cropStage=k.Watered)}actionPlant(){let t=this.scene.selectedInventoryItem;void 0!==t&&A.includes(t.type)&&this.cropStage===k.Watered&&(this.collision.enabled=!0,this.currentlyGrowing=t.type,this.cropStage=k.Growing,this.scene.removeFromInventoryByIndex(this.scene.globals.hotbar_selected_index,1))}}const R={[S.Chicken]:1,[S.Egg]:9,[S.WheatSeeds]:9,[S.Wheat]:9,[S.TomatoSeeds]:9,[S.Tomato]:9,[S.Hoe]:1,[S.WateringCan]:1,[S.Chest]:1},H={tileset:"tileset_ui",spriteX:15,spriteY:5},D={[S.Chicken]:{tileset:"tileset_chicken",spriteX:0,spriteY:0},[S.Egg]:{tileset:"tileset_egg",spriteX:0,spriteY:0},[S.WheatSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:0},[S.Wheat]:{tileset:"tileset_plants",spriteX:5,spriteY:0},[S.TomatoSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:1},[S.Tomato]:{tileset:"tileset_plants",spriteX:5,spriteY:1},[S.Hoe]:{tileset:"tileset_tools",spriteX:4,spriteY:4},[S.WateringCan]:{tileset:"tileset_tools",spriteX:0,spriteY:0},[S.Chest]:{tileset:"tileset_chest",spriteX:1,spriteY:1}},B=T.None,O={[S.Chicken]:T.Player,[S.Egg]:T.Player,[S.WheatSeeds]:T.Player,[S.Wheat]:T.Player,[S.TomatoSeeds]:T.Player,[S.Tomato]:T.Player,[S.Hoe]:T.Player,[S.WateringCan]:T.Player,[S.Chest]:T.Anywhere},F={[S.Chicken]:0,[S.Egg]:0,[S.WheatSeeds]:5,[S.Wheat]:10,[S.TomatoSeeds]:5,[S.Tomato]:10,[S.Hoe]:0,[S.WateringCan]:0,[S.Chest]:0};class N{constructor(t,e){var i,s,o;this.scene=t,this.type=e.type,this.maxStackSize=null!==(i=R[this.type])&&void 0!==i?i:1,this.sprite=null!==(s=D[this.type])&&void 0!==s?s:H,this.radius=null!==(o=O[this.type])&&void 0!==o?o:B,void 0!==e.currentStackSize?this.currentStackSize=e.currentStackSize>this.maxStackSize?this.maxStackSize:e.currentStackSize:this.currentStackSize=1}}class W extends h{constructor(e,i){super(e,i),this.scene=e,this.width=2,this.height=2,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=t.FIRST_UI_RENDER_LAYER+1,this.chest=i.chest,this.index=i.index}onUpdate(t){this.updateClicked()}onRender(t){this.renderContainer(t),this.renderItem(t),this.renderStackSize(t)}updateClicked(){void 0===this.parent.dragging&&s.isMousePressed()&&o.isMouseWithinObject(this)&&void 0!==this.item&&this.parent.startDraggingItem(this.chest?"chest":"inventory",this.index)}renderContainer(t){e.renderSprite(t,m.images.tileset_ui,.5,3.5,this.transform.position.world.x,this.transform.position.world.y,this.width,this.height,{centered:!0})}renderItem(t){void 0!==this.sprite&&e.renderSprite(t,m.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderStackSize(t){void 0!==this.item&&1!==this.item.maxStackSize&&e.renderText(t,`${this.item.currentStackSize}`,this.transform.position.world.x+.25,this.transform.position.world.y+.75)}get item(){return this.chest?this.chest.inventory[this.index]:this.scene.globals.inventory[this.index]}get sprite(){if(void 0!==this.item)return D[this.item.type]}}class P extends h{constructor(e,i){var s;super(e,i),this.scene=e,this.config=i,this.collision.enabled=!0,this.renderer.layer=null!==(s=i.renderLayer)&&void 0!==s?s:t.FIRST_UI_RENDER_LAYER,this.renderer.enabled=!0}onRender(i){e.fillRectangle(i,this.transform.position.world.x,this.transform.position.world.y,this.width*t.TILE_SIZE,this.height*t.TILE_SIZE,{colour:this.colour})}get colour(){return this.config.hexColourCode}}class G{}var V,z;G.ArrowRight={White:{Default:{x:15,y:0},Pressed:{x:16,y:0}}},G.ArrowLeft={White:{Default:{x:15,y:1},Pressed:{x:16,y:1}}},G.ArrowUp={White:{Default:{x:15,y:2},Pressed:{x:16,y:2}}},G.ArrowDown={White:{Default:{x:15,y:3},Pressed:{x:16,y:3}}},G.CheckMark={Green:{Default:{x:15,y:4},Pressed:{x:16,y:4}}},G.Cross={Red:{Default:{x:15,y:5,width:1,height:1},Pressed:{x:16,y:5,width:1,height:1}}},G.Button={White:{Default:{x:3.5,y:.5,width:2,height:2},Pressed:{x:6.5,y:.5,width:2,height:2}}},function(t){t[t.Default=0]="Default",t[t.Down=1]="Down",t[t.Up=2]="Up"}(V||(V={}));class U extends h{constructor(e,i){super(e,i),this.scene=e,this.width=2,this.height=2,this.state=V.Default,this.renderer.enabled=!0,this.renderer.layer=t.FIRST_UI_RENDER_LAYER+1}onUpdate(t){switch(this.state){case V.Default:this.updateDefault();break;case V.Down:this.updateDown();break;case V.Up:this.updateUp()}}onRender(t){this.renderButtonContainer(t),this.renderButtonIcon(t)}updateDefault(){s.isMousePressed()&&o.isMouseWithinObject(this)&&(this.state=V.Down)}updateDown(){s.isMousePressed()||(o.isMouseWithinObject(this)?this.state=V.Up:this.state=V.Default)}updateUp(){this.parent.destroy()}renderButtonContainer(t){const i=this.state===V.Default?G.Button.White.Default:G.Button.White.Pressed;e.renderSprite(t,m.images.tileset_basic,i.x,i.y,this.transform.position.world.x,this.transform.position.world.y,i.width,i.height,{centered:!0})}renderButtonIcon(t){const i=this.state===V.Default?G.Cross.Red.Default:G.Cross.Red.Pressed;e.renderSprite(t,m.images.tileset_basic,i.x,i.y,this.transform.position.world.x,this.transform.position.world.y,i.width,i.height,{centered:!0})}}!function(t){t.Close="tab"}(z||(z={}));class Z extends h{constructor(e,i){super(e,i),this.scene=e,this.chest=void 0,this.renderer.enabled=!0,this.renderer.layer=t.FIRST_UI_RENDER_LAYER+2,this.collision.layer=t.UI_COLLISION_LAYER,this.scene.globals.disable_player_inputs=!0,this.chest=i.chest}onAwake(){const e=[],i=this.chest?this.chest.rows:0,s=this.chest?this.chest.columns:0,o=(this.chest,5+(this.chest?s+1:0)),n=(t.CANVAS_TILE_HEIGHT-10)/2+1,r=(t.CANVAS_TILE_HEIGHT-2*i)/2+1,a=(t.CANVAS_TILE_WIDTH-2*o)/2+1;for(let t=0;t<5;t++)for(let i=0;i<5;i++){const s=5*t+i;e.push(new W(this.scene,{positionX:a+2*i,positionY:n+2*t,index:s}))}for(let t=0;t<i;t++)for(let i=0;i<s;i++){const o=t*s+i;this.chest&&e.push(new W(this.scene,{positionX:a+12+2*i,positionY:r+2*t,index:o,chest:this.chest}))}e.forEach((t=>this.addChild(t))),this.addChild(new U(this.scene,{positionX:30,positionY:2})),this.addChild(new P(this.scene,{positionX:0,positionY:0,hexColourCode:"#00000099",width:t.CANVAS_TILE_WIDTH,height:t.CANVAS_TILE_HEIGHT}))}onUpdate(t){this.updateDragging(),this.updateClose()}onRender(t){this.renderInventoryItem(t),this.renderInventoryItemStackSize(t)}onDestroy(){this.stopDraggingItem(),this.scene.globals.disable_player_inputs=!1,this.chest&&this.chest.actionClose()}get inventory(){return this.scene.globals.inventory}updateDragging(){if(void 0===this.dragging)return;if(!0===s.mouse.click.left)return;const t={position:{x:s.mouse.position.x,y:s.mouse.position.y},typeMatch:[W]},e=this.scene.getObject(t);if(e){const t="inventory"===this.dragging.source?this.scene.globals.inventory:this.chest.inventory,i=void 0===e.chest?this.scene.globals.inventory:this.chest.inventory;t[this.dragging.index]=i[e.index],i[e.index]=this.dragging.item}else this.stopDraggingItem();this.dragging=void 0}updateClose(){s.isKeyPressed(z.Close)&&(s.clearKeyPressed(z.Close),this.destroy())}renderInventoryItem(t){void 0!==this.dragging&&e.renderSprite(t,m.images[this.dragging.item.sprite.tileset],this.dragging.item.sprite.spriteX,this.dragging.item.sprite.spriteY,s.mouse.position.x-.5,s.mouse.position.y-.5)}renderInventoryItemStackSize(t){void 0!==this.dragging&&1!==this.dragging.item.maxStackSize&&e.renderText(t,`${this.dragging.item.currentStackSize}`,s.mouse.position.x+.25,s.mouse.position.y+.75)}startDraggingItem(t,e){this.dragging={item:this.getInventoryFromSource(t)[e],index:e,source:t},this.getInventoryFromSource(this.dragging.source)[e]=void 0}stopDraggingItem(){void 0!==this.dragging&&("inventory"===this.dragging.source?this.scene.globals.inventory[this.dragging.index]=this.dragging.item:"chest"===this.dragging.source&&(this.chest.inventory[this.dragging.index]=this.dragging.item))}getInventoryFromSource(t){return"chest"===t?this.chest.inventory:this.scene.globals.inventory}}const K={tileset:"tileset_chicken",x:0,y:0},$="tileset_chest";class q extends h{constructor(t,e){super(t,e),this.scene=t,this.isOpen=!1,this.inventory=[],this.rows=5,this.columns=5,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8}onRender(t){this.renderSprite(t)}interact(){this.actionOpen()}actionOpen(){this.isOpen=!0,this.scene.addObject(new Z(this.scene,{positionX:0,positionY:0,chest:this}))}actionClose(){this.isOpen=!1}renderSprite(t){this.isOpen?e.renderSprite(t,m.images[$],13,.5,this.transform.position.world.x,this.transform.position.world.y,1,2,{centered:!0}):e.renderSprite(t,m.images[$],1,.5,this.transform.position.world.x,this.transform.position.world.y,1,2,{centered:!0})}}class J extends h{constructor(e,i){super(e,i),this.scene=e,this.height=2,this.width=10,this.renderer.enabled=!0,this.renderer.layer=t.FIRST_UI_RENDER_LAYER,this.collision.layer=t.UI_COLLISION_LAYER}onUpdate(t){}onRender(t){!0!==this.scene.globals.disable_player_inputs&&(this.renderBackground(t),this.renderContainers(t),this.renderItems(t,this.inventory.slice(0,this.hotbarSize)),this.renderHotbarSelector(t))}renderHotbarSelector(t){const i=this.boundingBox.world.left+1+2*this.hotbarSelectedIndex,s=this.boundingBox.world.top+1;e.renderSprite(t,m.images.tileset_ui,9,9,i,s,2,2,{centered:!0})}renderBackground(t){e.fillRectangle(t,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"saddlebrown",type:"tile"})}renderContainers(t){for(let i=0;i<5;i++)e.renderSprite(t,m.images.tileset_ui,.5,3.5,this.boundingBox.world.left+1+2*i,this.boundingBox.world.top+1,2,2,{centered:!0})}renderItems(t,e){for(let i=0;i<5;i++){let s=e[i];void 0!==s&&this.renderInventoryItem(t,s.sprite.tileset,s.currentStackSize,s.maxStackSize,s.sprite.spriteX,s.sprite.spriteY,this.boundingBox.world.left+1+2*i,this.boundingBox.world.top+1)}}renderInventoryItem(t,i,s,o,n,r,a,h){e.renderSprite(t,m.images[i],n,r,a,h,1,1,{centered:!0}),o>1&&e.renderText(t,`${s}`,a+.75,h+1,{size:8})}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}get hotbarSize(){return this.scene.globals.hotbar_size}get hotbarSelectedIndex(){return this.scene.globals.hotbar_selected_index}}var Q,tt;!function(t){t.UP="w",t.DOWN="s",t.LEFT="a",t.RIGHT="d"}(Q||(Q={})),function(t){t.Inventory="tab",t.Interact="e",t.InteractAlt=" "}(tt||(tt={}));class et extends h{constructor(t,e){super(t,e),this.scene=t,this.targetX=-1,this.targetY=-1,this.movementSpeed=4,this.animations={[Q.RIGHT]:[{x:7,y:10},{x:10,y:10}],[Q.LEFT]:[{x:7,y:7},{x:10,y:7}],[Q.UP]:[{x:7,y:4},{x:10,y:4}],[Q.DOWN]:[{x:7,y:1},{x:10,y:1}]},this.animationsIdle={[Q.RIGHT]:[{x:1,y:10},{x:4,y:10}],[Q.LEFT]:[{x:1,y:7},{x:4,y:7}],[Q.UP]:[{x:1,y:4},{x:4,y:4}],[Q.DOWN]:[{x:1,y:1},{x:4,y:1}]},this.hotbar=void 0,this.direction=Q.DOWN,this.directionTime=0,this.directionTimer=0,this.animationIndex=0,this.isIdle=!0,this.movementEnabled=!1,this.hotbarEnabled=!1,this.leftClickEnabled=!1,this.inventoryEnabled=!1,this.interactButtonEnabled=!1,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=10,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.enableMovement(),this.enableInteractKeys(),this.enableInventoryKeys(),this.enableOtherKeys()}enableMovement(){this.movementEnabled=!0}enableOtherKeys(){this.hotbarEnabled=!0,this.leftClickEnabled=!0}enableInventoryKeys(){this.inventoryEnabled=!0}enableInteractKeys(){this.interactButtonEnabled=!0}onAwake(){this.addHotbar()}onUpdate(t){this.updateMovement(t),this.updateAnimations(t),this.updateHotbarViaKey(),this.updateHotbarViaWheel(),this.updateLeftClick(),this.updateButtonInteract(),this.updateOpenInventory(),this.latestScrollTimestamp=s.mouse.wheel.event.timeStamp}onRender(t){this.renderSprite(t),this.renderCursor(t)}updateMovement(t){!0!==this.scene.globals.disable_player_inputs&&!1!==this.movementEnabled&&(this.determineNextMovement(t),this.processMovement(t))}determineNextMovement(t){if(this.targetX!==this.transform.position.world.x||this.targetY!==this.transform.position.world.y)return;if(!s.isKeyPressed([Q.RIGHT,Q.LEFT,Q.UP,Q.DOWN]))return;let e,i=new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY);if(s.isKeyPressed(Q.RIGHT)?(i.targetX+=1,e=Q.RIGHT):s.isKeyPressed(Q.LEFT)?(i.targetX-=1,e=Q.LEFT):s.isKeyPressed(Q.UP)?(i.targetY-=1,e=Q.UP):s.isKeyPressed(Q.DOWN)&&(i.targetY+=1,e=Q.DOWN),this.direction!==e?(this.direction=e,this.directionTime=0,this.directionTimer=0):this.directionTimer+=t,this.directionTimer<.05)return;const o={boundingBox:h.calculateBoundingBox(i.target.x,i.target.y,this.width,this.height),objectIgnore:new Map([[this,!0]])};this.scene.getObject(o)||this.scene.isOutOfBounds(i.targetX,i.targetY)||(this.targetX=i.targetX,this.targetY=i.targetY)}updateAnimations(t){this.targetX!==this.transform.position.world.x||this.targetY!==this.transform.position.world.y?this.isIdle=!1:this.isIdle=!0,this.isIdle?this.directionTime<.5?this.animationIndex=0:this.animationIndex=1:this.directionTime<.25?this.animationIndex=0:this.directionTime<.5?this.animationIndex=1:this.directionTime<.75?this.animationIndex=0:this.animationIndex=1,this.directionTime=(this.directionTime+t)%1}processMovement(t){if(this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y){let e=new w(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=x.moveTowardsPosition(e,x.frameSpeed(this.movementSpeed,t));this.transform.position.local.x=i.positionX,this.transform.position.local.y=i.positionY}}updateButtonInteract(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.interactButtonEnabled)return;if(!s.isKeyPressed([tt.Interact,tt.InteractAlt]))return;s.clearKeyPressed([tt.Interact,tt.InteractAlt]);let t=this.transform.position.world.x,e=this.transform.position.world.y;switch(this.direction){case Q.UP:e-=1;break;case Q.RIGHT:t+=1;break;case Q.DOWN:e+=1;break;case Q.LEFT:t-=1}const i={position:{x:t,y:e},objectIgnore:new Map([[this,!0]])};let o=this.scene.getObject(i);void 0!==o&&function(t){return"interact"in t}(o)&&o.interact()}getPositionFacing(){let t=Math.floor(this.transform.position.world.x),e=Math.floor(this.transform.position.world.y);return this.direction===Q.RIGHT?{x:t+1,y:e}:this.direction===Q.LEFT?{x:t-1,y:e}:this.direction===Q.UP?{x:t,y:e-1}:this.direction===Q.DOWN?{x:t,y:e+1}:void 0}updateHotbarViaKey(){!0!==this.scene.globals.disable_player_inputs&&!1!==this.hotbarEnabled&&(!0!==s.isKeyPressed("1")?!0!==s.isKeyPressed("2")?!0!==s.isKeyPressed("3")?!0!==s.isKeyPressed("4")?!0!==s.isKeyPressed("5")||(this.scene.globals.hotbar_selected_index=4):this.scene.globals.hotbar_selected_index=3:this.scene.globals.hotbar_selected_index=2:this.scene.globals.hotbar_selected_index=1:this.scene.globals.hotbar_selected_index=0)}updateHotbarViaWheel(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.hotbarEnabled)return;if(this.latestScrollTimestamp===s.mouse.wheel.event.timeStamp)return;const t=this.scene.globals.hotbar_selected_index;s.mouse.wheel.event.deltaY>0?t===this.scene.globals.hotbar_size-1?this.scene.globals.hotbar_selected_index=0:this.scene.globals.hotbar_selected_index++:s.mouse.wheel.event.deltaY<0&&(0===t?this.scene.globals.hotbar_selected_index=this.scene.globals.hotbar_size-1:this.scene.globals.hotbar_selected_index--)}updateOpenInventory(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.inventoryEnabled)return;let t=[tt.Inventory];!1!==s.isKeyPressed(t)&&(this.scene.addObject(new Z(this.scene,{positionX:0,positionY:0})),s.clearKeyPressed(t))}updateLeftClick(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.leftClickEnabled)return;if(!s.isMousePressed(i.Left))return;s.clearMousePressed(i.Left);const t=this.scene.selectedInventoryItem;if(void 0===t)return;if(t.radius===T.None)return;const e=Math.round(s.mouse.position.x+this.scene.globals.camera.startX),o=Math.round(s.mouse.position.y+this.scene.globals.camera.startY);if(t.radius===T.Player&&Math.abs(e-this.transform.position.world.roundedX)>1||Math.abs(o-this.transform.position.world.roundedY)>1)return;const n={position:{x:e,y:o}},r=this.scene.getObject(n);if(void 0===r)switch(t.type){case S.Hoe:return void function(t){const e=Math.round(s.mouse.position.x+t.globals.camera.startX),i=Math.round(s.mouse.position.y+t.globals.camera.startY),o=new M(t,{positionX:e,positionY:i});t.addObject(o)}(this.scene);case S.WateringCan:return void function(t){t.globals.disable_player_inputs=!0;const e=new L(t,{text:"There is nothing to water...",onComplete:()=>{t.globals.disable_player_inputs=!1}});t.addObject(e)}(this.scene);case S.Chicken:return void function(t){const e=Math.round(s.mouse.position.x+t.globals.camera.startX),i=Math.round(s.mouse.position.y+t.globals.camera.startY),o=new ot(t,{positionX:e,positionY:i});t.addObject(o),t.removeFromInventoryByIndex(t.selectedInventoryIndex,1)}(this.scene);case S.Egg:return void function(t){const e=Math.round(s.mouse.position.x+t.globals.camera.startX),i=Math.round(s.mouse.position.y+t.globals.camera.startY),o=new it(t,{positionX:e,positionY:i});t.addObject(o),t.removeFromInventoryByIndex(t.selectedInventoryIndex,1)}(this.scene);case S.TomatoSeeds:case S.WheatSeeds:return void function(t){t.globals.disable_player_inputs=!0;const e=new L(t,{text:"Seeds can only be placed in watered dirt.",onComplete:()=>{t.globals.disable_player_inputs=!1}});t.addObject(e)}(this.scene);case S.Chest:return void function(t){const e=Math.round(s.mouse.position.x+t.globals.camera.startX),i=Math.round(s.mouse.position.y+t.globals.camera.startY),o=new q(t,{positionX:e,positionY:i});t.addObject(o),t.removeFromInventoryByIndex(t.selectedInventoryIndex,1)}(this.scene);default:return}else switch(t.type){case S.WateringCan:switch(!0){case r instanceof M:return void function(t,e){e.actionWater()}(this.scene,r);case r instanceof ot:return void function(t,e){t.globals.disable_player_inputs=!0;const i=new L(t,{text:"Hey could you not water me please...",portrait:K,name:"Chicken",onComplete:()=>{t.globals.disable_player_inputs=!1}});t.addObject(i)}(this.scene);default:return}case S.TomatoSeeds:case S.WheatSeeds:return 1==r instanceof M?void function(t,e){if(e.cropStage===k.Watered)e.actionPlant();else{t.globals.disable_player_inputs=!0;const e=new L(t,{text:"Seeds can only be placed in watered dirt.",onComplete:()=>{t.globals.disable_player_inputs=!1}});t.addObject(e)}}(this.scene,r):void 0;case S.Tomato:case S.Wheat:return 1==r instanceof ot?void function(t,e){e.actionGiveItem()}(this.scene,r):void 0;default:return}}renderSprite(t){let i=this.isIdle?this.animationsIdle:this.animations;e.renderSprite(t,m.images.tileset_player,i[this.direction][this.animationIndex].x,i[this.direction][this.animationIndex].y,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderCursor(t){if(!0===this.scene.globals.disable_player_inputs)return;if(!this.leftClickEnabled)return;let i=Math.round(s.mouse.position.x+this.scene.globals.camera.startX),o=Math.round(s.mouse.position.y+this.scene.globals.camera.startY),n=this.scene.selectedInventoryItem;void 0!==n&&n.radius!==T.None&&(i===this.transform.position.world.roundedX&&o===this.transform.position.world.roundedY||n.radius===T.Player&&Math.abs(i-this.transform.position.world.roundedX)>1||Math.abs(o-this.transform.position.world.roundedY)>1||e.fillRectangle(t,i-.5,o-.5,1,1,{colour:"#0000ff33",type:"tile"}))}addHotbar(){this.hotbar||(this.hotbar=new J(this.scene,{positionX:16,positionY:16}),this.scene.addObject(this.hotbar))}removeHotbar(){void 0!==this.hotbar&&this.hotbar.destroy()}}class it extends h{constructor(t,e){super(t,e),this.scene=t,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.hatchTimer=0,this.hatchTimerMax=7,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=7}onUpdate(t){this.updateAnimation(t),this.updateHatch(t)}onRender(t){e.renderSprite(t,m.images.tileset_egg,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0})}updateAnimation(t){this.animationTimer=(this.animationTimer+t)%1,this.animationIndex=0}updateHatch(t){if(this.hatchTimer+=t,this.hatchTimer<this.hatchTimerMax)return;const e=this.scene.getObject({typeMatch:[et]}),i=new ot(this.scene,{positionX:this.transform.position.world.x,positionY:this.transform.position.world.y,follows:e});this.destroy(),this.scene.addObject(i)}interact(){void 0!==this.scene.addToInventory(S.Egg)&&this.destroy()}}const st={tileset:"tileset_chicken",x:0,y:0};class ot extends h{constructor(t,e){var i,s;super(t,e),this.scene=t,this.targetX=-1,this.targetY=-1,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=f.randomStartingDelta(4),this.animationIndex=0,this.movementSpeed=2,this.movementTimer=f.randomStartingDelta(2),this.movementDelay=2,this.eggTimer=f.randomStartingDelta(2),this.eggTimerMax=7,this.eggMax=200,this.isMovingThisFrame=!1,this.isEdgyTeen=!1,this.interactionCount=0,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.canLayEggs=null!==(i=e.canLayEggs)&&void 0!==i&&i,this.isEdgyTeen=3===f.randomIntFromRange(0,3),this.canMove=null!==(s=e.canMove)&&void 0!==s&&s,this.following=e.follows,console.log(this.onRender)}onUpdate(t){this.isMovingThisFrame=!1,this.updateMovement(t),this.updateAnimation(t),this.updateEgg(t)}onRender(t){e.renderSprite(t,m.images.tileset_chicken,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}updateAnimation(t){this.animationTimer=(this.animationTimer+t)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}updateMovement(t){this.canMove&&(this.movementTimer+=t,this.movementTimer>this.movementDelay&&this.determineNextMovement(t),this.processMovement(t))}determineNextMovement(t){let e;this.movementTimer=0,e=this.following?x.moveTowardsOtherEntity(new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY),{positionX:this.following.transform.position.world.x,positionY:this.following.transform.position.world.y}):x.moveInRandomDirection(new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY));const i={position:{x:e.targetX,y:e.targetY},objectIgnore:new Map([[this,!0]])};this.scene.getObject(i)||this.scene.isOutOfBounds(e.targetX,e.targetY)||(this.targetX=e.targetX,this.targetY=e.targetY)}processMovement(t){if(this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y){let e=new w(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=x.moveTowardsPosition(e,x.frameSpeed(this.movementSpeed,t));this.transform.position.local.x=i.positionX,this.transform.position.local.y=i.positionY,this.isMovingThisFrame=!0}}updateEgg(t){if(!this.canLayEggs)return;if(this.eggTimer+=t,this.eggTimer<this.eggTimerMax)return;if(!this.isMovingThisFrame)return;if(this.scene.getObjects({typeMatch:[ot,it]}).length>this.eggMax)return;let e;e=this.transform.position.world.x>this.targetX||this.transform.position.world.y>this.targetY?Math.ceil:Math.floor,this.scene.addObject(new it(this.scene,{positionX:e(this.transform.position.world.x),positionY:e(this.transform.position.world.y)})),this.eggTimer=0}interact(){this.interactDefault()}interactDefault(){this.scene.globals.disable_player_inputs=!0;let t="";if(this.isEdgyTeen)switch(this.interactionCount%3){case 0:t="GET OUT OF MY ROOM MOM! GODDDD!!1!";break;case 1:t="UGHHHH! YOU ARE LIKE SO EMBARRASSING!1!11!";break;case 2:t="OMG!1!1 JUST LIKE LEAVE ME ALONE!1!11!!"}else switch(this.interactionCount%3){case 0:t="bock bock ... can i help you? ... cluck cluck ...";break;case 1:t="cluck cluck ... you're sort of annoying you know that? ... bock bock ...";break;case 2:t="bock cluck ... is... is this a simulation? ... cluck bock ..."}let e=new L(this.scene,{text:t,portrait:st,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(e),this.interactionCount++}actionGiveItem(){switch(this.scene.selectedInventoryItem.type){case S.Tomato:return void this.actionGiveTomato();case S.Wheat:return void this.actionGiveWheat()}}actionGiveTomato(){this.scene.globals.disable_player_inputs=!0;let t=new L(this.scene,{text:"I LOooOooOoOooOoOVE TOMATOES!",portrait:st,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}),e=this.scene.globals.inventory.indexOf(this.scene.selectedInventoryItem);this.scene.removeFromInventoryByIndex(e,1),this.scene.addObject(t)}actionGiveWheat(){this.scene.globals.disable_player_inputs=!0;let t=new L(this.scene,{text:"I HAAAAAAAAAAAAAAAATE WHEAT!",portrait:st,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(t)}}const nt={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},rt=[nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt,nt],at={index:0,tiles:[[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt],[...rt]]},ht={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},lt={...ht,animationFrames:[{spriteX:2,spriteY:1}]},dt={...ht,animationFrames:[{spriteX:1,spriteY:2}]},ct={...ht,animationFrames:[{spriteX:2,spriteY:2}]},pt={...ht,animationFrames:[{spriteX:5,spriteY:1}]},gt={index:1,tiles:[[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,pt,lt,lt,lt,lt,lt,lt,ct],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,pt,lt,lt,lt,ct],[void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,dt],[void 0,void 0,void 0,void 0,dt],[lt,lt,lt,lt,ct]]};class ut extends h{constructor(t,e){super(t,e),this.scene=t,this.collision.enabled=!0}}const mt={tileset:"tileset_grass",animationFrameDuration:1,animationFrames:[],animationMap:[1]},bt={...mt,animationFrames:[{spriteX:1,spriteY:1}]},yt={...mt,animationFrames:[{spriteX:2,spriteY:1}]},vt=[bt,bt,bt,bt,bt,bt,bt,bt,bt,bt,bt,bt,bt,bt,bt,bt,bt,bt,{...mt,animationFrames:[{spriteX:1,spriteY:2}]}],ft={index:1,tiles:[vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,[yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,{...mt,animationFrames:[{spriteX:2,spriteY:2}]}]]};class wt{constructor(t,e){this.tileset=t,this.frames=e,this.duration=e.reduce(((t,e)=>t+e.duration),0)}currentFrame(t){let e=t%this.duration,i=0;for(let t=0;t<this.frames.length;t++)if(i+=this.frames[t].duration,e<i)return this.frames[t];return this.frames[0]}}const xt={tileset:"tileset_chicken",x:0,y:0},It={idle:new wt("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}]),moving:new wt("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}])};class Et extends h{constructor(t,e){var i,s,o,n,r;super(t,e),this.scene=t,this.state="idle",this.targetX=-1,this.targetY=-1,this.animation={index:0,timer:0},this.movementTimer=f.randomStartingDelta(2),this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.canMove=null!==(i=e.canMove)&&void 0!==i&&i,this.following=e.follows,this.dialogue=e.dialogue,this.animations=null!==(s=e.animations)&&void 0!==s?s:It,this.movementSpeed=null!==(o=e.movementSpeed)&&void 0!==o?o:2,this.movementDelay=null!==(n=e.movementDelay)&&void 0!==n?n:void 0,this.name=null!==(r=e.name)&&void 0!==r?r:"???"}onUpdate(t){this.updateMovement(t),this.updateAnimationTimer(t)}onRender(t){let i=this.animations[this.state],s=i.currentFrame(this.animation.timer);e.renderSprite(t,m.images[i.tileset],s.spriteX,s.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{opacity:this.renderer.opacity,scale:this.renderer.scale,centered:!0})}updateAnimationTimer(t){this.animation.timer=(this.animation.timer+t)%this.animations[this.state].duration}updateMovement(t){this.canMove&&(this.movementTimer+=t,(void 0===this.movementDelay&&this.movementTimer>this.movementSpeed||this.movementTimer>this.movementDelay)&&this.determineNextMovement(t),this.processMovement(t))}determineNextMovement(t){let e;this.movementTimer=0,e=this.following?x.moveTowardsOtherEntity(new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY),{positionX:this.following.transform.position.world.x,positionY:this.following.transform.position.world.y}):x.moveInRandomDirection(new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY));const i={position:{x:e.targetX,y:e.targetY},objectIgnore:new Map([[this,!0]])};this.scene.getObject(i)||this.scene.isOutOfBounds(e.targetX,e.targetY)||(this.targetX=e.targetX,this.targetY=e.targetY)}processMovement(t){if(this.targetX!==this.transform.position.world.x||this.targetY!==this.transform.position.world.y){let e=new w(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY),i=x.moveTowardsPosition(e,x.frameSpeed(this.movementSpeed,t));this.transform.position.world.x=i.positionX,this.transform.position.world.y=i.positionY}}interact(){if(void 0===this.dialogue)return;let t=new L(this.scene,{text:this.dialogue,portrait:xt,name:this.name});this.scene.addObject(t)}}class St extends h{constructor(e,i){super(e,i),this.scene=e,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=t.FIRST_UI_RENDER_LAYER,this.price=i.price,this.type=i.type}onUpdate(t){this.updateClicked()}onRender(t){this.renderContainer(t),this.renderItem(t),this.renderPrice(t)}updateClicked(){s.isMousePressed()&&o.isMouseWithinObject(this)&&(s.clearMousePressed(i.Left),this.price>this.scene.globals.gold||(this.scene.addToInventory(this.type)&&(this.scene.globals.gold-=this.price),this.parent.refreshShopState()))}renderContainer(t){e.fillRectangle(t,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"white",type:"tile"})}renderItem(t){e.renderSprite(t,m.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderPrice(t){e.renderText(t,`$${this.price}`,this.transform.position.world.x,this.transform.position.world.y+1)}get sprite(){return D[this.type]}}class Tt extends h{constructor(e,i){super(e,i),this.scene=e,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=t.FIRST_UI_RENDER_LAYER,this.type=i.type,this.count=i.count,this.index=i.index}onUpdate(t){this.updateClicked()}onRender(t){this.renderContainer(t),this.renderItem(t),this.renderPrice(t),this.renderStackSize(t)}get price(){return F[this.type]}updateClicked(){s.isMousePressed()&&o.isMouseWithinObject(this)&&(s.clearMousePressed(i.Left),this.scene.globals.gold+=this.price,this.scene.removeFromInventoryByIndex(this.index,1),this.parent.refreshShopState())}renderContainer(t){e.fillRectangle(t,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"white",type:"tile"})}renderItem(t){e.renderSprite(t,m.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderPrice(t){e.renderText(t,`$${this.price}`,this.transform.position.world.x-1,this.transform.position.world.y)}renderStackSize(t){e.renderText(t,`${this.count}`,this.transform.position.world.x,this.transform.position.world.y+1)}get sprite(){return D[this.type]}}var _t;!function(t){t.Close="tab"}(_t||(_t={}));const Ct=[{type:S.TomatoSeeds,price:5},{type:S.WheatSeeds,price:5},{type:S.Hoe,price:50},{type:S.WateringCan,price:50},{type:S.Chest,price:500}];class Yt extends h{constructor(e,i){super(e,i),this.scene=e,this.renderer.enabled=!0,this.renderer.layer=t.FIRST_UI_RENDER_LAYER,this.collision.layer=t.UI_COLLISION_LAYER,this.onLeave=i.onLeave}onAwake(){this.refreshShopState()}onUpdate(t){this.updateButtonClose(),this.updateClickClose()}onRender(t){this.renderBackground(t),this.renderShopBackground(t),this.renderShopTitle(t),this.renderInventoryBackground(t),this.renderInventoryTitle(t),this.renderTotalGold(t),this.renderLeaveButton(t)}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}updateButtonClose(){s.isKeyPressed(_t.Close)&&(s.clearKeyPressed(_t.Close),this.close())}updateClickClose(){s.isMousePressed(i.Left)&&o.isMouseWithinBoundary(s.mouse.position,21.5,12,4.5,1.5)&&(s.clearMousePressed(i.Left),this.close())}close(){this.destroy(),this.onLeave&&this.onLeave()}renderBackground(t){e.fillRectangle(t,0,0,32,18,{colour:"#00000055",type:"tile"})}renderShopBackground(t){e.fillRectangle(t,1,1,14,10,{colour:"brown",type:"tile"})}renderShopTitle(t){e.fillRectangle(t,4,.25,8,1.5,{colour:"goldenrod",type:"tile"}),e.renderText(t,"Shop (buy)",6,1.25)}renderInventoryBackground(t){e.fillRectangle(t,17,1,14,11.75,{colour:"brown",type:"tile"})}renderInventoryTitle(t){e.fillRectangle(t,20,.25,8,1.5,{colour:"goldenrod",type:"tile"}),e.renderText(t,"Inventory (sell)",21,1.25)}renderTotalGold(t){e.fillRectangle(t,26.5,12,4.5,1.5,{colour:"goldenrod",type:"tile"}),e.renderText(t,`Gold: ${this.scene.globals.gold}`,27,13)}renderLeaveButton(t){e.fillRectangle(t,21.5,12,4.5,1.5,{colour:"grey",type:"tile"}),e.renderText(t,"Leave",22.5,13)}refreshShopState(){this.removeAllChildren();for(let t=0;t<Ct.length;t++){const e=Ct[t],i=new St(this.scene,{positionX:this.transform.position.world.x+3+2.5*t,positionY:this.transform.position.world.y+3,price:e.price,type:e.type});this.addChild(i)}const t=this.scene.globals.hotbar_size;for(let e=0;e<5;e++)for(let i=0;i<4;i++){const s=e+5*i+t,o=this.inventory[s];if(void 0===o)continue;const n=new Tt(this.scene,{positionX:this.transform.position.world.x+19+2.5*e,positionY:this.transform.position.world.y+3+2.5*i,type:o.type,count:o.currentStackSize,index:s});this.addChild(n)}}}const Lt={tileset:"tileset_player",x:1,y:1},Xt={idle:new wt("tileset_player",[{spriteX:1,spriteY:1,duration:.5},{spriteX:4,spriteY:1,duration:.5}]),moving:new wt("tileset_player",[])};class At extends Et{constructor(t,e){e.animations=Xt,super(t,e),this.scene=t,this.firstConversation=!0}onUpdate(t){super.onUpdate(t)}interact(){this.scene.globals.disable_player_inputs=!0,this.firstConversation?this.startStageFirstConversation():this.startStageGreeting()}startStageFirstConversation(){this.scene.addObject(new L(this.scene,{text:"Hi, I don't think we've met. I'm the shop keeper. I have farming supplies for sale and will buy most things you grow.",portrait:Lt,name:"???",onComplete:()=>{this.firstConversation=!1,this.startStageGreeting()}}))}startStageGreeting(){this.scene.globals.disable_player_inputs=!0,this.scene.addObject(new L(this.scene,{text:"Welcome to my shop, how can I help?",portrait:Lt,name:"Shopkeeper",onComplete:()=>{this.scene.addObject(new Yt(this.scene,{positionX:0,positionY:0,onLeave:this.leaveShopCallback}))}}))}leaveShopCallback(){this.scene.addObject(new L(this.scene,{text:"Thanks, come again any time!",portrait:Lt,name:"Shopkeeper",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}))}}class kt{}kt.TopLeft={x:1,y:0},kt.TopRight={x:3,y:0},kt.BottomLeft={x:1,y:2},kt.BottomRight={x:3,y:2},kt.LeftHorizontal={x:1,y:3},kt.MiddleHorizontal={x:2,y:3},kt.RightHorizontal={x:3,y:3},kt.TopVertical={x:0,y:0},kt.MiddleVertical={x:0,y:1},kt.BottomVertical={x:0,y:2},kt.FencePost={x:0,y:3},kt.Open={x:.5,y:3};class jt extends h{constructor(t,e){super(t,e),this.scene=t,this.type=kt.FencePost,this.open=!1,this.collision.enabled=!0,this.renderer.enabled=!0,e.type&&(this.type=e.type)}onRender(t){e.renderSprite(t,m.images.tileset_fence,this.open?kt.Open.x:this.type.x,this.open?kt.Open.y:this.type.y,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0})}interact(){}}const Mt=t.CANVAS_TILE_WIDTH/2,Rt=t.CANVAS_TILE_HEIGHT/2;class Ht extends h{constructor(e,i){var s,o,n,r,a;super(e,i),this.scene=e,this.animationTimer=0,this.renderer.enabled=!0,this.renderer.layer=t.LAST_UI_RENDER_LAYER,this.animationType=null!==(s=i.animationType)&&void 0!==s?s:"block",this.animationDirection=null!==(o=i.animationDirection)&&void 0!==o?o:"in",this.animationLength=null!==(n=i.animationLength)&&void 0!==n?n:1,this.animationCenterX=null!==(r=i.animationCenterX)&&void 0!==r?r:Mt,this.animationCenterY=null!==(a=i.animationCenterY)&&void 0!==a?a:Rt}onUpdate(t){this.animationTimer+=t,this.animationTimer>this.animationLength&&this.destroy()}get animationPercentage(){return this.animationTimer/this.animationLength}onRender(t){switch(this.animationType){case"block":this.renderAnimationBlock(t);break;case"circle":this.renderAnimationCircle(t)}}renderAnimationBlock(i){let s="in"===this.animationDirection?1-this.animationPercentage:this.animationPercentage;e.fillRectangle(i,0,0,t.CANVAS_WIDTH,t.CANVAS_HEIGHT,{colour:`rgba(0, 0, 0, ${s})`})}renderAnimationCircle(e){let i="in"===this.animationDirection?this.animationPercentage:1-this.animationPercentage,s=this.animationCenterX-this.scene.globals.camera.startX,o=this.animationCenterY-this.scene.globals.camera.startY;e.fillStyle="black",e.beginPath(),e.arc(s*t.TILE_SIZE,o*t.TILE_SIZE,t.CANVAS_WIDTH*i,0,2*Math.PI),e.rect(t.CANVAS_WIDTH,0,-1*t.CANVAS_WIDTH,t.CANVAS_HEIGHT),e.fill()}}const Dt={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},Bt={...Dt,animationFrames:[{spriteX:9.5,spriteY:4}]},Ot={...Dt,animationFrames:[{spriteX:10.5,spriteY:4}]},Ft={...Dt,animationFrames:[{spriteX:8.5,spriteY:5}]},Nt={...Dt,animationFrames:[{spriteX:9.5,spriteY:5}]},Wt={...Dt,animationFrames:[{spriteX:10.5,spriteY:5}]},Pt={index:1,tiles:[[],[],[],[],[],[],[],[],[],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ft,{...Dt,animationFrames:[{spriteX:8.5,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,Bt,Nt,{...Dt,animationFrames:[{spriteX:9.5,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ot,Wt,{...Dt,animationFrames:[{spriteX:10.5,spriteY:6}]}],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]},Gt=()=>{};class Vt extends h{constructor(t,e){var i,s;super(t,e),this.scene=t,this.timer=0,this.intervalsComplete=0,this.duration=null!==(i=e.duration)&&void 0!==i?i:1,this.onInterval=null!==(s=e.onInterval)&&void 0!==s?s:Gt,this.maxIntervals=e.maxIntervals}onUpdate(t){this.timer+=t,this.timer>=this.duration&&(this.onInterval(),this.timer-=this.duration,this.intervalsComplete++,this.maxIntervals&&this.intervalsComplete>=this.maxIntervals&&this.destroy())}}class zt extends h{constructor(e,i){super(e,i),this.scene=e,this.renderer.enabled=!0,this.renderer.layer=t.FIRST_UI_RENDER_LAYER}onUpdate(t){o.wasObjectClicked(this)&&(s.clearMousePressed(i.Left),document.fullscreenElement||document.webkitIsFullScreen?document.exitFullscreen():this.scene.displayContext.canvas.requestFullscreen().then((()=>{})).catch((t=>{throw new Error(t)})))}onRender(t){e.renderSprite(t,m.images.tileset_fullscreen,this.isFullscreen?1:0,0,this.boundingBox.world.left,this.boundingBox.world.top)}get isFullscreen(){return!(!document.fullscreenElement&&!document.webkitIsFullScreen)}}class Ut extends h{constructor(i,s){var o;super(i,s),this.scene=i,this.customerRenderer=i=>{const s=this.cameraOffsetX/this.zoom,o=this.cameraOffsetY/this.zoom;let n=this.object.transform.position.world.x-s,r=this.object.transform.position.world.y-o,a=this.object.transform.position.world.x+(s+1),h=this.object.transform.position.world.y+(o+1);n<0?(n=0,a=n+t.CANVAS_TILE_WIDTH):a>this.scene.map.width&&(a=this.scene.map.width,n=a-t.CANVAS_TILE_WIDTH),r<0?(r=0,h=r+t.CANVAS_TILE_HEIGHT):h>this.scene.map.height&&(h=this.scene.map.height,r=h-t.CANVAS_TILE_HEIGHT),this.scene.globals.camera.startX=n,this.scene.globals.camera.startY=r,this.scene.globals.camera.endX=a,this.scene.globals.camera.endY=h,i.background.forEach((t=>{e.renderSubsection(t,this.mainContext,n,r,a,h)})),i.objects.forEach(((i,s)=>{s>=t.FIRST_UI_RENDER_LAYER?e.renderSubsection(i,this.mainContext,0,0,t.CANVAS_TILE_WIDTH,t.CANVAS_TILE_HEIGHT):e.renderSubsection(i,this.mainContext,n,r,a,h)}))},this.cameraOffsetX=t.CANVAS_TILE_WIDTH/2-.5,this.cameraOffsetY=t.CANVAS_TILE_HEIGHT/2-.5,this.object=s.object,this.zoom=null!==(o=s.zoom)&&void 0!==o?o:1,this.scene.setCustomRenderer(this.customerRenderer)}onDestroy(){this.scene.removeCustomerRenderer()}}class Zt extends n{constructor(t){super(t),this.scene=t,this.height=100,this.width=100,this.backgroundLayers=[at,ft,gt,Pt],this.objects=[],o.setCursor(this.scene.displayContext.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.objects.push(new zt(t,{positionX:31,positionY:1}));let e=new et(t,{positionX:10,positionY:9});this.objects.push(e),this.objects.push(new At(t,{positionX:10,positionY:8})),this.objects.push(new q(t,{positionX:10,positionY:10})),this.objects.push(new ot(t,{positionX:10,positionY:13,follows:e,canLayEggs:!0,canMove:!0}));for(let e=0;e<4;e++)for(let i=0;i<16;i++)this.objects.push(new M(t,{positionX:2+i,positionY:2+e,growing:{stage:k.FullyGrown,itemType:S.WheatSeeds}}));for(let e=0;e<6;e++)for(let i=0;i<3;i++)this.objects.push(new M(t,{positionX:6+i,positionY:10+e,growing:{stage:k.FullyGrown,itemType:S.WheatSeeds}}));for(let e=0;e<4;e++)for(let i=0;i<4;i++)this.objects.push(new M(t,{positionX:21+i,positionY:6+e,growing:{stage:k.FullyGrown,itemType:S.WheatSeeds}}));for(let e=0;e<6;e++)for(let i=0;i<13;i++)this.objects.push(new M(t,{positionX:12+i,positionY:10+e,growing:{stage:k.FullyGrown,itemType:S.WheatSeeds}}));for(let e=0;e<19;e++)for(let i=0;i<1;i++){let i=18===e?kt.FencePost:kt.MiddleVertical;this.objects.push(new jt(t,{positionX:27,positionY:0+e,type:i}))}for(let e=0;e<1;e++)for(let e=0;e<28;e++){let i=27===e?kt.BottomRight:kt.MiddleHorizontal;this.objects.push(new jt(t,{positionX:0+e,positionY:18,type:i}))}this.objects.push(new jt(t,{positionX:25,positionY:0,type:kt.MiddleVertical}),new jt(t,{positionX:26,positionY:0,type:kt.FencePost})),this.objects.push(new jt(t,{positionX:25,positionY:2,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:25,positionY:1,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:19,positionY:3,type:kt.TopLeft}),new jt(t,{positionX:20,positionY:3,type:kt.MiddleHorizontal}),new jt(t,{positionX:21,positionY:3,type:kt.MiddleHorizontal}),new jt(t,{positionX:22,positionY:3,type:kt.MiddleHorizontal}),new jt(t,{positionX:23,positionY:3,type:kt.MiddleHorizontal}),new jt(t,{positionX:24,positionY:3,type:kt.MiddleHorizontal}),new jt(t,{positionX:25,positionY:3,type:kt.BottomRight})),this.objects.push(new jt(t,{positionX:19,positionY:4,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:19,positionY:5,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:19,positionY:6,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:4,positionY:7,type:kt.TopLeft}),new jt(t,{positionX:5,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:6,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:7,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:8,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:9,positionY:7,type:kt.RightHorizontal}),new jt(t,{positionX:11,positionY:7,type:kt.LeftHorizontal}),new jt(t,{positionX:12,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:13,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:14,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:15,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:16,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:17,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:18,positionY:7,type:kt.MiddleHorizontal}),new jt(t,{positionX:19,positionY:7,type:kt.BottomRight})),this.objects.push(new jt(t,{positionX:4,positionY:8,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:4,positionY:9,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:4,positionY:10,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:4,positionY:11,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:4,positionY:12,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:4,positionY:13,type:kt.MiddleVertical})),this.objects.push(new jt(t,{positionX:0,positionY:14,type:kt.MiddleHorizontal}),new jt(t,{positionX:1,positionY:14,type:kt.MiddleHorizontal}),new jt(t,{positionX:2,positionY:14,type:kt.MiddleHorizontal}),new jt(t,{positionX:3,positionY:14,type:kt.MiddleHorizontal}),new jt(t,{positionX:4,positionY:14,type:kt.BottomRight})),this.objects.push(),this.objects.push(new jt(t,{positionX:0,positionY:16,type:kt.FencePost})),this.objects.push(new jt(t,{positionX:0,positionY:17,type:kt.FencePost})),this.objects.push(new jt(t,{positionX:0,positionY:18,type:kt.FencePost})),this.objects.push(),this.objects.push(),this.objects.push(new ut(t,{positionX:25,positionY:1.5,height:4})),this.objects.push(new ut(t,{positionX:19,positionY:5.5,height:4})),this.objects.push(new ut(t,{positionX:22.5,positionY:4,width:6})),this.objects.push(new ut(t,{positionX:6.5,positionY:8,width:6})),this.objects.push(new ut(t,{positionX:15,positionY:8,width:9})),this.objects.push(new ut(t,{positionX:4,positionY:11.5,height:6})),this.objects.push(new ut(t,{positionX:2.25,positionY:15,width:4.5})),this.objects.push(new Ut(t,{object:e})),this.objects.push(new Ht(t,{animationCenterX:e.transform.position.world.x,animationCenterY:e.transform.position.world.y,animationType:"circle",animationLength:3})),this.objects.push(new Vt(this.scene,{duration:4.5,onInterval:()=>{let t=f.randomIntFromRange(19,28),e=f.randomIntFromRange(0,2),i="",s=0,o=0;0===e||1===e?(i="tileset_egg",s=1,o=0):(i="tileset_chicken",s=0,o=-.25),this.scene.addObject(new I(this.scene,{positionX:40,positionY:t,targetX:-1,targetY:t,tileset:i,spriteX:s,spriteY:o,destroyAtTarget:!0}))}}))}}class Kt{constructor(t){this.client=t,this.backgroundLayersAnimationTimer={},this.objects=new Map,this.globals={camera:{startX:0,startY:0,endX:0,endY:0}},this.flaggedForMapChange=void 0,this.renderingContext={background:[],objects:[]},this.backgroundLayerAnimationFrame={},this.renderContext=this.client.renderContext,this.displayContext=this.client.displayContext}frame(t){var e;this.awake(),this.background(t),this.update(t),this.render(t),this.customRenderer?this.customRenderer(this.renderingContext):((e=this).globals.camera.startX=0,e.globals.camera.startY=0,e.globals.camera.endX=0,e.globals.camera.endY=0,e.renderingContext.background.forEach((t=>{e.renderContext.drawImage(t.canvas,0,0)})),e.renderingContext.objects.forEach((t=>{e.renderContext.drawImage(t.canvas,0,0)}))),this.destroy(t)}awake(){this.client.flags.frame.log.awakeDuration&&console.time("[frame] awake");for(let[,t]of this.objects)t.awake();this.client.flags.frame.log.awakeDuration&&console.timeEnd("[frame] awake")}background(t){this.client.flags.frame.log.backgroundDuration&&console.time("[frame] background"),this.backgroundLayers.forEach(((i,s)=>{let o=this.renderingContext.background[s];e.clearCanvas(o);for(let s=0;s<this.map.width+1;s++)for(let n=0;n<this.map.height+1;n++){let r,a=i.tiles[s]?i.tiles[s][n]:void 0;if(void 0!==a){if(1===a.animationFrames.length)r=a.animationFrames[0];else{let e;void 0===this.backgroundLayersAnimationTimer[i.index]&&(this.backgroundLayersAnimationTimer[i.index]={}),void 0===this.backgroundLayersAnimationTimer[i.index][s]&&(this.backgroundLayersAnimationTimer[i.index][s]={}),e=void 0===this.backgroundLayersAnimationTimer[i.index][s][n]?0:this.backgroundLayersAnimationTimer[i.index][s][n]+t,e>a.animationFrameDuration&&(e%=a.animationFrameDuration);for(let t=0;t<a.animationMap.length;t++)if(e<=a.animationMap[t]){r=a.animationFrames[t];break}this.backgroundLayersAnimationTimer[i.index][s][n]=e}e.renderSprite(o,m.images[a.tileset],r.spriteX,r.spriteY,s-.5,n-.5)}}})),this.client.flags.frame.log.backgroundDuration&&console.timeEnd("[frame] background")}update(t){this.client.flags.frame.log.updateDuration&&console.time("[frame] update");for(let[,e]of this.objects)e.update(t);this.client.flags.frame.log.updateDuration&&console.timeEnd("[frame] update")}render(t){this.client.flags.frame.log.renderDuration&&console.time("[frame] render"),this.renderingContext.objects.forEach((t=>{e.clearCanvas(t)}));for(let[,t]of this.objects)this.client.debug.object.renderBackground&&t.debuggerRenderBackground(this.renderingContext.objects[t.renderer.layer]),t.render(this.renderingContext.objects[t.renderer.layer]),this.client.debug.object.renderBoundary&&t.debuggerRenderBoundary(this.renderingContext.objects[t.renderer.layer]);this.client.flags.frame.log.renderDuration&&console.timeEnd("[frame] render")}destroy(t){this.client.flags.frame.log.destroyDuration&&console.time("[frame] destroy");for(let[,t]of this.objects)t.flags.destroy&&this.removeObjectById(t.id);this.client.flags.frame.log.destroyDuration&&console.timeEnd("[frame] destroy")}addObject(t){this.objects.set(t.id,t)}removeObjectById(t){const e=this.objects.get(t);void 0!==e&&(e.onDestroy&&e.onDestroy(),this.objects.delete(t),e.parent&&e.parent.children.delete(e.id))}getObject(t={},e=!0){for(const[,i]of this.objects)if($t(i,t,e))return i}getObjects(t={},e=!0){const i=[];for(const[,s]of this.objects)$t(s,t,e)&&i.push(s);return i}isOutOfBounds(t,e){return t>this.map.width-1||e>this.map.height-1||t<0||e<0}removeAllObjects(){for(const[t]of this.objects)this.removeObjectById(t)}removeAllBackgroundLayers(){this.backgroundLayers=[]}setUpRenderingContexts(){this.renderingContext={background:[],objects:[]};for(let t=0;t<this.backgroundLayers.length;t++){let i=this.createCanvas();this.renderingContext.background[t]=e.getContext(i)}for(let i=0;i<t.TOTAL_RENDERING_LAYERS;i++){let t=this.createCanvas();this.renderingContext.objects[i]=e.getContext(t)}}createCanvas(){let t=e.createCanvas(this.map.width,this.map.height);return this.client.debug.ui.canvasLayers&&this.client.container.append(t),t}flagForMapChange(t){this.flaggedForMapChange=t}changeMap(t){void 0!==this.map&&this.map.destroy(),this.removeAllObjects(),this.removeAllBackgroundLayers(),console.log("[Scene] changing map to",t),this.map=Reflect.construct(t,[this]),this.backgroundLayers.push(...this.map.backgroundLayers),this.map.objects.forEach((t=>this.objects.set(t.id,t))),this.setUpRenderingContexts(),this.flaggedForMapChange=void 0}changeScene(t){this.client.changeScene(t)}setCustomRenderer(t){this.customRenderer=t}removeCustomerRenderer(){this.customRenderer=void 0}}function $t(e,i,s=!0){var o,n,r,a;if((void 0===(null===(o=i.collision)||void 0===o?void 0:o.enabled)||e.collision.enabled===i.collision.enabled)&&(!(null===(n=i.collision)||void 0===n?void 0:n.layerMatch)||i.collision.layerMatch.get(e.collision.layer))&&(void 0!==(null===(r=i.collision)||void 0===r?void 0:r.layerIgnore)||!s||e.collision.layer!==t.UI_COLLISION_LAYER)&&(!(null===(a=i.collision)||void 0===a?void 0:a.layerIgnore)||!i.collision.layerIgnore.get(e.collision.layer))&&(!i.typeMatch||i.typeMatch.some((t=>e instanceof t)))&&(!i.typeIgnore||!i.typeIgnore.some((t=>e instanceof t)))&&(!i.objectMatch||i.objectMatch.get(e))&&(!i.objectIgnore||!i.objectIgnore.get(e))&&(!i.boundingBox||function(t,e){return e.boundingBox.left<t.boundingBox.world.right&&e.boundingBox.right>t.boundingBox.world.left&&e.boundingBox.top<t.boundingBox.world.bottom&&e.boundingBox.bottom>t.boundingBox.world.top}(e,i))&&(!i.position||function(t,e){return e.position.x<t.boundingBox.world.right&&e.position.x>t.boundingBox.world.left&&e.position.y<t.boundingBox.world.bottom&&e.position.y>t.boundingBox.world.top}(e,i)))return e}class qt extends Kt{constructor(t){super(t),this.globals={...this.globals,inventory:[new N(this,{type:S.Hoe}),new N(this,{type:S.WateringCan}),new N(this,{type:S.WheatSeeds,currentStackSize:5}),void 0,void 0,new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken}),new N(this,{type:S.Chicken})],inventory_size:25,hotbar_size:5,hotbar_selected_index:0,disable_player_inputs:!1,gold:999},this.changeMap(Zt)}inventoryFirstStackWithRoom(t){for(let e=0;e<this.globals.inventory_size;e++){const i=this.globals.inventory[e];if(void 0!==i&&i.type===t&&!(i.currentStackSize>=i.maxStackSize))return e}}inventoryFirstFreeSlot(){for(let t=0;t<this.globals.inventory_size;t++)if(void 0===this.globals.inventory[t])return t}addToInventory(t){const e=this.inventoryFirstStackWithRoom(t);if(void 0!==e){const t=this.globals.inventory[e];return t.currentStackSize++,t}const i=this.inventoryFirstFreeSlot();if(void 0!==i){const e=new N(this,{type:t});return this.globals.inventory[i]=e,e}}inventoryHasRoom(t){return!!this.inventoryFirstStackWithRoom(t)||!!this.inventoryFirstFreeSlot()}removeFromInventoryByIndex(t,e){const i=this.globals.inventory[t];if(void 0!==i&&!(i.currentStackSize<e))return i.currentStackSize-=e,0===i.currentStackSize&&(this.globals.inventory[t]=void 0),i}get selectedInventoryItem(){return this.globals.inventory[this.globals.hotbar_selected_index]}get selectedInventoryIndex(){return this.globals.hotbar_selected_index}}class Jt extends h{constructor(t,e){super(t,e),this.scene=t,this.width=6,this.height=2,this.clicked=!1,this.renderer.enabled=!0}onUpdate(t){this.updateClickStart(),this.updateClickEnd()}onRender(t){this.renderStartButton(t)}renderStartButton(t){e.renderSprite(t,m.images.tileset_button,this.clicked?6:0,2,this.transform.position.world.x,this.transform.position.world.y,this.width,this.height,{centered:!0})}updateClickStart(){o.wasObjectClicked(this)&&(this.clicked=!0)}updateClickEnd(){!0!==s.mouse.click.left&&!1!==this.clicked&&(o.isMouseWithinObject(this)?this.scene.changeScene(qt):this.clicked=!1)}}const Qt=t.CANVAS_TILE_HEIGHT,te=t.CANVAS_TILE_WIDTH;class ee extends n{constructor(t){super(t),this.scene=t,this.height=Qt,this.width=te,this.backgroundLayers=[v],this.objects=[],o.setCursor(this.scene.displayContext.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.objects.push(new Jt(t,{renderLayer:15,positionX:16,positionY:9})),this.objects.push(new E(t,{}))}}class ie extends Kt{constructor(t){super(t),this.client=t,this.changeMap(ee)}}!function(){var e;t.DEFAULT_FONT_FAMILY="bookxel";const i=new URLSearchParams(window.location.search).get("scene"),s=null!==(e={"main-menu":ie,game:qt}[i])&&void 0!==e?e:ie;m.initialise({images:{tileset_sample:"assets/16x16.png",tileset_grass:"assets/sample/Tilesets/Grass.png",tileset_hills:"assets/sample/Tilesets/Hills.png",tileset_water:"assets/sample/Tilesets/Water.png",tileset_player:"assets/sample/Characters/Basic Charakter Spritesheet.png",tileset_chicken:"assets/sample/Characters/Free Chicken Sprites.png",tileset_fence:"assets/sample/Tilesets/Fences.png",tileset_egg:"assets/sample/Characters/Egg_And_Nest.png",tileset_house:"assets/sample/Tilesets/Wooden House.png",tileset_dirt:"assets/sample/Tilesets/Tilled_Dirt.png",tileset_button:"assets/sample/UI Big Play Button.png",tileset_ui:"assets/sample/Sprite sheet for Basic Pack.png",tileset_wood_bridge:"assets/sample/Objects/Wood_Bridge.png",tileset_chest:"assets/sample/Objects/Chest.png",tileset_plants:"assets/sample/Objects/Basic_Plants.png",tileset_dialogue_box:"assets/sample/Dialouge UI/dialog box.png",tileset_tools:"assets/sample/Characters/Tools.png",tileset_fullscreen:"assets/custom/fullscreen.png",tileset_basic:"assets/sample/Sprite sheet for Basic Pack.png"},audio:{},fonts:{bookxel:"assets/fonts/bookxel.woff"}}),p.initHelpers(),window.engine=new g(document.getElementById("render-area"),s,p.engineMapList,p.engineObjectList,p.engineObjectDetails,p.engineControls)}()})();