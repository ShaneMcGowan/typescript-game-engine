(()=>{"use strict";class e{static get CANVAS_HEIGHT(){return e.TILE_SIZE*e.CANVAS_TILE_HEIGHT}static get CANVAS_WIDTH(){return e.TILE_SIZE*e.CANVAS_TILE_WIDTH}static get ASPECT_RATIO(){return e.CANVAS_TILE_HEIGHT/e.CANVAS_TILE_WIDTH}static get TOTAL_RENDERING_LAYERS(){return e.OBJECT_RENDERING_LAYERS+e.UI_RENDERING_LAYERS}static get FIRST_UI_RENDER_LAYER(){return e.OBJECT_RENDERING_LAYERS}static get LAST_UI_RENDER_LAYER(){return e.OBJECT_RENDERING_LAYERS+e.UI_RENDERING_LAYERS-1}static get UI_COLLISION_LAYER(){return e.OBJECT_COLLISION_LAYERS-1}static get CANVAS_CENTER_TILE_Y(){return this.CANVAS_TILE_HEIGHT/2}static get CANVAS_CENTER_TILE_X(){return this.CANVAS_TILE_WIDTH/2}static get CANVAS_CENTER_PIXEL_X(){return e.CANVAS_WIDTH/2}static get CANVAS_CENTER_PIXEL_Y(){return e.CANVAS_HEIGHT/2}}e.CANVAS_TILE_HEIGHT=18,e.CANVAS_TILE_WIDTH=32,e.TILE_SIZE=16,e.OBJECT_RENDERING_LAYERS=16,e.UI_RENDERING_LAYERS=16,e.OBJECT_COLLISION_LAYERS=16,e.CONTEXT_IMAGE_SMOOTHING_ENABLED=!1,e.DEFAULT_FONT_SIZE=16,e.DEFAULT_FONT_COLOUR="black",e.DEFAULT_FONT_FAMILY="Helvetica";class t{static renderSprite(t,i,s,n,o,r,a,d,h={}){var l,c;let p=a?a*e.TILE_SIZE:e.TILE_SIZE,g=d?d*e.TILE_SIZE:e.TILE_SIZE,m=null!==(l=h.scale)&&void 0!==l?l:1,u=null!==(c=h.rotation)&&void 0!==c?c:0,b=h.opacity&&h.opacity<1,y=0!==u,v=b||y;if(v&&(t.save(),b&&(t.globalAlpha=Math.max(0,h.opacity)),y)){let i=Math.floor((o+a/2)*e.TILE_SIZE)+.5,s=Math.floor((r+d/2)*e.TILE_SIZE)+.5;t.translate(i,s),t.rotate(u*Math.PI/180),t.translate(-i,-s)}let w=Math.floor(p/2),f=Math.floor(g/2);h.centered&&t.translate(-w,-f),t.drawImage(i,s*e.TILE_SIZE,n*e.TILE_SIZE,p,g,Math.floor(o*e.TILE_SIZE),Math.floor(r*e.TILE_SIZE),p*m,g*m),h.centered&&t.translate(w,f),v&&t.restore()}static renderSubsection(t,i,s,n,o,r){let a=Math.floor(s*e.TILE_SIZE),d=Math.floor(n*e.TILE_SIZE),h=Math.floor(o*e.TILE_SIZE),l=Math.floor(r*e.TILE_SIZE);i.drawImage(t.canvas,a,d,h-a,l-d,0,0,i.canvas.width,i.canvas.height)}static renderCircle(t,i,s,n={}){t.beginPath(),t.arc(i*e.TILE_SIZE+e.TILE_SIZE/2,s*e.TILE_SIZE+e.TILE_SIZE/2,e.TILE_SIZE/2,0,2*Math.PI),t.stroke(),t.fillStyle=n.colour||"saddlebrown",t.fill()}static fillRectangle(t,i,s,n,o,r={}){t.strokeStyle=r.colour?r.colour:"black",t.fillStyle=r.colour?r.colour:"black",t.beginPath(),t.rect(Math.floor(i*e.TILE_SIZE)+.5,Math.floor(s*e.TILE_SIZE)+.5,n*("tile"===r.type?e.TILE_SIZE:1)-1,o*("tile"===r.type?e.TILE_SIZE:1)-1),t.stroke(),t.fill()}static strokeRectangle(t,i,s,n,o,r={}){var a;t.strokeStyle=null!==(a=r.colour)&&void 0!==a?a:"black",t.lineWidth=1;let d="tile"===r.type?Math.floor(i*e.TILE_SIZE):i,h="tile"===r.type?Math.floor(s*e.TILE_SIZE):s,l="tile"===r.type?Math.floor(n*e.TILE_SIZE):n,c="tile"===r.type?Math.floor(o*e.TILE_SIZE):o;t.strokeRect(d+.5,h+.5,l-1,c-1)}static clearCanvas(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}static createCanvas(t,i){const s=document.createElement("canvas");return s.width=t?t*e.TILE_SIZE:e.CANVAS_WIDTH,s.height=i?i*e.TILE_SIZE:e.CANVAS_HEIGHT,s}static getContext(t){let i=t.getContext("2d");return i.imageSmoothingEnabled=e.CONTEXT_IMAGE_SMOOTHING_ENABLED,i}static positionToPixelPosition(t){return t*e.TILE_SIZE}static renderText(t,i,s,n,o={}){let r=o.size?o.size:e.DEFAULT_FONT_SIZE,a=o.colour?o.colour:e.DEFAULT_FONT_COLOUR,d=o.font?o.font:e.DEFAULT_FONT_FAMILY;t.font=`${r}px ${d}`,t.fillStyle=`${a}`,t.fillText(i,s*e.TILE_SIZE,n*e.TILE_SIZE)}static textToArray(e,t,i={}){var s,n;let o=null!==(s=i.size)&&void 0!==s?s:16,r=null!==(n=i.colour)&&void 0!==n?n:"black",a=i.font?i.font:"Helvetica",d=document.createElement("canvas").getContext("2d");d.font=`${o}px ${a}`,d.fillStyle=`${r}`;let h=e.split(" "),l="",c=[];for(let e=0;e<h.length;e++){let i=`${l} ${h[e]}`;d.measureText(i).width>=t?(c.push(i),l=""):h.length-1!==e?l=i.trim():c.push(i)}return c}}var i;!function(e){e.Left="left",e.Middle="middle",e.Right="right"}(i||(i={}));class s{static isKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)if(this.keyboard[t])return!0;return!1}static setKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)this.keyboard[t]=!0}static clearKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)this.keyboard[t]=!1}static isMousePressed(e=i.Left){return this.mouse.click[e]}static clearMousePressed(e=i.Left){this.mouse.click[e]=!1}}s.keyboard={},s.mouse={click:{left:!1,middle:!1,right:!1},position:{x:0,y:0},wheel:{event:new WheelEvent("")},latestEvent:new MouseEvent("")};class n{static getMousePosition(t,i){let s,n=t.getBoundingClientRect(),o={height:n.height,width:n.width},r={clientX:i.clientX,clientY:i.clientY};if(t.width>t.height){s=t.width/n.width,o.height=t.height/s;let e=n.height-o.height;r.clientY-=e/2}else{s=t.height/n.height,o.width=t.width/s;let e=n.width-o.width;r.clientX-=e/2}let a=t.width/o.width,d=t.height/o.height;return{x:(r.clientX-n.left)*a/e.TILE_SIZE,y:(r.clientY-n.top)*d/e.TILE_SIZE}}static setCursor(e,t){e.style.cursor=`url("${t}"), auto`}static get isFullscreen(){return null!==document.fullscreenElement}static isMouseWithinBoundary(e,t,i,s,n){return e.x>=t&&e.x<=t+s&&e.y>=i&&e.y<=i+n}static isMouseWithinObject(e){return!!this.isMouseWithinBoundary(s.mouse.position,e.boundingBox.world.left,e.boundingBox.world.top,e.width,e.height)}static wasObjectClicked(e){return!!s.mouse.click.left&&!!this.isMouseWithinObject(e)}}class o{constructor(e){this.scene=e,this.flags={suspend:!0},this.store=new Map,this.objects=new Map}destroy(){}}class r{constructor(e,t){this.x=e,this.y=t}get roundedX(){return Math.round(this.x)}get roundedY(){return Math.round(this.y)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){let e=this.magnitude;return 0===e?new r(0,0):new r(this.x/e,this.y/e)}add(e){return new r(this.x+e.x,this.y+e.y)}subtract(e){return new r(this.x-e.x,this.y-e.y)}multiply(e){return new r(this.x*e,this.y*e)}divide(e){return new r(this.x/e,this.y/e)}}const a=!1;class d{constructor(e,t){var i,s,n,o,d,h,l,c,p,g;this.scene=e,this.id=crypto.randomUUID(),this.width=1,this.height=1,this.children=new Map,this.parent=void 0;const m=this;this.mainContext=this.scene.renderContext,this.transform={position:{local:new r(0,0),get world(){return m.calculateWorldPosition()}},scale:1,rotation:0},this.collision={enabled:a,layer:0},this.renderer={enabled:!1,layer:0,opacity:1,scale:1},this.flags={awake:!1,update:!0,render:!0,destroy:!1,save:!1},this.transform.position.local.x=null!==(i=t.positionX)&&void 0!==i?i:this.transform.position.local.x,this.transform.position.local.y=null!==(s=t.positionY)&&void 0!==s?s:this.transform.position.local.y,this.collision.enabled=null!==(n=t.collisionEnabled)&&void 0!==n?n:a,this.collision.layer=null!==(o=t.collisionLayer)&&void 0!==o?o:0,this.renderer.enabled=null!==(d=t.renderEnabled)&&void 0!==d?d:this.renderer.enabled,this.renderer.layer=null!==(h=t.renderLayer)&&void 0!==h?h:this.renderer.layer,this.renderer.opacity=null!==(l=t.renderOpacity)&&void 0!==l?l:this.renderer.opacity,this.renderer.scale=null!==(c=t.renderScale)&&void 0!==c?c:this.renderer.scale,this.width=null!==(p=t.width)&&void 0!==p?p:this.width,this.height=null!==(g=t.height)&&void 0!==g?g:this.height,void 0!==t.onAwake&&(this.onAwake=t.onAwake),void 0!==t.onUpdate&&(this.onUpdate=t.onUpdate),void 0!==t.onRender&&(this.onRender=t.onRender),void 0!==t.onDestroy&&(this.onDestroy=t.onDestroy)}awake(){this.flags.awake||(this.flags.awake=!0,void 0!==this.onAwake&&this.onAwake())}update(e){this.flags.update&&void 0!==this.onUpdate&&this.onUpdate(e)}render(e){this.renderer.enabled&&this.flags.render&&void 0!==this.onRender&&this.onRender(e)}destroy(){this.flags.destroy=!0,this.children.forEach((e=>{e.destroy()}))}get boundingBox(){return{local:d.calculateBoundingBox(this.transform.position.local.x,this.transform.position.local.y,this.width,this.height),world:d.calculateBoundingBox(this.transform.position.world.x,this.transform.position.world.y,this.width,this.height)}}debuggerRenderBoundary(e){t.strokeRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"red",type:"tile"})}debuggerRenderBackground(i){t.fillRectangle(i,this.boundingBox.world.left,this.boundingBox.world.top,Math.floor(this.width*e.TILE_SIZE),Math.floor(this.height*e.TILE_SIZE),{colour:"red"})}isCollidingWith(e){return this.isWithinHorizontalBounds(e)&&this.isWithinVerticalBounds(e)}isWithinHorizontalBounds(e){return e.boundingBox.world.left>=this.boundingBox.world.left&&e.boundingBox.world.left<=this.boundingBox.world.right||e.boundingBox.world.right>=this.boundingBox.world.left&&e.boundingBox.world.right<=this.boundingBox.world.right}isWithinVerticalBounds(e){return e.boundingBox.world.top>=this.boundingBox.world.top&&e.boundingBox.world.top<=this.boundingBox.world.bottom||e.boundingBox.world.bottom>=this.boundingBox.world.top&&e.boundingBox.world.bottom<=this.boundingBox.world.bottom}static calculateBoundingBox(e,t,i,s){let n=i/2,o=s/2;return{top:t-o,right:e+n,bottom:t+o,left:e-n}}addChild(e){this.children.set(e.id,e),e.parent=this,this.scene.addObject(e)}removeChild(e){void 0!==this.children.get(e.id)&&e.destroy()}removeAllChildren(){this.children.forEach((e=>{this.removeChild(e)}))}get rootParent(){return h(this)}calculateWorldPosition(){return void 0===this.parent?new r(this.transform.position.local.x,this.transform.position.local.y):new r(this.transform.position.local.x+this.parent.transform.position.world.x,this.transform.position.local.y+this.parent.transform.position.world.y)}}function h(e){return void 0===e.parent?e:h(e.parent)}class l extends d{constructor(e,t){super(e,t),this.scene=e,this.isColliding=!1,this.renderer.enabled=!0,t.width&&(this.width=t.width),t.height&&(this.height=t.height)}onUpdate(e){this.updateCollision()}onRender(e){let i=this.isColliding?"green":"red";t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:i,type:"tile"})}updateCollision(){if(this.collision.enabled){for(const[,e]of this.scene.objects)if(e!==this&&this.boundingBox.world.left<e.boundingBox.world.right&&this.boundingBox.world.right>e.boundingBox.world.left&&this.boundingBox.world.top<e.boundingBox.world.bottom&&this.boundingBox.world.bottom>e.boundingBox.world.top)return void(this.isColliding=!0);this.isColliding=!1}}}class c extends d{constructor(e,t){super(e,t),this.scene=e,this.timer=0,this.grow=!0,this.renderer.enabled=!0}onUpdate(e){this.timer+=e,this.timer>2&&(this.grow=!this.grow,this.timer=0),this.transform.position.local.x+=(this.grow?1:-1)*e,this.transform.position.local.y+=(this.grow?1:-1)*e}onRender(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"red",type:"tile"})}}class p{static get engineMapList(){return document.getElementById("map-list")||null}static get engineObjectList(){return document.getElementById("object-list")||null}static get engineObjectDetails(){return document.getElementById("object-details")||null}static get engineControls(){return{gridLines:document.getElementById("btnGridLines"),gridNumbers:document.getElementById("btnGridNumbers"),breakpoint:document.getElementById("btnBreakpoint"),fps:document.getElementById("btnFps"),objectCount:document.getElementById("btnObjectCount"),timingFrame:document.getElementById("btnTimingFrame"),timingFrameBackground:document.getElementById("btnTimingFrameBackground"),timingFrameRender:document.getElementById("btnTimingFrameRender"),timingFrameUpdate:document.getElementById("btnTimingFrameUpdate"),canvasLayers:document.getElementById("btnCanvasLayers"),fullscreen:document.getElementById("btnFullscreen"),renderBoundary:document.getElementById("btnRenderBoundary"),renderBackground:document.getElementById("btnRenderBackground")}}static initHelpers(){window.o=e=>window.engine.scene.objects.get(e)}static changeScene(e){window.engine.changeScene(e)}static changeMap(e){window.engine.scene.changeMap(e)}}p.TEST_MAPS=[{name:"collision test",map:class extends o{constructor(e){super(e),this.scene=e,this.height=18,this.width=30,this.backgroundLayers=[],this.initialiseNotColliding(),this.initialiseColliding()}initialiseNotColliding(){this.scene.addObject(new l(this.scene,{positionX:1.5,positionY:1.5})),this.scene.addObject(new l(this.scene,{positionX:2.5,positionY:1.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:1.5,positionY:2.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:4.5,positionY:1.5})),this.scene.addObject(new l(this.scene,{positionX:5.5,positionY:1.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:5.5,positionY:2.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:1.5,positionY:4.5})),this.scene.addObject(new l(this.scene,{positionX:2.5,positionY:5.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:1.5,positionY:5.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:5.5,positionY:4.5})),this.scene.addObject(new l(this.scene,{positionX:4.5,positionY:5.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:5.5,positionY:5.5,collisionEnabled:!0}))}initialiseColliding(){this.scene.addObject(new l(this.scene,{positionX:7.5,positionY:1.5})),this.scene.addObject(new l(this.scene,{positionX:8,positionY:1.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:7.5,positionY:2,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:11,positionY:1.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:11.5,positionY:1.5})),this.scene.addObject(new l(this.scene,{positionX:11.5,positionY:2,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:7.5,positionY:5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:8,positionY:5.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:7.5,positionY:5.5})),this.scene.addObject(new l(this.scene,{positionX:11.5,positionY:5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:11,positionY:5.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:11.5,positionY:5.5})),this.scene.addObject(new l(this.scene,{positionX:1.5,positionY:7.5})),this.scene.addObject(new l(this.scene,{positionX:2,positionY:7.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:3.5,positionY:7.5})),this.scene.addObject(new l(this.scene,{positionX:3.5,positionY:8,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:5.001,positionY:7.501,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:6,positionY:8.5})),this.scene.addObject(new l(this.scene,{positionX:8.499,positionY:7.501,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:7.5,positionY:8.5})),this.scene.addObject(new l(this.scene,{positionX:5.001,positionY:10.999,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:6,positionY:10})),this.scene.addObject(new l(this.scene,{positionX:8.499,positionY:10.999,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:7.5,positionY:10})),this.scene.addObject(new l(this.scene,{positionX:18,positionY:5,width:6,height:6,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:14.5,positionY:1.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:18,positionY:1.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:21.5,positionY:1.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:14.5,positionY:5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:18,positionY:5})),this.scene.addObject(new l(this.scene,{positionX:21.5,positionY:5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:14.5,positionY:8.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:18,positionY:8.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:21.5,positionY:8.5,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:18,positionY:14,width:6,height:6})),this.scene.addObject(new l(this.scene,{positionX:14.501,positionY:10.501,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:18.001,positionY:10.501,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:21.499,positionY:10.501,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:14.501,positionY:14,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:18,positionY:14,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:21.499,positionY:14,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:14.501,positionY:17.499,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:18,positionY:17.499,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:21.499,positionY:17.499,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:3.5,positionY:15,width:5,height:1,collisionEnabled:!0})),this.scene.addObject(new l(this.scene,{positionX:3.5,positionY:15,width:1,height:5})),this.scene.addObject(new l(this.scene,{positionX:9.5,positionY:15,width:5,height:1})),this.scene.addObject(new l(this.scene,{positionX:9.5,positionY:15,width:1,height:5,collisionEnabled:!0}))}}},{name:"object hierarchy test",map:class extends o{constructor(e){super(e),this.scene=e,this.height=18,this.width=30,this.backgroundLayers=[];const t=new c(this.scene,{positionX:1,positionY:1}),i=new c(this.scene,{positionX:1,positionY:1}),s=new c(this.scene,{positionX:1,positionY:1}),n=new c(this.scene,{positionX:1,positionY:1});this.scene.addObject(t),t.addChild(i),i.addChild(s),s.addChild(n)}}}];class g{constructor(i,s,n,o,r,a){this.container=i,this.engineMapList=n,this.engineObjectList=o,this.engineObjectDetails=r,this.engineControls=a,this.CANVAS_HEIGHT=e.CANVAS_HEIGHT,this.CANVAS_WIDTH=e.CANVAS_WIDTH,this.delta=0,this.lastRenderTimestamp=0,this.flags={frame:{interrupted:!1,log:{start:!1,end:!1,delta:!1,timestamp:!1,backgroundDuration:!1,awakeDuration:!1,updateDuration:!1,renderDuration:!1,destroyDuration:!1}}},this.debug={enabled:!0,stats:{fps:!1,fpsCounter:0,objectCount:!1},breakpoint:{frame:!1},ui:{grid:{lines:!1,numbers:!1},canvasLayers:!1},object:{renderBoundary:!1,renderBackground:!1}},this.gamepad=void 0,this.editorTimer=0,this.debug.enabled&&(this.initialiseDebuggerState(),this.initialiseDebuggerListeners()),this.displayCanvas=this.createCanvas(),this.displayContext=t.getContext(this.displayCanvas),this.renderCanvas=this.createCanvas(),this.renderContext=t.getContext(this.renderCanvas),i.append(this.displayCanvas),document.addEventListener("visibilitychange",(e=>{"visible"===document.visibilityState?(console.log("tab is active"),this.flags.frame.interrupted=!0):console.log("tab is inactive")})),document.addEventListener("fullscreenchange",(e=>{})),document.addEventListener("fullscreenerror",(e=>{})),this.initialiseMouseListeners(),this.initialiseKeyboardListeners(),this.intialiseGamepadListeners(),this.changeScene(s),window.requestAnimationFrame(this.firstFrame.bind(this))}createCanvas(){const e=t.createCanvas();return e.addEventListener("contextmenu",(e=>{e.preventDefault()})),e}changeScene(e){this.scene=Reflect.construct(e,[this])}firstFrame(e){this.setDelta(e),window.requestAnimationFrame(this.frame.bind(this))}interruptedFrame(e){console.log("frameInterrupted"),this.lastRenderTimestamp=e,this.flags.frame.interrupted=!1,window.requestAnimationFrame(this.frame.bind(this))}frame(e){this.flags.frame.log.start&&console.log("[frame] start"),this.debug.breakpoint.frame,this.flags.frame.interrupted?window.requestAnimationFrame(this.interruptedFrame.bind(this)):(this.setDelta(e),this.flags.frame.log.timestamp&&console.log(`[timestamp] ${e}`),this.flags.frame.log.delta&&console.log(`[delta] ${this.delta}`),t.clearCanvas(this.renderContext),this.scene.frame(this.delta),t.clearCanvas(this.displayContext),this.displayContext.drawImage(this.renderCanvas,0,0),this.debug.stats.fps&&(this.debug.stats.fpsCounter&&this.renderStats(0,"FPS",`${Math.round(1e3/(performance.now()-this.debug.stats.fpsCounter))} FPS`),this.debug.stats.fpsCounter=e),this.debug.stats.objectCount&&this.renderStats(1,"Objects",`${this.scene.objects.size} objects`),this.renderGrid(),this.editorTimer+=this.delta,this.editorTimer>1&&(this.editor(),this.editorTimer=0),window.requestAnimationFrame(this.frame.bind(this)),this.flags.frame.log.end&&console.log("[frame] end"))}setDelta(e){this.delta=(e-this.lastRenderTimestamp)/1e3,this.lastRenderTimestamp=e}renderStats(t,i,s){this.displayContext.fillStyle="red",this.displayContext.font="12px serif",this.displayContext.fillText(s,this.CANVAS_WIDTH-50,(t+1)*e.TILE_SIZE)}renderGrid(){if((this.debug.ui.grid.lines||this.debug.ui.grid.numbers)&&t.fillRectangle(this.displayContext,0,0,this.CANVAS_WIDTH,this.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.25)"}),this.debug.ui.grid.lines)for(let i=0;i<this.CANVAS_WIDTH;i+=e.TILE_SIZE)for(let s=0;s<this.CANVAS_HEIGHT;s+=e.TILE_SIZE)t.strokeRectangle(this.displayContext,i,s,e.TILE_SIZE,e.TILE_SIZE,{colour:"black"});if(this.debug.ui.grid.numbers)for(let t=0;t<e.CANVAS_TILE_WIDTH;t++)for(let i=0;i<e.CANVAS_TILE_HEIGHT;i++)this.displayContext.fillStyle="black",this.displayContext.font="8px helvetica",this.displayContext.fillText(`${t}`,t*e.TILE_SIZE+1,i*e.TILE_SIZE+8),this.displayContext.fillText(`${i}`,t*e.TILE_SIZE+6,i*e.TILE_SIZE+14)}initialiseDebuggerState(){if(void 0!==this.engineControls&&this.engineControls.renderBoundary){const e=JSON.parse(localStorage.getItem("object.renderBoundary"));this.engineControls.renderBoundary.checked=e,this.debug.object.renderBoundary=e}}initialiseDebuggerListeners(){void 0!==this.engineControls&&(this.engineControls.gridLines&&this.engineControls.gridLines.addEventListener("click",(()=>{this.debug.ui.grid.lines=!this.debug.ui.grid.lines})),this.engineControls.gridNumbers&&this.engineControls.gridNumbers.addEventListener("click",(()=>{this.debug.ui.grid.numbers=!this.debug.ui.grid.numbers})),this.engineControls.breakpoint&&this.engineControls.breakpoint.addEventListener("click",(()=>{this.debug.breakpoint.frame=!this.debug.breakpoint.frame})),this.engineControls.fps&&this.engineControls.fps.addEventListener("click",(()=>{this.debug.stats.fps=!this.debug.stats.fps})),this.engineControls.objectCount&&this.engineControls.objectCount.addEventListener("click",(()=>{this.debug.stats.objectCount=!this.debug.stats.objectCount})),this.engineControls.timingFrame&&this.engineControls.timingFrame.addEventListener("click",(()=>{this.flags.frame.log.delta=!this.flags.frame.log.delta})),this.engineControls.timingFrameBackground&&this.engineControls.timingFrameBackground.addEventListener("click",(()=>{this.flags.frame.log.backgroundDuration=!this.flags.frame.log.backgroundDuration})),this.engineControls.timingFrameRender&&this.engineControls.timingFrameRender.addEventListener("click",(()=>{this.flags.frame.log.renderDuration=!this.flags.frame.log.renderDuration})),this.engineControls.timingFrameUpdate&&this.engineControls.timingFrameUpdate.addEventListener("click",(()=>{this.flags.frame.log.updateDuration=!this.flags.frame.log.updateDuration})),this.engineControls.canvasLayers&&this.engineControls.canvasLayers.addEventListener("click",(()=>{this.debug.ui.canvasLayers=!this.debug.ui.canvasLayers})),this.engineControls.renderBoundary&&this.engineControls.renderBoundary.addEventListener("click",(()=>{this.debug.object.renderBoundary=!this.debug.object.renderBoundary,localStorage.setItem("object.renderBoundary",JSON.stringify(this.debug.object.renderBoundary))})),this.engineControls.renderBackground&&this.engineControls.renderBackground.addEventListener("click",(()=>{this.debug.object.renderBackground=!this.debug.object.renderBackground})),this.engineControls.fullscreen&&this.engineControls.fullscreen.addEventListener("click",(()=>{this.displayCanvas.requestFullscreen().catch((e=>{throw new Error(e)}))})))}initialiseKeyboardListeners(){console.log("[listener added] keydown"),document.addEventListener("keydown",(e=>{if(e.preventDefault(),e.repeat)return;console.log("[keydown]",e);let t=e.key.toLocaleLowerCase();s.setKeyPressed(t)})),console.log("[listener added] keyup"),document.addEventListener("keyup",(e=>{if(e.preventDefault(),e.repeat)return;console.log("[keyup]",e);let t=e.key.toLocaleLowerCase();s.clearKeyPressed(t)}))}initialiseMouseListeners(){console.log("[listener added] mousemove"),this.displayCanvas.addEventListener("mousemove",(e=>{s.mouse.position=n.getMousePosition(this.displayCanvas,e),s.mouse.latestEvent=e})),console.log("[listener added] mousedown"),this.displayCanvas.addEventListener("mousedown",(e=>{switch(console.log("[mousedown]",e),e.button){case 0:s.mouse.click.left=!0;break;case 1:s.mouse.click.middle=!0;break;case 2:s.mouse.click.right=!0}})),console.log("[listener added] mouseup"),this.displayCanvas.addEventListener("mouseup",(e=>{switch(console.log("[mouseup]",e),e.button){case 0:s.mouse.click.left=!1;break;case 1:s.mouse.click.middle=!1;break;case 2:s.mouse.click.right=!1}})),console.log("[listener added] touchstart"),this.displayCanvas.addEventListener("touchstart",(e=>{console.log("[touchstart]",e),s.mouse.click.left=!0})),console.log("[listener added] touchend"),this.displayCanvas.addEventListener("touchend",(e=>{console.log("[touchend]",e),s.mouse.click.left=!1})),console.log("[listener added] wheel"),this.displayCanvas.addEventListener("wheel",(e=>{console.log("[wheel]",e),s.mouse.wheel.event=e}))}intialiseGamepadListeners(){window.addEventListener("gamepadconnected",(e=>{console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.gamepad.index,e.gamepad.id,e.gamepad.buttons.length,e.gamepad.axes.length),this.gamepad=e.gamepad})),window.addEventListener("gamepaddisconnected",(e=>{this.gamepad=void 0}))}editor(){if(null===this.engineObjectList||null===this.engineMapList)return;let e=document.createElement("ul");this.engineMapList.innerHTML="",this.engineMapList.appendChild(e),[...p.TEST_MAPS].forEach((t=>{let i=document.createElement("li");i.innerHTML=t.name,e.appendChild(i),i.addEventListener("click",(()=>{p.changeMap(t.map)}))}));let t=document.createElement("ul");this.engineObjectList.innerHTML="",this.engineObjectList.appendChild(t),this.scene.objects.forEach((e=>{let i=document.createElement("li");i.innerHTML=e.constructor.name,t.appendChild(i),i.addEventListener("click",(()=>{this.engineSelectedObjectId=e.id,this.updateEngineObjectDetails()}))}))}updateEngineObjectDetails(){if(void 0===this.engineSelectedObjectId)return;if(null===this.engineObjectDetails)return;let e=this.scene.objects.get(this.engineSelectedObjectId);if(void 0===e)return;const t=this.engineObjectDetails.querySelector("#object-details-header"),i=this.engineObjectDetails.querySelector("#object-details-content");t.innerHTML=`<h3>${e.constructor.name}</h3>`,i.innerHTML="",Object.keys(e).forEach((t=>{"transform"===t?(i.innerHTML+=m(e.transform.position.local,"x"),i.innerHTML+=m(e.transform.position.local,"y")):i.innerHTML+=m(e,t)})),console.log(e)}}function m(e,t){let i="";return i+='<div style="display:flex; padding: 0.25rem 0;">',i+=`<span style="margin-right: auto;">${t}</span>`,i+=`<code>${e[t]}</code>`,i+="</div>",i}class u{static initialise(e){Object.keys(e.images).forEach((t=>{this.images[t]=new Image,this.images[t].src=e.images[t]})),Object.keys(e.audio).forEach((t=>{this.audio[t]=new Audio(e.audio[t])})),Object.keys(e.fonts).forEach((t=>{const i=new FontFace(t,`url(${e.fonts[t]})`);this.fonts[t]=i,i.load().then((()=>{document.fonts.add(i)})).catch((e=>{console.log(`[initialise assets]: ${e}`)}))}))}}u.images={},u.audio={},u.fonts={};const b={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},y=[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],v={index:0,tiles:[y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y]};class w{static randomIntFromRange(e,t){return Math.floor(this.randomNumberFromRange(e,t))}static randomNumberFromRange(e,t){return Math.random()*(t-e+1)+e}static randomStartingDelta(e){return Math.random()*(null!=e?e:1)}}class f{get position(){return{x:this.targetX,y:this.targetY}}get target(){return{x:this.targetX,y:this.targetY}}constructor(e,t,i,s){this.positionX=e,this.positionY=t,this.targetX=i,this.targetY=s}}class x{static moveTowardsPosition(e,t){return e.targetX>e.positionX?(e.positionX+=t,e.targetX<e.positionX&&(e.positionX=e.targetX)):e.targetX<e.positionX?(e.positionX-=t,e.targetX>e.positionX&&(e.positionX=e.targetX)):e.targetY>e.positionY?(e.positionY+=t,e.targetY<e.positionY&&(e.positionY=e.targetY)):e.targetY<e.positionY&&(e.positionY-=t,e.targetY>e.positionY&&(e.positionY=e.targetY)),new f(e.positionX,e.positionY,e.targetX,e.targetY)}static moveTowardsOtherEntity(e,t){return t.positionX>e.positionX?e.targetX+=1:t.positionX<e.positionX?e.targetX-=1:t.positionY>e.positionY?e.targetY+=1:t.positionY<e.positionY&&(e.targetY-=1),new f(e.positionX,e.positionY,e.targetX,e.targetY)}static moveInRandomDirection(e){switch(w.randomIntFromRange(1,4)){case 1:e.targetX+=1;break;case 2:e.targetX-=1;break;case 3:e.targetY+=1;break;case 4:e.targetY-=1}return new f(e.positionX,e.positionY,e.targetX,e.targetY)}static frameSpeed(e,t){return e*t}static MoveTowards(e,t,i){let s=t.subtract(e),n=s.normalized.multiply(i);return n.magnitude>s.magnitude&&(n=s),n}}class I extends d{constructor(e,t){var i,s,n,o,r;super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.movementSpeed=.5,this.renderer.enabled=!0,this.tileset=t.tileset,this.spriteX=t.spriteX,this.spriteY=t.spriteY,this.spriteHeight=t.spriteHeight,this.spriteWidth=t.spriteWidth,this.destroyAtTarget=null!==(i=t.destroyAtTarget)&&void 0!==i&&i,this.movementSpeed=null!==(s=t.movementSpeed)&&void 0!==s?s:.5,this.canMove=null!==(n=t.canMove)&&void 0!==n&&n,this.targetX=null!==(o=t.targetX)&&void 0!==o?o:this.targetX,this.targetY=null!==(r=t.targetY)&&void 0!==r?r:this.targetY}onUpdate(e){this.updatePosition(e)}updatePosition(e){if(!this.canMove)return;if(this.transform.position.local.x===this.targetX&&this.transform.position.local.y===this.targetY)return void(this.destroyAtTarget&&this.destroy());let t=new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=this.movementSpeed*e,s=x.moveTowardsPosition(t,i);this.transform.position.local.x=s.positionX,this.transform.position.local.y=s.positionY}onRender(e){t.renderSprite(e,u.images[this.tileset],this.spriteX,this.spriteY,this.transform.position.world.x,this.transform.position.world.y,this.spriteWidth,this.spriteWidth,{centered:!0})}}class E extends d{constructor(e,t){super(e,t),this.scene=e,this.newItemTimer=0}onUpdate(e){this.updateGenerateNewItem(e)}updateGenerateNewItem(t){if(this.newItemTimer+=t,this.newItemTimer<3)return;if(this.scene.objects.size>15)return;let i=w.randomIntFromRange(0,this.scene.map.height);this.scene.addObject(new I(this.scene,{positionX:e.CANVAS_TILE_WIDTH,positionY:i,targetX:-1,targetY:i,tileset:"tileset_egg",spriteX:1,spriteY:0,destroyAtTarget:!0})),this.newItemTimer=0}}class T extends d{constructor(e,t){super(e,t),this.scene=e,this.collision.enabled=!1,this.renderer.enabled=!0,this.tileset=t.tileset,this.spriteX=t.spriteX,this.spriteY=t.spriteY}onRender(e){t.renderSprite(e,u.images[this.tileset],this.spriteX,this.spriteY,this.transform.position.world.x,this.transform.position.world.y,this.width,this.height,{centered:!0})}}var _;!function(e){e.Confirm="e",e.ConfirmAlt=" "}(_||(_={}));const S="tileset_dialogue_box",C=()=>{};class Y extends d{constructor(t,i){var s,n,o,r,a;super(t,i),this.scene=t,this.height=3,this.width=e.CANVAS_TILE_WIDTH,this.textboxWidth=e.CANVAS_TILE_WIDTH-8,this.textboxBorder=2,this.textSize=16,this.textSegments=[],this.textIndex=0,this.characterIndex=0,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.completionTimer=0,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,void 0===i.positionX&&(this.transform.position.local.x=0),void 0===i.positionY&&(this.transform.position.local.y=e.CANVAS_TILE_HEIGHT-this.height),this.showOverlay=null===(s=i.showOverlay)||void 0===s||s,this.text=null!==(n=i.text)&&void 0!==n?n:"...",this.onComplete=null!==(o=i.onComplete)&&void 0!==o?o:C,this.portrait=i.portrait,this.name=i.name,this.completionDuration=i.completionDuration,this.scrollText=null===(r=i.scrollText)||void 0===r||r,this.scrollSpeed=null!==(a=i.scrollSpeed)&&void 0!==a?a:48,this.initText()}initText(){this.textSegments=t.textToArray(this.text,(this.textboxWidth-4)*e.TILE_SIZE,{size:this.textSize})}onUpdate(e){void 0!==this.completionDuration?this.updateTimer(e):this.updateConfirm(),this.scrollText&&this.updateScrollText(e),this.updatePortraitAnimation(e)}onRender(e){this.showOverlay&&this.renderOverlay(e),this.hasPortrait&&this.renderPortrait(e),this.generateTextbox(e),this.hasNamePlate&&this.renderNamePlate(e),this.renderText(e)}updateTimer(e){this.completionTimer+=e,this.completionTimer>=this.completionDuration&&(this.onComplete&&this.onComplete(),this.destroy())}updateScrollText(e){this.currentText.length>this.characterIndex&&(this.characterIndex+=this.scrollSpeed*e)}updateConfirm(){if(s.isKeyPressed([_.Confirm,_.ConfirmAlt])||s.isMousePressed(i.Left)){if(this.scrollText&&this.currentText.length>this.characterIndex)return this.characterIndex=this.currentText.length,s.clearKeyPressed([_.Confirm,_.ConfirmAlt]),void s.clearMousePressed(i.Left);this.textIndex+=2,this.characterIndex=0,this.textSegments.length<=this.textIndex&&(this.onComplete&&this.onComplete(),this.destroy()),s.clearKeyPressed([_.Confirm,_.ConfirmAlt]),s.clearMousePressed(i.Left)}}renderOverlay(i){t.fillRectangle(i,0,0,e.CANVAS_WIDTH,e.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.5)"})}generateTextbox(i){let s=this.textboxWidth,n=(e.CANVAS_TILE_WIDTH-s)/2;t.renderSprite(i,u.images[S],0,0,n,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,u.images[S],0,1,n,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,u.images[S],0,1,n,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,u.images[S],0,2,n,e.CANVAS_TILE_HEIGHT-1);for(let o=1;o<s-1;o++)t.renderSprite(i,u.images[S],1,0,n+o,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,u.images[S],1,1,n+o,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,u.images[S],1,1,n+o,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,u.images[S],1,2,n+o,e.CANVAS_TILE_HEIGHT-1);t.renderSprite(i,u.images[S],2,0,n+s-1,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,u.images[S],2,1,n+s-1,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,u.images[S],2,1,n+s-1,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,u.images[S],2,2,n+s-1,e.CANVAS_TILE_HEIGHT-1)}renderText(i){if(this.textLine1){let s=this.scrollText?this.textLine1.substring(0,this.characterIndex):this.textLine1;t.renderText(i,s,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-2-.25,{size:this.textSize})}if(this.textLine2){let s=this.scrollText?this.textLine2.substring(0,this.characterIndex-this.textLine1.length):this.textLine2;t.renderText(i,s,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-1-.25,{size:this.textSize})}}renderPortrait(e){t.renderSprite(e,u.images[this.portrait.tileset],this.portrait.x,this.portrait.y,3,9,void 0,void 0,{scale:8})}renderNamePlate(i){t.fillRectangle(i,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1,e.CANVAS_TILE_HEIGHT-4,6*e.TILE_SIZE,1*e.TILE_SIZE,{colour:"#e8cfa6"}),t.renderText(i,this.name,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-3-.25,{size:this.textSize})}updatePortraitAnimation(e){this.animationTimer=(this.animationTimer+e)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}get hasPortrait(){return void 0!==this.portrait}get hasNamePlate(){return void 0!==this.name}get textLine1(){return this.textSegments[this.textIndex]}get textLine2(){return this.textSegments[this.textIndex+1]}get currentText(){let e="";return this.textLine1&&(e+=this.textLine1),this.textLine2&&(e+=this.textLine2),e}}var X,O;!function(e){e.Chicken="Chicken",e.Egg="Egg",e.WheatSeeds="WheatSeeds",e.Wheat="Wheat",e.TomatoSeeds="TomatoSeeds",e.Tomato="Tomato",e.Hoe="Hoe",e.WateringCan="WateringCan",e.Chest="Chest"}(X||(X={})),function(e){e.Player="Player",e.Anywhere="Anywhere",e.None="None"}(O||(O={}));const L={tileset:"tileset_ui",spriteX:15,spriteY:5},j=O.None,A={[X.Chicken]:O.Player,[X.Egg]:O.Player,[X.WheatSeeds]:O.Player,[X.Wheat]:O.Player,[X.TomatoSeeds]:O.Player,[X.Tomato]:O.Player,[X.Hoe]:O.Player,[X.WateringCan]:O.Player,[X.Chest]:O.Anywhere},k={[X.Chicken]:{tileset:"tileset_chicken",spriteX:0,spriteY:0},[X.Egg]:{tileset:"tileset_egg",spriteX:0,spriteY:0},[X.WheatSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:0},[X.Wheat]:{tileset:"tileset_plants",spriteX:5,spriteY:0},[X.TomatoSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:1},[X.Tomato]:{tileset:"tileset_plants",spriteX:5,spriteY:1},[X.Hoe]:{tileset:"tileset_tools",spriteX:4,spriteY:4},[X.WateringCan]:{tileset:"tileset_tools",spriteX:0,spriteY:0},[X.Chest]:{tileset:"tileset_chest",spriteX:1,spriteY:1}},D={[X.Chicken]:1,[X.Egg]:9,[X.WheatSeeds]:9,[X.Wheat]:9,[X.TomatoSeeds]:9,[X.Tomato]:9,[X.Hoe]:1,[X.WateringCan]:1,[X.Chest]:1},M={[X.Chicken]:0,[X.Egg]:0,[X.WheatSeeds]:5,[X.Wheat]:10,[X.TomatoSeeds]:5,[X.Tomato]:10,[X.Hoe]:0,[X.WateringCan]:0,[X.Chest]:0};class R{constructor(e,t){this.items=[],this.rows=e,this.columns=t}get size(){return this.rows*this.columns}firstSlotWithRoom(e){for(let t=0;t<this.size;t++){const i=this.items[t];if(void 0!==i&&i.type===e&&!(i.currentStackSize>=i.maxStackSize))return t}}getFirstFreeSlot(){for(let e=0;e<this.size;e++)if(void 0===this.items[e])return e}addToInventory(e){const t=this.firstSlotWithRoom(e);if(void 0!==t){const e=this.items[t];return e.currentStackSize++,e}const i=this.getFirstFreeSlot();if(void 0!==i){const t=this.createItem(e);return this.items[i]=t,t}}removeFromInventoryByIndex(e,t){const i=this.items[e];if(void 0!==i&&!(i.currentStackSize<t))return i.currentStackSize-=t,0===i.currentStackSize&&(this.items[e]=void 0),i}createItem(e,t){var i,s,n;const o=null!==(i=D[e])&&void 0!==i?i:1;let r=1;return void 0!==t&&(r=t>o?o:t),{type:e,maxStackSize:o,sprite:null!==(s=k[e])&&void 0!==s?s:L,radius:null!==(n=A[e])&&void 0!==n?n:j,currentStackSize:r}}}const B={x:1,y:1},H=[X.TomatoSeeds,X.WheatSeeds];var F;!function(e){e[e.Empty=0]="Empty",e[e.Watered=1]="Watered",e[e.Growing=2]="Growing",e[e.FullyGrown=3]="FullyGrown",e[e.Spoiled=4]="Spoiled"}(F||(F={}));const N={[X.WheatSeeds]:{[F.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:0},[F.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:0},[F.Spoiled]:void 0},[X.TomatoSeeds]:{[F.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:1},[F.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:1},[F.Spoiled]:void 0}};class W extends d{constructor(e,t){super(e,t),this.scene=e,this.spriteX=B.x,this.spriteY=B.y,this.counterDry=0,this.counterGrow=0,this.counterSpoil=0,this.currentlyGrowing=void 0,this.renderer.enabled=!0,this.renderer.layer=6,this.cropStage=F.Empty,t.growing&&(this.collision.enabled=!0,this.cropStage=t.growing.stage,this.currentlyGrowing=t.growing.itemType)}get inventory(){return this.scene.globals.inventory}onDirtPlaced(e){let t=this.scene.getObjects({position:{x:this.transform.position.world.x-1,y:this.transform.position.world.y}}),i=this.scene.getObjects({position:{x:this.transform.position.world.x+1,y:this.transform.position.world.y}}),s=(t.filter((e=>e instanceof W)).length,i.filter((e=>e instanceof W)).length,B);this.spriteX=s.x,this.spriteY=s.y}interact(){switch(this.cropStage){case F.Empty:return void this.interactStageEmpty();case F.Watered:return void this.interactStageWatered();case F.Growing:return void this.interactStageGrowing();case F.FullyGrown:return void this.interactStageFullyGrown()}}interactStageEmpty(){this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:"It's a beautiful patch of dirt, brimming with potential.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageWatered(){this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:"The patch of dirt is watered, better plant something before it dries up.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageGrowing(){this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:"The plant is growing nicely, it will be ready for harvest soon.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageFullyGrown(){let e=!1;switch(this.currentlyGrowing){case X.TomatoSeeds:e=!!this.inventory.addToInventory(X.Tomato);break;case X.WheatSeeds:e=!!this.inventory.addToInventory(X.Wheat)}e&&this.destroy()}get isEmpty(){return void 0===this.currentlyGrowing}onUpdate(e){this.cropStage===F.Empty||this.cropStage===F.Watered?this.counterDry+=e:this.cropStage===F.Growing?this.counterGrow+=e:this.cropStage===F.FullyGrown&&(this.counterSpoil+=e),this.isEmpty&&this.counterDry>15?this.destroy():this.cropStage===F.Growing&&this.counterGrow>5?this.cropStage=F.FullyGrown:this.cropStage===F.FullyGrown&&this.counterSpoil>86400&&(this.cropStage=F.Spoiled)}onRender(e){this.renderDirt(e),this.renderCrop(e)}renderDirt(e){let i=(this.cropStage,F.Empty,"tileset_dirt");t.renderSprite(e,u.images[i],this.spriteX,this.spriteY,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0}),this.cropStage!==F.Empty&&t.fillRectangle(e,this.boundingBox.local.left,this.boundingBox.local.top,1,1,{colour:"#00000011",type:"tile"})}renderCrop(e){if(this.cropStage===F.Empty||this.cropStage===F.Watered)return;if(this.currentlyGrowing!==X.TomatoSeeds&&this.currentlyGrowing!==X.WheatSeeds)return;let i=N[this.currentlyGrowing][this.cropStage];void 0!==i&&t.renderSprite(e,u.images[i.tileset],i.spriteX,i.spriteY,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0})}actionWater(){this.cropStage===F.Empty&&(this.counterDry=0,this.cropStage=F.Watered)}actionPlant(){let e=this.scene.selectedInventoryItem;void 0!==e&&H.includes(e.type)&&this.cropStage===F.Watered&&(this.collision.enabled=!0,this.currentlyGrowing=e.type,this.cropStage=F.Growing,this.inventory.removeFromInventoryByIndex(this.scene.globals.hotbar_selected_index,1))}}class P{}var G,V,U;P.id="tileset_ui",P.Container={White:{Default:{x:.5,y:1.5,width:2,height:2}},Default:{Default:{x:.5,y:3.5,width:2,height:2}},Dark:{Default:{x:.5,y:6.5,width:2,height:2}},Darker:{Default:{x:.5,y:9.5,width:2,height:2}}},function(e){e.QuickMove="shift"}(G||(G={}));class z extends d{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER+1,this.chest=i.chest,this.index=i.index}onUpdate(e){this.updateClicked()}onRender(e){this.renderContainer(e),this.renderItem(e),this.renderStackSize(e)}updateClicked(){void 0===this.parent.dragging&&s.isMousePressed()&&n.isMouseWithinObject(this)&&void 0!==this.item&&(s.isKeyPressed(G.QuickMove)?this.parent.quickMove(this.chest?"chest":"inventory",this.index):this.parent.startDraggingItem(this.chest?"chest":"inventory",this.index))}renderContainer(e){const i=n.isMouseWithinObject(this)?P.Container.Darker.Default:P.Container.Default.Default;t.renderSprite(e,u.images[P.id],i.x,i.y,this.transform.position.world.x,this.transform.position.world.y,i.width,i.height,{centered:!0})}renderItem(e){void 0!==this.sprite&&t.renderSprite(e,u.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderStackSize(e){void 0!==this.item&&1!==this.item.maxStackSize&&t.renderText(e,`${this.item.currentStackSize}`,this.transform.position.world.x+.25,this.transform.position.world.y+.75)}get item(){return this.chest?this.chest.inventory.items[this.index]:this.inventory.items[this.index]}get inventory(){return this.scene.globals.inventory}get sprite(){if(void 0!==this.item)return k[this.item.type]}}class Z extends d{constructor(t,i){var s;super(t,i),this.scene=t,this.config=i,this.collision.enabled=!0,this.renderer.layer=null!==(s=i.renderLayer)&&void 0!==s?s:e.FIRST_UI_RENDER_LAYER,this.renderer.enabled=!0}onRender(i){t.fillRectangle(i,this.transform.position.world.x,this.transform.position.world.y,this.width*e.TILE_SIZE,this.height*e.TILE_SIZE,{colour:this.colour})}get colour(){return this.config.hexColourCode}}class K{}K.id="tileset_basic",K.ArrowRight={White:{Default:{x:15,y:0},Pressed:{x:16,y:0}}},K.ArrowLeft={White:{Default:{x:15,y:1},Pressed:{x:16,y:1}}},K.ArrowUp={White:{Default:{x:15,y:2},Pressed:{x:16,y:2}}},K.ArrowDown={White:{Default:{x:15,y:3},Pressed:{x:16,y:3}}},K.CheckMark={Green:{Default:{x:15,y:4},Pressed:{x:16,y:4}}},K.Cross={Red:{Default:{x:15,y:5,width:1,height:1},Pressed:{x:16,y:5,width:1,height:1}}},K.Button={White:{Default:{x:3.5,y:.5,width:2,height:2},Pressed:{x:6.5,y:.5,width:2,height:2}}},K.Skull={Dark:{Default:{x:55,y:12}}},function(e){e[e.Default=0]="Default",e[e.Down=1]="Down",e[e.Up=2]="Up"}(V||(V={}));class $ extends d{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.state=V.Default,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER+1}onUpdate(e){switch(this.state){case V.Default:this.updateDefault();break;case V.Down:this.updateDown();break;case V.Up:this.updateUp()}}onRender(e){this.renderButtonContainer(e),this.renderButtonIcon(e)}updateDefault(){s.isMousePressed()&&n.isMouseWithinObject(this)&&(this.state=V.Down)}updateDown(){s.isMousePressed()||(n.isMouseWithinObject(this)?this.state=V.Up:this.state=V.Default)}updateUp(){this.parent.destroy()}renderButtonContainer(e){const i=this.state===V.Default?K.Button.White.Default:K.Button.White.Pressed;t.renderSprite(e,u.images[K.id],i.x,i.y,this.transform.position.world.x,this.transform.position.world.y,i.width,i.height,{centered:!0})}renderButtonIcon(e){const i=this.state===V.Default?K.Cross.Red.Default:K.Cross.Red.Pressed;t.renderSprite(e,u.images[K.id],i.x,i.y,this.transform.position.world.x,this.transform.position.world.y,i.width,i.height,{centered:!0})}}class q extends d{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER+1}onUpdate(e){}onRender(e){this.renderButtonContainer(e),this.renderButtonIcon(e)}renderButtonContainer(e){let i;i=this.parent.isDragging&&n.isMouseWithinObject(this)?K.Button.White.Pressed:K.Button.White.Default,t.renderSprite(e,u.images[K.id],i.x,i.y,this.transform.position.world.x,this.transform.position.world.y,i.width,i.height,{centered:!0})}renderButtonIcon(e){const i=K.Skull.Dark.Default;t.renderSprite(e,u.images[K.id],i.x,i.y,this.transform.position.world.x,this.transform.position.world.y,i.width,i.height,{centered:!0})}}!function(e){e.Close="tab"}(U||(U={}));class J extends d{constructor(t,i){super(t,i),this.scene=t,this.chest=void 0,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER+2,this.collision.layer=e.UI_COLLISION_LAYER,this.scene.globals.disable_player_inputs=!0,this.chest=i.chest}onAwake(){const t=[],i=this.chest?this.chest.rows:0,s=this.chest?this.chest.columns:0,n=(this.chest,5+(this.chest?s+1:0)),o=(e.CANVAS_TILE_HEIGHT-10)/2+1,r=(e.CANVAS_TILE_HEIGHT-2*i)/2+1,a=(e.CANVAS_TILE_WIDTH-2*n)/2+1;for(let e=0;e<5;e++)for(let i=0;i<5;i++){const s=5*e+i;t.push(new z(this.scene,{positionX:a+2*i,positionY:o+2*e,index:s}))}for(let e=0;e<i;e++)for(let i=0;i<s;i++){const n=e*s+i;this.chest&&t.push(new z(this.scene,{positionX:a+12+2*i,positionY:r+2*e,index:n,chest:this.chest}))}t.forEach((e=>this.addChild(e))),this.addChild(new $(this.scene,{positionX:30,positionY:2})),this.addChild(new q(this.scene,{positionX:28,positionY:2})),this.addChild(new Z(this.scene,{positionX:0,positionY:0,hexColourCode:"#00000099",width:e.CANVAS_TILE_WIDTH,height:e.CANVAS_TILE_HEIGHT}))}onUpdate(e){this.updateDragging(),this.updateClose()}onRender(e){this.renderInventoryItem(e),this.renderInventoryItemStackSize(e)}onDestroy(){this.stopDraggingItem(),this.scene.globals.disable_player_inputs=!1,this.chest&&this.chest.actionClose()}get isDragging(){return void 0!==this.dragging}get inventory(){return this.scene.globals.inventory}updateDragging(){if(void 0===this.dragging)return;if(!0===s.mouse.click.left)return;const e={position:{x:s.mouse.position.x,y:s.mouse.position.y},typeMatch:[z,q]},t=this.scene.getObject(e);if(void 0===t)this.stopDraggingItem();else if(t instanceof q)this.dragging=void 0;else if(t instanceof z){const e="inventory"===this.dragging.source?this.inventory:this.chest.inventory,i=void 0===t.chest?this.inventory:this.chest.inventory;e.items[this.dragging.index]=i.items[t.index],i.items[t.index]=this.dragging.item}this.dragging=void 0}updateClose(){s.isKeyPressed(U.Close)&&(s.clearKeyPressed(U.Close),this.destroy())}renderInventoryItem(e){void 0!==this.dragging&&t.renderSprite(e,u.images[this.dragging.item.sprite.tileset],this.dragging.item.sprite.spriteX,this.dragging.item.sprite.spriteY,s.mouse.position.x-.5,s.mouse.position.y-.5)}renderInventoryItemStackSize(e){void 0!==this.dragging&&1!==this.dragging.item.maxStackSize&&t.renderText(e,`${this.dragging.item.currentStackSize}`,s.mouse.position.x+.25,s.mouse.position.y+.75)}startDraggingItem(e,t){this.dragging={item:this.getInventoryFromSource(e).items[t],index:t,source:e},this.getInventoryFromSource(this.dragging.source).items[t]=void 0}quickMove(e,t){if(void 0===this.chest)return;const i="inventory"===e?this.inventory:this.chest.inventory,s="inventory"===e?this.chest.inventory:this.inventory,n=s.getFirstFreeSlot();void 0!==n&&(s.items[n]=i.items[t],i.items[t]=void 0)}stopDraggingItem(){void 0!==this.dragging&&("inventory"===this.dragging.source?this.inventory.items[this.dragging.index]=this.dragging.item:"chest"===this.dragging.source&&(this.chest.inventory.items[this.dragging.index]=this.dragging.item))}getInventoryFromSource(e){return"chest"===e?this.chest.inventory:this.inventory}}const Q={tileset:"tileset_chicken",x:0,y:0},ee="tileset_chest";class te extends d{constructor(e,t){super(e,t),this.scene=e,this.rows=5,this.columns=5,this.isOpen=!1,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.inventory=new R(this.rows,this.columns)}onRender(e){this.renderSprite(e)}get totalSlots(){return this.rows*this.columns}interact(){this.actionOpen()}actionOpen(){this.isOpen=!0,this.scene.addObject(new J(this.scene,{positionX:0,positionY:0,chest:this}))}actionClose(){this.isOpen=!1}renderSprite(e){this.isOpen?t.renderSprite(e,u.images[ee],13,.5,this.transform.position.world.x,this.transform.position.world.y,1,2,{centered:!0}):t.renderSprite(e,u.images[ee],1,.5,this.transform.position.world.x,this.transform.position.world.y,1,2,{centered:!0})}}class ie extends d{constructor(t,i){super(t,i),this.scene=t,this.height=2,this.width=10,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,this.collision.layer=e.UI_COLLISION_LAYER}onUpdate(e){}onRender(e){!0!==this.scene.globals.disable_player_inputs&&(this.renderContainers(e),this.renderItems(e,this.inventory.items.slice(0,this.hotbar.size)),this.renderHotbarSelector(e))}renderHotbarSelector(e){const i=this.boundingBox.world.left+1+2*this.hotbarSelectedIndex,s=this.boundingBox.world.top+1;t.renderSprite(e,u.images.tileset_ui,9,9,i,s,2,2,{centered:!0})}renderContainers(e){for(let i=0;i<5;i++)t.renderSprite(e,u.images.tileset_ui,.5,3.5,this.boundingBox.world.left+1+2*i,this.boundingBox.world.top+1,2,2,{centered:!0})}renderItems(e,t){for(let i=0;i<5;i++){let s=t[i];void 0!==s&&this.renderInventoryItem(e,s.sprite.tileset,s.currentStackSize,s.maxStackSize,s.sprite.spriteX,s.sprite.spriteY,this.boundingBox.world.left+1+2*i,this.boundingBox.world.top+1)}}renderInventoryItem(e,i,s,n,o,r,a,d){t.renderSprite(e,u.images[i],o,r,a,d,1,1,{centered:!0}),n>1&&t.renderText(e,`${s}`,a+.75,d+1,{size:8})}get inventory(){return this.scene.globals.inventory}get hotbar(){return this.scene.globals.hotbar}get hotbarSelectedIndex(){return this.scene.globals.hotbar_selected_index}}var se,ne;!function(e){e.UP="w",e.DOWN="s",e.LEFT="a",e.RIGHT="d"}(se||(se={})),function(e){e.Inventory="tab",e.Interact="e",e.InteractAlt=" "}(ne||(ne={}));class oe extends d{constructor(e,t){super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.movementSpeed=4,this.animations={[se.RIGHT]:[{x:7,y:10},{x:10,y:10}],[se.LEFT]:[{x:7,y:7},{x:10,y:7}],[se.UP]:[{x:7,y:4},{x:10,y:4}],[se.DOWN]:[{x:7,y:1},{x:10,y:1}]},this.animationsIdle={[se.RIGHT]:[{x:1,y:10},{x:4,y:10}],[se.LEFT]:[{x:1,y:7},{x:4,y:7}],[se.UP]:[{x:1,y:4},{x:4,y:4}],[se.DOWN]:[{x:1,y:1},{x:4,y:1}]},this.hotbarObject=void 0,this.direction=se.DOWN,this.directionTime=0,this.directionTimer=0,this.animationIndex=0,this.isIdle=!0,this.movementEnabled=!1,this.hotbarEnabled=!1,this.leftClickEnabled=!1,this.inventoryEnabled=!1,this.interactButtonEnabled=!1,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=10,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.enableMovement(),this.enableInteractKeys(),this.enableInventoryKeys(),this.enableOtherKeys()}enableMovement(){this.movementEnabled=!0}enableOtherKeys(){this.hotbarEnabled=!0,this.leftClickEnabled=!0}enableInventoryKeys(){this.inventoryEnabled=!0}enableInteractKeys(){this.interactButtonEnabled=!0}onAwake(){this.addHotbar()}onUpdate(e){this.updateMovement(e),this.updateAnimations(e),this.updateHotbarViaKey(),this.updateHotbarViaWheel(),this.updateLeftClick(),this.updateButtonInteract(),this.updateOpenInventory(),this.latestScrollTimestamp=s.mouse.wheel.event.timeStamp}onRender(e){this.renderSprite(e),this.renderCursor(e)}get hotbar(){return this.scene.globals.hotbar}updateMovement(e){!0!==this.scene.globals.disable_player_inputs&&!1!==this.movementEnabled&&(this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){if(this.targetX!==this.transform.position.world.x||this.targetY!==this.transform.position.world.y)return;if(!s.isKeyPressed([se.RIGHT,se.LEFT,se.UP,se.DOWN]))return;let t,i=new f(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY);if(s.isKeyPressed(se.RIGHT)?(i.targetX+=1,t=se.RIGHT):s.isKeyPressed(se.LEFT)?(i.targetX-=1,t=se.LEFT):s.isKeyPressed(se.UP)?(i.targetY-=1,t=se.UP):s.isKeyPressed(se.DOWN)&&(i.targetY+=1,t=se.DOWN),this.direction!==t?(this.direction=t,this.directionTime=0,this.directionTimer=0):this.directionTimer+=e,this.directionTimer<.05)return;const n={boundingBox:d.calculateBoundingBox(i.target.x,i.target.y,this.width,this.height),objectIgnore:new Map([[this,!0]]),collision:{enabled:!0}};this.scene.getObject(n)||this.scene.isOutOfBounds(i.targetX,i.targetY)||(this.targetX=i.targetX,this.targetY=i.targetY)}updateAnimations(e){this.targetX!==this.transform.position.world.x||this.targetY!==this.transform.position.world.y?this.isIdle=!1:this.isIdle=!0,this.isIdle?this.directionTime<.5?this.animationIndex=0:this.animationIndex=1:this.directionTime<.25?this.animationIndex=0:this.directionTime<.5?this.animationIndex=1:this.directionTime<.75?this.animationIndex=0:this.animationIndex=1,this.directionTime=(this.directionTime+e)%1}processMovement(e){if(this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y){let t=new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=x.moveTowardsPosition(t,x.frameSpeed(this.movementSpeed,e));this.transform.position.local.x=i.positionX,this.transform.position.local.y=i.positionY}}updateButtonInteract(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.interactButtonEnabled)return;if(!s.isKeyPressed([ne.Interact,ne.InteractAlt]))return;s.clearKeyPressed([ne.Interact,ne.InteractAlt]);let e=this.transform.position.world.x,t=this.transform.position.world.y;switch(this.direction){case se.UP:t-=1;break;case se.RIGHT:e+=1;break;case se.DOWN:t+=1;break;case se.LEFT:e-=1}const i={position:{x:e,y:t},objectIgnore:new Map([[this,!0]])};let n=this.scene.getObject(i);void 0!==n&&function(e){return"interact"in e}(n)&&n.interact()}getPositionFacing(){let e=Math.floor(this.transform.position.world.x),t=Math.floor(this.transform.position.world.y);return this.direction===se.RIGHT?{x:e+1,y:t}:this.direction===se.LEFT?{x:e-1,y:t}:this.direction===se.UP?{x:e,y:t-1}:this.direction===se.DOWN?{x:e,y:t+1}:void 0}updateHotbarViaKey(){!0!==this.scene.globals.disable_player_inputs&&!1!==this.hotbarEnabled&&(!0!==s.isKeyPressed("1")?!0!==s.isKeyPressed("2")?!0!==s.isKeyPressed("3")?!0!==s.isKeyPressed("4")?!0!==s.isKeyPressed("5")||(this.scene.globals.hotbar_selected_index=4):this.scene.globals.hotbar_selected_index=3:this.scene.globals.hotbar_selected_index=2:this.scene.globals.hotbar_selected_index=1:this.scene.globals.hotbar_selected_index=0)}updateHotbarViaWheel(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.hotbarEnabled)return;if(this.latestScrollTimestamp===s.mouse.wheel.event.timeStamp)return;const e=this.scene.globals.hotbar_selected_index;s.mouse.wheel.event.deltaY>0?e===this.hotbar.size-1?this.scene.globals.hotbar_selected_index=0:this.scene.globals.hotbar_selected_index++:s.mouse.wheel.event.deltaY<0&&(0===e?this.scene.globals.hotbar_selected_index=this.hotbar.size-1:this.scene.globals.hotbar_selected_index--)}updateOpenInventory(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.inventoryEnabled)return;let e=[ne.Inventory];!1!==s.isKeyPressed(e)&&(this.scene.addObject(new J(this.scene,{positionX:0,positionY:0})),s.clearKeyPressed(e))}updateLeftClick(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.leftClickEnabled)return;if(!s.isMousePressed(i.Left))return;console.log({x:Math.round(s.mouse.position.x+this.scene.globals.camera.startX),y:Math.round(s.mouse.position.y+this.scene.globals.camera.startY)}),s.clearMousePressed(i.Left);const e=this.scene.selectedInventoryItem;if(void 0===e)return;if(e.radius===O.None)return;const t=Math.round(s.mouse.position.x+this.scene.globals.camera.startX),n=Math.round(s.mouse.position.y+this.scene.globals.camera.startY);if(e.radius===O.Player&&Math.abs(t-this.transform.position.world.roundedX)>1||Math.abs(n-this.transform.position.world.roundedY)>1)return;const o={position:{x:t,y:n}},r=this.scene.getObject(o);if(void 0===r)switch(e.type){case X.Hoe:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),n=new W(e,{positionX:t,positionY:i});e.addObject(n)}(this.scene);case X.WateringCan:return void function(e){e.globals.disable_player_inputs=!0;const t=new Y(e,{text:"There is nothing to water...",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(t)}(this.scene);case X.Chicken:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),n=new de(e,{positionX:t,positionY:i});e.addObject(n),e.globals.inventory.removeFromInventoryByIndex(e.selectedInventoryIndex,1)}(this.scene);case X.Egg:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),n=new re(e,{positionX:t,positionY:i});e.addObject(n),e.globals.inventory.removeFromInventoryByIndex(e.selectedInventoryIndex,1)}(this.scene);case X.TomatoSeeds:case X.WheatSeeds:return void function(e){e.globals.disable_player_inputs=!0;const t=new Y(e,{text:"Seeds can only be placed in watered dirt.",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(t)}(this.scene);case X.Chest:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),n=new te(e,{positionX:t,positionY:i});e.addObject(n),e.globals.inventory.removeFromInventoryByIndex(e.selectedInventoryIndex,1)}(this.scene);default:return}else switch(e.type){case X.WateringCan:switch(!0){case r instanceof W:return void function(e,t){t.actionWater()}(this.scene,r);case r instanceof de:return void function(e,t){e.globals.disable_player_inputs=!0;const i=new Y(e,{text:"Hey could you not water me please...",portrait:Q,name:"Chicken",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(i)}(this.scene);default:return}case X.TomatoSeeds:case X.WheatSeeds:return 1==r instanceof W?void function(e,t){if(t.cropStage===F.Watered)t.actionPlant();else{e.globals.disable_player_inputs=!0;const t=new Y(e,{text:"Seeds can only be placed in watered dirt.",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(t)}}(this.scene,r):void 0;case X.Tomato:case X.Wheat:return 1==r instanceof de?void function(e,t){t.actionGiveItem()}(this.scene,r):void 0;default:return}}renderSprite(e){let i=this.isIdle?this.animationsIdle:this.animations;t.renderSprite(e,u.images.tileset_player,i[this.direction][this.animationIndex].x,i[this.direction][this.animationIndex].y,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderCursor(e){if(!0===this.scene.globals.disable_player_inputs)return;if(!this.leftClickEnabled)return;let i=Math.round(s.mouse.position.x+this.scene.globals.camera.startX),n=Math.round(s.mouse.position.y+this.scene.globals.camera.startY),o=this.scene.selectedInventoryItem;void 0!==o&&o.radius!==O.None&&(i===this.transform.position.world.roundedX&&n===this.transform.position.world.roundedY||o.radius===O.Player&&Math.abs(i-this.transform.position.world.roundedX)>1||Math.abs(n-this.transform.position.world.roundedY)>1||t.fillRectangle(e,i-.5,n-.5,1,1,{colour:"#0000ff33",type:"tile"}))}addHotbar(){this.hotbarObject||(this.hotbarObject=new ie(this.scene,{positionX:16,positionY:16}),this.scene.addObject(this.hotbarObject))}removeHotbar(){void 0!==this.hotbarObject&&this.hotbarObject.destroy()}}class re extends d{constructor(e,t){super(e,t),this.scene=e,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.hatchTimer=0,this.hatchTimerMax=7,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=7}onUpdate(e){this.updateAnimation(e),this.updateHatch(e)}onRender(e){t.renderSprite(e,u.images.tileset_egg,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0})}get inventory(){return this.scene.globals.inventory}updateAnimation(e){this.animationTimer=(this.animationTimer+e)%1,this.animationIndex=0}updateHatch(e){if(this.hatchTimer+=e,this.hatchTimer<this.hatchTimerMax)return;const t=this.scene.getObject({typeMatch:[oe]}),i=new de(this.scene,{positionX:this.transform.position.world.x,positionY:this.transform.position.world.y,follows:t});this.destroy(),this.scene.addObject(i)}interact(){void 0!==this.inventory.addToInventory(X.Egg)&&this.destroy()}}const ae={tileset:"tileset_chicken",x:0,y:0};class de extends d{constructor(e,t){var i,s;super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=w.randomStartingDelta(4),this.animationIndex=0,this.movementSpeed=2,this.movementTimer=w.randomStartingDelta(2),this.movementDelay=2,this.eggTimer=w.randomStartingDelta(2),this.eggTimerMax=7,this.eggMax=200,this.isMovingThisFrame=!1,this.isEdgyTeen=!1,this.interactionCount=0,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.canLayEggs=null!==(i=t.canLayEggs)&&void 0!==i&&i,this.isEdgyTeen=3===w.randomIntFromRange(0,3),this.canMove=null!==(s=t.canMove)&&void 0!==s&&s,this.following=t.follows,console.log(this.onRender)}onUpdate(e){this.isMovingThisFrame=!1,this.updateMovement(e),this.updateAnimation(e),this.updateEgg(e)}onRender(e){t.renderSprite(e,u.images.tileset_chicken,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}get inventory(){return this.scene.globals.inventory}updateAnimation(e){this.animationTimer=(this.animationTimer+e)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}updateMovement(e){this.canMove&&(this.movementTimer+=e,this.movementTimer>this.movementDelay&&this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){let t;this.movementTimer=0,t=this.following?x.moveTowardsOtherEntity(new f(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY),{positionX:this.following.transform.position.world.x,positionY:this.following.transform.position.world.y}):x.moveInRandomDirection(new f(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY));const i={position:{x:t.targetX,y:t.targetY},objectIgnore:new Map([[this,!0]])};this.scene.getObject(i)||this.scene.isOutOfBounds(t.targetX,t.targetY)||(this.targetX=t.targetX,this.targetY=t.targetY)}processMovement(e){if(this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y){let t=new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=x.moveTowardsPosition(t,x.frameSpeed(this.movementSpeed,e));this.transform.position.local.x=i.positionX,this.transform.position.local.y=i.positionY,this.isMovingThisFrame=!0}}updateEgg(e){if(!this.canLayEggs)return;if(this.eggTimer+=e,this.eggTimer<this.eggTimerMax)return;if(!this.isMovingThisFrame)return;if(this.scene.getObjects({typeMatch:[de,re]}).length>this.eggMax)return;let t;t=this.transform.position.world.x>this.targetX||this.transform.position.world.y>this.targetY?Math.ceil:Math.floor,this.scene.addObject(new re(this.scene,{positionX:t(this.transform.position.world.x),positionY:t(this.transform.position.world.y)})),this.eggTimer=0}interact(){this.interactDefault()}interactDefault(){this.scene.globals.disable_player_inputs=!0;let e="";if(this.isEdgyTeen)switch(this.interactionCount%3){case 0:e="GET OUT OF MY ROOM MOM! GODDDD!!1!";break;case 1:e="UGHHHH! YOU ARE LIKE SO EMBARRASSING!1!11!";break;case 2:e="OMG!1!1 JUST LIKE LEAVE ME ALONE!1!11!!"}else switch(this.interactionCount%3){case 0:e="bock bock ... can i help you? ... cluck cluck ...";break;case 1:e="cluck cluck ... you're sort of annoying you know that? ... bock bock ...";break;case 2:e="bock cluck ... is... is this a simulation? ... cluck bock ..."}let t=new Y(this.scene,{text:e,portrait:ae,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(t),this.interactionCount++}actionGiveItem(){switch(this.scene.selectedInventoryItem.type){case X.Tomato:return void this.actionGiveTomato();case X.Wheat:return void this.actionGiveWheat()}}actionGiveTomato(){this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:"I LOooOooOoOooOoOVE TOMATOES!",portrait:ae,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}),t=this.inventory.items.indexOf(this.scene.selectedInventoryItem);this.inventory.removeFromInventoryByIndex(t,1),this.scene.addObject(e)}actionGiveWheat(){this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:"I HAAAAAAAAAAAAAAAATE WHEAT!",portrait:ae,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(e)}}const he={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},le=[he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he,he],ce={index:0,tiles:[[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le],[...le]]},pe={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},ge={...pe,animationFrames:[{spriteX:2,spriteY:1}]},me={...pe,animationFrames:[{spriteX:1,spriteY:2}]},ue={...pe,animationFrames:[{spriteX:2,spriteY:2}]},be={...pe,animationFrames:[{spriteX:5,spriteY:1}]},ye={index:1,tiles:[[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,be,ge,ge,ge,ge,ge,ge,ue],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,be,ge,ge,ge,ue],[void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,me],[void 0,void 0,void 0,void 0,me],[ge,ge,ge,ge,ue]]};class ve extends d{constructor(e,t){super(e,t),this.scene=e,this.collision.enabled=!0}}const we={tileset:"tileset_grass",animationFrameDuration:1,animationFrames:[],animationMap:[1]},fe={...we,animationFrames:[{spriteX:1,spriteY:1}]},xe={...we,animationFrames:[{spriteX:2,spriteY:1}]},Ie=[fe,fe,fe,fe,fe,fe,fe,fe,fe,fe,fe,fe,fe,fe,fe,fe,fe,fe,{...we,animationFrames:[{spriteX:1,spriteY:2}]}],Ee={index:1,tiles:[Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,Ie,[xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,xe,{...we,animationFrames:[{spriteX:2,spriteY:2}]}]]};class Te{constructor(e,t){this.tileset=e,this.frames=t,this.duration=t.reduce(((e,t)=>e+t.duration),0)}currentFrame(e){let t=e%this.duration,i=0;for(let e=0;e<this.frames.length;e++)if(i+=this.frames[e].duration,t<i)return this.frames[e];return this.frames[0]}}const _e={tileset:"tileset_chicken",x:0,y:0},Se={idle:new Te("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}]),moving:new Te("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}])};class Ce extends d{constructor(e,t){var i,s,n,o,r;super(e,t),this.scene=e,this.state="idle",this.targetX=-1,this.targetY=-1,this.animation={index:0,timer:0},this.movementTimer=w.randomStartingDelta(2),this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.canMove=null!==(i=t.canMove)&&void 0!==i&&i,this.following=t.follows,this.dialogue=t.dialogue,this.animations=null!==(s=t.animations)&&void 0!==s?s:Se,this.movementSpeed=null!==(n=t.movementSpeed)&&void 0!==n?n:2,this.movementDelay=null!==(o=t.movementDelay)&&void 0!==o?o:void 0,this.name=null!==(r=t.name)&&void 0!==r?r:"???"}onUpdate(e){this.updateMovement(e),this.updateAnimationTimer(e)}onRender(e){let i=this.animations[this.state],s=i.currentFrame(this.animation.timer);t.renderSprite(e,u.images[i.tileset],s.spriteX,s.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{opacity:this.renderer.opacity,scale:this.renderer.scale,centered:!0})}onDestroy(){this.scene.globals.disable_player_inputs=!1}updateAnimationTimer(e){this.animation.timer=(this.animation.timer+e)%this.animations[this.state].duration}updateMovement(e){this.canMove&&(this.movementTimer+=e,(void 0===this.movementDelay&&this.movementTimer>this.movementSpeed||this.movementTimer>this.movementDelay)&&this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){let t;this.movementTimer=0,t=this.following?x.moveTowardsOtherEntity(new f(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY),{positionX:this.following.transform.position.world.x,positionY:this.following.transform.position.world.y}):x.moveInRandomDirection(new f(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY));const i={position:{x:t.targetX,y:t.targetY},objectIgnore:new Map([[this,!0]])};this.scene.getObject(i)||this.scene.isOutOfBounds(t.targetX,t.targetY)||(this.targetX=t.targetX,this.targetY=t.targetY)}processMovement(e){if(this.targetX!==this.transform.position.world.x||this.targetY!==this.transform.position.world.y){let t=new f(this.transform.position.world.x,this.transform.position.world.y,this.targetX,this.targetY),i=x.moveTowardsPosition(t,x.frameSpeed(this.movementSpeed,e));this.transform.position.world.x=i.positionX,this.transform.position.world.y=i.positionY}}interact(){if(void 0===this.dialogue)return;this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:this.dialogue,portrait:_e,name:this.name});this.scene.addObject(e)}}class Ye extends d{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,this.price=i.price,this.type=i.type}onUpdate(e){this.updateClicked()}onRender(e){this.renderContainer(e),this.renderItem(e),this.renderPrice(e)}updateClicked(){s.isMousePressed()&&n.isMouseWithinObject(this)&&(s.clearMousePressed(i.Left),this.price>this.scene.globals.gold||(this.inventory.addToInventory(this.type)&&(this.scene.globals.gold-=this.price),this.parent.refreshShopState()))}renderContainer(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"white",type:"tile"})}renderItem(e){t.renderSprite(e,u.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderPrice(e){t.renderText(e,`$${this.price}`,this.transform.position.world.x,this.transform.position.world.y+1)}get inventory(){return this.scene.globals.inventory}get sprite(){return k[this.type]}}class Xe extends d{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,this.type=i.type,this.count=i.count,this.index=i.index}onUpdate(e){this.updateClicked()}onRender(e){this.renderContainer(e),this.renderItem(e),this.renderPrice(e),this.renderStackSize(e)}get price(){return M[this.type]}get inventory(){return this.scene.globals.inventory}get sprite(){return k[this.type]}updateClicked(){s.isMousePressed()&&n.isMouseWithinObject(this)&&(s.clearMousePressed(i.Left),this.scene.globals.gold+=this.price,this.inventory.removeFromInventoryByIndex(this.index,1),this.parent.refreshShopState())}renderContainer(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"white",type:"tile"})}renderItem(e){t.renderSprite(e,u.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderPrice(e){t.renderText(e,`$${this.price}`,this.transform.position.world.x-1,this.transform.position.world.y)}renderStackSize(e){t.renderText(e,`${this.count}`,this.transform.position.world.x,this.transform.position.world.y+1)}}var Oe;!function(e){e.Close="tab"}(Oe||(Oe={}));const Le=[{type:X.TomatoSeeds,price:5},{type:X.WheatSeeds,price:5},{type:X.Hoe,price:50},{type:X.WateringCan,price:50},{type:X.Chest,price:500}];class je extends d{constructor(t,i){super(t,i),this.scene=t,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER,this.collision.layer=e.UI_COLLISION_LAYER,this.onLeave=i.onLeave}onAwake(){this.refreshShopState()}onUpdate(e){this.updateButtonClose(),this.updateClickClose()}onRender(e){this.renderBackground(e),this.renderShopBackground(e),this.renderShopTitle(e),this.renderInventoryBackground(e),this.renderInventoryTitle(e),this.renderTotalGold(e),this.renderLeaveButton(e)}get inventory(){return this.scene.globals.inventory}get hotbar(){return this.scene.globals.hotbar}updateButtonClose(){s.isKeyPressed(Oe.Close)&&(s.clearKeyPressed(Oe.Close),this.close())}updateClickClose(){s.isMousePressed(i.Left)&&n.isMouseWithinBoundary(s.mouse.position,21.5,12,4.5,1.5)&&(s.clearMousePressed(i.Left),this.close())}close(){this.destroy(),this.onLeave&&this.onLeave()}renderBackground(e){t.fillRectangle(e,0,0,32,18,{colour:"#00000055",type:"tile"})}renderShopBackground(e){t.fillRectangle(e,1,1,14,10,{colour:"brown",type:"tile"})}renderShopTitle(e){t.fillRectangle(e,4,.25,8,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,"Shop (buy)",6,1.25)}renderInventoryBackground(e){t.fillRectangle(e,17,1,14,11.75,{colour:"brown",type:"tile"})}renderInventoryTitle(e){t.fillRectangle(e,20,.25,8,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,"Inventory (sell)",21,1.25)}renderTotalGold(e){t.fillRectangle(e,26.5,12,4.5,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,`Gold: ${this.scene.globals.gold}`,27,13)}renderLeaveButton(e){t.fillRectangle(e,21.5,12,4.5,1.5,{colour:"grey",type:"tile"}),t.renderText(e,"Leave",22.5,13)}refreshShopState(){this.removeAllChildren();for(let e=0;e<Le.length;e++){const t=Le[e],i=new Ye(this.scene,{positionX:this.transform.position.world.x+3+2.5*e,positionY:this.transform.position.world.y+3,price:t.price,type:t.type});this.addChild(i)}const e=this.hotbar.size;for(let t=0;t<5;t++)for(let i=0;i<4;i++){const s=t+5*i+e,n=this.inventory.items[s];if(void 0===n)continue;const o=new Xe(this.scene,{positionX:this.transform.position.world.x+19+2.5*t,positionY:this.transform.position.world.y+3+2.5*i,type:n.type,count:n.currentStackSize,index:s});this.addChild(o)}}}const Ae={tileset:"tileset_player",x:1,y:1},ke={idle:new Te("tileset_player",[{spriteX:1,spriteY:1,duration:.5},{spriteX:4,spriteY:1,duration:.5}]),moving:new Te("tileset_player",[])};class De extends Ce{constructor(e,t){t.animations=ke,super(e,t),this.scene=e,this.firstConversation=!0}onUpdate(e){super.onUpdate(e)}interact(){this.scene.globals.disable_player_inputs=!0,this.firstConversation?this.startStageFirstConversation():this.startStageGreeting()}startStageFirstConversation(){this.scene.addObject(new Y(this.scene,{text:"Hi, I don't think we've met. I'm the shop keeper. I have farming supplies for sale and will buy most things you grow.",portrait:Ae,name:"???",onComplete:()=>{this.firstConversation=!1,this.startStageGreeting()}}))}startStageGreeting(){this.scene.globals.disable_player_inputs=!0,this.scene.addObject(new Y(this.scene,{text:"Welcome to my shop, how can I help?",portrait:Ae,name:"Shopkeeper",onComplete:()=>{this.scene.addObject(new je(this.scene,{positionX:0,positionY:0,onLeave:this.leaveShopCallback}))}}))}leaveShopCallback(){this.scene.addObject(new Y(this.scene,{text:"Thanks, come again any time!",portrait:Ae,name:"Shopkeeper",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}))}}class Me{}Me.TopLeft={x:1,y:0},Me.TopRight={x:3,y:0},Me.BottomLeft={x:1,y:2},Me.BottomRight={x:3,y:2},Me.LeftHorizontal={x:1,y:3},Me.MiddleHorizontal={x:2,y:3},Me.RightHorizontal={x:3,y:3},Me.TopVertical={x:0,y:0},Me.MiddleVertical={x:0,y:1},Me.BottomVertical={x:0,y:2},Me.FencePost={x:0,y:3},Me.Open={x:.5,y:3};class Re extends d{constructor(e,t){super(e,t),this.scene=e,this.type=Me.FencePost,this.open=!1,this.collision.enabled=!0,this.renderer.enabled=!0,t.type&&(this.type=t.type)}onRender(e){t.renderSprite(e,u.images.tileset_fence,this.open?Me.Open.x:this.type.x,this.open?Me.Open.y:this.type.y,this.transform.position.world.x,this.transform.position.world.y,1,1,{centered:!0})}interact(){}}const Be=e.CANVAS_TILE_WIDTH/2,He=e.CANVAS_TILE_HEIGHT/2;class Fe extends d{constructor(t,i){var s,n,o,r,a;super(t,i),this.scene=t,this.animationTimer=0,this.renderer.enabled=!0,this.renderer.layer=e.LAST_UI_RENDER_LAYER,this.animationType=null!==(s=i.animationType)&&void 0!==s?s:"block",this.animationDirection=null!==(n=i.animationDirection)&&void 0!==n?n:"in",this.animationLength=null!==(o=i.animationLength)&&void 0!==o?o:1,this.animationCenterX=null!==(r=i.animationCenterX)&&void 0!==r?r:Be,this.animationCenterY=null!==(a=i.animationCenterY)&&void 0!==a?a:He}onUpdate(e){this.animationTimer+=e,this.animationTimer>this.animationLength&&(this.animationTimer=this.animationLength,this.destroy())}get animationPercentage(){return this.animationTimer/this.animationLength}onRender(e){switch(this.animationType){case"block":this.renderAnimationBlock(e);break;case"circle":this.renderAnimationCircle(e)}}renderAnimationBlock(i){let s="in"===this.animationDirection?1-this.animationPercentage:this.animationPercentage;t.fillRectangle(i,0,0,e.CANVAS_WIDTH,e.CANVAS_HEIGHT,{colour:`rgba(0, 0, 0, ${s})`})}renderAnimationCircle(t){let i="in"===this.animationDirection?this.animationPercentage:1-this.animationPercentage,s=this.animationCenterX-this.scene.globals.camera.startX,n=this.animationCenterY-this.scene.globals.camera.startY;t.fillStyle="black",t.beginPath(),t.arc(s*e.TILE_SIZE,n*e.TILE_SIZE,e.CANVAS_WIDTH*i,0,2*Math.PI),t.rect(e.CANVAS_WIDTH,0,-1*e.CANVAS_WIDTH,e.CANVAS_HEIGHT),t.fill()}}const Ne={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},We={...Ne,animationFrames:[{spriteX:9.5,spriteY:4}]},Pe={...Ne,animationFrames:[{spriteX:10.5,spriteY:4}]},Ge={...Ne,animationFrames:[{spriteX:8.5,spriteY:5}]},Ve={...Ne,animationFrames:[{spriteX:9.5,spriteY:5}]},Ue={...Ne,animationFrames:[{spriteX:10.5,spriteY:5}]},ze={index:1,tiles:[[],[],[],[],[],[],[],[],[],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ge,{...Ne,animationFrames:[{spriteX:8.5,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,We,Ve,{...Ne,animationFrames:[{spriteX:9.5,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,Pe,Ue,{...Ne,animationFrames:[{spriteX:10.5,spriteY:6}]}],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]},Ze=()=>{};class Ke extends d{constructor(e,t){var i,s;super(e,t),this.scene=e,this.timer=0,this.intervalsComplete=0,this.duration=null!==(i=t.duration)&&void 0!==i?i:1,this.onInterval=null!==(s=t.onInterval)&&void 0!==s?s:Ze,this.maxIntervals=t.maxIntervals}onUpdate(e){this.timer+=e,this.timer>=this.duration&&(this.onInterval(),this.timer-=this.duration,this.intervalsComplete++,this.maxIntervals&&this.intervalsComplete>=this.maxIntervals&&this.destroy())}}class $e extends d{constructor(t,i){super(t,i),this.scene=t,this.renderer.enabled=!0,this.renderer.layer=e.FIRST_UI_RENDER_LAYER}onUpdate(e){n.wasObjectClicked(this)&&(s.clearMousePressed(i.Left),document.fullscreenElement||document.webkitIsFullScreen?document.exitFullscreen():this.scene.displayContext.canvas.requestFullscreen().then((()=>{})).catch((e=>{throw new Error(e)})))}onRender(e){t.renderSprite(e,u.images.tileset_fullscreen,this.isFullscreen?1:0,0,this.boundingBox.world.left,this.boundingBox.world.top)}get isFullscreen(){return!(!document.fullscreenElement&&!document.webkitIsFullScreen)}}class qe extends d{constructor(i,s){var n;super(i,s),this.scene=i,this.customerRenderer=i=>{const s=this.cameraOffsetX/this.zoom,n=this.cameraOffsetY/this.zoom;let o=this.object.transform.position.world.x-s,r=this.object.transform.position.world.y-n,a=this.object.transform.position.world.x+(s+1),d=this.object.transform.position.world.y+(n+1);o<0?(o=0,a=o+e.CANVAS_TILE_WIDTH):a>this.scene.map.width&&(a=this.scene.map.width,o=a-e.CANVAS_TILE_WIDTH),r<0?(r=0,d=r+e.CANVAS_TILE_HEIGHT):d>this.scene.map.height&&(d=this.scene.map.height,r=d-e.CANVAS_TILE_HEIGHT),this.scene.globals.camera.startX=o,this.scene.globals.camera.startY=r,this.scene.globals.camera.endX=a,this.scene.globals.camera.endY=d,i.background.forEach((e=>{t.renderSubsection(e,this.mainContext,o,r,a,d)})),i.objects.forEach(((i,s)=>{s>=e.FIRST_UI_RENDER_LAYER?t.renderSubsection(i,this.mainContext,0,0,e.CANVAS_TILE_WIDTH,e.CANVAS_TILE_HEIGHT):t.renderSubsection(i,this.mainContext,o,r,a,d)}))},this.cameraOffsetX=e.CANVAS_TILE_WIDTH/2-.5,this.cameraOffsetY=e.CANVAS_TILE_HEIGHT/2-.5,this.object=s.object,this.zoom=null!==(n=s.zoom)&&void 0!==n?n:1,this.scene.setCustomRenderer(this.customerRenderer)}onDestroy(){this.scene.removeCustomerRenderer()}}const Je=()=>{};class Qe extends d{constructor(e,t){var i,s;super(e,t),this.scene=e,this.timer=0,this.duration=null!==(i=t.duration)&&void 0!==i?i:1,this.onComplete=null!==(s=t.onComplete)&&void 0!==s?s:Je}onUpdate(e){this.timer+=e,this.timer>=this.duration&&(this.onComplete(),this.destroy())}}class et extends d{constructor(e,t){super(e,t),this.scene=e,this.isWarping=!1,this.isColliding=!1,this.player=t.player,this.map=t.map}onUpdate(e){this.isWarping||(this.transform.position.world.x===this.player.transform.position.world.x&&this.transform.position.world.y===this.player.transform.position.world.y?this.isColliding||(this.scene.globals.disable_player_inputs=!0,this.isWarping=!0,this.isColliding=!0,this.scene.addObject(new Qe(this.scene,{duration:1.5,onComplete:()=>{this.reset(),this.scene.flagForMapChange(this.map)}})),this.scene.addObject(new Fe(this.scene,{animationType:"circle",animationDirection:"out",animationCenterX:this.transform.position.world.x,animationCenterY:this.transform.position.world.y,animationLength:1.5}))):this.isColliding=!1)}reset(){this.isWarping=!1,this.scene.globals.disable_player_inputs=!1}}const tt={tileset:"tileset_dirt",animationFrameDuration:1,animationFrames:[],animationMap:[1]},it={...tt,animationFrames:[{spriteX:0,spriteY:0}]},st={...tt,animationFrames:[{spriteX:1,spriteY:0}]},nt={...tt,animationFrames:[{spriteX:2,spriteY:0}]},ot={...tt,animationFrames:[{spriteX:0,spriteY:1}]},rt={...tt,animationFrames:[{spriteX:1,spriteY:1}]},at={...tt,animationFrames:[{spriteX:2,spriteY:1}]},dt={...tt,animationFrames:[{spriteX:0,spriteY:2}]},ht={...tt,animationFrames:[{spriteX:1,spriteY:2}]},lt={index:0,tiles:[[],[],[],[],[],[],[],[],[],[],[],[void 0,void 0,void 0,void 0,void 0,it,ot,ot,ot,ot,ot,dt],[void 0,void 0,void 0,void 0,void 0,st,rt,rt,rt,rt,rt,ht],[void 0,void 0,void 0,void 0,void 0,st,rt,rt,rt,rt,rt,ht],[void 0,void 0,void 0,void 0,void 0,st,rt,rt,rt,rt,rt,ht],[void 0,void 0,void 0,void 0,void 0,st,rt,rt,rt,rt,rt,ht],[void 0,void 0,void 0,void 0,void 0,st,rt,rt,rt,rt,rt,ht],[void 0,void 0,void 0,void 0,void 0,nt,at,at,at,at,at,{...tt,animationFrames:[{spriteX:2,spriteY:2}]}]]},ct={index:1,tiles:[]},pt={unknown_npc_1:"Welcome. I have been expecting you. We all have.",unknown_npc_2:"If you do not do as we wish, a terrible plague will befall the land.",unknown_npc_3:"You have no idea of the power that we posess.",greg:{line_1:"Hi, I'm Greg.",line_2:"........",line_3:"Byeeeeeeee"}},gt={tileset:"tileset_chicken",x:0,y:0};class mt extends Ce{constructor(e,t){super(e,t),this.scene=e,this.stage="idle",this.stagePauseTimer=0,this.stagePauseDuration=3,this.stageByeTimer=0,this.stageByeDuration=3}onUpdate(e){switch(super.onUpdate(e),this.stage){case"idle":case"hi":break;case"pause":this.updateStagePause(e);break;case"bye":this.updateStageBye(e)}}interact(){"idle"===this.stage&&(this.scene.globals.disable_player_inputs=!0,this.startStageHi())}startStageHi(){this.stage="hi",this.scene.addObject(new Y(this.scene,{text:pt.greg.line_1,portrait:gt,name:this.name,onComplete:()=>{this.startStagePause()}}))}startStagePause(){this.stage="pause",this.scene.addObject(new Y(this.scene,{showOverlay:!1,text:pt.greg.line_2,portrait:gt,name:this.name,onComplete:()=>{this.startStageBye()}}))}updateStagePause(e){}startStageBye(){this.stage="bye",this.scene.addObject(new Y(this.scene,{showOverlay:!1,text:pt.greg.line_3,portrait:gt,name:this.name,completionDuration:this.stageByeDuration}))}updateStageBye(e){this.stageByeTimer+=e,this.renderer.scale=1-this.stageByeTimer/this.stageByeDuration,this.stageByeTimer>=this.stageByeDuration&&this.destroy()}}const ut={tileset:"tileset_chicken",x:0,y:0};class bt extends Ce{constructor(e,t){super(e,t),this.scene=e,this.stage="idle",this.stageOutroTimer=0,this.stageOutroDuration=1}onUpdate(e){switch(super.onUpdate(e),this.stage){case"idle":case"intro":break;case"outro":this.updateStageOutro(e)}}onDestroy(){this.scene.globals.disable_player_inputs=!1}interact(){"idle"===this.stage&&(this.scene.globals.disable_player_inputs=!0,this.startStageIntro())}startStageIntro(){this.stage="intro",this.scene.addObject(new Y(this.scene,{text:this.dialogue,portrait:ut,name:this.name,onComplete:()=>{this.startStageOutro()}}))}startStageOutro(){this.stage="outro"}updateStageOutro(e){this.stageOutroTimer+=e,this.renderer.opacity=1-this.stageOutroTimer/this.stageOutroDuration,this.stageOutroTimer>=this.stageOutroDuration&&this.destroy()}}class yt extends o{constructor(e){super(e),this.scene=e,this.height=40,this.width=40,this.backgroundLayers=[lt,ct];let t=new oe(e,{positionX:14,positionY:8});this.scene.addObject(t),this.scene.addObject(new Fe(e,{animationType:"block",animationLength:2})),this.scene.addObject(new mt(e,{positionX:14,positionY:7,name:"Greg"})),this.scene.addObject(new bt(e,{positionX:13,positionY:8,dialogue:pt.unknown_npc_1})),this.scene.addObject(new bt(e,{positionX:15,positionY:8,dialogue:pt.unknown_npc_2})),this.scene.addObject(new bt(e,{positionX:14,positionY:9,dialogue:pt.unknown_npc_3})),this.scene.addObject(new ve(e,{positionX:11,positionY:4})),this.scene.addObject(new ve(e,{positionX:12,positionY:4})),this.scene.addObject(new ve(e,{positionX:13,positionY:4})),this.scene.addObject(new ve(e,{positionX:15,positionY:4})),this.scene.addObject(new ve(e,{positionX:16,positionY:4})),this.scene.addObject(new ve(e,{positionX:17,positionY:4})),this.scene.addObject(new ve(e,{positionX:10,positionY:5})),this.scene.addObject(new ve(e,{positionX:18,positionY:5})),this.scene.addObject(new ve(e,{positionX:10,positionY:6})),this.scene.addObject(new ve(e,{positionX:18,positionY:6})),this.scene.addObject(new ve(e,{positionX:10,positionY:7})),this.scene.addObject(new ve(e,{positionX:18,positionY:7})),this.scene.addObject(new ve(e,{positionX:10,positionY:8})),this.scene.addObject(new ve(e,{positionX:18,positionY:8})),this.scene.addObject(new ve(e,{positionX:10,positionY:9})),this.scene.addObject(new ve(e,{positionX:18,positionY:9})),this.scene.addObject(new ve(e,{positionX:10,positionY:10})),this.scene.addObject(new ve(e,{positionX:18,positionY:10})),this.scene.addObject(new ve(e,{positionX:10,positionY:11})),this.scene.addObject(new ve(e,{positionX:18,positionY:11})),this.scene.addObject(new ve(e,{positionX:11,positionY:12})),this.scene.addObject(new ve(e,{positionX:12,positionY:12})),this.scene.addObject(new ve(e,{positionX:13,positionY:12})),this.scene.addObject(new ve(e,{positionX:14,positionY:12})),this.scene.addObject(new ve(e,{positionX:15,positionY:12})),this.scene.addObject(new ve(e,{positionX:16,positionY:12})),this.scene.addObject(new ve(e,{positionX:17,positionY:12})),this.scene.addObject(new ve(e,{positionX:14,positionY:0})),this.scene.addObject(new ve(e,{positionX:13,positionY:1})),this.scene.addObject(new et(e,{player:t,map:wt,positionX:14,positionY:1})),this.scene.addObject(new I(e,{tileset:"tileset_wood_bridge",spriteX:0,spriteY:0,positionX:14,positionY:1})),this.scene.addObject(new ve(e,{positionX:15,positionY:1})),this.scene.addObject(new ve(e,{positionX:13,positionY:2})),this.scene.addObject(new I(e,{tileset:"tileset_wood_bridge",spriteX:0,spriteY:1,positionX:14,positionY:2})),this.scene.addObject(new ve(e,{positionX:15,positionY:2})),this.scene.addObject(new ve(e,{positionX:13,positionY:3})),this.scene.addObject(new I(e,{tileset:"tileset_wood_bridge",spriteX:0,spriteY:1,positionX:14,positionY:3})),this.scene.addObject(new ve(e,{positionX:15,positionY:3})),this.scene.addObject(new I(e,{tileset:"tileset_wood_bridge",spriteX:0,spriteY:1,positionX:14,positionY:4})),this.scene.addObject(new I(e,{tileset:"tileset_wood_bridge",spriteX:0,spriteY:2,positionX:14,positionY:5}))}}class vt{}vt.id="tileset_house",vt.Door={Default:{Open:{x:3,y:0,width:1,height:1},Closed:{x:3,y:1,width:1,height:1},AlmostClosed:{x:3,y:2,width:1,height:1},AlmostOpen:{x:3,y:3,width:1,height:1}}},vt.Wall={Default:{BottomLeft:{x:.5,y:3,width:1,height:1},Bottom:{x:1,y:3,width:1,height:1},BottomRight:{x:1.5,y:3,width:1,height:1}}},vt.Roof={Default:{BottomLeft:{x:4.5,y:3.5,width:1,height:1},Bottom:{x:5,y:3.5,width:1,height:1},BottomRight:{x:5.5,y:3.5,width:1,height:1}}};class wt extends o{constructor(e){super(e),this.scene=e,this.height=100,this.width=100,this.backgroundLayers=[ce,Ee,ye,ze],n.setCursor(this.scene.displayContext.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.scene.addObject(new $e(e,{positionX:31,positionY:1}));let t=new oe(e,{positionX:10,positionY:2});this.scene.addObject(t),this.scene.addObject(new De(e,{positionX:2,positionY:12})),this.scene.addObject(new T(e,{positionX:8,positionY:.5,tileset:vt.id,spriteX:vt.Roof.Default.BottomLeft.x,spriteY:vt.Roof.Default.BottomLeft.y,renderLayer:t.renderer.layer+1})),this.scene.addObject(new T(e,{positionX:9,positionY:.5,tileset:vt.id,spriteX:vt.Roof.Default.Bottom.x,spriteY:vt.Roof.Default.Bottom.y,renderLayer:t.renderer.layer+1})),this.scene.addObject(new T(e,{positionX:10,positionY:.5,tileset:vt.id,spriteX:vt.Roof.Default.Bottom.x,spriteY:vt.Roof.Default.Bottom.y,renderLayer:t.renderer.layer+1})),this.scene.addObject(new T(e,{positionX:11,positionY:.5,tileset:vt.id,spriteX:vt.Roof.Default.Bottom.x,spriteY:vt.Roof.Default.Bottom.y,renderLayer:t.renderer.layer+1})),this.scene.addObject(new T(e,{positionX:12,positionY:.5,tileset:vt.id,spriteX:vt.Roof.Default.BottomRight.x,spriteY:vt.Roof.Default.BottomRight.y,renderLayer:t.renderer.layer+1})),this.scene.addObject(new T(e,{positionX:8,positionY:1,tileset:vt.id,spriteX:vt.Wall.Default.BottomLeft.x,spriteY:vt.Wall.Default.BottomLeft.y})),this.scene.addObject(new T(e,{positionX:9,positionY:1,tileset:vt.id,spriteX:vt.Wall.Default.Bottom.x,spriteY:vt.Wall.Default.Bottom.y})),this.scene.addObject(new et(e,{positionX:10,positionY:1,player:t,map:yt})),this.scene.addObject(new T(e,{positionX:10,positionY:1,tileset:vt.id,spriteX:vt.Door.Default.Closed.x,spriteY:vt.Door.Default.Closed.y})),this.scene.addObject(new T(e,{positionX:11,positionY:1,tileset:vt.id,spriteX:vt.Wall.Default.Bottom.x,spriteY:vt.Wall.Default.Bottom.y})),this.scene.addObject(new T(e,{positionX:12,positionY:1,tileset:vt.id,spriteX:vt.Wall.Default.BottomRight.x,spriteY:vt.Wall.Default.BottomRight.y})),this.scene.addObject(new de(e,{positionX:10,positionY:13,follows:t,canLayEggs:!0,canMove:!0}));const i={positionX:2,positionY:2,growing:{stage:F.FullyGrown,itemType:X.WheatSeeds}};this.scene.addObjects([...[...Array(5)].map(((t,s)=>new W(e,{...i,positionX:2+s,positionY:2}))),...[...Array(4)].map(((t,s)=>new W(e,{...i,positionX:14+s,positionY:2}))),...[...Array(8)].map(((t,s)=>new W(e,{...i,positionX:2+s,positionY:3}))),...[...Array(7)].map(((t,s)=>new W(e,{...i,positionX:11+s,positionY:3}))),...[...Array(8)].map(((t,s)=>new W(e,{...i,positionX:2+s,positionY:4}))),...[...Array(7)].map(((t,s)=>new W(e,{...i,positionX:11+s,positionY:4}))),...[...Array(8)].map(((t,s)=>new W(e,{...i,positionX:2+s,positionY:5}))),...[...Array(7)].map(((t,s)=>new W(e,{...i,positionX:11+s,positionY:5})))]);for(let t=0;t<6;t++)for(let i=0;i<13;i++)this.scene.addObject(new W(e,{positionX:12+i,positionY:10+t,growing:{stage:F.FullyGrown,itemType:X.WheatSeeds}}));for(let t=0;t<19;t++)for(let i=0;i<1;i++){let i=18===t?Me.FencePost:Me.MiddleVertical;this.scene.addObject(new Re(e,{positionX:27,positionY:0+t,type:i}))}for(let t=0;t<1;t++)for(let t=0;t<28;t++){let i=27===t?Me.BottomRight:Me.MiddleHorizontal;this.scene.addObject(new Re(e,{positionX:0+t,positionY:18,type:i}))}this.scene.addObjects([new Re(e,{positionX:25,positionY:0,type:Me.MiddleVertical}),new Re(e,{positionX:26,positionY:0,type:Me.FencePost})]),this.scene.addObjects([new Re(e,{positionX:25,positionY:2,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:25,positionY:1,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:19,positionY:3,type:Me.TopLeft}),new Re(e,{positionX:20,positionY:3,type:Me.MiddleHorizontal}),new Re(e,{positionX:21,positionY:3,type:Me.MiddleHorizontal}),new Re(e,{positionX:22,positionY:3,type:Me.MiddleHorizontal}),new Re(e,{positionX:23,positionY:3,type:Me.MiddleHorizontal}),new Re(e,{positionX:24,positionY:3,type:Me.MiddleHorizontal}),new Re(e,{positionX:25,positionY:3,type:Me.BottomRight})]),this.scene.addObjects([new Re(e,{positionX:19,positionY:4,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:19,positionY:5,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:19,positionY:6,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:4,positionY:7,type:Me.TopLeft}),new Re(e,{positionX:5,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:6,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:7,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:8,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:9,positionY:7,type:Me.RightHorizontal}),new Re(e,{positionX:11,positionY:7,type:Me.LeftHorizontal}),new Re(e,{positionX:12,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:13,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:14,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:15,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:16,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:17,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:18,positionY:7,type:Me.MiddleHorizontal}),new Re(e,{positionX:19,positionY:7,type:Me.BottomRight})]),this.scene.addObjects([new Re(e,{positionX:4,positionY:8,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:4,positionY:9,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:4,positionY:10,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:4,positionY:11,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:4,positionY:12,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:4,positionY:13,type:Me.MiddleVertical})]),this.scene.addObjects([new Re(e,{positionX:0,positionY:14,type:Me.MiddleHorizontal}),new Re(e,{positionX:1,positionY:14,type:Me.MiddleHorizontal}),new Re(e,{positionX:2,positionY:14,type:Me.MiddleHorizontal}),new Re(e,{positionX:3,positionY:14,type:Me.MiddleHorizontal}),new Re(e,{positionX:4,positionY:14,type:Me.BottomRight})]),this.scene.addObjects([]),this.scene.addObject(new Re(e,{positionX:0,positionY:16,type:Me.FencePost})),this.scene.addObject(new Re(e,{positionX:0,positionY:17,type:Me.FencePost})),this.scene.addObject(new Re(e,{positionX:0,positionY:18,type:Me.FencePost})),this.scene.addObjects([]),this.scene.addObjects([]),this.scene.addObject(new ve(e,{positionX:25,positionY:1.5,height:4})),this.scene.addObject(new ve(e,{positionX:19,positionY:5.5,height:4})),this.scene.addObject(new ve(e,{positionX:22.5,positionY:4,width:6})),this.scene.addObject(new ve(e,{positionX:6.5,positionY:8,width:6})),this.scene.addObject(new ve(e,{positionX:15,positionY:8,width:9})),this.scene.addObject(new ve(e,{positionX:4,positionY:11.5,height:6})),this.scene.addObject(new ve(e,{positionX:2.25,positionY:15,width:4.5})),this.scene.addObject(new qe(e,{object:t})),this.scene.addObject(new Fe(e,{animationCenterX:t.transform.position.world.x,animationCenterY:t.transform.position.world.y,animationType:"circle",animationLength:3})),this.scene.addObject(new Ke(this.scene,{duration:4.5,onInterval:()=>{let e=w.randomIntFromRange(19,28),t=w.randomIntFromRange(0,2),i="",s=0,n=0;0===t||1===t?(i="tileset_egg",s=1,n=0):(i="tileset_chicken",s=0,n=-.25),this.scene.addObject(new I(this.scene,{positionX:40,positionY:e,targetX:-1,targetY:e,tileset:i,spriteX:s,spriteY:n,destroyAtTarget:!0}))}}))}}class ft{constructor(e){this.client=e,this.backgroundLayersAnimationTimer={},this.objects=new Map,this.globals={camera:{startX:0,startY:0,endX:0,endY:0}},this.flaggedForMapChange=void 0,this.maps=new Map,this.renderingContext={background:[],objects:[]},this.backgroundLayerAnimationFrame={},this.renderContext=this.client.renderContext,this.displayContext=this.client.displayContext}frame(e){var t;this.awake(),this.background(e),this.update(e),this.render(e),this.customRenderer?this.customRenderer(this.renderingContext):((t=this).globals.camera.startX=0,t.globals.camera.startY=0,t.globals.camera.endX=0,t.globals.camera.endY=0,t.renderingContext.background.forEach((e=>{t.renderContext.drawImage(e.canvas,0,0)})),t.renderingContext.objects.forEach((e=>{t.renderContext.drawImage(e.canvas,0,0)}))),this.destroy(e),this.flaggedForMapChange&&this.changeMap(this.flaggedForMapChange)}awake(){this.client.flags.frame.log.awakeDuration&&console.time("[frame] awake");for(let[,e]of this.objects)e.awake();this.client.flags.frame.log.awakeDuration&&console.timeEnd("[frame] awake")}background(e){this.client.flags.frame.log.backgroundDuration&&console.time("[frame] background"),this.backgroundLayers.forEach(((i,s)=>{let n=this.renderingContext.background[s];t.clearCanvas(n);for(let s=0;s<this.map.width+1;s++)for(let o=0;o<this.map.height+1;o++){let r,a=i.tiles[s]?i.tiles[s][o]:void 0;if(void 0!==a){if(1===a.animationFrames.length)r=a.animationFrames[0];else{let t;void 0===this.backgroundLayersAnimationTimer[i.index]&&(this.backgroundLayersAnimationTimer[i.index]={}),void 0===this.backgroundLayersAnimationTimer[i.index][s]&&(this.backgroundLayersAnimationTimer[i.index][s]={}),t=void 0===this.backgroundLayersAnimationTimer[i.index][s][o]?0:this.backgroundLayersAnimationTimer[i.index][s][o]+e,t>a.animationFrameDuration&&(t%=a.animationFrameDuration);for(let e=0;e<a.animationMap.length;e++)if(t<=a.animationMap[e]){r=a.animationFrames[e];break}this.backgroundLayersAnimationTimer[i.index][s][o]=t}t.renderSprite(n,u.images[a.tileset],r.spriteX,r.spriteY,s-.5,o-.5)}}})),this.client.flags.frame.log.backgroundDuration&&console.timeEnd("[frame] background")}update(e){this.client.flags.frame.log.updateDuration&&console.time("[frame] update");for(let[,t]of this.objects)t.update(e);this.client.flags.frame.log.updateDuration&&console.timeEnd("[frame] update")}render(e){this.client.flags.frame.log.renderDuration&&console.time("[frame] render"),this.renderingContext.objects.forEach((e=>{t.clearCanvas(e)}));for(let[,e]of this.objects)this.client.debug.object.renderBackground&&e.debuggerRenderBackground(this.renderingContext.objects[e.renderer.layer]),e.render(this.renderingContext.objects[e.renderer.layer]),this.client.debug.object.renderBoundary&&e.debuggerRenderBoundary(this.renderingContext.objects[e.renderer.layer]);this.client.flags.frame.log.renderDuration&&console.timeEnd("[frame] render")}destroy(e){this.client.flags.frame.log.destroyDuration&&console.time("[frame] destroy");for(let[,e]of this.objects)e.flags.destroy&&this.removeObjectById(e.id);this.client.flags.frame.log.destroyDuration&&console.timeEnd("[frame] destroy")}get map(){return this.maps.get(this.activeMap)}addObjects(e){e.forEach((e=>{this.addObject(e)}))}addObject(e){this.objects.set(e.id,e)}removeObjectById(e){const t=this.objects.get(e);void 0!==t&&(t.onDestroy&&t.onDestroy(),this.objects.delete(e),t.parent&&t.parent.children.delete(t.id))}getObject(e={},t=!0){for(const[,i]of this.objects)if(xt(i,e,t))return i}getObjects(e={},t=!0){const i=[];for(const[,s]of this.objects)xt(s,e,t)&&i.push(s);return i}isOutOfBounds(e,t){return e>this.map.width-1||t>this.map.height-1||e<0||t<0}removeAllBackgroundLayers(){this.backgroundLayers=[]}setUpRenderingContexts(){this.renderingContext={background:[],objects:[]};for(let e=0;e<this.backgroundLayers.length;e++){let i=this.createCanvas();this.renderingContext.background[e]=t.getContext(i)}for(let i=0;i<e.TOTAL_RENDERING_LAYERS;i++){let e=this.createCanvas();this.renderingContext.objects[i]=t.getContext(e)}}createCanvas(){let e=t.createCanvas(this.map.width,this.map.height);return this.client.debug.ui.canvasLayers&&this.client.container.append(e),e}flagForMapChange(e){this.flaggedForMapChange=e}changeMap(e){var t;void 0!==(null===(t=this.map)||void 0===t?void 0:t.destroy)&&this.map.destroy(),void 0!==this.map&&(this.map.objects.clear(),this.objects.forEach((e=>this.map.objects.set(e.id,e)))),this.objects.clear(),this.removeAllBackgroundLayers(),void 0!==this.maps.get(e)&&this.maps.get(e).flags.suspend?console.log("[Scene] changing map to cached instance of",e.name):(console.log("[Scene] changing map to new instance of",e.name),this.maps.set(e,Reflect.construct(e,[this]))),this.activeMap=e,this.backgroundLayers.push(...this.map.backgroundLayers),this.map.objects.forEach((e=>this.objects.set(e.id,e))),this.setUpRenderingContexts(),this.flaggedForMapChange=void 0}changeScene(e){this.client.changeScene(e)}setCustomRenderer(e){this.customRenderer=e}removeCustomerRenderer(){this.customRenderer=void 0}}function xt(t,i,s=!0){var n,o,r,a;if((void 0===(null===(n=i.collision)||void 0===n?void 0:n.enabled)||t.collision.enabled===i.collision.enabled)&&(!(null===(o=i.collision)||void 0===o?void 0:o.layerMatch)||i.collision.layerMatch.get(t.collision.layer))&&(void 0!==(null===(r=i.collision)||void 0===r?void 0:r.layerIgnore)||!s||t.collision.layer!==e.UI_COLLISION_LAYER)&&(!(null===(a=i.collision)||void 0===a?void 0:a.layerIgnore)||!i.collision.layerIgnore.get(t.collision.layer))&&(!i.typeMatch||i.typeMatch.some((e=>t instanceof e)))&&(!i.typeIgnore||!i.typeIgnore.some((e=>t instanceof e)))&&(!i.objectMatch||i.objectMatch.get(t))&&(!i.objectIgnore||!i.objectIgnore.get(t))&&(!i.boundingBox||function(e,t){return t.boundingBox.left<e.boundingBox.world.right&&t.boundingBox.right>e.boundingBox.world.left&&t.boundingBox.top<e.boundingBox.world.bottom&&t.boundingBox.bottom>e.boundingBox.world.top}(t,i))&&(!i.position||function(e,t){return t.position.x<e.boundingBox.world.right&&t.position.x>e.boundingBox.world.left&&t.position.y<e.boundingBox.world.bottom&&t.position.y>e.boundingBox.world.top}(t,i)))return t}class It extends ft{constructor(e){super(e),this.globals={...this.globals,inventory:new R(5,5),hotbar:new R(1,5),hotbar_selected_index:0,disable_player_inputs:!1,gold:999},this.globals.inventory.addToInventory(X.Hoe),this.globals.inventory.addToInventory(X.WateringCan),this.globals.inventory.addToInventory(X.WheatSeeds),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.globals.inventory.addToInventory(X.Chicken),this.changeMap(wt)}get selectedInventoryItem(){return this.globals.inventory.items[this.globals.hotbar_selected_index]}get selectedInventoryIndex(){return this.globals.hotbar_selected_index}}class Et extends d{constructor(e,t){super(e,t),this.scene=e,this.width=6,this.height=2,this.clicked=!1,this.renderer.enabled=!0}onUpdate(e){this.updateClickStart(),this.updateClickEnd()}onRender(e){this.renderStartButton(e)}renderStartButton(e){t.renderSprite(e,u.images.tileset_button,this.clicked?6:0,2,this.transform.position.world.x,this.transform.position.world.y,this.width,this.height,{centered:!0})}updateClickStart(){n.wasObjectClicked(this)&&(this.clicked=!0)}updateClickEnd(){!0!==s.mouse.click.left&&!1!==this.clicked&&(n.isMouseWithinObject(this)?this.scene.changeScene(It):this.clicked=!1)}}const Tt=e.CANVAS_TILE_HEIGHT,_t=e.CANVAS_TILE_WIDTH;class St extends o{constructor(e){super(e),this.scene=e,this.height=Tt,this.width=_t,this.backgroundLayers=[v],n.setCursor(this.scene.displayContext.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.scene.addObject(new Et(e,{renderLayer:15,positionX:16,positionY:9})),this.scene.addObject(new E(e,{}))}}class Ct extends ft{constructor(e){super(e),this.client=e,this.changeMap(St)}}!function(){var t;e.DEFAULT_FONT_FAMILY="bookxel";const i=new URLSearchParams(window.location.search).get("scene"),s=null!==(t={"main-menu":Ct,game:It}[i])&&void 0!==t?t:Ct;u.initialise({images:{tileset_sample:"assets/16x16.png",tileset_grass:"assets/sample/Tilesets/Grass.png",tileset_hills:"assets/sample/Tilesets/Hills.png",tileset_water:"assets/sample/Tilesets/Water.png",tileset_player:"assets/sample/Characters/Basic Charakter Spritesheet.png",tileset_chicken:"assets/sample/Characters/Free Chicken Sprites.png",tileset_fence:"assets/sample/Tilesets/Fences.png",tileset_egg:"assets/sample/Characters/Egg_And_Nest.png",tileset_house:"assets/sample/Tilesets/Wooden House.png",tileset_dirt:"assets/sample/Tilesets/Tilled_Dirt.png",tileset_button:"assets/sample/UI Big Play Button.png",tileset_ui:"assets/sample/Sprite sheet for Basic Pack.png",tileset_wood_bridge:"assets/sample/Objects/Wood_Bridge.png",tileset_chest:"assets/sample/Objects/Chest.png",tileset_plants:"assets/sample/Objects/Basic_Plants.png",tileset_dialogue_box:"assets/sample/Dialouge UI/dialog box.png",tileset_tools:"assets/sample/Characters/Tools.png",tileset_fullscreen:"assets/custom/fullscreen.png",tileset_basic:"assets/sample/Sprite sheet for Basic Pack.png"},audio:{},fonts:{bookxel:"assets/fonts/bookxel.woff"}}),p.initHelpers(),window.engine=new g(document.getElementById("render-area"),s,p.engineMapList,p.engineObjectList,p.engineObjectDetails,p.engineControls)}()})();