(()=>{"use strict";class e{static get CANVAS_HEIGHT(){return e.TILE_SIZE*e.CANVAS_TILE_HEIGHT}static get CANVAS_WIDTH(){return e.TILE_SIZE*e.CANVAS_TILE_WIDTH}static get ASPECT_RATIO(){return e.CANVAS_TILE_HEIGHT/e.CANVAS_TILE_WIDTH}static get UI_RENDER_LAYER(){return e.OBJECT_RENDERING_LAYERS-1}static get UI_COLLISION_LAYER(){return e.OBJECT_COLLISION_LAYERS-1}static get CANVAS_CENTER_TILE_Y(){return this.CANVAS_TILE_HEIGHT/2}static get CANVAS_CENTER_TILE_X(){return this.CANVAS_TILE_WIDTH/2}static get CANVAS_CENTER_PIXEL_X(){return e.CANVAS_WIDTH/2}static get CANVAS_CENTER_PIXEL_Y(){return e.CANVAS_HEIGHT/2}}e.CANVAS_TILE_HEIGHT=18,e.CANVAS_TILE_WIDTH=32,e.TILE_SIZE=16,e.OBJECT_RENDERING_LAYERS=16,e.OBJECT_COLLISION_LAYERS=16,e.CONTEXT_IMAGE_SMOOTHING_ENABLED=!1;class t{static renderSprite(t,i,s,n,o,r,a,h,d={}){var l,c;let p=a?a*e.TILE_SIZE:e.TILE_SIZE,m=h?h*e.TILE_SIZE:e.TILE_SIZE,g=null!==(l=d.scale)&&void 0!==l?l:1,u=null!==(c=d.rotation)&&void 0!==c?c:0,b=d.opacity&&d.opacity<1,v=0!==u,y=b||v;if(y&&(t.save(),b&&(t.globalAlpha=Math.max(0,d.opacity)),v)){let i=Math.floor((o+a/2)*e.TILE_SIZE)+.5,s=Math.floor((r+h/2)*e.TILE_SIZE)+.5;t.translate(i,s),t.rotate(u*Math.PI/180),t.translate(-i,-s)}let f=Math.floor(p/2),x=Math.floor(m/2);d.centered&&t.translate(-f,-x),t.drawImage(i,s*e.TILE_SIZE,n*e.TILE_SIZE,p,m,Math.floor(o*e.TILE_SIZE),Math.floor(r*e.TILE_SIZE),p*g,m*g),d.centered&&t.translate(f,x),y&&t.restore()}static renderSubsection(t,i,s,n,o,r){let a=Math.floor(s*e.TILE_SIZE),h=Math.floor(n*e.TILE_SIZE),d=Math.floor(o*e.TILE_SIZE),l=Math.floor(r*e.TILE_SIZE);i.drawImage(t.canvas,a,h,d-a,l-h,0,0,i.canvas.width,i.canvas.height)}static renderCircle(t,i,s,n={}){t.beginPath(),t.arc(i*e.TILE_SIZE+e.TILE_SIZE/2,s*e.TILE_SIZE+e.TILE_SIZE/2,e.TILE_SIZE/2,0,2*Math.PI),t.stroke(),t.fillStyle=n.colour||"saddlebrown",t.fill()}static fillRectangle(t,i,s,n,o,r={}){t.strokeStyle=r.colour?r.colour:"black",t.fillStyle=r.colour?r.colour:"black",t.beginPath(),t.rect(Math.floor(i*e.TILE_SIZE)+.5,Math.floor(s*e.TILE_SIZE)+.5,n*("tile"===r.type?e.TILE_SIZE:1)-1,o*("tile"===r.type?e.TILE_SIZE:1)-1),t.stroke(),t.fill()}static strokeRectangle(t,i,s,n,o,r={}){var a;t.strokeStyle=null!==(a=r.colour)&&void 0!==a?a:"black",t.lineWidth=1;let h="tile"===r.type?Math.floor(i*e.TILE_SIZE):i,d="tile"===r.type?Math.floor(s*e.TILE_SIZE):s,l="tile"===r.type?Math.floor(n*e.TILE_SIZE):n,c="tile"===r.type?Math.floor(o*e.TILE_SIZE):o;t.strokeRect(h+.5,d+.5,l-1,c-1)}static clearCanvas(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}static createCanvas(t,i){const s=document.createElement("canvas");return s.width=t?t*e.TILE_SIZE:e.CANVAS_WIDTH,s.height=i?i*e.TILE_SIZE:e.CANVAS_HEIGHT,s}static getContext(t){let i=t.getContext("2d");return i.imageSmoothingEnabled=e.CONTEXT_IMAGE_SMOOTHING_ENABLED,i}static positionToPixelPosition(t){return t*e.TILE_SIZE}static renderText(t,i,s,n,o={}){let r=o.size?o.size:16,a=o.colour?o.colour:"black",h=o.font?o.font:"Helvetica";t.font=`${r}px ${h}`,t.fillStyle=`${a}`,t.fillText(i,s*e.TILE_SIZE,n*e.TILE_SIZE)}static textToArray(e,t,i={}){var s,n;let o=null!==(s=i.size)&&void 0!==s?s:16,r=null!==(n=i.colour)&&void 0!==n?n:"black",a=i.font?i.font:"Helvetica",h=document.createElement("canvas").getContext("2d");h.font=`${o}px ${a}`,h.fillStyle=`${r}`;let d=e.split(" "),l="",c=[];for(let e=0;e<d.length;e++){let i=`${l} ${d[e]}`;h.measureText(i).width>=t?(c.push(i),l=""):d.length-1!==e?l=i.trim():c.push(i)}return c}}var i;!function(e){e.Left="left",e.Middle="middle",e.Right="right"}(i||(i={}));class s{static isKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)if(this.keyboard[t])return!0;return!1}static setKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)this.keyboard[t]=!0}static clearKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)this.keyboard[t]=!1}static isMousePressed(e=i.Left){return this.mouse.click[e]}static clearMousePressed(e=i.Left){this.mouse.click[e]=!1}}s.keyboard={},s.mouse={click:{left:!1,middle:!1,right:!1},position:{x:0,y:0,exactX:0,exactY:0},wheel:{event:new WheelEvent("")},latestEvent:new MouseEvent("")};class n{static getMousePosition(t,i){let s,n=t.getBoundingClientRect(),o={height:n.height,width:n.width},r={clientX:i.clientX,clientY:i.clientY};if(t.width>t.height){s=t.width/n.width,o.height=t.height/s;let e=n.height-o.height;r.clientY-=e/2}else{s=t.height/n.height,o.width=t.width/s;let e=n.width-o.width;r.clientX-=e/2}let a=t.width/o.width,h=t.height/o.height,d=(r.clientX-n.left)*a/e.TILE_SIZE,l=(r.clientY-n.top)*h/e.TILE_SIZE;return{x:Math.floor(d),y:Math.floor(l),exactX:d,exactY:l}}static setCursor(e,t){e.style.cursor=`url("${t}"), auto`}static get isFullscreen(){return null!==document.fullscreenElement}static isMouseWithinBoundary(e,t,i,s,n){return e.exactX>=t&&e.exactX<=t+s&&e.exactY>=i&&e.exactY<=i+n}static isMouseWithinObject(e){return!!this.isMouseWithinBoundary(s.mouse.position,e.boundingBox.left,e.boundingBox.top,e.width,e.height)}static wasObjectClicked(e){return!!s.mouse.click.left&&!!this.isMouseWithinObject(e)}}class o{constructor(e){this.scene=e,this.globals={}}destroy(){}}class r{constructor(e,t){this.x=e,this.y=t}get roundedX(){return Math.round(this.x)}get roundedY(){return Math.round(this.y)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){let e=this.magnitude;return 0===e?new r(0,0):new r(this.x/e,this.y/e)}add(e){return new r(this.x+e.x,this.y+e.y)}subtract(e){return new r(this.x-e.x,this.y-e.y)}multiply(e){return new r(this.x*e,this.y*e)}divide(e){return new r(this.x/e,this.y/e)}}const a=!1;class h{constructor(e,t){var i,s,n,o,h,d,l,c,p,m;this.scene=e,this.id=crypto.randomUUID(),this.transform={position:new r(0,0),scale:1,rotation:0},this.collision={enabled:a,layer:0},this.renderer={enabled:!1,layer:0,opacity:1,scale:1},this.flags={awake:!1,update:!0,render:!0,destroy:!1},this.width=1,this.height=1,this.children=new Array,this.parent=void 0,this.mainContext=this.scene.renderContext,this.transform.position.x=null!==(i=t.positionX)&&void 0!==i?i:this.transform.position.x,this.transform.position.y=null!==(s=t.positionY)&&void 0!==s?s:this.transform.position.y,this.collision.enabled=null!==(n=t.collisionEnabled)&&void 0!==n?n:a,this.collision.layer=null!==(o=t.collisionLayer)&&void 0!==o?o:0,this.renderer.enabled=null!==(h=t.renderEnabled)&&void 0!==h?h:this.renderer.enabled,this.renderer.layer=null!==(d=t.renderLayer)&&void 0!==d?d:this.renderer.layer,this.renderer.opacity=null!==(l=t.renderOpacity)&&void 0!==l?l:this.renderer.opacity,this.renderer.scale=null!==(c=t.renderScale)&&void 0!==c?c:this.renderer.scale,this.width=null!==(p=t.width)&&void 0!==p?p:this.width,this.height=null!==(m=t.height)&&void 0!==m?m:this.height}get boundingBox(){return h.calculateBoundingBox(this.transform.position.x,this.transform.position.y,this.width,this.height)}debuggerRenderBoundary(e){t.strokeRectangle(e,this.boundingBox.left,this.boundingBox.top,this.width,this.height,{colour:"red",type:"tile"})}debuggerRenderBackground(i){t.fillRectangle(i,this.boundingBox.left,this.boundingBox.top,Math.floor(this.width*e.TILE_SIZE),Math.floor(this.height*e.TILE_SIZE),{colour:"red"})}get cameraRelativePositionX(){return this.transform.position.x+this.scene.globals.camera.startX}get cameraRelativePositionY(){return this.transform.position.y+this.scene.globals.camera.startY}get pixelWidth(){return this.width*e.TILE_SIZE}get pixelHeight(){return this.height*e.TILE_SIZE}isCollidingWith(e){return this.isWithinHorizontalBounds(e)&&this.isWithinVerticalBounds(e)}isWithinHorizontalBounds(e){return e.boundingBox.left>=this.boundingBox.left&&e.boundingBox.left<=this.boundingBox.right||e.boundingBox.right>=this.boundingBox.left&&e.boundingBox.right<=this.boundingBox.right}isWithinVerticalBounds(e){return e.boundingBox.top>=this.boundingBox.top&&e.boundingBox.top<=this.boundingBox.bottom||e.boundingBox.bottom>=this.boundingBox.top&&e.boundingBox.bottom<=this.boundingBox.bottom}static calculateBoundingBox(e,t,i,s){let n=i/2,o=s/2;return{top:t-o,right:e+n,bottom:t+o,left:e-n}}}class d extends h{constructor(e,t){super(e,t),this.scene=e,this.isColliding=!1,this.renderer.enabled=!0,t.width&&(this.width=t.width),t.height&&(this.height=t.height)}update(e){this.updateCollision()}render(e){let i=this.isColliding?"green":"red";t.fillRectangle(e,this.boundingBox.left,this.boundingBox.top,this.width,this.height,{colour:i,type:"tile"})}updateCollision(){if(this.collision.enabled){for(const e of this.scene.objects)if(e!==this&&this.boundingBox.left<e.boundingBox.right&&this.boundingBox.right>e.boundingBox.left&&this.boundingBox.top<e.boundingBox.bottom&&this.boundingBox.bottom>e.boundingBox.top)return void(this.isColliding=!0);this.isColliding=!1}}}class l{static get engineMapList(){return document.getElementById("map-list")||null}static get engineObjectList(){return document.getElementById("object-list")||null}static get engineObjectDetails(){return document.getElementById("object-details")||null}static get engineControls(){return{gridLines:document.getElementById("btnGridLines"),gridNumbers:document.getElementById("btnGridNumbers"),breakpoint:document.getElementById("btnBreakpoint"),fps:document.getElementById("btnFps"),objectCount:document.getElementById("btnObjectCount"),timingFrame:document.getElementById("btnTimingFrame"),timingFrameBackground:document.getElementById("btnTimingFrameBackground"),timingFrameRender:document.getElementById("btnTimingFrameRender"),timingFrameUpdate:document.getElementById("btnTimingFrameUpdate"),canvasLayers:document.getElementById("btnCanvasLayers"),fullscreen:document.getElementById("btnFullscreen"),renderBoundary:document.getElementById("btnRenderBoundary"),renderBackground:document.getElementById("btnRenderBackground")}}static initHelpers(){window.o=e=>window.engine.scene.objects.find((t=>t.id===e))}static changeScene(e){window.engine.changeScene(e)}static changeMap(e){window.engine.scene.changeMap(e)}}l.TEST_MAPS=[{name:"collision test",map:class extends o{constructor(e){super(e),this.scene=e,this.height=18,this.width=30,this.backgroundLayers=[],this.objects=[],this.initialiseNotColliding(),this.initialiseColliding()}initialiseNotColliding(){this.objects.push(new d(this.scene,{positionX:1.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:2.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:2.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:4.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:2.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:4.5})),this.objects.push(new d(this.scene,{positionX:2.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:4.5})),this.objects.push(new d(this.scene,{positionX:4.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.5,positionY:5.5,collisionEnabled:!0}))}initialiseColliding(){this.objects.push(new d(this.scene,{positionX:7.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:8,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:2,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:1.5})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:2,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:8,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:5.5})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11,positionY:5.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:11.5,positionY:5.5})),this.objects.push(new d(this.scene,{positionX:1.5,positionY:7.5})),this.objects.push(new d(this.scene,{positionX:2,positionY:7.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:7.5})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:8,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:5.001,positionY:7.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:6,positionY:8.5})),this.objects.push(new d(this.scene,{positionX:8.499,positionY:7.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:8.5})),this.objects.push(new d(this.scene,{positionX:5.001,positionY:10.999,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:6,positionY:10})),this.objects.push(new d(this.scene,{positionX:8.499,positionY:10.999,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:7.5,positionY:10})),this.objects.push(new d(this.scene,{positionX:18,positionY:5,width:6,height:6,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:5})),this.objects.push(new d(this.scene,{positionX:21.5,positionY:5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.5,positionY:8.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:8.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.5,positionY:8.5,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:14,width:6,height:6})),this.objects.push(new d(this.scene,{positionX:14.501,positionY:10.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18.001,positionY:10.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.499,positionY:10.501,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.501,positionY:14,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:14,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.499,positionY:14,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:14.501,positionY:17.499,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:18,positionY:17.499,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:21.499,positionY:17.499,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:15,width:5,height:1,collisionEnabled:!0})),this.objects.push(new d(this.scene,{positionX:3.5,positionY:15,width:1,height:5})),this.objects.push(new d(this.scene,{positionX:9.5,positionY:15,width:5,height:1})),this.objects.push(new d(this.scene,{positionX:9.5,positionY:15,width:1,height:5,collisionEnabled:!0}))}}}];class c{constructor(i,s,n,o,r,a){this.container=i,this.engineMapList=n,this.engineObjectList=o,this.engineObjectDetails=r,this.engineControls=a,this.CANVAS_HEIGHT=e.CANVAS_HEIGHT,this.CANVAS_WIDTH=e.CANVAS_WIDTH,this.delta=0,this.lastRenderTimestamp=0,this.debug={enabled:!0,stats:{fps:!1,fpsCounter:0,objectCount:!1},breakpoint:{frame:!1},timing:{frame:!1,frameBackground:!1,frameUpdate:!1,frameRender:!1,frameDestroy:!1},ui:{grid:{lines:!1,numbers:!1},canvasLayers:!1},object:{renderBoundary:!1,renderBackground:!1}},this.gamepad=void 0,this.editorTimer=0,this.debug.enabled&&(this.initialiseDebuggerState(),this.initialiseDebuggerListeners()),this.displayCanvas=this.createCanvas(),this.displayContext=t.getContext(this.displayCanvas),this.renderCanvas=this.createCanvas(),this.renderContext=t.getContext(this.renderCanvas),i.append(this.displayCanvas),document.addEventListener("visibilitychange",(e=>{"visible"===document.visibilityState?console.log("tab is active"):console.log("tab is inactive")})),this.initialiseMouseListeners(),this.initialiseKeyboardListeners(),this.intialiseGamepadListeners(),this.changeScene(s),this.frame(0)}createCanvas(){const e=t.createCanvas();return e.addEventListener("contextmenu",(e=>{e.preventDefault()})),e}changeScene(e){this.scene=Reflect.construct(e,[this])}frame(e){this.debug.breakpoint.frame,this.debug.timing.frame&&console.log(`[frame] ${this.delta}`),this.setDelta(e),t.clearCanvas(this.renderContext),this.scene.frame(this.delta),t.clearCanvas(this.displayContext),this.displayContext.drawImage(this.renderCanvas,0,0),this.debug.stats.fps&&(this.debug.stats.fpsCounter&&this.renderStats(0,"FPS",`${Math.round(1e3/(performance.now()-this.debug.stats.fpsCounter))} FPS`),this.debug.stats.fpsCounter=e),this.debug.stats.objectCount&&this.renderStats(1,"Objects",`${this.scene.objects.length} objects`),this.renderGrid(),this.scene.flaggedForMapChange&&this.scene.changeMap(this.scene.flaggedForMapChange),this.editorTimer+=this.delta,this.editorTimer>1&&(this.editor(),this.editorTimer=0),window.requestAnimationFrame(this.frame.bind(this))}setDelta(e){this.delta=(e-this.lastRenderTimestamp)/1e3,this.lastRenderTimestamp=e}renderStats(t,i,s){this.displayContext.fillStyle="red",this.displayContext.font="12px serif",this.displayContext.fillText(s,this.CANVAS_WIDTH-50,(t+1)*e.TILE_SIZE)}renderGrid(){if((this.debug.ui.grid.lines||this.debug.ui.grid.numbers)&&t.fillRectangle(this.displayContext,0,0,this.CANVAS_WIDTH,this.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.25)"}),this.debug.ui.grid.lines)for(let i=0;i<this.CANVAS_WIDTH;i+=e.TILE_SIZE)for(let s=0;s<this.CANVAS_HEIGHT;s+=e.TILE_SIZE)t.strokeRectangle(this.displayContext,i,s,e.TILE_SIZE,e.TILE_SIZE,{colour:"black"});if(this.debug.ui.grid.numbers)for(let t=0;t<e.CANVAS_TILE_WIDTH;t++)for(let i=0;i<e.CANVAS_TILE_HEIGHT;i++)this.displayContext.fillStyle="black",this.displayContext.font="8px helvetica",this.displayContext.fillText(`${t}`,t*e.TILE_SIZE+1,i*e.TILE_SIZE+8),this.displayContext.fillText(`${i}`,t*e.TILE_SIZE+6,i*e.TILE_SIZE+14)}initialiseDebuggerState(){if(void 0!==this.engineControls&&this.engineControls.renderBoundary){const e=JSON.parse(localStorage.getItem("object.renderBoundary"));this.engineControls.renderBoundary.checked=e,this.debug.object.renderBoundary=e}}initialiseDebuggerListeners(){void 0!==this.engineControls&&(this.engineControls.gridLines&&this.engineControls.gridLines.addEventListener("click",(()=>{this.debug.ui.grid.lines=!this.debug.ui.grid.lines})),this.engineControls.gridNumbers&&this.engineControls.gridNumbers.addEventListener("click",(()=>{this.debug.ui.grid.numbers=!this.debug.ui.grid.numbers})),this.engineControls.breakpoint&&this.engineControls.breakpoint.addEventListener("click",(()=>{this.debug.breakpoint.frame=!this.debug.breakpoint.frame})),this.engineControls.fps&&this.engineControls.fps.addEventListener("click",(()=>{this.debug.stats.fps=!this.debug.stats.fps})),this.engineControls.objectCount&&this.engineControls.objectCount.addEventListener("click",(()=>{this.debug.stats.objectCount=!this.debug.stats.objectCount})),this.engineControls.timingFrame&&this.engineControls.timingFrame.addEventListener("click",(()=>{this.debug.timing.frame=!this.debug.timing.frame})),this.engineControls.timingFrameBackground&&this.engineControls.timingFrameBackground.addEventListener("click",(()=>{this.debug.timing.frameBackground=!this.debug.timing.frameBackground})),this.engineControls.timingFrameRender&&this.engineControls.timingFrameRender.addEventListener("click",(()=>{this.debug.timing.frameRender=!this.debug.timing.frameRender})),this.engineControls.timingFrameUpdate&&this.engineControls.timingFrameUpdate.addEventListener("click",(()=>{this.debug.timing.frameUpdate=!this.debug.timing.frameUpdate})),this.engineControls.canvasLayers&&this.engineControls.canvasLayers.addEventListener("click",(()=>{this.debug.ui.canvasLayers=!this.debug.ui.canvasLayers})),this.engineControls.renderBoundary&&this.engineControls.renderBoundary.addEventListener("click",(()=>{this.debug.object.renderBoundary=!this.debug.object.renderBoundary,localStorage.setItem("object.renderBoundary",JSON.stringify(this.debug.object.renderBoundary))})),this.engineControls.renderBackground&&this.engineControls.renderBackground.addEventListener("click",(()=>{this.debug.object.renderBackground=!this.debug.object.renderBackground})),this.engineControls.fullscreen&&this.engineControls.fullscreen.addEventListener("click",(()=>{this.displayCanvas.requestFullscreen().catch((e=>{throw new Error(e)}))})))}initialiseKeyboardListeners(){console.log("[listener added] keydown"),document.addEventListener("keydown",(e=>{if(e.preventDefault(),e.repeat)return;console.log("[keydown]",e);let t=e.key.toLocaleLowerCase();s.setKeyPressed(t)})),console.log("[listener added] keyup"),document.addEventListener("keyup",(e=>{if(e.preventDefault(),e.repeat)return;console.log("[keyup]",e);let t=e.key.toLocaleLowerCase();s.clearKeyPressed(t)}))}initialiseMouseListeners(){console.log("[listener added] mousemove"),this.displayCanvas.addEventListener("mousemove",(e=>{s.mouse.position=n.getMousePosition(this.displayCanvas,e),s.mouse.latestEvent=e})),console.log("[listener added] mousedown"),this.displayCanvas.addEventListener("mousedown",(e=>{switch(console.log("[mousedown]",e),e.button){case 0:s.mouse.click.left=!0;break;case 1:s.mouse.click.middle=!0;break;case 2:s.mouse.click.right=!0}})),console.log("[listener added] mouseup"),this.displayCanvas.addEventListener("mouseup",(e=>{switch(console.log("[mouseup]",e),e.button){case 0:s.mouse.click.left=!1;break;case 1:s.mouse.click.middle=!1;break;case 2:s.mouse.click.right=!1}})),console.log("[listener added] touchstart"),this.displayCanvas.addEventListener("touchstart",(e=>{console.log("[touchstart]",e),s.mouse.click.left=!0})),console.log("[listener added] touchend"),this.displayCanvas.addEventListener("touchend",(e=>{console.log("[touchend]",e),s.mouse.click.left=!1})),console.log("[listener added] wheel"),this.displayCanvas.addEventListener("wheel",(e=>{console.log("[wheel]",e),s.mouse.wheel.event=e}))}intialiseGamepadListeners(){window.addEventListener("gamepadconnected",(e=>{console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.gamepad.index,e.gamepad.id,e.gamepad.buttons.length,e.gamepad.axes.length),this.gamepad=e.gamepad})),window.addEventListener("gamepaddisconnected",(e=>{this.gamepad=void 0}))}editor(){if(null===this.engineObjectList||null===this.engineMapList)return;let e=document.createElement("ul");this.engineMapList.innerHTML="",this.engineMapList.appendChild(e),[...l.TEST_MAPS].forEach((t=>{let i=document.createElement("li");i.innerHTML=t.name,e.appendChild(i),i.addEventListener("click",(()=>{l.changeMap(t.map)}))}));let t=document.createElement("ul");this.engineObjectList.innerHTML="",this.engineObjectList.appendChild(t),this.scene.objects.forEach((e=>{let i=document.createElement("li");i.innerHTML=e.constructor.name,t.appendChild(i),i.addEventListener("click",(()=>{this.engineSelectedObjectId=e.id,this.updateEngineObjectDetails()}))}))}updateEngineObjectDetails(){if(void 0===this.engineSelectedObjectId)return;if(null===this.engineObjectDetails)return;let e=this.scene.objects.find((e=>e.id===this.engineSelectedObjectId));if(void 0===e)return;const t=this.engineObjectDetails.querySelector("#object-details-header"),i=this.engineObjectDetails.querySelector("#object-details-content");t.innerHTML=`<h3>${e.constructor.name}</h3>`,i.innerHTML="",Object.keys(e).forEach((t=>{"transform"===t?(i.innerHTML+=p(e.transform.position,"x"),i.innerHTML+=p(e.transform.position,"y")):i.innerHTML+=p(e,t)})),console.log(e)}}function p(e,t){let i="";return i+='<div style="display:flex; padding: 0.25rem 0;">',i+=`<span style="margin-right: auto;">${t}</span>`,i+=`<code>${e[t]}</code>`,i+="</div>",i}class m{static initialise(e){Object.keys(e.images).forEach((t=>{this.images[t]=new Image,this.images[t].src=e.images[t]})),Object.keys(e.audio).forEach((t=>{this.audio[t]=new Audio(e.audio[t])}))}}m.images={},m.audio={};const g={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},u=[g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g],b={index:0,tiles:[u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u]};class v{static randomIntFromRange(e,t){return Math.floor(this.randomNumberFromRange(e,t))}static randomNumberFromRange(e,t){return Math.random()*(t-e+1)+e}static randomStartingDelta(e){return Math.random()*(null!=e?e:1)}}class y{get position(){return{x:this.targetX,y:this.targetY}}get target(){return{x:this.targetX,y:this.targetY}}constructor(e,t,i,s){this.positionX=e,this.positionY=t,this.targetX=i,this.targetY=s}}class f{static moveTowardsPosition(e,t){return e.targetX>e.positionX?(e.positionX+=t,e.targetX<e.positionX&&(e.positionX=e.targetX)):e.targetX<e.positionX?(e.positionX-=t,e.targetX>e.positionX&&(e.positionX=e.targetX)):e.targetY>e.positionY?(e.positionY+=t,e.targetY<e.positionY&&(e.positionY=e.targetY)):e.targetY<e.positionY&&(e.positionY-=t,e.targetY>e.positionY&&(e.positionY=e.targetY)),new y(e.positionX,e.positionY,e.targetX,e.targetY)}static moveTowardsOtherEntity(e,t){return t.positionX>e.positionX?e.targetX+=1:t.positionX<e.positionX?e.targetX-=1:t.positionY>e.positionY?e.targetY+=1:t.positionY<e.positionY&&(e.targetY-=1),new y(e.positionX,e.positionY,e.targetX,e.targetY)}static moveInRandomDirection(e){switch(v.randomIntFromRange(1,4)){case 1:e.targetX+=1;break;case 2:e.targetX-=1;break;case 3:e.targetY+=1;break;case 4:e.targetY-=1}return new y(e.positionX,e.positionY,e.targetX,e.targetY)}static frameSpeed(e,t){return e*t}static MoveTowards(e,t,i){let s=t.subtract(e),n=s.normalized.multiply(i);return n.magnitude>s.magnitude&&(n=s),n}}class x extends h{constructor(e,t){var i,s;super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.movementSpeed=.5,this.renderer.enabled=!0,this.tileset=t.tileset,this.spriteX=t.spriteX,this.spriteY=t.spriteY,this.spriteHeight=t.spriteHeight,this.spriteWidth=t.spriteWidth,this.destroyAtTarget=null!==(i=t.destroyAtTarget)&&void 0!==i&&i,this.movementSpeed=null!==(s=t.movementSpeed)&&void 0!==s?s:.5}update(e){this.updatePosition(e)}updatePosition(e){if(this.transform.position.x===this.targetX&&this.transform.position.y===this.targetY)return void(this.destroyAtTarget&&this.scene.removeObjectById(this.id));let t=new y(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),i=this.movementSpeed*e,s=f.moveTowardsPosition(t,i);this.transform.position.x=s.positionX,this.transform.position.y=s.positionY}render(e){t.renderSprite(e,m.images[this.tileset],this.spriteX,this.spriteY,this.transform.position.x,this.transform.position.y,this.spriteWidth,this.spriteWidth,{centered:!0})}}class I extends h{constructor(e,t){super(e,t),this.scene=e,this.newItemTimer=0}update(e){this.updateGenerateNewItem(e)}updateGenerateNewItem(t){if(this.newItemTimer+=t,this.newItemTimer<3)return;if(this.scene.objects.length>15)return;let i=v.randomIntFromRange(0,this.scene.map.height);this.scene.addObject(new x(this.scene,{positionX:e.CANVAS_TILE_WIDTH,positionY:i,targetX:-1,targetY:i,tileset:"tileset_egg",spriteX:1,spriteY:0,destroyAtTarget:!0})),this.newItemTimer=0}}var E,S,T;!function(e){e.Chicken="Chicken",e.Egg="Egg",e.WheatSeeds="WheatSeeds",e.Wheat="Wheat",e.TomatoSeeds="TomatoSeeds",e.Tomato="Tomato",e.Hoe="Hoe",e.WateringCan="WateringCan",e.Chest="Chest"}(E||(E={})),function(e){e.Player="Player",e.Anywhere="Anywhere",e.None="None"}(S||(S={})),function(e){e.Confirm="e",e.ConfirmAlt=" "}(T||(T={}));const _="tileset_dialogue_box",C=()=>{};class w extends h{constructor(t,i){var s,n,o,r,a;super(t,i),this.scene=t,this.height=3,this.width=e.CANVAS_TILE_WIDTH,this.textboxWidth=e.CANVAS_TILE_WIDTH-8,this.textboxBorder=2,this.textSize=10,this.textSegments=[],this.textIndex=0,this.characterIndex=0,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.completionTimer=0,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,void 0===i.positionX&&(this.transform.position.x=0),void 0===i.positionY&&(this.transform.position.y=e.CANVAS_TILE_HEIGHT-this.height),this.showOverlay=null===(s=i.showOverlay)||void 0===s||s,this.text=null!==(n=i.text)&&void 0!==n?n:"...",this.onComplete=null!==(o=i.onComplete)&&void 0!==o?o:C,this.portrait=i.portrait,this.name=i.name,this.completionDuration=i.completionDuration,this.scrollText=null===(r=i.scrollText)||void 0===r||r,this.scrollSpeed=null!==(a=i.scrollSpeed)&&void 0!==a?a:48,this.initText()}initText(){this.textSegments=t.textToArray(this.text,(this.textboxWidth-4)*e.TILE_SIZE,{size:this.textSize})}update(e){void 0!==this.completionDuration?this.updateTimer(e):this.updateConfirm(),this.scrollText&&this.updateScrollText(e),this.updatePortraitAnimation(e)}render(e){this.showOverlay&&this.renderOverlay(e),this.hasPortrait&&this.renderPortrait(e),this.generateTextbox(e),this.hasNamePlate&&this.renderNamePlate(e),this.renderText(e)}updateTimer(e){this.completionTimer+=e,this.completionTimer>=this.completionDuration&&(this.onComplete&&this.onComplete(),this.scene.removeObjectById(this.id))}updateScrollText(e){this.currentText.length>this.characterIndex&&(this.characterIndex+=this.scrollSpeed*e)}updateConfirm(){if(s.isKeyPressed([T.Confirm,T.ConfirmAlt])||s.isMousePressed(i.Left)){if(this.scrollText&&this.currentText.length>this.characterIndex)return this.characterIndex=this.currentText.length,s.clearKeyPressed([T.Confirm,T.ConfirmAlt]),void s.clearMousePressed(i.Left);this.textIndex+=2,this.characterIndex=0,this.textSegments.length<=this.textIndex&&(this.onComplete&&this.onComplete(),this.scene.removeObjectById(this.id)),s.clearKeyPressed([T.Confirm,T.ConfirmAlt]),s.clearMousePressed(i.Left)}}renderOverlay(i){t.fillRectangle(i,0,0,e.CANVAS_WIDTH,e.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.5)"})}generateTextbox(i){let s=this.textboxWidth,n=(e.CANVAS_TILE_WIDTH-s)/2;t.renderSprite(i,m.images[_],0,0,n,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,m.images[_],0,1,n,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,m.images[_],0,1,n,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,m.images[_],0,2,n,e.CANVAS_TILE_HEIGHT-1);for(let o=1;o<s-1;o++)t.renderSprite(i,m.images[_],1,0,n+o,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,m.images[_],1,1,n+o,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,m.images[_],1,1,n+o,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,m.images[_],1,2,n+o,e.CANVAS_TILE_HEIGHT-1);t.renderSprite(i,m.images[_],2,0,n+s-1,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,m.images[_],2,1,n+s-1,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,m.images[_],2,1,n+s-1,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,m.images[_],2,2,n+s-1,e.CANVAS_TILE_HEIGHT-1)}renderText(i){if(this.textLine1){let s=this.scrollText?this.textLine1.substring(0,this.characterIndex):this.textLine1;t.renderText(i,s,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-2-.25,{size:this.textSize})}if(this.textLine2){let s=this.scrollText?this.textLine2.substring(0,this.characterIndex-this.textLine1.length):this.textLine2;t.renderText(i,s,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-1-.25,{size:this.textSize})}}renderPortrait(e){t.renderSprite(e,m.images[this.portrait.tileset],this.portrait.x,this.portrait.y,3,9,void 0,void 0,{scale:8})}renderNamePlate(i){t.fillRectangle(i,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1,e.CANVAS_TILE_HEIGHT-4,6*e.TILE_SIZE,1*e.TILE_SIZE,{colour:"#e8cfa6"}),t.renderText(i,this.name,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-3-.25,{size:this.textSize})}updatePortraitAnimation(e){this.animationTimer=(this.animationTimer+e)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}get hasPortrait(){return void 0!==this.portrait}get hasNamePlate(){return void 0!==this.name}get textLine1(){return this.textSegments[this.textIndex]}get textLine2(){return this.textSegments[this.textIndex+1]}get currentText(){let e="";return this.textLine1&&(e+=this.textLine1),this.textLine2&&(e+=this.textLine2),e}}const L={x:1,y:1},Y=[E.TomatoSeeds,E.WheatSeeds];var X;!function(e){e[e.Empty=0]="Empty",e[e.Watered=1]="Watered",e[e.Growing=2]="Growing",e[e.FullyGrown=3]="FullyGrown",e[e.Spoiled=4]="Spoiled"}(X||(X={}));const A={[E.WheatSeeds]:{[X.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:0},[X.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:0},[X.Spoiled]:void 0},[E.TomatoSeeds]:{[X.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:1},[X.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:1},[X.Spoiled]:void 0}};class k extends h{constructor(e,t){super(e,t),this.scene=e,this.spriteX=L.x,this.spriteY=L.y,this.counterDry=0,this.counterGrow=0,this.counterSpoil=0,this.currentlyGrowing=void 0,this.renderer.enabled=!0,this.renderer.layer=6,this.cropStage=X.Empty,t.growing&&(this.collision.enabled=!0,this.cropStage=t.growing.stage,this.currentlyGrowing=t.growing.itemType)}onDirtPlaced(e){let t=this.scene.getAllObjectsAtPosition(this.transform.position.x-1,this.transform.position.y),i=this.scene.getAllObjectsAtPosition(this.transform.position.x+1,this.transform.position.y),s=(t.filter((e=>e instanceof k)).length,i.filter((e=>e instanceof k)).length,L);this.spriteX=s.x,this.spriteY=s.y}interact(){switch(this.cropStage){case X.Empty:return void this.interactStageEmpty();case X.Watered:return void this.interactStageWatered();case X.Growing:return void this.interactStageGrowing();case X.FullyGrown:return void this.interactStageFullyGrown()}}interactStageEmpty(){this.scene.globals.disable_player_inputs=!0;let e=new w(this.scene,{text:"It's a beautiful patch of dirt, brimming with potential.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageWatered(){this.scene.globals.disable_player_inputs=!0;let e=new w(this.scene,{text:"The patch of dirt is watered, better plant something before it dries up.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageGrowing(){this.scene.globals.disable_player_inputs=!0;let e=new w(this.scene,{text:"The plant is growing nicely, it will be ready for harvest soon.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageFullyGrown(){switch(this.currentlyGrowing){case E.TomatoSeeds:this.scene.addToInventory(E.Tomato);break;case E.WheatSeeds:this.scene.addToInventory(E.Wheat)}this.scene.removeObjectById(this.id)}get isEmpty(){return void 0===this.currentlyGrowing}update(e){this.cropStage===X.Empty||this.cropStage===X.Watered?this.counterDry+=e:this.cropStage===X.Growing?this.counterGrow+=e:this.cropStage===X.FullyGrown&&(this.counterSpoil+=e),this.isEmpty&&this.counterDry>15?this.scene.removeObjectById(this.id):this.cropStage===X.Growing&&this.counterGrow>5?this.cropStage=X.FullyGrown:this.cropStage===X.FullyGrown&&this.counterSpoil>86400&&(this.cropStage=X.Spoiled)}render(e){this.renderDirt(e),this.renderCrop(e)}destroy(){}renderDirt(e){let i=(this.cropStage,X.Empty,"tileset_dirt");t.renderSprite(e,m.images[i],this.spriteX,this.spriteY,this.transform.position.x,this.transform.position.y,1,1,{centered:!0})}renderCrop(e){if(this.cropStage===X.Empty||this.cropStage===X.Watered)return;if(this.currentlyGrowing!==E.TomatoSeeds&&this.currentlyGrowing!==E.WheatSeeds)return;let i=A[this.currentlyGrowing][this.cropStage];void 0!==i&&t.renderSprite(e,m.images[i.tileset],i.spriteX,i.spriteY,this.transform.position.x,this.transform.position.y,1,1,{centered:!0})}actionWater(){this.cropStage===X.Empty&&(this.counterDry=0,this.cropStage=X.Watered)}actionPlant(){let e=this.scene.selectedInventoryItem;void 0!==e&&Y.includes(e.type)&&this.cropStage===X.Watered&&(this.collision.enabled=!0,this.currentlyGrowing=e.type,this.cropStage=X.Growing,this.scene.removeFromInventory(this.scene.globals.hotbar_selected_index))}}const j=[{x:11,y:15},{x:13,y:15},{x:15,y:15},{x:17,y:15},{x:19,y:15},{x:11,y:6},{x:13,y:6},{x:15,y:6},{x:17,y:6},{x:19,y:6},{x:11,y:8},{x:13,y:8},{x:15,y:8},{x:17,y:8},{x:19,y:8},{x:11,y:10},{x:13,y:10},{x:15,y:10},{x:17,y:10},{x:19,y:10},{x:11,y:12},{x:13,y:12},{x:15,y:12},{x:17,y:12},{x:19,y:12}],B=[{x:7,y:1},{x:9,y:1},{x:11,y:1},{x:13,y:1},{x:15,y:1},{x:17,y:1},{x:19,y:1},{x:21,y:1},{x:23,y:1},{x:7,y:3},{x:9,y:3},{x:11,y:3},{x:13,y:3},{x:15,y:3},{x:17,y:3},{x:19,y:3},{x:21,y:3},{x:23,y:3},{x:7,y:5},{x:9,y:5},{x:11,y:5},{x:13,y:5},{x:15,y:5},{x:17,y:5},{x:19,y:5},{x:21,y:5},{x:23,y:5}];var H;!function(e){e.Close="tab"}(H||(H={}));class O extends h{constructor(t,i){super(t,i),this.scene=t,this.showInventory=!0,this.showHotbar=!0,this.chest=void 0,this.itemHolding=void 0,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.collision.layer=e.UI_COLLISION_LAYER,this.scene.globals.disable_player_inputs=!0,this.chest=i.chest}update(e){this.updatePickUpItem(),this.updateDropItem(),this.updateClose()}render(e){if(this.showHotbar){let t=11,i=15;this.renderInventoryBackground(e,t,i),this.renderInventoryContainers(e,t,i),this.renderInventoryItems(e,t,i,this.inventory.slice(0,this.hotbarSize)),this.showInventory||this.renderHotbarSelector(e)}if(this.chest){this.renderChestHeader(e,7,0);for(let t=0;t<3;t++){let i=7,s=1+2*t;this.renderInventoryBackground(e,i,s),this.renderInventoryContainers(e,i,s),this.renderInventoryItems(e,i,s,this.chest.inventory.slice(this.hotbarSize*t,this.hotbarSize*(t+1)))}}if(this.showInventory){this.renderInventoryHeader(e,11,5);for(let t=0;t<4;t++){let i=11,s=6+2*t;this.renderInventoryBackground(e,i,s),this.renderInventoryContainers(e,i,s),this.renderInventoryItems(e,i,s,this.inventory.slice(this.hotbarSize*(t+1),this.hotbarSize*(t+2)))}this.renderInventoryItemGrabbed(e)}}destroy(){this.scene.globals.disable_player_inputs=!1,this.chest&&this.chest.actionClose()}renderHotbarSelector(e){const i=11+2*this.hotbarSelectedIndex;t.renderSprite(e,m.images.tileset_ui,9,9,i,15,2,2)}renderInventoryHeader(i,s,n){let o=4*e.TILE_SIZE,r=2*e.TILE_SIZE;t.fillRectangle(i,s,n,o,r,{colour:"saddlebrown"}),t.renderText(i,"Inventory",s+.4,n+.75,{size:12,colour:"white"})}renderChestHeader(i,s,n){let o=4*e.TILE_SIZE,r=2*e.TILE_SIZE;t.fillRectangle(i,s,n,o,r,{colour:"saddlebrown"}),t.renderText(i,"Chest",s+.9,n+.75,{size:12,colour:"white"})}renderInventoryBackground(i,s,n){let o=2*e.TILE_SIZE*this.scene.globals.hotbar_size,r=2*e.TILE_SIZE;t.fillRectangle(i,s,n,o,r,{colour:"saddlebrown"})}renderInventoryContainers(e,i,s){for(let n=0;n<this.scene.globals.hotbar_size;n++)t.renderSprite(e,m.images.tileset_ui,.5,3.5,i+2*n,s,2,2)}renderInventoryItems(e,t,i,s){for(let n=0;n<9;n++){let o=s[n];void 0!==o&&this.renderInventoryItem(e,o.sprite.tileset,o.currentStackSize,o.maxStackSize,o.sprite.spriteX,o.sprite.spriteY,t+.5+2*n,i+.5)}}renderInventoryItemGrabbed(e){if(void 0===this.itemHolding)return;let t=this.itemHolding.item;this.renderInventoryItem(e,t.sprite.tileset,t.currentStackSize,t.maxStackSize,t.sprite.spriteX,t.sprite.spriteY,s.mouse.position.exactX-.5,s.mouse.position.exactY-.5)}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}get hotbarSize(){return this.scene.globals.hotbar_size}get hotbarSelectedIndex(){return this.scene.globals.hotbar_selected_index}updatePickUpItem(){if(void 0!==this.itemHolding)return;let e=this.getIndexFromPositionMap(s.mouse.position,j);if(void 0===e){if(void 0!==this.chest){let e=this.getIndexFromPositionMap(s.mouse.position,B);if(void 0!==e){let t=this.chest.inventory[e];if(void 0===t)return;return void(this.itemHolding={location:"chest",item:t,index:e})}}this.itemHolding=void 0}else{let t=this.inventory[e];if(void 0===t)return;this.itemHolding={location:"inventory",item:t,index:e}}}updateDropItem(){if(void 0===this.itemHolding)return;if(!0===s.mouse.click.left)return;let e=this.getIndexFromPositionMap(s.mouse.position,j);if(void 0!==e){let t=this.inventory[e];return"inventory"===this.itemHolding.location?(this.inventory[e]=this.itemHolding.item,this.inventory[this.itemHolding.index]=t):"chest"===this.itemHolding.location&&(this.inventory[e]=this.itemHolding.item,this.chest.inventory[this.itemHolding.index]=t),void(this.itemHolding=void 0)}if(void 0!==this.chest){let e=this.getIndexFromPositionMap(s.mouse.position,B);if(void 0!==e){let t=this.chest.inventory[e];return"inventory"===this.itemHolding.location?(this.chest.inventory[e]=this.itemHolding.item,this.inventory[this.itemHolding.index]=t):"chest"===this.itemHolding.location&&(this.chest.inventory[e]=this.itemHolding.item,this.chest.inventory[this.itemHolding.index]=t),void(this.itemHolding=void 0)}}this.itemHolding=void 0}updateClose(){s.isKeyPressed(H.Close)&&(s.clearKeyPressed(H.Close),this.scene.removeObjectById(this.id))}renderInventoryItem(e,i,s,n,o,r,a,h){t.renderSprite(e,m.images[i],o,r,a,h),n>1&&t.renderText(e,`${s}`,a+.75,h+1,{size:8,colour:"black"})}getIndexFromPositionMap(e,t){for(let i=0;i<t.length;i++){let s=t[i];if(e.x>=s.x&&e.x<=s.x+1&&e.y>=s.y&&e.y<=s.y+1)return i}}}const M={tileset:"tileset_chicken",x:0,y:0},N="tileset_chest";class R extends h{constructor(e,t){super(e,t),this.scene=e,this.isOpen=!1,this.inventory=[],this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8}render(e){this.renderSprite(e)}interact(){this.actionOpen()}actionOpen(){this.isOpen=!0,this.scene.addObject(new O(this.scene,{positionX:0,positionY:0,chest:this}))}actionClose(){this.isOpen=!1}renderSprite(e){this.isOpen?t.renderSprite(e,m.images[N],13,.5,this.transform.position.x,this.transform.position.y-.5,1,2,{centered:!0}):t.renderSprite(e,m.images[N],1,.5,this.transform.position.x,this.transform.position.y-.5,1,2,{centered:!0})}}var P,D;!function(e){e.UP="w",e.DOWN="s",e.LEFT="a",e.RIGHT="d"}(P||(P={})),function(e){e.Inventory="tab",e.Interact="e",e.InteractAlt=" "}(D||(D={}));class F extends h{constructor(e,t){super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.movementSpeed=4,this.animations={[P.RIGHT]:[{x:7,y:10},{x:10,y:10}],[P.LEFT]:[{x:7,y:7},{x:10,y:7}],[P.UP]:[{x:7,y:4},{x:10,y:4}],[P.DOWN]:[{x:7,y:1},{x:10,y:1}]},this.animationsIdle={[P.RIGHT]:[{x:1,y:10},{x:4,y:10}],[P.LEFT]:[{x:1,y:7},{x:4,y:7}],[P.UP]:[{x:1,y:4},{x:4,y:4}],[P.DOWN]:[{x:1,y:1},{x:4,y:1}]},this.direction=P.DOWN,this.directionTime=0,this.directionTimer=0,this.animationIndex=0,this.isIdle=!0,this.movementEnabled=!1,this.hotbarEnabled=!1,this.leftClickEnabled=!1,this.inventoryEnabled=!1,this.interactButtonEnabled=!1,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=10,this.targetX=this.transform.position.x,this.targetY=this.transform.position.y,this.enableMovement(),this.enableInteractKeys(),this.enableInventoryKeys(),this.enableOtherKeys()}enableMovement(){this.movementEnabled=!0}enableOtherKeys(){this.hotbarEnabled=!0,this.leftClickEnabled=!0}enableInventoryKeys(){this.inventoryEnabled=!0}enableInteractKeys(){this.interactButtonEnabled=!0}update(e){this.updateMovement(e),this.updateAnimations(e),this.updateHotbarViaKey(),this.updateHotbarViaWheel(),this.updateLeftClick(),this.updateButtonInteract(),this.updateOpenInventory(),this.latestScrollTimestamp=s.mouse.wheel.event.timeStamp}render(e){this.renderSprite(e),this.renderCursor(e)}updateMovement(e){!0!==this.scene.globals.disable_player_inputs&&!1!==this.movementEnabled&&(this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){if(this.targetX!==this.transform.position.x||this.targetY!==this.transform.position.y)return;if(!s.isKeyPressed([P.RIGHT,P.LEFT,P.UP,P.DOWN]))return;let t,i=new y(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY);if(s.isKeyPressed(P.RIGHT)?(i.targetX+=1,t=P.RIGHT):s.isKeyPressed(P.LEFT)?(i.targetX-=1,t=P.LEFT):s.isKeyPressed(P.UP)?(i.targetY-=1,t=P.UP):s.isKeyPressed(P.DOWN)&&(i.targetY+=1,t=P.DOWN),this.direction!==t?(this.direction=t,this.directionTime=0,this.directionTimer=0):this.directionTimer+=e,this.directionTimer<.05)return;const n=h.calculateBoundingBox(i.target.x,i.target.y,this.width,this.height);this.scene.hasCollisionAtBoundingBox(n,this)||this.scene.isOutOfBounds(i.targetX,i.targetY)||(this.targetX=i.targetX,this.targetY=i.targetY)}updateAnimations(e){this.targetX!==this.transform.position.x||this.targetY!==this.transform.position.y?this.isIdle=!1:this.isIdle=!0,this.isIdle?this.directionTime<.5?this.animationIndex=0:this.animationIndex=1:this.directionTime<.25?this.animationIndex=0:this.directionTime<.5?this.animationIndex=1:this.directionTime<.75?this.animationIndex=0:this.animationIndex=1,this.directionTime=(this.directionTime+e)%1}processMovement(e){if(this.targetX!==this.transform.position.x||this.targetY!==this.transform.position.y){let t=new y(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),i=f.moveTowardsPosition(t,f.frameSpeed(this.movementSpeed,e));this.transform.position.x=i.positionX,this.transform.position.y=i.positionY}}updateButtonInteract(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.interactButtonEnabled)return;if(!s.isKeyPressed([D.Interact,D.InteractAlt]))return;s.clearKeyPressed([D.Interact,D.InteractAlt]);let e=this.transform.position.x,t=this.transform.position.y;switch(this.direction){case P.UP:t-=1;break;case P.RIGHT:e+=1;break;case P.DOWN:t+=1;break;case P.LEFT:e-=1}let i=this.scene.getObjectAtPosition(e,t,this);void 0!==i&&function(e){return"interact"in e}(i)&&i.interact()}destroy(){}getPositionFacing(){let e=Math.floor(this.transform.position.x),t=Math.floor(this.transform.position.y);return this.direction===P.RIGHT?{x:e+1,y:t}:this.direction===P.LEFT?{x:e-1,y:t}:this.direction===P.UP?{x:e,y:t-1}:this.direction===P.DOWN?{x:e,y:t+1}:void 0}updateHotbarViaKey(){!0!==this.scene.globals.disable_player_inputs&&!1!==this.hotbarEnabled&&(!0!==s.isKeyPressed("1")?!0!==s.isKeyPressed("2")?!0!==s.isKeyPressed("3")?!0!==s.isKeyPressed("4")?!0!==s.isKeyPressed("5")||(this.scene.globals.hotbar_selected_index=4):this.scene.globals.hotbar_selected_index=3:this.scene.globals.hotbar_selected_index=2:this.scene.globals.hotbar_selected_index=1:this.scene.globals.hotbar_selected_index=0)}updateHotbarViaWheel(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.hotbarEnabled)return;if(this.latestScrollTimestamp===s.mouse.wheel.event.timeStamp)return;const e=this.scene.globals.hotbar_selected_index;s.mouse.wheel.event.deltaY>0?e===this.scene.globals.hotbar_size-1?this.scene.globals.hotbar_selected_index=0:this.scene.globals.hotbar_selected_index++:s.mouse.wheel.event.deltaY<0&&(0===e?this.scene.globals.hotbar_selected_index=this.scene.globals.hotbar_size-1:this.scene.globals.hotbar_selected_index--)}updateOpenInventory(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.inventoryEnabled)return;let e=[D.Inventory];!1!==s.isKeyPressed(e)&&(this.scene.addObject(new O(this.scene,{positionX:0,positionY:0})),s.clearKeyPressed(e))}updateLeftClick(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.leftClickEnabled)return;if(!s.isMousePressed(i.Left))return;s.clearMousePressed(i.Left);let e=this.scene.selectedInventoryItem;if(void 0===e)return;if(e.radius===S.None)return;let t=Math.round(s.mouse.position.exactX+this.scene.globals.camera.startX),n=Math.round(s.mouse.position.exactY+this.scene.globals.camera.startY);if(e.radius===S.Player&&Math.abs(t-this.transform.position.roundedX)>1||Math.abs(n-this.transform.position.roundedY)>1)return;let o=this.scene.getObjectAtPosition(t,n);if(void 0===o)switch(e.type){case E.Hoe:return void function(e,t){const i=Math.round(t.transform.position.x),n=Math.round(t.transform.position.y),o=Math.round(s.mouse.position.exactX+e.globals.camera.startX),r=Math.round(s.mouse.position.exactY+e.globals.camera.startY);if(Math.abs(o-i)>1||Math.abs(r-n)>1)return;const a=new k(e,{positionX:o,positionY:r});e.addObject(a)}(this.scene,this);case E.WateringCan:return(r=this.scene).globals.disable_player_inputs=!0,void r.addObject(new w(r,{text:"There is nothing to water...",onComplete:()=>{r.globals.disable_player_inputs=!1}}));case E.Chicken:return void function(e){let t=s.mouse.position,i=new V(e,{positionX:t.x,positionY:t.y});e.addObject(i),e.removeFromInventory(e.selectedInventoryIndex)}(this.scene);case E.Egg:return void function(e){const t=Math.round(s.mouse.position.exactX+e.globals.camera.startX),i=Math.round(s.mouse.position.exactY+e.globals.camera.startY);let n=new W(e,{positionX:t,positionY:i});e.addObject(n),e.removeFromInventory(e.selectedInventoryIndex)}(this.scene);case E.TomatoSeeds:case E.WheatSeeds:return void function(e){e.globals.disable_player_inputs=!0,e.addObject(new w(e,{text:"Seeds can only be placed in watered dirt.",onComplete:()=>{e.globals.disable_player_inputs=!1}}))}(this.scene);case E.Chest:return void function(e){const t=s.mouse.position.x,i=s.mouse.position.y,n=new R(e,{positionX:t,positionY:i});e.addObject(n),e.removeFromInventory(e.selectedInventoryIndex)}(this.scene);default:return}else switch(e.type){case E.WateringCan:switch(!0){case o instanceof k:return void function(e,t){t.actionWater()}(this.scene,o);case o instanceof V:return void function(e,t){e.globals.disable_player_inputs=!0,e.addObject(new w(e,{text:"Hey could you not water me please...",portrait:M,name:"Chicken",onComplete:()=>{e.globals.disable_player_inputs=!1}}))}(this.scene);default:return}case E.TomatoSeeds:case E.WheatSeeds:return 1==o instanceof k?void function(e,t){t.actionPlant()}(this.scene,o):void 0;case E.Tomato:case E.Wheat:return 1==o instanceof V?void function(e,t){t.actionGiveItem()}(this.scene,o):void 0;default:return}var r}renderSprite(e){let i=this.isIdle?this.animationsIdle:this.animations;t.renderSprite(e,m.images.tileset_player,i[this.direction][this.animationIndex].x,i[this.direction][this.animationIndex].y,this.transform.position.x,this.transform.position.y,void 0,void 0,{centered:!0})}renderCursor(e){if(!this.leftClickEnabled)return;let i=Math.round(s.mouse.position.exactX+this.scene.globals.camera.startX),n=Math.round(s.mouse.position.exactY+this.scene.globals.camera.startY),o=this.scene.selectedInventoryItem;void 0!==o&&o.radius!==S.None&&(i===this.transform.position.roundedX&&n===this.transform.position.roundedY||o.radius===S.Player&&Math.abs(i-this.transform.position.roundedX)>1||Math.abs(n-this.transform.position.roundedY)>1||t.fillRectangle(e,i-.5,n-.5,1,1,{colour:"#0000ff33",type:"tile"}))}}class W extends h{constructor(e,t){super(e,t),this.scene=e,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.hatchTimer=0,this.hatchTimerMax=7,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=7}update(e){this.updateAnimation(e),this.updateHatch(e)}render(e){t.renderSprite(e,m.images.tileset_egg,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.x,this.transform.position.y,1,1,{centered:!0})}destroy(){}updateAnimation(e){this.animationTimer=(this.animationTimer+e)%1,this.animationIndex=0}updateHatch(e){if(this.hatchTimer+=e,this.hatchTimer<this.hatchTimerMax)return;let t=this.scene.getObjectsByType(F)[0],i=new V(this.scene,{positionX:this.transform.position.x,positionY:this.transform.position.y,follows:t});this.scene.removeObjectById(this.id),this.scene.addObject(i)}interact(){this.scene.addToInventory(E.Egg),this.scene.removeObjectById(this.id)}}const G={tileset:"tileset_chicken",x:0,y:0};class V extends h{constructor(e,t){var i,s;super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=v.randomStartingDelta(4),this.animationIndex=0,this.movementSpeed=2,this.movementTimer=v.randomStartingDelta(2),this.movementDelay=2,this.eggTimer=v.randomStartingDelta(2),this.eggTimerMax=7,this.eggMax=200,this.isMovingThisFrame=!1,this.isEdgyTeen=!1,this.interactionCount=0,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.targetX=this.transform.position.x,this.targetY=this.transform.position.y,this.canLayEggs=null!==(i=t.canLayEggs)&&void 0!==i&&i,this.isEdgyTeen=3===v.randomIntFromRange(0,3),this.canMove=null!==(s=t.canMove)&&void 0!==s&&s,this.following=t.follows}update(e){this.isMovingThisFrame=!1,this.updateMovement(e),this.updateAnimation(e),this.updateEgg(e)}render(e){t.renderSprite(e,m.images.tileset_chicken,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.x,this.transform.position.y,void 0,void 0,{centered:!0})}updateAnimation(e){this.animationTimer=(this.animationTimer+e)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}updateMovement(e){this.canMove&&(this.movementTimer+=e,this.movementTimer>this.movementDelay&&this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){let t;this.movementTimer=0,t=this.following?f.moveTowardsOtherEntity(new y(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),{positionX:this.following.transform.position.x,positionY:this.following.transform.position.y}):f.moveInRandomDirection(new y(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY)),this.scene.hasCollisionAtPosition(t.targetX,t.targetY,this)||this.scene.isOutOfBounds(t.targetX,t.targetY)||(this.targetX=t.targetX,this.targetY=t.targetY)}processMovement(e){if(this.targetX!==this.transform.position.x||this.targetY!==this.transform.position.y){let t=new y(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),i=f.moveTowardsPosition(t,f.frameSpeed(this.movementSpeed,e));this.transform.position.x=i.positionX,this.transform.position.y=i.positionY,this.isMovingThisFrame=!0}}updateEgg(e){if(!this.canLayEggs)return;if(this.eggTimer+=e,this.eggTimer<this.eggTimerMax)return;if(!this.isMovingThisFrame)return;let t;this.scene.getObjectsByType(V).length+this.scene.getObjectsByType(W).length>this.eggMax||(t=this.transform.position.x>this.targetX||this.transform.position.y>this.targetY?Math.ceil:Math.floor,this.scene.addObject(new W(this.scene,{positionX:t(this.transform.position.x),positionY:t(this.transform.position.y)})),this.eggTimer=0)}interact(){this.interactDefault()}interactDefault(){this.scene.globals.disable_player_inputs=!0;let e="";if(this.isEdgyTeen)switch(this.interactionCount%3){case 0:e="GET OUT OF MY ROOM MOM! GODDDD!!1!";break;case 1:e="UGHHHH! YOU ARE LIKE SO EMBARRASSING!1!11!";break;case 2:e="OMG!1!1 JUST LIKE LEAVE ME ALONE!1!11!!"}else switch(this.interactionCount%3){case 0:e="bock bock ... can i help you? ... cluck cluck ...";break;case 1:e="cluck cluck ... you're sort of annoying you know that? ... bock bock ...";break;case 2:e="bock cluck ... is... is this a simulation? ... cluck bock ..."}let t=new w(this.scene,{text:e,portrait:G,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(t),this.interactionCount++}actionGiveItem(){switch(this.scene.selectedInventoryItem.type){case E.Tomato:return void this.actionGiveTomato();case E.Wheat:return void this.actionGiveWheat()}}actionGiveTomato(){this.scene.globals.disable_player_inputs=!0;let e=new w(this.scene,{text:"I LOooOooOoOooOoOVE TOMATOES!",portrait:G,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}),t=this.scene.globals.inventory.indexOf(this.scene.selectedInventoryItem);this.scene.removeFromInventory(t),this.scene.addObject(e)}actionGiveWheat(){this.scene.globals.disable_player_inputs=!0;let e=new w(this.scene,{text:"I HAAAAAAAAAAAAAAAATE WHEAT!",portrait:G,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(e)}}const z={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},Z=[z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z,z],U={index:0,tiles:[[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z]]},K={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},$={...K,animationFrames:[{spriteX:2,spriteY:1}]},J={...K,animationFrames:[{spriteX:1,spriteY:2}]},q={...K,animationFrames:[{spriteX:2,spriteY:2}]},Q={...K,animationFrames:[{spriteX:5,spriteY:1}]},ee={index:1,tiles:[[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Q,$,$,$,$,$,$,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,Q,$,$,$,q],[void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,J],[$,$,$,$,q]]};class te extends h{constructor(e,t){super(e,t),this.scene=e,this.collision.enabled=!0}}const ie={tileset:"tileset_grass",animationFrameDuration:1,animationFrames:[],animationMap:[1]},se={...ie,animationFrames:[{spriteX:1,spriteY:1}]},ne={...ie,animationFrames:[{spriteX:2,spriteY:1}]},oe=[se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,se,{...ie,animationFrames:[{spriteX:1,spriteY:2}]}],re={index:1,tiles:[oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,[ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,{...ie,animationFrames:[{spriteX:2,spriteY:2}]}]]};class ae extends h{constructor(i,s){super(i,s),this.scene=i,this.customerRenderer=i=>{let s=this.object.transform.position.x-this.cameraOffsetX,n=this.object.transform.position.y-this.cameraOffsetY,o=this.object.transform.position.x+(this.cameraOffsetX+1),r=this.object.transform.position.y+(this.cameraOffsetY+1);s<0?(s=0,o=s+e.CANVAS_TILE_WIDTH):o>this.scene.map.width&&(o=this.scene.map.width,s=o-e.CANVAS_TILE_WIDTH),n<0?(n=0,r=n+e.CANVAS_TILE_HEIGHT):r>this.scene.map.height&&(r=this.scene.map.height,n=r-e.CANVAS_TILE_HEIGHT),this.scene.globals.camera.startX=s,this.scene.globals.camera.startY=n,this.scene.globals.camera.endX=o,this.scene.globals.camera.endY=r,i.background.forEach((e=>{t.renderSubsection(e,this.mainContext,s,n,o,r)})),i.objects.forEach(((i,a)=>{a===e.UI_RENDER_LAYER?t.renderSubsection(i,this.mainContext,0,0,e.CANVAS_TILE_WIDTH,e.CANVAS_TILE_HEIGHT):t.renderSubsection(i,this.mainContext,s,n,o,r)}))};let n=e.CANVAS_TILE_WIDTH/2-.5,o=e.CANVAS_TILE_HEIGHT/2-.5;this.cameraOffsetX=s.zoom?n/s.zoom:n,this.cameraOffsetY=s.zoom?o/s.zoom:o,this.object=s.object,this.scene.setCustomRenderer(this.customerRenderer)}destroy(){this.scene.removeCustomerRenderer()}}class he extends h{constructor(t,i){super(t,i),this.scene=t,this.height=2,this.width=10,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.collision.layer=e.UI_COLLISION_LAYER}update(e){}render(e){this.renderBackground(e),this.renderContainers(e),this.renderItems(e,this.inventory.slice(0,this.hotbarSize)),this.renderHotbarSelector(e)}renderHotbarSelector(e){const i=this.boundingBox.left+1+2*this.hotbarSelectedIndex,s=this.boundingBox.top+1;t.renderSprite(e,m.images.tileset_ui,9,9,i,s,2,2,{centered:!0})}renderBackground(e){t.fillRectangle(e,this.boundingBox.left,this.boundingBox.top,this.width,this.height,{colour:"saddlebrown",type:"tile"})}renderContainers(e){for(let i=0;i<5;i++)t.renderSprite(e,m.images.tileset_ui,.5,3.5,this.boundingBox.left+1+2*i,this.boundingBox.top+1,2,2,{centered:!0})}renderItems(e,t){for(let i=0;i<5;i++){let s=t[i];void 0!==s&&this.renderInventoryItem(e,s.sprite.tileset,s.currentStackSize,s.maxStackSize,s.sprite.spriteX,s.sprite.spriteY,this.boundingBox.left+1+2*i,this.boundingBox.top+1)}}renderInventoryItem(e,i,s,n,o,r,a,h){t.renderSprite(e,m.images[i],o,r,a,h,1,1,{centered:!0}),n>1&&t.renderText(e,`${s}`,a+.75,h+1,{size:8,colour:"black"})}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}get hotbarSize(){return this.scene.globals.hotbar_size}get hotbarSelectedIndex(){return this.scene.globals.hotbar_selected_index}}class de{constructor(e,t){this.tileset=e,this.frames=t,this.duration=t.reduce(((e,t)=>e+t.duration),0)}currentFrame(e){let t=e%this.duration,i=0;for(let e=0;e<this.frames.length;e++)if(i+=this.frames[e].duration,t<i)return this.frames[e];return this.frames[0]}}const le={tileset:"tileset_chicken",x:0,y:0},ce={idle:new de("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}]),moving:new de("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}])};class pe extends h{constructor(e,t){var i,s,n,o,r;super(e,t),this.scene=e,this.state="idle",this.targetX=-1,this.targetY=-1,this.animation={index:0,timer:0},this.movementTimer=v.randomStartingDelta(2),this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.targetX=this.transform.position.x,this.targetY=this.transform.position.y,this.canMove=null!==(i=t.canMove)&&void 0!==i&&i,this.following=t.follows,this.dialogue=t.dialogue,this.animations=null!==(s=t.animations)&&void 0!==s?s:ce,this.movementSpeed=null!==(n=t.movementSpeed)&&void 0!==n?n:2,this.movementDelay=null!==(o=t.movementDelay)&&void 0!==o?o:void 0,this.name=null!==(r=t.name)&&void 0!==r?r:"???"}update(e){this.updateMovement(e),this.updateAnimationTimer(e)}render(e){let i=this.animations[this.state],s=i.currentFrame(this.animation.timer);t.renderSprite(e,m.images[i.tileset],s.spriteX,s.spriteY,this.transform.position.x,this.transform.position.y,void 0,void 0,{opacity:this.renderer.opacity,scale:this.renderer.scale,centered:!0})}updateAnimationTimer(e){this.animation.timer=(this.animation.timer+e)%this.animations[this.state].duration}updateMovement(e){this.canMove&&(this.movementTimer+=e,(void 0===this.movementDelay&&this.movementTimer>this.movementSpeed||this.movementTimer>this.movementDelay)&&this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){let t;this.movementTimer=0,t=this.following?f.moveTowardsOtherEntity(new y(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),{positionX:this.following.transform.position.x,positionY:this.following.transform.position.y}):f.moveInRandomDirection(new y(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY)),this.scene.hasCollisionAtPosition(t.targetX,t.targetY,this)||this.scene.isOutOfBounds(t.targetX,t.targetY)||(this.targetX=t.targetX,this.targetY=t.targetY)}processMovement(e){if(this.targetX!==this.transform.position.x||this.targetY!==this.transform.position.y){let t=new y(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),i=f.moveTowardsPosition(t,f.frameSpeed(this.movementSpeed,e));this.transform.position.x=i.positionX,this.transform.position.y=i.positionY}}interact(){if(void 0===this.dialogue)return;let e=new w(this.scene,{text:this.dialogue,portrait:le,name:this.name});this.scene.addObject(e)}}const me={[E.Chicken]:1,[E.Egg]:9,[E.WheatSeeds]:9,[E.Wheat]:9,[E.TomatoSeeds]:9,[E.Tomato]:9,[E.Hoe]:1,[E.WateringCan]:1,[E.Chest]:1},ge={tileset:"tileset_ui",spriteX:15,spriteY:5},ue={[E.Chicken]:{tileset:"tileset_chicken",spriteX:0,spriteY:0},[E.Egg]:{tileset:"tileset_egg",spriteX:0,spriteY:0},[E.WheatSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:0},[E.Wheat]:{tileset:"tileset_plants",spriteX:5,spriteY:0},[E.TomatoSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:1},[E.Tomato]:{tileset:"tileset_plants",spriteX:5,spriteY:1},[E.Hoe]:{tileset:"tileset_tools",spriteX:4,spriteY:4},[E.WateringCan]:{tileset:"tileset_tools",spriteX:0,spriteY:0},[E.Chest]:{tileset:"tileset_chest",spriteX:1,spriteY:1}},be=S.None,ve={[E.Chicken]:S.Player,[E.Egg]:S.Player,[E.WheatSeeds]:S.Player,[E.Wheat]:S.None,[E.TomatoSeeds]:S.Player,[E.Tomato]:S.None,[E.Hoe]:S.Player,[E.WateringCan]:S.Player,[E.Chest]:S.Anywhere},ye={[E.Chicken]:0,[E.Egg]:0,[E.WheatSeeds]:5,[E.Wheat]:10,[E.TomatoSeeds]:5,[E.Tomato]:10,[E.Hoe]:0,[E.WateringCan]:0,[E.Chest]:0};class fe extends h{constructor(e,t){var i,s,n;super(e,t),this.scene=e,this.type=t.type,this.maxStackSize=null!==(i=me[this.type])&&void 0!==i?i:1,this.sprite=null!==(s=ue[this.type])&&void 0!==s?s:ge,this.radius=null!==(n=ve[this.type])&&void 0!==n?n:be,void 0!==t.currentStackSize?this.currentStackSize=t.currentStackSize>this.maxStackSize?this.maxStackSize:t.currentStackSize:this.currentStackSize=1}}class xe extends h{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.price=i.price,this.type=i.type}update(e){this.updateClicked()}render(e){this.renderContainer(e),this.renderItem(e),this.renderPrice(e)}updateClicked(){s.isMousePressed()&&n.isMouseWithinObject(this)&&(s.clearMousePressed(),this.price>this.scene.globals.gold||(this.scene.globals.gold-=this.price,this.scene.addToInventory(this.type)))}renderContainer(e){t.fillRectangle(e,this.transform.position.x,this.transform.position.y,this.width,this.height,{colour:"white",type:"tile"})}renderItem(e){t.fillRectangle(e,this.transform.position.x,this.transform.position.y,this.width,this.height,{colour:"white",type:"tile"}),t.renderSprite(e,m.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.x,this.transform.position.y,void 0,void 0)}renderPrice(e){t.renderText(e,`$${this.price}`,this.transform.position.x+1,this.transform.position.y+2,{size:12,colour:"black",font:"MS Gothic"})}get sprite(){return ue[this.type]}}class Ie extends h{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.item=i.item,this.index=i.index}update(e){this.updateClicked()}render(e){this.renderContainer(e),this.renderItem(e),this.renderPrice(e),this.renderStackSize(e)}get type(){return this.item.type}get price(){return ye[this.type]}updateClicked(){s.isMousePressed()&&n.isMouseWithinObject(this)&&(s.clearMousePressed(),this.scene.globals.gold+=this.price,this.scene.removeFromInventory(this.index),0===this.item.currentStackSize&&this.scene.removeObjectById(this.id))}renderContainer(e){t.fillRectangle(e,this.boundingBox.left,this.boundingBox.top,this.width,this.height,{colour:"white",type:"tile"})}renderItem(e){t.renderSprite(e,m.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.x,this.transform.position.y,void 0,void 0,{centered:!0})}renderPrice(e){t.renderText(e,`$${this.price}`,this.boundingBox.right-.75,this.boundingBox.bottom,{size:12,colour:"black",font:"MS Gothic"})}renderStackSize(e){t.renderText(e,`${this.item.currentStackSize}`,this.boundingBox.right-.75,this.boundingBox.top+.75,{size:12,colour:"black",font:"MS Gothic"})}get sprite(){return ue[this.type]}}var Ee;!function(e){e.Close="tab"}(Ee||(Ee={}));const Se=[{type:E.TomatoSeeds,price:5},{type:E.WheatSeeds,price:5}];class Te extends h{constructor(t,i){super(t,i),this.scene=t,this.items=[],this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.collision.layer=e.UI_COLLISION_LAYER,this.onLeave=i.onLeave}awake(){for(let e=0;e<Se.length;e++){const t=Se[e];this.items.push(new xe(this.scene,{positionX:this.transform.position.x+2+2.5*e,positionY:this.transform.position.y+2,price:t.price,type:t.type}))}const e=this.scene.globals.hotbar_size;for(let t=0;t<5;t++)for(let i=0;i<4;i++){const s=t+5*i+e,n=this.inventory[s];void 0!==n&&this.items.push(new Ie(this.scene,{positionX:this.transform.position.x+19+2.5*t,positionY:this.transform.position.y+3+2.5*i,item:n,index:s}))}this.items.forEach((e=>this.scene.addObject(e)))}update(e){this.updateButtonClose(),this.updateClickClose()}render(e){this.renderBackground(e),this.renderShopBackground(e),this.renderShopTitle(e),this.renderInventoryBackground(e),this.renderInventoryTitle(e),this.renderTotalGold(e),this.renderLeaveButton(e)}destroy(){this.items.forEach((e=>this.scene.removeObjectById(e.id)))}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}updateButtonClose(){s.isKeyPressed(Ee.Close)&&(s.clearKeyPressed(Ee.Close),this.close())}updateClickClose(){s.isMousePressed(i.Left)&&n.isMouseWithinBoundary(s.mouse.position,21.5,12,4.5,1.5)&&(s.clearMousePressed(i.Left),this.close())}close(){this.scene.removeObjectById(this.id),this.onLeave&&this.onLeave()}renderBackground(e){t.fillRectangle(e,0,0,32,18,{colour:"#00000055",type:"tile"})}renderShopBackground(e){t.fillRectangle(e,1,1,14,10,{colour:"brown",type:"tile"})}renderShopTitle(e){t.fillRectangle(e,4,.25,8,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,"Shop (buy)",6,1.25,{size:12,colour:"black",font:"MS Gothic"})}renderInventoryBackground(e){t.fillRectangle(e,17,1,14,11.75,{colour:"brown",type:"tile"})}renderInventoryTitle(e){t.fillRectangle(e,20,.25,8,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,"Inventory (sell)",21,1.25,{size:12,colour:"black",font:"MS Gothic"})}renderTotalGold(e){t.fillRectangle(e,26.5,12,4.5,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,`Gold: ${this.scene.globals.gold}`,27,13,{size:12,colour:"black",font:"MS Gothic"})}renderLeaveButton(e){t.fillRectangle(e,21.5,12,4.5,1.5,{colour:"grey",type:"tile"}),t.renderText(e,"Leave",22.5,13,{size:12,colour:"black",font:"MS Gothic"})}}const _e={tileset:"tileset_player",x:1,y:1},Ce={idle:new de("tileset_player",[{spriteX:1,spriteY:1,duration:.5},{spriteX:4,spriteY:1,duration:.5}]),moving:new de("tileset_player",[])};class we extends pe{constructor(e,t){t.animations=Ce,super(e,t),this.scene=e,this.firstConversation=!0}update(e){super.update(e)}interact(){this.scene.globals.disable_player_inputs=!0,this.firstConversation?this.startStageFirstConversation():this.startStageGreeting()}startStageFirstConversation(){this.scene.addObject(new w(this.scene,{text:"Hi, I don't think we've met. I'm the shop keeper. I have farming supplies for sale and will buy most things you grow.",portrait:_e,name:"???",onComplete:()=>{this.firstConversation=!1,this.startStageGreeting()}}))}startStageGreeting(){this.scene.globals.disable_player_inputs=!0,this.scene.addObject(new w(this.scene,{text:"Welcome to my shop, how can I help?",portrait:_e,name:"Shopkeeper",onComplete:()=>{this.scene.addObject(new Te(this.scene,{positionX:0,positionY:0,onLeave:this.leaveShopCallback}))}}))}leaveShopCallback(){this.scene.addObject(new w(this.scene,{text:"Thanks, come again any time!",portrait:_e,name:"Shopkeeper",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}))}}class Le{}Le.TopLeft={x:1,y:0},Le.TopRight={x:3,y:0},Le.BottomLeft={x:1,y:2},Le.BottomRight={x:3,y:2},Le.MiddleHorizontal={x:2,y:3},Le.MiddleVertical={x:0,y:1},Le.FencePost={x:0,y:3},Le.Open={x:.5,y:3};class Ye extends h{constructor(e,t){super(e,t),this.scene=e,this.type=Le.FencePost,this.open=!1,this.collision.enabled=!0,this.renderer.enabled=!0,t.type&&(this.type=t.type)}render(e){t.renderSprite(e,m.images.tileset_fence,this.open?Le.Open.x:this.type.x,this.open?Le.Open.y:this.type.y,this.transform.position.x,this.transform.position.y,1,1,{centered:!0})}interact(){}}const Xe=e.CANVAS_TILE_WIDTH/2,Ae=e.CANVAS_TILE_HEIGHT/2;class ke extends h{constructor(t,i){var s,n,o,r,a;super(t,i),this.scene=t,this.animationTimer=0,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.animationType=null!==(s=i.animationType)&&void 0!==s?s:"block",this.animationDirection=null!==(n=i.animationDirection)&&void 0!==n?n:"in",this.animationLength=null!==(o=i.animationLength)&&void 0!==o?o:1,this.animationCenterX=null!==(r=i.animationCenterX)&&void 0!==r?r:Xe,this.animationCenterY=null!==(a=i.animationCenterY)&&void 0!==a?a:Ae}update(e){this.animationTimer+=e,this.animationTimer>this.animationLength&&this.scene.removeObjectById(this.id)}get animationPercentage(){return this.animationTimer/this.animationLength}render(e){switch(this.animationType){case"block":this.renderAnimationBlock(e);break;case"circle":this.renderAnimationCircle(e)}}renderAnimationBlock(i){let s="in"===this.animationDirection?1-this.animationPercentage:this.animationPercentage;t.fillRectangle(i,0,0,e.CANVAS_WIDTH,e.CANVAS_HEIGHT,{colour:`rgba(0, 0, 0, ${s})`})}renderAnimationCircle(t){let i="in"===this.animationDirection?this.animationPercentage:1-this.animationPercentage,s=this.animationCenterX-this.scene.globals.camera.startX,n=this.animationCenterY-this.scene.globals.camera.startY;t.fillStyle="black",t.beginPath(),t.arc(s*e.TILE_SIZE,n*e.TILE_SIZE,e.CANVAS_WIDTH*i,0,2*Math.PI),t.rect(e.CANVAS_WIDTH,0,-1*e.CANVAS_WIDTH,e.CANVAS_HEIGHT),t.fill()}}const je={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},Be={...je,animationFrames:[{spriteX:9.5,spriteY:4}]},He={...je,animationFrames:[{spriteX:10.5,spriteY:4}]},Oe={...je,animationFrames:[{spriteX:8.5,spriteY:5}]},Me={...je,animationFrames:[{spriteX:9.5,spriteY:5}]},Ne={...je,animationFrames:[{spriteX:10.5,spriteY:5}]},Re={index:1,tiles:[[],[],[],[],[],[],[],[],[],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Oe,{...je,animationFrames:[{spriteX:8.5,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,Be,Me,{...je,animationFrames:[{spriteX:9.5,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,He,Ne,{...je,animationFrames:[{spriteX:10.5,spriteY:6}]}],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]},Pe=()=>{};class De extends h{constructor(e,t){var i,s,n;super(e,t),this.scene=e,this.timer=0,this.intervalsComplete=0,this.duration=null!==(i=t.duration)&&void 0!==i?i:1,this.onInterval=null!==(s=t.onInterval)&&void 0!==s?s:Pe,this.onDestroy=null!==(n=t.onDestroy)&&void 0!==n?n:void 0,this.maxIntervals=t.maxIntervals}update(e){this.timer+=e,this.timer>=this.duration&&(this.onInterval(),this.timer-=this.duration,this.intervalsComplete++,this.maxIntervals&&this.intervalsComplete>=this.maxIntervals&&this.scene.removeObjectById(this.id))}destroy(){this.onDestroy&&this.onDestroy()}}class Fe extends o{constructor(e){super(e),this.scene=e,this.height=100,this.width=100,this.backgroundLayers=[U,re,ee,Re],this.objects=[],n.setCursor(this.scene.displayContext.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.objects.push(new he(e,{positionX:16,positionY:16}));let t=new F(e,{positionX:10,positionY:9});this.objects.push(t),this.objects.push(new we(e,{positionX:2,positionY:14})),this.objects.push(new V(e,{positionX:10,positionY:13,follows:t,canLayEggs:!0,canMove:!0}));for(let t=0;t<5;t++)for(let i=0;i<16;i++)this.objects.push(new k(e,{positionX:2+i,positionY:2+t,growing:{stage:X.FullyGrown,itemType:E.WheatSeeds}}));for(let t=0;t<6;t++)for(let i=0;i<3;i++)this.objects.push(new k(e,{positionX:6+i,positionY:10+t,growing:{stage:X.FullyGrown,itemType:E.WheatSeeds}}));for(let t=0;t<4;t++)for(let i=0;i<4;i++)this.objects.push(new k(e,{positionX:21+i,positionY:6+t,growing:{stage:X.FullyGrown,itemType:E.WheatSeeds}}));for(let t=0;t<6;t++)for(let i=0;i<13;i++)this.objects.push(new k(e,{positionX:12+i,positionY:10+t,growing:{stage:X.FullyGrown,itemType:E.WheatSeeds}}));this.objects.push(new Ye(e,{positionX:26,positionY:0,type:Le.FencePost}));for(let t=0;t<19;t++)for(let i=0;i<1;i++){let i=18===t?Le.FencePost:Le.MiddleVertical;this.objects.push(new Ye(e,{positionX:27,positionY:0+t,type:i}))}for(let t=0;t<1;t++)for(let t=0;t<28;t++){let i=27===t?Le.BottomRight:Le.MiddleHorizontal;this.objects.push(new Ye(e,{positionX:0+t,positionY:18,type:i}))}this.objects.push(new te(e,{positionX:25,positionY:1.5,height:4})),this.objects.push(new te(e,{positionX:19,positionY:5.5,height:4})),this.objects.push(new te(e,{positionX:22.5,positionY:4,width:6})),this.objects.push(new te(e,{positionX:6.5,positionY:8,width:6})),this.objects.push(new te(e,{positionX:15,positionY:8,width:9})),this.objects.push(new te(e,{positionX:4,positionY:11.5,height:6})),this.objects.push(new te(e,{positionX:2.25,positionY:15,width:4.5})),this.objects.push(new Ye(e,{positionX:0,positionY:16,type:Le.FencePost})),this.objects.push(new Ye(e,{positionX:0,positionY:17,type:Le.FencePost})),this.objects.push(new Ye(e,{positionX:0,positionY:18,type:Le.FencePost})),this.objects.push(new ae(e,{object:t})),this.objects.push(new ke(e,{animationCenterX:t.transform.position.x,animationCenterY:t.transform.position.y,animationType:"circle",animationLength:3})),this.objects.push(new De(this.scene,{duration:4.5,onInterval:()=>{let e=v.randomIntFromRange(19,28),t=v.randomIntFromRange(0,2),i="",s=0,n=0;0===t||1===t?(i="tileset_egg",s=1,n=0):(i="tileset_chicken",s=0,n=-.25),this.scene.addObject(new x(this.scene,{positionX:40,positionY:e,targetX:-1,targetY:e,tileset:i,spriteX:s,spriteY:n,destroyAtTarget:!0}))}}))}}class We{constructor(e){this.client=e,this.backgroundLayersAnimationTimer={},this.objects=[],this.globals={camera:{startX:0,startY:0,endX:0,endY:0}},this.flaggedForMapChange=void 0,this.renderingContext={background:[],objects:[]},this.backgroundLayerAnimationFrame={},this.renderContext=this.client.renderContext,this.displayContext=this.client.displayContext}frame(e){this.awakeObjects(),this.renderBackground(e),this.updateObjects(e),this.renderObjects(e),this.customRenderer?this.customRenderer(this.renderingContext):this.defaultRenderer(),this.destroyObjects(e)}awakeObjects(){this.client.debug.timing.frameUpdate&&console.time("[frame] awake");for(let e=0;e<this.objects.length;e++){const t=this.objects[e];t.flags.awake||(t.flags.awake=!0,void 0!==t.awake&&t.awake())}this.client.debug.timing.frameUpdate&&console.timeEnd("[frame] awake")}renderBackground(e){this.client.debug.timing.frameBackground&&console.time("[frame] background"),this.backgroundLayers.forEach(((i,s)=>{let n=this.renderingContext.background[s];t.clearCanvas(n);for(let s=0;s<this.map.width+1;s++)for(let o=0;o<this.map.height+1;o++){let r,a=i.tiles[s]?i.tiles[s][o]:void 0;if(void 0!==a){if(1===a.animationFrames.length)r=a.animationFrames[0];else{let t;void 0===this.backgroundLayersAnimationTimer[i.index]&&(this.backgroundLayersAnimationTimer[i.index]={}),void 0===this.backgroundLayersAnimationTimer[i.index][s]&&(this.backgroundLayersAnimationTimer[i.index][s]={}),t=void 0===this.backgroundLayersAnimationTimer[i.index][s][o]?0:this.backgroundLayersAnimationTimer[i.index][s][o]+e,t>a.animationFrameDuration&&(t%=a.animationFrameDuration);for(let e=0;e<a.animationMap.length;e++)if(t<=a.animationMap[e]){r=a.animationFrames[e];break}this.backgroundLayersAnimationTimer[i.index][s][o]=t}t.renderSprite(n,m.images[a.tileset],r.spriteX,r.spriteY,s-.5,o-.5)}}})),this.client.debug.timing.frameBackground&&console.timeEnd("[frame] background")}updateObjects(e){this.client.debug.timing.frameUpdate&&console.time("[frame] update");for(let t=0;t<this.objects.length;t++){const i=this.objects[t];i.flags.update&&void 0!==i.update&&i.update(e)}this.client.debug.timing.frameUpdate&&console.timeEnd("[frame] update")}renderObjects(e){this.client.debug.timing.frameRender&&console.time("[frame] render"),this.renderingContext.objects.forEach((e=>{t.clearCanvas(e)}));for(let e=0;e<this.objects.length;e++){const t=this.objects[e];t.flags.render&&(this.client.debug.object.renderBackground&&t.debuggerRenderBackground(this.renderingContext.objects[t.renderer.layer]),t.render&&t.renderer.enabled&&t.render(this.renderingContext.objects[t.renderer.layer]),this.client.debug.object.renderBoundary&&t.debuggerRenderBoundary(this.renderingContext.objects[t.renderer.layer]))}this.client.debug.timing.frameRender&&console.timeEnd("[frame] render")}destroyObjects(e){this.client.debug.timing.frameDestroy&&console.time("[frame] destroy");for(let e=0;e<this.objects.length;e++){const t=this.objects[e];t.flags.destroy&&this.removeObjectById(t.id)}this.client.debug.timing.frameDestroy&&console.timeEnd("[frame] destroy")}defaultRenderer(){this.globals.camera.startX=0,this.globals.camera.startY=0,this.globals.camera.endX=0,this.globals.camera.endY=0,this.renderingContext.background.forEach((e=>{this.renderContext.drawImage(e.canvas,0,0)})),this.renderingContext.objects.forEach((e=>{this.renderContext.drawImage(e.canvas,0,0)}))}addObject(e){this.objects.push(e)}removeObjectById(e){let t=this.objects.find((t=>t.id===e));void 0!==t&&(t.destroy&&t.destroy(),this.objects.splice(this.objects.indexOf(t),1))}getObjectsByType(e){return this.objects.filter((t=>t instanceof e))}hasCollisionAtPosition(e,t,i){for(const s of this.objects)if(s.collision.enabled&&s!==i&&e<s.boundingBox.right&&e>s.boundingBox.left&&t<s.boundingBox.bottom&&t>s.boundingBox.top)return!0;return!1}hasCollisionAtBoundingBox(e,t){for(const i of this.objects)if(i.collision.enabled&&i!==t&&e.left<i.boundingBox.right&&e.right>i.boundingBox.left&&e.top<i.boundingBox.bottom&&e.bottom>i.boundingBox.top)return i}isOutOfBounds(e,t){return e>this.map.width-1||t>this.map.height-1||e<0||t<0}getObjectAtPosition(e,t,i){for(const s of this.objects)if(s!==i&&e<s.boundingBox.right&&e>s.boundingBox.left&&t<s.boundingBox.bottom&&t>s.boundingBox.top)return s}getAllObjectsAtPosition(t,i,s){return this.objects.filter((s=>s.transform.position.x===t&&s.transform.position.y===i&&s.collision.layer!==e.UI_COLLISION_LAYER))}removeAllObjects(){for(;this.objects.length>0;)this.removeObjectById(this.objects[0].id)}removeAllBackgroundLayers(){this.backgroundLayers=[]}setUpRenderingContexts(){this.renderingContext={background:[],objects:[]};for(let e=0;e<this.backgroundLayers.length;e++){let i=this.createCanvas();this.renderingContext.background[e]=t.getContext(i)}for(let i=0;i<e.OBJECT_RENDERING_LAYERS;i++){let e=this.createCanvas();this.renderingContext.objects[i]=t.getContext(e)}}createCanvas(){let e=t.createCanvas(this.map.width,this.map.height);return this.client.debug.ui.canvasLayers&&this.client.container.append(e),e}flagForMapChange(e){this.flaggedForMapChange=e}changeMap(e){void 0!==this.map&&this.map.destroy(),this.removeAllObjects(),this.removeAllBackgroundLayers(),console.log("[Scene] changing map to",e),this.map=Reflect.construct(e,[this]),this.backgroundLayers.push(...this.map.backgroundLayers),this.objects.push(...this.map.objects),this.setUpRenderingContexts(),this.flaggedForMapChange=void 0}changeScene(e){this.client.changeScene(e)}setCustomRenderer(e){this.customRenderer=e}removeCustomerRenderer(){this.customRenderer=void 0}addEventListener(e,t){console.log("addEventListener is deprecated. refactor your code.")}removeEventListener(e,t){console.log("removeEventListener is deprecated. refactor your code.")}dispatchEvent(e,t){console.log("dispatchEvent is deprecated. refactor your code.")}}class Ge extends We{constructor(e){super(e),this.globals={...this.globals,inventory:[new fe(this,{type:E.Hoe}),new fe(this,{type:E.WateringCan}),new fe(this,{type:E.WheatSeeds,currentStackSize:5}),void 0],inventory_size:25,hotbar_size:5,hotbar_selected_index:0,disable_player_inputs:!1,gold:0},this.changeMap(Fe)}get firstFreeInventorySpaceIndex(){for(let e=0;e<this.globals.inventory_size;e++)if(void 0===this.globals.inventory[e])return e}getFirstInventoryItemWithRoomInStack(e){for(let t=0;t<this.globals.inventory_size;t++){let i=this.globals.inventory[t];if(void 0!==i&&i.type===e&&i.currentStackSize<i.maxStackSize)return i}}addToInventory(e){let t=this.getFirstInventoryItemWithRoomInStack(e);if(void 0!==t)return void t.currentStackSize++;let i=this.firstFreeInventorySpaceIndex;if(void 0===i)return;let s=new fe(this,{type:e});this.globals.inventory[i]=s}removeFromInventory(e){let t=this.globals.inventory[e];void 0!==t&&(t.currentStackSize--,t.currentStackSize<=0&&(this.globals.inventory[e]=void 0))}get selectedInventoryItem(){return this.globals.inventory[this.globals.hotbar_selected_index]}get selectedInventoryIndex(){return this.globals.hotbar_selected_index}}class Ve extends h{constructor(e,t){super(e,t),this.scene=e,this.width=6,this.height=2,this.clicked=!1,this.renderer.enabled=!0}update(e){this.updateClickStart(),this.updateClickEnd()}render(e){this.renderStartButton(e)}renderStartButton(e){t.renderSprite(e,m.images.tileset_button,this.clicked?6:0,2,this.transform.position.x,this.transform.position.y,this.width,this.height,{centered:!0})}updateClickStart(){n.wasObjectClicked(this)&&(this.clicked=!0)}updateClickEnd(){!0!==s.mouse.click.left&&!1!==this.clicked&&(n.isMouseWithinObject(this)?this.scene.changeScene(Ge):this.clicked=!1)}}const ze=e.CANVAS_TILE_HEIGHT,Ze=e.CANVAS_TILE_WIDTH;class Ue extends o{constructor(e){super(e),this.scene=e,this.height=ze,this.width=Ze,this.backgroundLayers=[b],this.objects=[],n.setCursor(this.scene.displayContext.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.objects.push(new Ve(e,{renderLayer:15,positionX:16,positionY:9})),this.objects.push(new I(e,{}))}}class Ke extends We{constructor(e){super(e),this.client=e,this.changeMap(Ue)}}!function(){var e;const t=new URLSearchParams(window.location.search).get("scene"),i=null!==(e={"main-menu":Ke,game:Ge}[t])&&void 0!==e?e:Ke;m.initialise({images:{tileset_sample:"assets/16x16.png",tileset_grass:"assets/sample/Tilesets/Grass.png",tileset_hills:"assets/sample/Tilesets/Hills.png",tileset_water:"assets/sample/Tilesets/Water.png",tileset_player:"assets/sample/Characters/Basic Charakter Spritesheet.png",tileset_chicken:"assets/sample/Characters/Free Chicken Sprites.png",tileset_fence:"assets/sample/Tilesets/Fences.png",tileset_egg:"assets/sample/Characters/Egg_And_Nest.png",tileset_house:"assets/sample/Tilesets/Wooden House.png",tileset_dirt:"assets/sample/Tilesets/Tilled_Dirt.png",tileset_button:"assets/sample/UI Big Play Button.png",tileset_ui:"assets/sample/Sprite sheet for Basic Pack.png",tileset_wood_bridge:"assets/sample/Objects/Wood_Bridge.png",tileset_chest:"assets/sample/Objects/Chest.png",tileset_plants:"assets/sample/Objects/Basic_Plants.png",tileset_dialogue_box:"assets/sample/Dialouge UI/dialog box.png",tileset_tools:"assets/sample/Characters/Tools.png"},audio:{}}),l.initHelpers(),window.engine=new c(document.getElementById("render-area"),i,l.engineMapList,l.engineObjectList,l.engineObjectDetails,l.engineControls)}()})();