(()=>{"use strict";class e{static get CANVAS_HEIGHT(){return e.TILE_SIZE*e.CANVAS_TILE_HEIGHT}static get CANVAS_WIDTH(){return e.TILE_SIZE*e.CANVAS_TILE_WIDTH}static get ASPECT_RATIO(){return e.CANVAS_TILE_HEIGHT/e.CANVAS_TILE_WIDTH}static get UI_RENDER_LAYER(){return e.OBJECT_RENDERING_LAYERS-1}static get UI_COLLISION_LAYER(){return e.OBJECT_COLLISION_LAYERS-1}static get CANVAS_CENTER_TILE_Y(){return this.CANVAS_TILE_HEIGHT/2}static get CANVAS_CENTER_TILE_X(){return this.CANVAS_TILE_WIDTH/2}static get CANVAS_CENTER_PIXEL_X(){return e.CANVAS_WIDTH/2}static get CANVAS_CENTER_PIXEL_Y(){return e.CANVAS_HEIGHT/2}}e.CANVAS_TILE_HEIGHT=18,e.CANVAS_TILE_WIDTH=32,e.TILE_SIZE=16,e.OBJECT_RENDERING_LAYERS=16,e.OBJECT_COLLISION_LAYERS=16,e.CONTEXT_IMAGE_SMOOTHING_ENABLED=!1;class t{static renderSprite(t,i,s,o,n,r,a,l,h={}){var d,c;let p=a?a*e.TILE_SIZE:e.TILE_SIZE,m=l?l*e.TILE_SIZE:e.TILE_SIZE,u=null!==(d=h.scale)&&void 0!==d?d:1,g=null!==(c=h.rotation)&&void 0!==c?c:0,b=h.opacity&&h.opacity<1,y=0!==g,v=b||y;if(v&&(t.save(),b&&(t.globalAlpha=Math.max(0,h.opacity)),y)){let i=Math.floor((n+a/2)*e.TILE_SIZE)+.5,s=Math.floor((r+l/2)*e.TILE_SIZE)+.5;t.translate(i,s),t.rotate(g*Math.PI/180),t.translate(-i,-s)}let f=Math.floor(p/2),x=Math.floor(m/2);h.centered&&t.translate(-f,-x),t.drawImage(i,s*e.TILE_SIZE,o*e.TILE_SIZE,p,m,Math.floor(n*e.TILE_SIZE),Math.floor(r*e.TILE_SIZE),p*u,m*u),h.centered&&t.translate(f,x),v&&t.restore()}static renderSubsection(t,i,s,o,n,r){let a=Math.floor(s*e.TILE_SIZE),l=Math.floor(o*e.TILE_SIZE),h=Math.floor(n*e.TILE_SIZE),d=Math.floor(r*e.TILE_SIZE);i.drawImage(t.canvas,a,l,h-a,d-l,0,0,i.canvas.width,i.canvas.height)}static renderCircle(t,i,s,o={}){t.beginPath(),t.arc(i*e.TILE_SIZE+e.TILE_SIZE/2,s*e.TILE_SIZE+e.TILE_SIZE/2,e.TILE_SIZE/2,0,2*Math.PI),t.stroke(),t.fillStyle=o.colour||"saddlebrown",t.fill()}static fillRectangle(t,i,s,o,n,r={}){t.strokeStyle=r.colour?r.colour:"black",t.fillStyle=r.colour?r.colour:"black",t.beginPath(),t.rect(Math.floor(i*e.TILE_SIZE)+.5,Math.floor(s*e.TILE_SIZE)+.5,o*("tile"===r.type?e.TILE_SIZE:1)-1,n*("tile"===r.type?e.TILE_SIZE:1)-1),t.stroke(),t.fill()}static strokeRectangle(t,i,s,o,n,r={}){var a;t.strokeStyle=null!==(a=r.colour)&&void 0!==a?a:"black",t.lineWidth=1;let l="tile"===r.type?Math.floor(i*e.TILE_SIZE):i,h="tile"===r.type?Math.floor(s*e.TILE_SIZE):s,d="tile"===r.type?Math.floor(o*e.TILE_SIZE):o,c="tile"===r.type?Math.floor(n*e.TILE_SIZE):n;t.strokeRect(l+.5,h+.5,d-1,c-1)}static clearCanvas(e){e.clearRect(0,0,e.canvas.width,e.canvas.height)}static createCanvas(t,i){const s=document.createElement("canvas");return s.width=t?t*e.TILE_SIZE:e.CANVAS_WIDTH,s.height=i?i*e.TILE_SIZE:e.CANVAS_HEIGHT,s}static getContext(t){let i=t.getContext("2d");return i.imageSmoothingEnabled=e.CONTEXT_IMAGE_SMOOTHING_ENABLED,i}static positionToPixelPosition(t){return t*e.TILE_SIZE}static renderText(t,i,s,o,n={}){let r=n.size?n.size:16,a=n.colour?n.colour:"black",l=n.font?n.font:"Helvetica";t.font=`${r}px ${l}`,t.fillStyle=`${a}`,t.fillText(i,s*e.TILE_SIZE,o*e.TILE_SIZE)}static textToArray(e,t,i={}){var s,o;let n=null!==(s=i.size)&&void 0!==s?s:16,r=null!==(o=i.colour)&&void 0!==o?o:"black",a=i.font?i.font:"Helvetica",l=document.createElement("canvas").getContext("2d");l.font=`${n}px ${a}`,l.fillStyle=`${r}`;let h=e.split(" "),d="",c=[];for(let e=0;e<h.length;e++){let i=`${d} ${h[e]}`;l.measureText(i).width>=t?(c.push(i),d=""):h.length-1!==e?d=i.trim():c.push(i)}return c}}var i;!function(e){e.Left="left",e.Middle="middle",e.Right="right"}(i||(i={}));class s{static isKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)if(this.keyboard[t])return!0;return!1}static setKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)this.keyboard[t]=!0}static clearKeyPressed(e){Array.isArray(e)||(e=[e]);for(const t of e)this.keyboard[t]=!1}static isMousePressed(e=i.Left){return this.mouse.click[e]}static clearMousePressed(e=i.Left){this.mouse.click[e]=!1}}s.keyboard={},s.mouse={click:{left:!1,middle:!1,right:!1},position:{x:0,y:0},wheel:{event:new WheelEvent("")},latestEvent:new MouseEvent("")};class o{static getMousePosition(t,i){let s,o=t.getBoundingClientRect(),n={height:o.height,width:o.width},r={clientX:i.clientX,clientY:i.clientY};if(t.width>t.height){s=t.width/o.width,n.height=t.height/s;let e=o.height-n.height;r.clientY-=e/2}else{s=t.height/o.height,n.width=t.width/s;let e=o.width-n.width;r.clientX-=e/2}let a=t.width/n.width,l=t.height/n.height;return{x:(r.clientX-o.left)*a/e.TILE_SIZE,y:(r.clientY-o.top)*l/e.TILE_SIZE}}static setCursor(e,t){e.style.cursor=`url("${t}"), auto`}static get isFullscreen(){return null!==document.fullscreenElement}static isMouseWithinBoundary(e,t,i,s,o){return e.x>=t&&e.x<=t+s&&e.y>=i&&e.y<=i+o}static isMouseWithinObject(e){return!!this.isMouseWithinBoundary(s.mouse.position,e.boundingBox.world.left,e.boundingBox.world.top,e.width,e.height)}static wasObjectClicked(e){return!!s.mouse.click.left&&!!this.isMouseWithinObject(e)}}class n{constructor(e){this.scene=e,this.globals={}}destroy(){}}class r{constructor(e,t){this.x=e,this.y=t}get roundedX(){return Math.round(this.x)}get roundedY(){return Math.round(this.y)}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){let e=this.magnitude;return 0===e?new r(0,0):new r(this.x/e,this.y/e)}add(e){return new r(this.x+e.x,this.y+e.y)}subtract(e){return new r(this.x-e.x,this.y-e.y)}multiply(e){return new r(this.x*e,this.y*e)}divide(e){return new r(this.x/e,this.y/e)}}const a=!1;class l{constructor(e,t){var i,s,o,n,l,h,d,c,p,m;this.scene=e,this.id=crypto.randomUUID(),this.width=1,this.height=1,this.children=new Map,this.parent=void 0;const u=this;this.mainContext=this.scene.renderContext,this.transform={position:{local:new r(0,0),get world(){return u.calculateWorldPosition()}},scale:1,rotation:0},this.collision={enabled:a,layer:0},this.renderer={enabled:!1,layer:0,opacity:1,scale:1},this.flags={awake:!1,update:!0,render:!0,destroy:!1},this.transform.position.local.x=null!==(i=t.positionX)&&void 0!==i?i:this.transform.position.local.x,this.transform.position.local.y=null!==(s=t.positionY)&&void 0!==s?s:this.transform.position.local.y,this.collision.enabled=null!==(o=t.collisionEnabled)&&void 0!==o?o:a,this.collision.layer=null!==(n=t.collisionLayer)&&void 0!==n?n:0,this.renderer.enabled=null!==(l=t.renderEnabled)&&void 0!==l?l:this.renderer.enabled,this.renderer.layer=null!==(h=t.renderLayer)&&void 0!==h?h:this.renderer.layer,this.renderer.opacity=null!==(d=t.renderOpacity)&&void 0!==d?d:this.renderer.opacity,this.renderer.scale=null!==(c=t.renderScale)&&void 0!==c?c:this.renderer.scale,this.width=null!==(p=t.width)&&void 0!==p?p:this.width,this.height=null!==(m=t.height)&&void 0!==m?m:this.height,void 0!==t.onAwake&&(this.onAwake=t.onAwake),void 0!==t.onUpdate&&(this.onUpdate=t.onUpdate),void 0!==t.onRender&&(this.onRender=t.onRender),void 0!==t.onDestroy&&(this.onDestroy=t.onDestroy)}awake(){this.flags.awake||(this.flags.awake=!0,void 0!==this.onAwake&&this.onAwake())}update(e){this.flags.update&&void 0!==this.onUpdate&&this.onUpdate(e)}render(e){this.renderer.enabled&&this.flags.render&&void 0!==this.onRender&&this.onRender(e)}destroy(){this.flags.destroy=!0,this.children.forEach((e=>{e.destroy()}))}get boundingBox(){return{local:l.calculateBoundingBox(this.transform.position.local.x,this.transform.position.local.y,this.width,this.height),world:l.calculateBoundingBox(this.transform.position.world.x,this.transform.position.world.y,this.width,this.height)}}debuggerRenderBoundary(e){t.strokeRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"red",type:"tile"})}debuggerRenderBackground(i){t.fillRectangle(i,this.boundingBox.world.left,this.boundingBox.world.top,Math.floor(this.width*e.TILE_SIZE),Math.floor(this.height*e.TILE_SIZE),{colour:"red"})}isCollidingWith(e){return this.isWithinHorizontalBounds(e)&&this.isWithinVerticalBounds(e)}isWithinHorizontalBounds(e){return e.boundingBox.world.left>=this.boundingBox.world.left&&e.boundingBox.world.left<=this.boundingBox.world.right||e.boundingBox.world.right>=this.boundingBox.world.left&&e.boundingBox.world.right<=this.boundingBox.world.right}isWithinVerticalBounds(e){return e.boundingBox.world.top>=this.boundingBox.world.top&&e.boundingBox.world.top<=this.boundingBox.world.bottom||e.boundingBox.world.bottom>=this.boundingBox.world.top&&e.boundingBox.world.bottom<=this.boundingBox.world.bottom}static calculateBoundingBox(e,t,i,s){let o=i/2,n=s/2;return{top:t-n,right:e+o,bottom:t+n,left:e-o}}addChild(e){this.children.set(e.id,e),e.parent=this,this.scene.addObject(e)}removeChild(e){void 0!==this.children.get(e.id)&&e.destroy()}removeAllChildren(){this.children.forEach((e=>{this.removeChild(e)}))}calculateWorldPosition(){return void 0===this.parent?new r(this.transform.position.local.x,this.transform.position.local.y):new r(this.transform.position.local.x+this.parent.transform.position.world.x,this.transform.position.local.y+this.parent.transform.position.world.y)}}class h extends l{constructor(e,t){super(e,t),this.scene=e,this.isColliding=!1,this.renderer.enabled=!0,t.width&&(this.width=t.width),t.height&&(this.height=t.height)}onUpdate(e){this.updateCollision()}onRender(e){let i=this.isColliding?"green":"red";t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:i,type:"tile"})}updateCollision(){if(this.collision.enabled){for(const[,e]of this.scene.objects)if(e!==this&&this.boundingBox.world.left<e.boundingBox.world.right&&this.boundingBox.world.right>e.boundingBox.world.left&&this.boundingBox.world.top<e.boundingBox.world.bottom&&this.boundingBox.world.bottom>e.boundingBox.world.top)return void(this.isColliding=!0);this.isColliding=!1}}}class d extends l{constructor(e,t){super(e,t),this.scene=e,this.timer=0,this.grow=!0,this.renderer.enabled=!0}onUpdate(e){this.timer+=e,this.timer>2&&(this.grow=!this.grow,this.timer=0),this.transform.position.local.x+=(this.grow?1:-1)*e,this.transform.position.local.y+=(this.grow?1:-1)*e}onRender(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"red",type:"tile"})}}class c{static get engineMapList(){return document.getElementById("map-list")||null}static get engineObjectList(){return document.getElementById("object-list")||null}static get engineObjectDetails(){return document.getElementById("object-details")||null}static get engineControls(){return{gridLines:document.getElementById("btnGridLines"),gridNumbers:document.getElementById("btnGridNumbers"),breakpoint:document.getElementById("btnBreakpoint"),fps:document.getElementById("btnFps"),objectCount:document.getElementById("btnObjectCount"),timingFrame:document.getElementById("btnTimingFrame"),timingFrameBackground:document.getElementById("btnTimingFrameBackground"),timingFrameRender:document.getElementById("btnTimingFrameRender"),timingFrameUpdate:document.getElementById("btnTimingFrameUpdate"),canvasLayers:document.getElementById("btnCanvasLayers"),fullscreen:document.getElementById("btnFullscreen"),renderBoundary:document.getElementById("btnRenderBoundary"),renderBackground:document.getElementById("btnRenderBackground")}}static initHelpers(){window.o=e=>window.engine.scene.objects.get(e)}static changeScene(e){window.engine.changeScene(e)}static changeMap(e){window.engine.scene.changeMap(e)}}c.TEST_MAPS=[{name:"collision test",map:class extends n{constructor(e){super(e),this.scene=e,this.height=18,this.width=30,this.backgroundLayers=[],this.objects=[],this.initialiseNotColliding(),this.initialiseColliding()}initialiseNotColliding(){this.objects.push(new h(this.scene,{positionX:1.5,positionY:1.5})),this.objects.push(new h(this.scene,{positionX:2.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:1.5,positionY:2.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:4.5,positionY:1.5})),this.objects.push(new h(this.scene,{positionX:5.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:5.5,positionY:2.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:1.5,positionY:4.5})),this.objects.push(new h(this.scene,{positionX:2.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:1.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:5.5,positionY:4.5})),this.objects.push(new h(this.scene,{positionX:4.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:5.5,positionY:5.5,collisionEnabled:!0}))}initialiseColliding(){this.objects.push(new h(this.scene,{positionX:7.5,positionY:1.5})),this.objects.push(new h(this.scene,{positionX:8,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:7.5,positionY:2,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:11,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:11.5,positionY:1.5})),this.objects.push(new h(this.scene,{positionX:11.5,positionY:2,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:7.5,positionY:5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:8,positionY:5.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:7.5,positionY:5.5})),this.objects.push(new h(this.scene,{positionX:11.5,positionY:5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:11,positionY:5.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:11.5,positionY:5.5})),this.objects.push(new h(this.scene,{positionX:1.5,positionY:7.5})),this.objects.push(new h(this.scene,{positionX:2,positionY:7.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:3.5,positionY:7.5})),this.objects.push(new h(this.scene,{positionX:3.5,positionY:8,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:5.001,positionY:7.501,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:6,positionY:8.5})),this.objects.push(new h(this.scene,{positionX:8.499,positionY:7.501,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:7.5,positionY:8.5})),this.objects.push(new h(this.scene,{positionX:5.001,positionY:10.999,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:6,positionY:10})),this.objects.push(new h(this.scene,{positionX:8.499,positionY:10.999,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:7.5,positionY:10})),this.objects.push(new h(this.scene,{positionX:18,positionY:5,width:6,height:6,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:14.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:21.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:14.5,positionY:5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:5})),this.objects.push(new h(this.scene,{positionX:21.5,positionY:5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:14.5,positionY:8.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:8.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:21.5,positionY:8.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:14,width:6,height:6})),this.objects.push(new h(this.scene,{positionX:14.501,positionY:10.501,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18.001,positionY:10.501,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:21.499,positionY:10.501,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:14.501,positionY:14,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:14,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:21.499,positionY:14,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:14.501,positionY:17.499,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:17.499,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:21.499,positionY:17.499,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:3.5,positionY:15,width:5,height:1,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:3.5,positionY:15,width:1,height:5})),this.objects.push(new h(this.scene,{positionX:9.5,positionY:15,width:5,height:1})),this.objects.push(new h(this.scene,{positionX:9.5,positionY:15,width:1,height:5,collisionEnabled:!0}))}}},{name:"object hierarchy test",map:class extends n{constructor(e){super(e),this.scene=e,this.height=18,this.width=30,this.backgroundLayers=[],this.objects=[];const t=new d(this.scene,{positionX:1,positionY:1}),i=new d(this.scene,{positionX:1,positionY:1}),s=new d(this.scene,{positionX:1,positionY:1}),o=new d(this.scene,{positionX:1,positionY:1});this.scene.addObject(t),t.addChild(i),i.addChild(s),s.addChild(o)}}}];class p{constructor(i,s,o,n,r,a){this.container=i,this.engineMapList=o,this.engineObjectList=n,this.engineObjectDetails=r,this.engineControls=a,this.CANVAS_HEIGHT=e.CANVAS_HEIGHT,this.CANVAS_WIDTH=e.CANVAS_WIDTH,this.delta=0,this.lastRenderTimestamp=0,this.debug={enabled:!0,stats:{fps:!1,fpsCounter:0,objectCount:!1},breakpoint:{frame:!1},timing:{frame:!1,frameBackground:!1,frameUpdate:!1,frameRender:!1,frameDestroy:!1},ui:{grid:{lines:!1,numbers:!1},canvasLayers:!1},object:{renderBoundary:!1,renderBackground:!1}},this.gamepad=void 0,this.editorTimer=0,this.debug.enabled&&(this.initialiseDebuggerState(),this.initialiseDebuggerListeners()),this.displayCanvas=this.createCanvas(),this.displayContext=t.getContext(this.displayCanvas),this.renderCanvas=this.createCanvas(),this.renderContext=t.getContext(this.renderCanvas),i.append(this.displayCanvas),document.addEventListener("visibilitychange",(e=>{"visible"===document.visibilityState?console.log("tab is active"):console.log("tab is inactive")})),this.initialiseMouseListeners(),this.initialiseKeyboardListeners(),this.intialiseGamepadListeners(),this.changeScene(s),this.frame(0)}createCanvas(){const e=t.createCanvas();return e.addEventListener("contextmenu",(e=>{e.preventDefault()})),e}changeScene(e){this.scene=Reflect.construct(e,[this])}frame(e){this.debug.breakpoint.frame,this.debug.timing.frame&&console.log(`[frame] ${this.delta}`),this.setDelta(e),t.clearCanvas(this.renderContext),this.scene.frame(this.delta),t.clearCanvas(this.displayContext),this.displayContext.drawImage(this.renderCanvas,0,0),this.debug.stats.fps&&(this.debug.stats.fpsCounter&&this.renderStats(0,"FPS",`${Math.round(1e3/(performance.now()-this.debug.stats.fpsCounter))} FPS`),this.debug.stats.fpsCounter=e),this.debug.stats.objectCount&&this.renderStats(1,"Objects",`${this.scene.objects.size} objects`),this.renderGrid(),this.scene.flaggedForMapChange&&this.scene.changeMap(this.scene.flaggedForMapChange),this.editorTimer+=this.delta,this.editorTimer>1&&(this.editor(),this.editorTimer=0),window.requestAnimationFrame(this.frame.bind(this))}setDelta(e){this.delta=(e-this.lastRenderTimestamp)/1e3,this.lastRenderTimestamp=e}renderStats(t,i,s){this.displayContext.fillStyle="red",this.displayContext.font="12px serif",this.displayContext.fillText(s,this.CANVAS_WIDTH-50,(t+1)*e.TILE_SIZE)}renderGrid(){if((this.debug.ui.grid.lines||this.debug.ui.grid.numbers)&&t.fillRectangle(this.displayContext,0,0,this.CANVAS_WIDTH,this.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.25)"}),this.debug.ui.grid.lines)for(let i=0;i<this.CANVAS_WIDTH;i+=e.TILE_SIZE)for(let s=0;s<this.CANVAS_HEIGHT;s+=e.TILE_SIZE)t.strokeRectangle(this.displayContext,i,s,e.TILE_SIZE,e.TILE_SIZE,{colour:"black"});if(this.debug.ui.grid.numbers)for(let t=0;t<e.CANVAS_TILE_WIDTH;t++)for(let i=0;i<e.CANVAS_TILE_HEIGHT;i++)this.displayContext.fillStyle="black",this.displayContext.font="8px helvetica",this.displayContext.fillText(`${t}`,t*e.TILE_SIZE+1,i*e.TILE_SIZE+8),this.displayContext.fillText(`${i}`,t*e.TILE_SIZE+6,i*e.TILE_SIZE+14)}initialiseDebuggerState(){if(void 0!==this.engineControls&&this.engineControls.renderBoundary){const e=JSON.parse(localStorage.getItem("object.renderBoundary"));this.engineControls.renderBoundary.checked=e,this.debug.object.renderBoundary=e}}initialiseDebuggerListeners(){void 0!==this.engineControls&&(this.engineControls.gridLines&&this.engineControls.gridLines.addEventListener("click",(()=>{this.debug.ui.grid.lines=!this.debug.ui.grid.lines})),this.engineControls.gridNumbers&&this.engineControls.gridNumbers.addEventListener("click",(()=>{this.debug.ui.grid.numbers=!this.debug.ui.grid.numbers})),this.engineControls.breakpoint&&this.engineControls.breakpoint.addEventListener("click",(()=>{this.debug.breakpoint.frame=!this.debug.breakpoint.frame})),this.engineControls.fps&&this.engineControls.fps.addEventListener("click",(()=>{this.debug.stats.fps=!this.debug.stats.fps})),this.engineControls.objectCount&&this.engineControls.objectCount.addEventListener("click",(()=>{this.debug.stats.objectCount=!this.debug.stats.objectCount})),this.engineControls.timingFrame&&this.engineControls.timingFrame.addEventListener("click",(()=>{this.debug.timing.frame=!this.debug.timing.frame})),this.engineControls.timingFrameBackground&&this.engineControls.timingFrameBackground.addEventListener("click",(()=>{this.debug.timing.frameBackground=!this.debug.timing.frameBackground})),this.engineControls.timingFrameRender&&this.engineControls.timingFrameRender.addEventListener("click",(()=>{this.debug.timing.frameRender=!this.debug.timing.frameRender})),this.engineControls.timingFrameUpdate&&this.engineControls.timingFrameUpdate.addEventListener("click",(()=>{this.debug.timing.frameUpdate=!this.debug.timing.frameUpdate})),this.engineControls.canvasLayers&&this.engineControls.canvasLayers.addEventListener("click",(()=>{this.debug.ui.canvasLayers=!this.debug.ui.canvasLayers})),this.engineControls.renderBoundary&&this.engineControls.renderBoundary.addEventListener("click",(()=>{this.debug.object.renderBoundary=!this.debug.object.renderBoundary,localStorage.setItem("object.renderBoundary",JSON.stringify(this.debug.object.renderBoundary))})),this.engineControls.renderBackground&&this.engineControls.renderBackground.addEventListener("click",(()=>{this.debug.object.renderBackground=!this.debug.object.renderBackground})),this.engineControls.fullscreen&&this.engineControls.fullscreen.addEventListener("click",(()=>{this.displayCanvas.requestFullscreen().catch((e=>{throw new Error(e)}))})))}initialiseKeyboardListeners(){console.log("[listener added] keydown"),document.addEventListener("keydown",(e=>{if(e.preventDefault(),e.repeat)return;console.log("[keydown]",e);let t=e.key.toLocaleLowerCase();s.setKeyPressed(t)})),console.log("[listener added] keyup"),document.addEventListener("keyup",(e=>{if(e.preventDefault(),e.repeat)return;console.log("[keyup]",e);let t=e.key.toLocaleLowerCase();s.clearKeyPressed(t)}))}initialiseMouseListeners(){console.log("[listener added] mousemove"),this.displayCanvas.addEventListener("mousemove",(e=>{s.mouse.position=o.getMousePosition(this.displayCanvas,e),s.mouse.latestEvent=e})),console.log("[listener added] mousedown"),this.displayCanvas.addEventListener("mousedown",(e=>{switch(console.log("[mousedown]",e),e.button){case 0:s.mouse.click.left=!0;break;case 1:s.mouse.click.middle=!0;break;case 2:s.mouse.click.right=!0}})),console.log("[listener added] mouseup"),this.displayCanvas.addEventListener("mouseup",(e=>{switch(console.log("[mouseup]",e),e.button){case 0:s.mouse.click.left=!1;break;case 1:s.mouse.click.middle=!1;break;case 2:s.mouse.click.right=!1}})),console.log("[listener added] touchstart"),this.displayCanvas.addEventListener("touchstart",(e=>{console.log("[touchstart]",e),s.mouse.click.left=!0})),console.log("[listener added] touchend"),this.displayCanvas.addEventListener("touchend",(e=>{console.log("[touchend]",e),s.mouse.click.left=!1})),console.log("[listener added] wheel"),this.displayCanvas.addEventListener("wheel",(e=>{console.log("[wheel]",e),s.mouse.wheel.event=e}))}intialiseGamepadListeners(){window.addEventListener("gamepadconnected",(e=>{console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.gamepad.index,e.gamepad.id,e.gamepad.buttons.length,e.gamepad.axes.length),this.gamepad=e.gamepad})),window.addEventListener("gamepaddisconnected",(e=>{this.gamepad=void 0}))}editor(){if(null===this.engineObjectList||null===this.engineMapList)return;let e=document.createElement("ul");this.engineMapList.innerHTML="",this.engineMapList.appendChild(e),[...c.TEST_MAPS].forEach((t=>{let i=document.createElement("li");i.innerHTML=t.name,e.appendChild(i),i.addEventListener("click",(()=>{c.changeMap(t.map)}))}));let t=document.createElement("ul");this.engineObjectList.innerHTML="",this.engineObjectList.appendChild(t),this.scene.objects.forEach((e=>{let i=document.createElement("li");i.innerHTML=e.constructor.name,t.appendChild(i),i.addEventListener("click",(()=>{this.engineSelectedObjectId=e.id,this.updateEngineObjectDetails()}))}))}updateEngineObjectDetails(){if(void 0===this.engineSelectedObjectId)return;if(null===this.engineObjectDetails)return;let e=this.scene.objects.get(this.engineSelectedObjectId);if(void 0===e)return;const t=this.engineObjectDetails.querySelector("#object-details-header"),i=this.engineObjectDetails.querySelector("#object-details-content");t.innerHTML=`<h3>${e.constructor.name}</h3>`,i.innerHTML="",Object.keys(e).forEach((t=>{"transform"===t?(i.innerHTML+=m(e.transform.position.local,"x"),i.innerHTML+=m(e.transform.position.local,"y")):i.innerHTML+=m(e,t)})),console.log(e)}}function m(e,t){let i="";return i+='<div style="display:flex; padding: 0.25rem 0;">',i+=`<span style="margin-right: auto;">${t}</span>`,i+=`<code>${e[t]}</code>`,i+="</div>",i}class u{static initialise(e){Object.keys(e.images).forEach((t=>{this.images[t]=new Image,this.images[t].src=e.images[t]})),Object.keys(e.audio).forEach((t=>{this.audio[t]=new Audio(e.audio[t])}))}}u.images={},u.audio={};const g={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},b=[g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g],y={index:0,tiles:[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b]};class v{static randomIntFromRange(e,t){return Math.floor(this.randomNumberFromRange(e,t))}static randomNumberFromRange(e,t){return Math.random()*(t-e+1)+e}static randomStartingDelta(e){return Math.random()*(null!=e?e:1)}}class f{get position(){return{x:this.targetX,y:this.targetY}}get target(){return{x:this.targetX,y:this.targetY}}constructor(e,t,i,s){this.positionX=e,this.positionY=t,this.targetX=i,this.targetY=s}}class x{static moveTowardsPosition(e,t){return e.targetX>e.positionX?(e.positionX+=t,e.targetX<e.positionX&&(e.positionX=e.targetX)):e.targetX<e.positionX?(e.positionX-=t,e.targetX>e.positionX&&(e.positionX=e.targetX)):e.targetY>e.positionY?(e.positionY+=t,e.targetY<e.positionY&&(e.positionY=e.targetY)):e.targetY<e.positionY&&(e.positionY-=t,e.targetY>e.positionY&&(e.positionY=e.targetY)),new f(e.positionX,e.positionY,e.targetX,e.targetY)}static moveTowardsOtherEntity(e,t){return t.positionX>e.positionX?e.targetX+=1:t.positionX<e.positionX?e.targetX-=1:t.positionY>e.positionY?e.targetY+=1:t.positionY<e.positionY&&(e.targetY-=1),new f(e.positionX,e.positionY,e.targetX,e.targetY)}static moveInRandomDirection(e){switch(v.randomIntFromRange(1,4)){case 1:e.targetX+=1;break;case 2:e.targetX-=1;break;case 3:e.targetY+=1;break;case 4:e.targetY-=1}return new f(e.positionX,e.positionY,e.targetX,e.targetY)}static frameSpeed(e,t){return e*t}static MoveTowards(e,t,i){let s=t.subtract(e),o=s.normalized.multiply(i);return o.magnitude>s.magnitude&&(o=s),o}}class w extends l{constructor(e,t){var i,s;super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.movementSpeed=.5,this.renderer.enabled=!0,this.tileset=t.tileset,this.spriteX=t.spriteX,this.spriteY=t.spriteY,this.spriteHeight=t.spriteHeight,this.spriteWidth=t.spriteWidth,this.destroyAtTarget=null!==(i=t.destroyAtTarget)&&void 0!==i&&i,this.movementSpeed=null!==(s=t.movementSpeed)&&void 0!==s?s:.5}onUpdate(e){this.updatePosition(e)}updatePosition(e){if(this.transform.position.local.x===this.targetX&&this.transform.position.local.y===this.targetY)return void(this.destroyAtTarget&&this.destroy());let t=new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=this.movementSpeed*e,s=x.moveTowardsPosition(t,i);this.transform.position.local.x=s.positionX,this.transform.position.local.y=s.positionY}onRender(e){t.renderSprite(e,u.images[this.tileset],this.spriteX,this.spriteY,this.transform.position.local.x,this.transform.position.local.y,this.spriteWidth,this.spriteWidth,{centered:!0})}}class I extends l{constructor(e,t){super(e,t),this.scene=e,this.newItemTimer=0}onUpdate(e){this.updateGenerateNewItem(e)}updateGenerateNewItem(t){if(this.newItemTimer+=t,this.newItemTimer<3)return;if(this.scene.objects.size>15)return;let i=v.randomIntFromRange(0,this.scene.map.height);this.scene.addObject(new w(this.scene,{positionX:e.CANVAS_TILE_WIDTH,positionY:i,targetX:-1,targetY:i,tileset:"tileset_egg",spriteX:1,spriteY:0,destroyAtTarget:!0})),this.newItemTimer=0}}var E,S,T;!function(e){e.Chicken="Chicken",e.Egg="Egg",e.WheatSeeds="WheatSeeds",e.Wheat="Wheat",e.TomatoSeeds="TomatoSeeds",e.Tomato="Tomato",e.Hoe="Hoe",e.WateringCan="WateringCan",e.Chest="Chest"}(E||(E={})),function(e){e.Player="Player",e.Anywhere="Anywhere",e.None="None"}(S||(S={})),function(e){e.Confirm="e",e.ConfirmAlt=" "}(T||(T={}));const C="tileset_dialogue_box",_=()=>{};class Y extends l{constructor(t,i){var s,o,n,r,a;super(t,i),this.scene=t,this.height=3,this.width=e.CANVAS_TILE_WIDTH,this.textboxWidth=e.CANVAS_TILE_WIDTH-8,this.textboxBorder=2,this.textSize=10,this.textSegments=[],this.textIndex=0,this.characterIndex=0,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.completionTimer=0,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,void 0===i.positionX&&(this.transform.position.local.x=0),void 0===i.positionY&&(this.transform.position.local.y=e.CANVAS_TILE_HEIGHT-this.height),this.showOverlay=null===(s=i.showOverlay)||void 0===s||s,this.text=null!==(o=i.text)&&void 0!==o?o:"...",this.onComplete=null!==(n=i.onComplete)&&void 0!==n?n:_,this.portrait=i.portrait,this.name=i.name,this.completionDuration=i.completionDuration,this.scrollText=null===(r=i.scrollText)||void 0===r||r,this.scrollSpeed=null!==(a=i.scrollSpeed)&&void 0!==a?a:48,this.initText()}initText(){this.textSegments=t.textToArray(this.text,(this.textboxWidth-4)*e.TILE_SIZE,{size:this.textSize})}onUpdate(e){void 0!==this.completionDuration?this.updateTimer(e):this.updateConfirm(),this.scrollText&&this.updateScrollText(e),this.updatePortraitAnimation(e)}onRender(e){this.showOverlay&&this.renderOverlay(e),this.hasPortrait&&this.renderPortrait(e),this.generateTextbox(e),this.hasNamePlate&&this.renderNamePlate(e),this.renderText(e)}updateTimer(e){this.completionTimer+=e,this.completionTimer>=this.completionDuration&&(this.onComplete&&this.onComplete(),this.destroy())}updateScrollText(e){this.currentText.length>this.characterIndex&&(this.characterIndex+=this.scrollSpeed*e)}updateConfirm(){if(s.isKeyPressed([T.Confirm,T.ConfirmAlt])||s.isMousePressed(i.Left)){if(this.scrollText&&this.currentText.length>this.characterIndex)return this.characterIndex=this.currentText.length,s.clearKeyPressed([T.Confirm,T.ConfirmAlt]),void s.clearMousePressed(i.Left);this.textIndex+=2,this.characterIndex=0,this.textSegments.length<=this.textIndex&&(this.onComplete&&this.onComplete(),this.destroy()),s.clearKeyPressed([T.Confirm,T.ConfirmAlt]),s.clearMousePressed(i.Left)}}renderOverlay(i){t.fillRectangle(i,0,0,e.CANVAS_WIDTH,e.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.5)"})}generateTextbox(i){let s=this.textboxWidth,o=(e.CANVAS_TILE_WIDTH-s)/2;t.renderSprite(i,u.images[C],0,0,o,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,u.images[C],0,1,o,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,u.images[C],0,1,o,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,u.images[C],0,2,o,e.CANVAS_TILE_HEIGHT-1);for(let n=1;n<s-1;n++)t.renderSprite(i,u.images[C],1,0,o+n,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,u.images[C],1,1,o+n,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,u.images[C],1,1,o+n,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,u.images[C],1,2,o+n,e.CANVAS_TILE_HEIGHT-1);t.renderSprite(i,u.images[C],2,0,o+s-1,e.CANVAS_TILE_HEIGHT-4),t.renderSprite(i,u.images[C],2,1,o+s-1,e.CANVAS_TILE_HEIGHT-3),t.renderSprite(i,u.images[C],2,1,o+s-1,e.CANVAS_TILE_HEIGHT-2),t.renderSprite(i,u.images[C],2,2,o+s-1,e.CANVAS_TILE_HEIGHT-1)}renderText(i){if(this.textLine1){let s=this.scrollText?this.textLine1.substring(0,this.characterIndex):this.textLine1;t.renderText(i,s,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-2-.25,{size:this.textSize})}if(this.textLine2){let s=this.scrollText?this.textLine2.substring(0,this.characterIndex-this.textLine1.length):this.textLine2;t.renderText(i,s,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-1-.25,{size:this.textSize})}}renderPortrait(e){t.renderSprite(e,u.images[this.portrait.tileset],this.portrait.x,this.portrait.y,3,9,void 0,void 0,{scale:8})}renderNamePlate(i){t.fillRectangle(i,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1,e.CANVAS_TILE_HEIGHT-4,6*e.TILE_SIZE,1*e.TILE_SIZE,{colour:"#e8cfa6"}),t.renderText(i,this.name,(e.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,e.CANVAS_TILE_HEIGHT-3-.25,{size:this.textSize})}updatePortraitAnimation(e){this.animationTimer=(this.animationTimer+e)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}get hasPortrait(){return void 0!==this.portrait}get hasNamePlate(){return void 0!==this.name}get textLine1(){return this.textSegments[this.textIndex]}get textLine2(){return this.textSegments[this.textIndex+1]}get currentText(){let e="";return this.textLine1&&(e+=this.textLine1),this.textLine2&&(e+=this.textLine2),e}}const L={x:1,y:1},X=[E.TomatoSeeds,E.WheatSeeds];var k;!function(e){e[e.Empty=0]="Empty",e[e.Watered=1]="Watered",e[e.Growing=2]="Growing",e[e.FullyGrown=3]="FullyGrown",e[e.Spoiled=4]="Spoiled"}(k||(k={}));const A={[E.WheatSeeds]:{[k.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:0},[k.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:0},[k.Spoiled]:void 0},[E.TomatoSeeds]:{[k.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:1},[k.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:1},[k.Spoiled]:void 0}};class j extends l{constructor(e,t){super(e,t),this.scene=e,this.spriteX=L.x,this.spriteY=L.y,this.counterDry=0,this.counterGrow=0,this.counterSpoil=0,this.currentlyGrowing=void 0,this.renderer.enabled=!0,this.renderer.layer=6,this.cropStage=k.Empty,t.growing&&(this.collision.enabled=!0,this.cropStage=t.growing.stage,this.currentlyGrowing=t.growing.itemType)}onDirtPlaced(e){let t=this.scene.getAllObjectsAtPosition(this.transform.position.local.x-1,this.transform.position.local.y),i=this.scene.getAllObjectsAtPosition(this.transform.position.local.x+1,this.transform.position.local.y),s=(t.filter((e=>e instanceof j)).length,i.filter((e=>e instanceof j)).length,L);this.spriteX=s.x,this.spriteY=s.y}interact(){switch(this.cropStage){case k.Empty:return void this.interactStageEmpty();case k.Watered:return void this.interactStageWatered();case k.Growing:return void this.interactStageGrowing();case k.FullyGrown:return void this.interactStageFullyGrown()}}interactStageEmpty(){this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:"It's a beautiful patch of dirt, brimming with potential.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageWatered(){this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:"The patch of dirt is watered, better plant something before it dries up.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageGrowing(){this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:"The plant is growing nicely, it will be ready for harvest soon.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(e)}interactStageFullyGrown(){let e=!1;switch(this.currentlyGrowing){case E.TomatoSeeds:e=!!this.scene.addToInventory(E.Tomato);break;case E.WheatSeeds:e=!!this.scene.addToInventory(E.Wheat)}e&&this.destroy()}get isEmpty(){return void 0===this.currentlyGrowing}onUpdate(e){this.cropStage===k.Empty||this.cropStage===k.Watered?this.counterDry+=e:this.cropStage===k.Growing?this.counterGrow+=e:this.cropStage===k.FullyGrown&&(this.counterSpoil+=e),this.isEmpty&&this.counterDry>15?this.destroy():this.cropStage===k.Growing&&this.counterGrow>5?this.cropStage=k.FullyGrown:this.cropStage===k.FullyGrown&&this.counterSpoil>86400&&(this.cropStage=k.Spoiled)}onRender(e){this.renderDirt(e),this.renderCrop(e)}renderDirt(e){let i=(this.cropStage,k.Empty,"tileset_dirt");t.renderSprite(e,u.images[i],this.spriteX,this.spriteY,this.transform.position.local.x,this.transform.position.local.y,1,1,{centered:!0}),this.cropStage!==k.Empty&&t.fillRectangle(e,this.boundingBox.local.left,this.boundingBox.local.top,1,1,{colour:"#00000011",type:"tile"})}renderCrop(e){if(this.cropStage===k.Empty||this.cropStage===k.Watered)return;if(this.currentlyGrowing!==E.TomatoSeeds&&this.currentlyGrowing!==E.WheatSeeds)return;let i=A[this.currentlyGrowing][this.cropStage];void 0!==i&&t.renderSprite(e,u.images[i.tileset],i.spriteX,i.spriteY,this.transform.position.local.x,this.transform.position.local.y,1,1,{centered:!0})}actionWater(){this.cropStage===k.Empty&&(this.counterDry=0,this.cropStage=k.Watered)}actionPlant(){let e=this.scene.selectedInventoryItem;void 0!==e&&X.includes(e.type)&&this.cropStage===k.Watered&&(this.collision.enabled=!0,this.currentlyGrowing=e.type,this.cropStage=k.Growing,this.scene.removeFromInventoryByIndex(this.scene.globals.hotbar_selected_index,1))}}const H=[{x:11,y:15},{x:13,y:15},{x:15,y:15},{x:17,y:15},{x:19,y:15},{x:11,y:6},{x:13,y:6},{x:15,y:6},{x:17,y:6},{x:19,y:6},{x:11,y:8},{x:13,y:8},{x:15,y:8},{x:17,y:8},{x:19,y:8},{x:11,y:10},{x:13,y:10},{x:15,y:10},{x:17,y:10},{x:19,y:10},{x:11,y:12},{x:13,y:12},{x:15,y:12},{x:17,y:12},{x:19,y:12}],M=[{x:7,y:1},{x:9,y:1},{x:11,y:1},{x:13,y:1},{x:15,y:1},{x:17,y:1},{x:19,y:1},{x:21,y:1},{x:23,y:1},{x:7,y:3},{x:9,y:3},{x:11,y:3},{x:13,y:3},{x:15,y:3},{x:17,y:3},{x:19,y:3},{x:21,y:3},{x:23,y:3},{x:7,y:5},{x:9,y:5},{x:11,y:5},{x:13,y:5},{x:15,y:5},{x:17,y:5},{x:19,y:5},{x:21,y:5},{x:23,y:5}];var B;!function(e){e.Close="tab"}(B||(B={}));class R extends l{constructor(t,i){super(t,i),this.scene=t,this.showInventory=!0,this.showHotbar=!0,this.chest=void 0,this.itemHolding=void 0,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.collision.layer=e.UI_COLLISION_LAYER,this.scene.globals.disable_player_inputs=!0,this.chest=i.chest}onUpdate(e){this.updatePickUpItem(),this.updateDropItem(),this.updateClose()}onRender(e){if(this.showHotbar){let t=11,i=15;this.renderInventoryBackground(e,t,i),this.renderInventoryContainers(e,t,i),this.renderInventoryItems(e,t,i,this.inventory.slice(0,this.hotbarSize)),this.showInventory||this.renderHotbarSelector(e)}if(this.chest){this.renderChestHeader(e,7,0);for(let t=0;t<3;t++){let i=7,s=1+2*t;this.renderInventoryBackground(e,i,s),this.renderInventoryContainers(e,i,s),this.renderInventoryItems(e,i,s,this.chest.inventory.slice(this.hotbarSize*t,this.hotbarSize*(t+1)))}}if(this.showInventory){this.renderInventoryHeader(e,11,5);for(let t=0;t<4;t++){let i=11,s=6+2*t;this.renderInventoryBackground(e,i,s),this.renderInventoryContainers(e,i,s),this.renderInventoryItems(e,i,s,this.inventory.slice(this.hotbarSize*(t+1),this.hotbarSize*(t+2)))}this.renderInventoryItemGrabbed(e)}}onDestroy(){this.scene.globals.disable_player_inputs=!1,this.chest&&this.chest.actionClose()}renderHotbarSelector(e){const i=11+2*this.hotbarSelectedIndex;t.renderSprite(e,u.images.tileset_ui,9,9,i,15,2,2)}renderInventoryHeader(i,s,o){let n=4*e.TILE_SIZE,r=2*e.TILE_SIZE;t.fillRectangle(i,s,o,n,r,{colour:"saddlebrown"}),t.renderText(i,"Inventory",s+.4,o+.75,{size:12,colour:"white"})}renderChestHeader(i,s,o){let n=4*e.TILE_SIZE,r=2*e.TILE_SIZE;t.fillRectangle(i,s,o,n,r,{colour:"saddlebrown"}),t.renderText(i,"Chest",s+.9,o+.75,{size:12,colour:"white"})}renderInventoryBackground(i,s,o){let n=2*e.TILE_SIZE*this.scene.globals.hotbar_size,r=2*e.TILE_SIZE;t.fillRectangle(i,s,o,n,r,{colour:"saddlebrown"})}renderInventoryContainers(e,i,s){for(let o=0;o<this.scene.globals.hotbar_size;o++)t.renderSprite(e,u.images.tileset_ui,.5,3.5,i+2*o,s,2,2)}renderInventoryItems(e,t,i,s){for(let o=0;o<9;o++){let n=s[o];void 0!==n&&this.renderInventoryItem(e,n.sprite.tileset,n.currentStackSize,n.maxStackSize,n.sprite.spriteX,n.sprite.spriteY,t+.5+2*o,i+.5)}}renderInventoryItemGrabbed(e){if(void 0===this.itemHolding)return;let t=this.itemHolding.item;this.renderInventoryItem(e,t.sprite.tileset,t.currentStackSize,t.maxStackSize,t.sprite.spriteX,t.sprite.spriteY,s.mouse.position.x-.5,s.mouse.position.y-.5)}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}get hotbarSize(){return this.scene.globals.hotbar_size}get hotbarSelectedIndex(){return this.scene.globals.hotbar_selected_index}updatePickUpItem(){if(void 0!==this.itemHolding)return;let e=this.getIndexFromPositionMap(s.mouse.position,H);if(void 0===e){if(void 0!==this.chest){let e=this.getIndexFromPositionMap(s.mouse.position,M);if(void 0!==e){let t=this.chest.inventory[e];if(void 0===t)return;return void(this.itemHolding={location:"chest",item:t,index:e})}}this.itemHolding=void 0}else{let t=this.inventory[e];if(void 0===t)return;this.itemHolding={location:"inventory",item:t,index:e}}}updateDropItem(){if(void 0===this.itemHolding)return;if(!0===s.mouse.click.left)return;let e=this.getIndexFromPositionMap(s.mouse.position,H);if(void 0!==e){let t=this.inventory[e];return"inventory"===this.itemHolding.location?(this.inventory[e]=this.itemHolding.item,this.inventory[this.itemHolding.index]=t):"chest"===this.itemHolding.location&&(this.inventory[e]=this.itemHolding.item,this.chest.inventory[this.itemHolding.index]=t),void(this.itemHolding=void 0)}if(void 0!==this.chest){let e=this.getIndexFromPositionMap(s.mouse.position,M);if(void 0!==e){let t=this.chest.inventory[e];return"inventory"===this.itemHolding.location?(this.chest.inventory[e]=this.itemHolding.item,this.inventory[this.itemHolding.index]=t):"chest"===this.itemHolding.location&&(this.chest.inventory[e]=this.itemHolding.item,this.chest.inventory[this.itemHolding.index]=t),void(this.itemHolding=void 0)}}this.itemHolding=void 0}updateClose(){s.isKeyPressed(B.Close)&&(s.clearKeyPressed(B.Close),this.destroy())}renderInventoryItem(e,i,s,o,n,r,a,l){t.renderSprite(e,u.images[i],n,r,a,l),o>1&&t.renderText(e,`${s}`,a+.75,l+1,{size:8,colour:"black"})}getIndexFromPositionMap(e,t){for(let i=0;i<t.length;i++){let s=t[i];if(e.x>=s.x&&e.x<=s.x+1&&e.y>=s.y&&e.y<=s.y+1)return i}}}const O={tileset:"tileset_chicken",x:0,y:0},N="tileset_chest";class F extends l{constructor(e,t){super(e,t),this.scene=e,this.isOpen=!1,this.inventory=[],this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8}onRender(e){this.renderSprite(e)}interact(){this.actionOpen()}actionOpen(){this.isOpen=!0,this.scene.addObject(new R(this.scene,{positionX:0,positionY:0,chest:this}))}actionClose(){this.isOpen=!1}renderSprite(e){this.isOpen?t.renderSprite(e,u.images[N],13,.5,this.transform.position.local.x,this.transform.position.local.y-.5,1,2,{centered:!0}):t.renderSprite(e,u.images[N],1,.5,this.transform.position.local.x,this.transform.position.local.y-.5,1,2,{centered:!0})}}var P,D;!function(e){e.UP="w",e.DOWN="s",e.LEFT="a",e.RIGHT="d"}(P||(P={})),function(e){e.Inventory="tab",e.Interact="e",e.InteractAlt=" "}(D||(D={}));class W extends l{constructor(e,t){super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.movementSpeed=4,this.animations={[P.RIGHT]:[{x:7,y:10},{x:10,y:10}],[P.LEFT]:[{x:7,y:7},{x:10,y:7}],[P.UP]:[{x:7,y:4},{x:10,y:4}],[P.DOWN]:[{x:7,y:1},{x:10,y:1}]},this.animationsIdle={[P.RIGHT]:[{x:1,y:10},{x:4,y:10}],[P.LEFT]:[{x:1,y:7},{x:4,y:7}],[P.UP]:[{x:1,y:4},{x:4,y:4}],[P.DOWN]:[{x:1,y:1},{x:4,y:1}]},this.direction=P.DOWN,this.directionTime=0,this.directionTimer=0,this.animationIndex=0,this.isIdle=!0,this.movementEnabled=!1,this.hotbarEnabled=!1,this.leftClickEnabled=!1,this.inventoryEnabled=!1,this.interactButtonEnabled=!1,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=10,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.enableMovement(),this.enableInteractKeys(),this.enableInventoryKeys(),this.enableOtherKeys()}enableMovement(){this.movementEnabled=!0}enableOtherKeys(){this.hotbarEnabled=!0,this.leftClickEnabled=!0}enableInventoryKeys(){this.inventoryEnabled=!0}enableInteractKeys(){this.interactButtonEnabled=!0}onUpdate(e){this.updateMovement(e),this.updateAnimations(e),this.updateHotbarViaKey(),this.updateHotbarViaWheel(),this.updateLeftClick(),this.updateButtonInteract(),this.updateOpenInventory(),this.latestScrollTimestamp=s.mouse.wheel.event.timeStamp}onRender(e){this.renderSprite(e),this.renderCursor(e)}updateMovement(e){!0!==this.scene.globals.disable_player_inputs&&!1!==this.movementEnabled&&(this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){if(this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y)return;if(!s.isKeyPressed([P.RIGHT,P.LEFT,P.UP,P.DOWN]))return;let t,i=new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY);if(s.isKeyPressed(P.RIGHT)?(i.targetX+=1,t=P.RIGHT):s.isKeyPressed(P.LEFT)?(i.targetX-=1,t=P.LEFT):s.isKeyPressed(P.UP)?(i.targetY-=1,t=P.UP):s.isKeyPressed(P.DOWN)&&(i.targetY+=1,t=P.DOWN),this.direction!==t?(this.direction=t,this.directionTime=0,this.directionTimer=0):this.directionTimer+=e,this.directionTimer<.05)return;const o=l.calculateBoundingBox(i.target.x,i.target.y,this.width,this.height);this.scene.hasCollisionAtBoundingBox(o,this)||this.scene.isOutOfBounds(i.targetX,i.targetY)||(this.targetX=i.targetX,this.targetY=i.targetY)}updateAnimations(e){this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y?this.isIdle=!1:this.isIdle=!0,this.isIdle?this.directionTime<.5?this.animationIndex=0:this.animationIndex=1:this.directionTime<.25?this.animationIndex=0:this.directionTime<.5?this.animationIndex=1:this.directionTime<.75?this.animationIndex=0:this.animationIndex=1,this.directionTime=(this.directionTime+e)%1}processMovement(e){if(this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y){let t=new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=x.moveTowardsPosition(t,x.frameSpeed(this.movementSpeed,e));this.transform.position.local.x=i.positionX,this.transform.position.local.y=i.positionY}}updateButtonInteract(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.interactButtonEnabled)return;if(!s.isKeyPressed([D.Interact,D.InteractAlt]))return;s.clearKeyPressed([D.Interact,D.InteractAlt]);let e=this.transform.position.local.x,t=this.transform.position.local.y;switch(this.direction){case P.UP:t-=1;break;case P.RIGHT:e+=1;break;case P.DOWN:t+=1;break;case P.LEFT:e-=1}let i=this.scene.getObjectAtPosition(e,t,this);void 0!==i&&function(e){return"interact"in e}(i)&&i.interact()}getPositionFacing(){let e=Math.floor(this.transform.position.local.x),t=Math.floor(this.transform.position.local.y);return this.direction===P.RIGHT?{x:e+1,y:t}:this.direction===P.LEFT?{x:e-1,y:t}:this.direction===P.UP?{x:e,y:t-1}:this.direction===P.DOWN?{x:e,y:t+1}:void 0}updateHotbarViaKey(){!0!==this.scene.globals.disable_player_inputs&&!1!==this.hotbarEnabled&&(!0!==s.isKeyPressed("1")?!0!==s.isKeyPressed("2")?!0!==s.isKeyPressed("3")?!0!==s.isKeyPressed("4")?!0!==s.isKeyPressed("5")||(this.scene.globals.hotbar_selected_index=4):this.scene.globals.hotbar_selected_index=3:this.scene.globals.hotbar_selected_index=2:this.scene.globals.hotbar_selected_index=1:this.scene.globals.hotbar_selected_index=0)}updateHotbarViaWheel(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.hotbarEnabled)return;if(this.latestScrollTimestamp===s.mouse.wheel.event.timeStamp)return;const e=this.scene.globals.hotbar_selected_index;s.mouse.wheel.event.deltaY>0?e===this.scene.globals.hotbar_size-1?this.scene.globals.hotbar_selected_index=0:this.scene.globals.hotbar_selected_index++:s.mouse.wheel.event.deltaY<0&&(0===e?this.scene.globals.hotbar_selected_index=this.scene.globals.hotbar_size-1:this.scene.globals.hotbar_selected_index--)}updateOpenInventory(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.inventoryEnabled)return;let e=[D.Inventory];!1!==s.isKeyPressed(e)&&(this.scene.addObject(new R(this.scene,{positionX:0,positionY:0})),s.clearKeyPressed(e))}updateLeftClick(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.leftClickEnabled)return;if(!s.isMousePressed(i.Left))return;s.clearMousePressed(i.Left);const e=this.scene.selectedInventoryItem;if(void 0===e)return;if(e.radius===S.None)return;const t=Math.round(s.mouse.position.x+this.scene.globals.camera.startX),o=Math.round(s.mouse.position.y+this.scene.globals.camera.startY);if(e.radius===S.Player&&Math.abs(t-this.transform.position.local.roundedX)>1||Math.abs(o-this.transform.position.local.roundedY)>1)return;const n=this.scene.getObjectAtPosition(t,o);if(void 0===n)switch(e.type){case E.Hoe:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),o=new j(e,{positionX:t,positionY:i});e.addObject(o)}(this.scene);case E.WateringCan:return void function(e){e.globals.disable_player_inputs=!0;const t=new Y(e,{text:"There is nothing to water...",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(t)}(this.scene);case E.Chicken:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),o=new V(e,{positionX:t,positionY:i});e.addObject(o),e.removeFromInventoryByIndex(e.selectedInventoryIndex,1)}(this.scene);case E.Egg:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),o=new G(e,{positionX:t,positionY:i});e.addObject(o),e.removeFromInventoryByIndex(e.selectedInventoryIndex,1)}(this.scene);case E.TomatoSeeds:case E.WheatSeeds:return void function(e){e.globals.disable_player_inputs=!0;const t=new Y(e,{text:"Seeds can only be placed in watered dirt.",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(t)}(this.scene);case E.Chest:return void function(e){const t=Math.round(s.mouse.position.x+e.globals.camera.startX),i=Math.round(s.mouse.position.y+e.globals.camera.startY),o=new F(e,{positionX:t,positionY:i});e.addObject(o),e.removeFromInventoryByIndex(e.selectedInventoryIndex,1)}(this.scene);default:return}else switch(e.type){case E.WateringCan:switch(!0){case n instanceof j:return void function(e,t){t.actionWater()}(this.scene,n);case n instanceof V:return void function(e,t){e.globals.disable_player_inputs=!0;const i=new Y(e,{text:"Hey could you not water me please...",portrait:O,name:"Chicken",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(i)}(this.scene);default:return}case E.TomatoSeeds:case E.WheatSeeds:return 1==n instanceof j?void function(e,t){if(t.cropStage===k.Watered)t.actionPlant();else{e.globals.disable_player_inputs=!0;const t=new Y(e,{text:"Seeds can only be placed in watered dirt.",onComplete:()=>{e.globals.disable_player_inputs=!1}});e.addObject(t)}}(this.scene,n):void 0;case E.Tomato:case E.Wheat:return 1==n instanceof V?void function(e,t){t.actionGiveItem()}(this.scene,n):void 0;default:return}}renderSprite(e){let i=this.isIdle?this.animationsIdle:this.animations;t.renderSprite(e,u.images.tileset_player,i[this.direction][this.animationIndex].x,i[this.direction][this.animationIndex].y,this.transform.position.local.x,this.transform.position.local.y,void 0,void 0,{centered:!0})}renderCursor(e){if(!this.leftClickEnabled)return;let i=Math.round(s.mouse.position.x+this.scene.globals.camera.startX),o=Math.round(s.mouse.position.y+this.scene.globals.camera.startY),n=this.scene.selectedInventoryItem;void 0!==n&&n.radius!==S.None&&(i===this.transform.position.local.roundedX&&o===this.transform.position.local.roundedY||n.radius===S.Player&&Math.abs(i-this.transform.position.local.roundedX)>1||Math.abs(o-this.transform.position.local.roundedY)>1||t.fillRectangle(e,i-.5,o-.5,1,1,{colour:"#0000ff33",type:"tile"}))}}class G extends l{constructor(e,t){super(e,t),this.scene=e,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.hatchTimer=0,this.hatchTimerMax=7,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=7}onUpdate(e){this.updateAnimation(e),this.updateHatch(e)}onRender(e){t.renderSprite(e,u.images.tileset_egg,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.local.x,this.transform.position.local.y,1,1,{centered:!0})}updateAnimation(e){this.animationTimer=(this.animationTimer+e)%1,this.animationIndex=0}updateHatch(e){if(this.hatchTimer+=e,this.hatchTimer<this.hatchTimerMax)return;let t=this.scene.getObjectsByType(W)[0],i=new V(this.scene,{positionX:this.transform.position.local.x,positionY:this.transform.position.local.y,follows:t});this.destroy(),this.scene.addObject(i)}interact(){void 0!==this.scene.addToInventory(E.Egg)&&this.destroy()}}const z={tileset:"tileset_chicken",x:0,y:0};class V extends l{constructor(e,t){var i,s;super(e,t),this.scene=e,this.targetX=-1,this.targetY=-1,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=v.randomStartingDelta(4),this.animationIndex=0,this.movementSpeed=2,this.movementTimer=v.randomStartingDelta(2),this.movementDelay=2,this.eggTimer=v.randomStartingDelta(2),this.eggTimerMax=7,this.eggMax=200,this.isMovingThisFrame=!1,this.isEdgyTeen=!1,this.interactionCount=0,this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.canLayEggs=null!==(i=t.canLayEggs)&&void 0!==i&&i,this.isEdgyTeen=3===v.randomIntFromRange(0,3),this.canMove=null!==(s=t.canMove)&&void 0!==s&&s,this.following=t.follows,console.log(this.onRender)}onUpdate(e){this.isMovingThisFrame=!1,this.updateMovement(e),this.updateAnimation(e),this.updateEgg(e)}onRender(e){t.renderSprite(e,u.images.tileset_chicken,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.local.x,this.transform.position.local.y,void 0,void 0,{centered:!0})}updateAnimation(e){this.animationTimer=(this.animationTimer+e)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}updateMovement(e){this.canMove&&(this.movementTimer+=e,this.movementTimer>this.movementDelay&&this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){let t;this.movementTimer=0,t=this.following?x.moveTowardsOtherEntity(new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),{positionX:this.following.transform.position.local.x,positionY:this.following.transform.position.local.y}):x.moveInRandomDirection(new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY)),this.scene.hasCollisionAtPosition(t.targetX,t.targetY,this)||this.scene.isOutOfBounds(t.targetX,t.targetY)||(this.targetX=t.targetX,this.targetY=t.targetY)}processMovement(e){if(this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y){let t=new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=x.moveTowardsPosition(t,x.frameSpeed(this.movementSpeed,e));this.transform.position.local.x=i.positionX,this.transform.position.local.y=i.positionY,this.isMovingThisFrame=!0}}updateEgg(e){if(!this.canLayEggs)return;if(this.eggTimer+=e,this.eggTimer<this.eggTimerMax)return;if(!this.isMovingThisFrame)return;let t;this.scene.getObjectsByType(V).length+this.scene.getObjectsByType(G).length>this.eggMax||(t=this.transform.position.local.x>this.targetX||this.transform.position.local.y>this.targetY?Math.ceil:Math.floor,this.scene.addObject(new G(this.scene,{positionX:t(this.transform.position.local.x),positionY:t(this.transform.position.local.y)})),this.eggTimer=0)}interact(){this.interactDefault()}interactDefault(){this.scene.globals.disable_player_inputs=!0;let e="";if(this.isEdgyTeen)switch(this.interactionCount%3){case 0:e="GET OUT OF MY ROOM MOM! GODDDD!!1!";break;case 1:e="UGHHHH! YOU ARE LIKE SO EMBARRASSING!1!11!";break;case 2:e="OMG!1!1 JUST LIKE LEAVE ME ALONE!1!11!!"}else switch(this.interactionCount%3){case 0:e="bock bock ... can i help you? ... cluck cluck ...";break;case 1:e="cluck cluck ... you're sort of annoying you know that? ... bock bock ...";break;case 2:e="bock cluck ... is... is this a simulation? ... cluck bock ..."}let t=new Y(this.scene,{text:e,portrait:z,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(t),this.interactionCount++}actionGiveItem(){switch(this.scene.selectedInventoryItem.type){case E.Tomato:return void this.actionGiveTomato();case E.Wheat:return void this.actionGiveWheat()}}actionGiveTomato(){this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:"I LOooOooOoOooOoOVE TOMATOES!",portrait:z,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}),t=this.scene.globals.inventory.indexOf(this.scene.selectedInventoryItem);this.scene.removeFromInventoryByIndex(t,1),this.scene.addObject(e)}actionGiveWheat(){this.scene.globals.disable_player_inputs=!0;let e=new Y(this.scene,{text:"I HAAAAAAAAAAAAAAAATE WHEAT!",portrait:z,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(e)}}const U={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},Z=[U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U],K={index:0,tiles:[[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z]]},$={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},J={...$,animationFrames:[{spriteX:2,spriteY:1}]},q={...$,animationFrames:[{spriteX:1,spriteY:2}]},Q={...$,animationFrames:[{spriteX:2,spriteY:2}]},ee={...$,animationFrames:[{spriteX:5,spriteY:1}]},te={index:1,tiles:[[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,ee,J,J,J,J,J,J,Q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,ee,J,J,J,Q],[void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,q],[J,J,J,J,Q]]};class ie extends l{constructor(e,t){super(e,t),this.scene=e,this.collision.enabled=!0}}const se={tileset:"tileset_grass",animationFrameDuration:1,animationFrames:[],animationMap:[1]},oe={...se,animationFrames:[{spriteX:1,spriteY:1}]},ne={...se,animationFrames:[{spriteX:2,spriteY:1}]},re=[oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,oe,{...se,animationFrames:[{spriteX:1,spriteY:2}]}],ae={index:1,tiles:[re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,re,[ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,ne,{...se,animationFrames:[{spriteX:2,spriteY:2}]}]]};class le extends l{constructor(t,i){super(t,i),this.scene=t,this.height=2,this.width=10,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.collision.layer=e.UI_COLLISION_LAYER}onUpdate(e){}onRender(e){this.renderBackground(e),this.renderContainers(e),this.renderItems(e,this.inventory.slice(0,this.hotbarSize)),this.renderHotbarSelector(e)}renderHotbarSelector(e){const i=this.boundingBox.world.left+1+2*this.hotbarSelectedIndex,s=this.boundingBox.world.top+1;t.renderSprite(e,u.images.tileset_ui,9,9,i,s,2,2,{centered:!0})}renderBackground(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"saddlebrown",type:"tile"})}renderContainers(e){for(let i=0;i<5;i++)t.renderSprite(e,u.images.tileset_ui,.5,3.5,this.boundingBox.world.left+1+2*i,this.boundingBox.world.top+1,2,2,{centered:!0})}renderItems(e,t){for(let i=0;i<5;i++){let s=t[i];void 0!==s&&this.renderInventoryItem(e,s.sprite.tileset,s.currentStackSize,s.maxStackSize,s.sprite.spriteX,s.sprite.spriteY,this.boundingBox.world.left+1+2*i,this.boundingBox.world.top+1)}}renderInventoryItem(e,i,s,o,n,r,a,l){t.renderSprite(e,u.images[i],n,r,a,l,1,1,{centered:!0}),o>1&&t.renderText(e,`${s}`,a+.75,l+1,{size:8,colour:"black"})}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}get hotbarSize(){return this.scene.globals.hotbar_size}get hotbarSelectedIndex(){return this.scene.globals.hotbar_selected_index}}class he{constructor(e,t){this.tileset=e,this.frames=t,this.duration=t.reduce(((e,t)=>e+t.duration),0)}currentFrame(e){let t=e%this.duration,i=0;for(let e=0;e<this.frames.length;e++)if(i+=this.frames[e].duration,t<i)return this.frames[e];return this.frames[0]}}const de={tileset:"tileset_chicken",x:0,y:0},ce={idle:new he("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}]),moving:new he("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}])};class pe extends l{constructor(e,t){var i,s,o,n,r;super(e,t),this.scene=e,this.state="idle",this.targetX=-1,this.targetY=-1,this.animation={index:0,timer:0},this.movementTimer=v.randomStartingDelta(2),this.collision.enabled=!0,this.renderer.enabled=!0,this.renderer.layer=8,this.targetX=this.transform.position.local.x,this.targetY=this.transform.position.local.y,this.canMove=null!==(i=t.canMove)&&void 0!==i&&i,this.following=t.follows,this.dialogue=t.dialogue,this.animations=null!==(s=t.animations)&&void 0!==s?s:ce,this.movementSpeed=null!==(o=t.movementSpeed)&&void 0!==o?o:2,this.movementDelay=null!==(n=t.movementDelay)&&void 0!==n?n:void 0,this.name=null!==(r=t.name)&&void 0!==r?r:"???"}onUpdate(e){this.updateMovement(e),this.updateAnimationTimer(e)}onRender(e){let i=this.animations[this.state],s=i.currentFrame(this.animation.timer);t.renderSprite(e,u.images[i.tileset],s.spriteX,s.spriteY,this.transform.position.local.x,this.transform.position.local.y,void 0,void 0,{opacity:this.renderer.opacity,scale:this.renderer.scale,centered:!0})}updateAnimationTimer(e){this.animation.timer=(this.animation.timer+e)%this.animations[this.state].duration}updateMovement(e){this.canMove&&(this.movementTimer+=e,(void 0===this.movementDelay&&this.movementTimer>this.movementSpeed||this.movementTimer>this.movementDelay)&&this.determineNextMovement(e),this.processMovement(e))}determineNextMovement(e){let t;this.movementTimer=0,t=this.following?x.moveTowardsOtherEntity(new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),{positionX:this.following.transform.position.local.x,positionY:this.following.transform.position.local.y}):x.moveInRandomDirection(new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY)),this.scene.hasCollisionAtPosition(t.targetX,t.targetY,this)||this.scene.isOutOfBounds(t.targetX,t.targetY)||(this.targetX=t.targetX,this.targetY=t.targetY)}processMovement(e){if(this.targetX!==this.transform.position.local.x||this.targetY!==this.transform.position.local.y){let t=new f(this.transform.position.local.x,this.transform.position.local.y,this.targetX,this.targetY),i=x.moveTowardsPosition(t,x.frameSpeed(this.movementSpeed,e));this.transform.position.local.x=i.positionX,this.transform.position.local.y=i.positionY}}interact(){if(void 0===this.dialogue)return;let e=new Y(this.scene,{text:this.dialogue,portrait:de,name:this.name});this.scene.addObject(e)}}const me={[E.Chicken]:1,[E.Egg]:9,[E.WheatSeeds]:9,[E.Wheat]:9,[E.TomatoSeeds]:9,[E.Tomato]:9,[E.Hoe]:1,[E.WateringCan]:1,[E.Chest]:1},ue={tileset:"tileset_ui",spriteX:15,spriteY:5},ge={[E.Chicken]:{tileset:"tileset_chicken",spriteX:0,spriteY:0},[E.Egg]:{tileset:"tileset_egg",spriteX:0,spriteY:0},[E.WheatSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:0},[E.Wheat]:{tileset:"tileset_plants",spriteX:5,spriteY:0},[E.TomatoSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:1},[E.Tomato]:{tileset:"tileset_plants",spriteX:5,spriteY:1},[E.Hoe]:{tileset:"tileset_tools",spriteX:4,spriteY:4},[E.WateringCan]:{tileset:"tileset_tools",spriteX:0,spriteY:0},[E.Chest]:{tileset:"tileset_chest",spriteX:1,spriteY:1}},be=S.None,ye={[E.Chicken]:S.Player,[E.Egg]:S.Player,[E.WheatSeeds]:S.Player,[E.Wheat]:S.Player,[E.TomatoSeeds]:S.Player,[E.Tomato]:S.Player,[E.Hoe]:S.Player,[E.WateringCan]:S.Player,[E.Chest]:S.Anywhere},ve={[E.Chicken]:0,[E.Egg]:0,[E.WheatSeeds]:5,[E.Wheat]:10,[E.TomatoSeeds]:5,[E.Tomato]:10,[E.Hoe]:0,[E.WateringCan]:0,[E.Chest]:0};class fe extends l{constructor(e,t){var i,s,o;super(e,t),this.scene=e,this.type=t.type,this.maxStackSize=null!==(i=me[this.type])&&void 0!==i?i:1,this.sprite=null!==(s=ge[this.type])&&void 0!==s?s:ue,this.radius=null!==(o=ye[this.type])&&void 0!==o?o:be,void 0!==t.currentStackSize?this.currentStackSize=t.currentStackSize>this.maxStackSize?this.maxStackSize:t.currentStackSize:this.currentStackSize=1}}class xe extends l{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.price=i.price,this.type=i.type}onUpdate(e){this.updateClicked()}onRender(e){this.renderContainer(e),this.renderItem(e),this.renderPrice(e)}updateClicked(){s.isMousePressed()&&o.isMouseWithinObject(this)&&(s.clearMousePressed(i.Left),this.price>this.scene.globals.gold||(this.scene.addToInventory(this.type)&&(this.scene.globals.gold-=this.price),this.parent.refreshShopState()))}renderContainer(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"white",type:"tile"})}renderItem(e){t.renderSprite(e,u.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.world.x,this.transform.position.world.y,void 0,void 0,{centered:!0})}renderPrice(e){t.renderText(e,`$${this.price}`,this.transform.position.world.x,this.transform.position.world.y+1,{size:12,colour:"black",font:"MS Gothic"})}get sprite(){return ge[this.type]}}class we extends l{constructor(t,i){super(t,i),this.scene=t,this.width=2,this.height=2,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.type=i.type,this.count=i.count,this.index=i.index}onUpdate(e){this.updateClicked()}onRender(e){this.renderContainer(e),this.renderItem(e),this.renderPrice(e),this.renderStackSize(e)}get price(){return ve[this.type]}updateClicked(){s.isMousePressed()&&o.isMouseWithinObject(this)&&(s.clearMousePressed(i.Left),this.scene.globals.gold+=this.price,this.scene.removeFromInventoryByIndex(this.index,1),this.parent.refreshShopState())}renderContainer(e){t.fillRectangle(e,this.boundingBox.world.left,this.boundingBox.world.top,this.width,this.height,{colour:"white",type:"tile"})}renderItem(e){t.renderSprite(e,u.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.local.x,this.transform.position.local.y,void 0,void 0,{centered:!0})}renderPrice(e){t.renderText(e,`$${this.price}`,this.transform.position.local.x-1,this.transform.position.local.y,{size:12,colour:"black",font:"MS Gothic"})}renderStackSize(e){t.renderText(e,`${this.count}`,this.transform.position.local.x,this.transform.position.local.y+1,{size:12,colour:"black",font:"MS Gothic"})}get sprite(){return ge[this.type]}}var Ie;!function(e){e.Close="tab"}(Ie||(Ie={}));const Ee=[{type:E.TomatoSeeds,price:5},{type:E.WheatSeeds,price:5},{type:E.Hoe,price:50},{type:E.WateringCan,price:50}];class Se extends l{constructor(t,i){super(t,i),this.scene=t,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.collision.layer=e.UI_COLLISION_LAYER,this.onLeave=i.onLeave}onAwake(){this.refreshShopState()}onUpdate(e){this.updateButtonClose(),this.updateClickClose()}onRender(e){this.renderBackground(e),this.renderShopBackground(e),this.renderShopTitle(e),this.renderInventoryBackground(e),this.renderInventoryTitle(e),this.renderTotalGold(e),this.renderLeaveButton(e)}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}updateButtonClose(){s.isKeyPressed(Ie.Close)&&(s.clearKeyPressed(Ie.Close),this.close())}updateClickClose(){s.isMousePressed(i.Left)&&o.isMouseWithinBoundary(s.mouse.position,21.5,12,4.5,1.5)&&(s.clearMousePressed(i.Left),this.close())}close(){this.destroy(),this.onLeave&&this.onLeave()}renderBackground(e){t.fillRectangle(e,0,0,32,18,{colour:"#00000055",type:"tile"})}renderShopBackground(e){t.fillRectangle(e,1,1,14,10,{colour:"brown",type:"tile"})}renderShopTitle(e){t.fillRectangle(e,4,.25,8,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,"Shop (buy)",6,1.25,{size:12,colour:"black",font:"MS Gothic"})}renderInventoryBackground(e){t.fillRectangle(e,17,1,14,11.75,{colour:"brown",type:"tile"})}renderInventoryTitle(e){t.fillRectangle(e,20,.25,8,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,"Inventory (sell)",21,1.25,{size:12,colour:"black",font:"MS Gothic"})}renderTotalGold(e){t.fillRectangle(e,26.5,12,4.5,1.5,{colour:"goldenrod",type:"tile"}),t.renderText(e,`Gold: ${this.scene.globals.gold}`,27,13,{size:12,colour:"black",font:"MS Gothic"})}renderLeaveButton(e){t.fillRectangle(e,21.5,12,4.5,1.5,{colour:"grey",type:"tile"}),t.renderText(e,"Leave",22.5,13,{size:12,colour:"black",font:"MS Gothic"})}refreshShopState(){this.removeAllChildren();for(let e=0;e<Ee.length;e++){const t=Ee[e],i=new xe(this.scene,{positionX:this.transform.position.world.x+3+2.5*e,positionY:this.transform.position.world.y+3,price:t.price,type:t.type});this.addChild(i)}const e=this.scene.globals.hotbar_size;for(let t=0;t<5;t++)for(let i=0;i<4;i++){const s=t+5*i+e,o=this.inventory[s];if(void 0===o)continue;const n=new we(this.scene,{positionX:this.transform.position.world.x+19+2.5*t,positionY:this.transform.position.world.y+3+2.5*i,type:o.type,count:o.currentStackSize,index:s});this.addChild(n)}}}const Te={tileset:"tileset_player",x:1,y:1},Ce={idle:new he("tileset_player",[{spriteX:1,spriteY:1,duration:.5},{spriteX:4,spriteY:1,duration:.5}]),moving:new he("tileset_player",[])};class _e extends pe{constructor(e,t){t.animations=Ce,super(e,t),this.scene=e,this.firstConversation=!0}onUpdate(e){super.onUpdate(e)}interact(){this.scene.globals.disable_player_inputs=!0,this.firstConversation?this.startStageFirstConversation():this.startStageGreeting()}startStageFirstConversation(){this.scene.addObject(new Y(this.scene,{text:"Hi, I don't think we've met. I'm the shop keeper. I have farming supplies for sale and will buy most things you grow.",portrait:Te,name:"???",onComplete:()=>{this.firstConversation=!1,this.startStageGreeting()}}))}startStageGreeting(){this.scene.globals.disable_player_inputs=!0,this.scene.addObject(new Y(this.scene,{text:"Welcome to my shop, how can I help?",portrait:Te,name:"Shopkeeper",onComplete:()=>{this.scene.addObject(new Se(this.scene,{positionX:0,positionY:0,onLeave:this.leaveShopCallback}))}}))}leaveShopCallback(){this.scene.addObject(new Y(this.scene,{text:"Thanks, come again any time!",portrait:Te,name:"Shopkeeper",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}))}}class Ye{}Ye.TopLeft={x:1,y:0},Ye.TopRight={x:3,y:0},Ye.BottomLeft={x:1,y:2},Ye.BottomRight={x:3,y:2},Ye.LeftHorizontal={x:1,y:3},Ye.MiddleHorizontal={x:2,y:3},Ye.RightHorizontal={x:3,y:3},Ye.TopVertical={x:0,y:0},Ye.MiddleVertical={x:0,y:1},Ye.BottomVertical={x:0,y:2},Ye.FencePost={x:0,y:3},Ye.Open={x:.5,y:3};class Le extends l{constructor(e,t){super(e,t),this.scene=e,this.type=Ye.FencePost,this.open=!1,this.collision.enabled=!0,this.renderer.enabled=!0,t.type&&(this.type=t.type)}onRender(e){t.renderSprite(e,u.images.tileset_fence,this.open?Ye.Open.x:this.type.x,this.open?Ye.Open.y:this.type.y,this.transform.position.local.x,this.transform.position.local.y,1,1,{centered:!0})}interact(){}}const Xe=e.CANVAS_TILE_WIDTH/2,ke=e.CANVAS_TILE_HEIGHT/2;class Ae extends l{constructor(t,i){var s,o,n,r,a;super(t,i),this.scene=t,this.animationTimer=0,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER,this.animationType=null!==(s=i.animationType)&&void 0!==s?s:"block",this.animationDirection=null!==(o=i.animationDirection)&&void 0!==o?o:"in",this.animationLength=null!==(n=i.animationLength)&&void 0!==n?n:1,this.animationCenterX=null!==(r=i.animationCenterX)&&void 0!==r?r:Xe,this.animationCenterY=null!==(a=i.animationCenterY)&&void 0!==a?a:ke}onUpdate(e){this.animationTimer+=e,this.animationTimer>this.animationLength&&this.destroy()}get animationPercentage(){return this.animationTimer/this.animationLength}onRender(e){switch(this.animationType){case"block":this.renderAnimationBlock(e);break;case"circle":this.renderAnimationCircle(e)}}renderAnimationBlock(i){let s="in"===this.animationDirection?1-this.animationPercentage:this.animationPercentage;t.fillRectangle(i,0,0,e.CANVAS_WIDTH,e.CANVAS_HEIGHT,{colour:`rgba(0, 0, 0, ${s})`})}renderAnimationCircle(t){let i="in"===this.animationDirection?this.animationPercentage:1-this.animationPercentage,s=this.animationCenterX-this.scene.globals.camera.startX,o=this.animationCenterY-this.scene.globals.camera.startY;t.fillStyle="black",t.beginPath(),t.arc(s*e.TILE_SIZE,o*e.TILE_SIZE,e.CANVAS_WIDTH*i,0,2*Math.PI),t.rect(e.CANVAS_WIDTH,0,-1*e.CANVAS_WIDTH,e.CANVAS_HEIGHT),t.fill()}}const je={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},He={...je,animationFrames:[{spriteX:9.5,spriteY:4}]},Me={...je,animationFrames:[{spriteX:10.5,spriteY:4}]},Be={...je,animationFrames:[{spriteX:8.5,spriteY:5}]},Re={...je,animationFrames:[{spriteX:9.5,spriteY:5}]},Oe={...je,animationFrames:[{spriteX:10.5,spriteY:5}]},Ne={index:1,tiles:[[],[],[],[],[],[],[],[],[],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Be,{...je,animationFrames:[{spriteX:8.5,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,He,Re,{...je,animationFrames:[{spriteX:9.5,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,Me,Oe,{...je,animationFrames:[{spriteX:10.5,spriteY:6}]}],[],[],[],[],[],[],[],[],[],[],[],[],[],[]]},Fe=()=>{};class Pe extends l{constructor(e,t){var i,s;super(e,t),this.scene=e,this.timer=0,this.intervalsComplete=0,this.duration=null!==(i=t.duration)&&void 0!==i?i:1,this.onInterval=null!==(s=t.onInterval)&&void 0!==s?s:Fe,this.maxIntervals=t.maxIntervals}onUpdate(e){this.timer+=e,this.timer>=this.duration&&(this.onInterval(),this.timer-=this.duration,this.intervalsComplete++,this.maxIntervals&&this.intervalsComplete>=this.maxIntervals&&this.destroy())}}class De extends l{constructor(t,i){super(t,i),this.scene=t,this.isFullscreen=!1,this.renderer.enabled=!0,this.renderer.layer=e.UI_RENDER_LAYER}onUpdate(e){o.wasObjectClicked(this)&&(s.clearMousePressed(i.Left),document.fullscreenElement||document.webkitIsFullScreen?(document.exitFullscreen(),this.isFullscreen=!1):this.scene.displayContext.canvas.requestFullscreen().then((()=>{this.isFullscreen=!0})).catch((e=>{throw new Error(e)})))}onRender(e){t.renderSprite(e,u.images.tileset_fullscreen,this.isFullscreen?1:0,0,this.boundingBox.world.left,this.boundingBox.world.top)}}class We extends l{constructor(i,s){var o;super(i,s),this.scene=i,this.customerRenderer=i=>{const s=this.cameraOffsetX/this.zoom,o=this.cameraOffsetY/this.zoom;let n=this.object.transform.position.local.x-s,r=this.object.transform.position.local.y-o,a=this.object.transform.position.local.x+(s+1),l=this.object.transform.position.local.y+(o+1);n<0?(n=0,a=n+e.CANVAS_TILE_WIDTH):a>this.scene.map.width&&(a=this.scene.map.width,n=a-e.CANVAS_TILE_WIDTH),r<0?(r=0,l=r+e.CANVAS_TILE_HEIGHT):l>this.scene.map.height&&(l=this.scene.map.height,r=l-e.CANVAS_TILE_HEIGHT),this.scene.globals.camera.startX=n,this.scene.globals.camera.startY=r,this.scene.globals.camera.endX=a,this.scene.globals.camera.endY=l,i.background.forEach((e=>{t.renderSubsection(e,this.mainContext,n,r,a,l)})),i.objects.forEach(((i,s)=>{s===e.UI_RENDER_LAYER?t.renderSubsection(i,this.mainContext,0,0,e.CANVAS_TILE_WIDTH,e.CANVAS_TILE_HEIGHT):t.renderSubsection(i,this.mainContext,n,r,a,l)}))},this.cameraOffsetX=e.CANVAS_TILE_WIDTH/2-.5,this.cameraOffsetY=e.CANVAS_TILE_HEIGHT/2-.5,this.object=s.object,this.zoom=null!==(o=s.zoom)&&void 0!==o?o:1,this.scene.setCustomRenderer(this.customerRenderer)}onDestroy(){this.scene.removeCustomerRenderer()}}class Ge extends n{constructor(e){super(e),this.scene=e,this.height=100,this.width=100,this.backgroundLayers=[K,ae,te,Ne],this.objects=[],o.setCursor(this.scene.displayContext.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.objects.push(new le(e,{positionX:16,positionY:16})),this.objects.push(new De(e,{positionX:31,positionY:1}));let t=new W(e,{positionX:10,positionY:9});this.objects.push(t),this.objects.push(new _e(e,{positionX:10,positionY:10})),this.objects.push(new V(e,{positionX:10,positionY:13,follows:t,canLayEggs:!0,canMove:!0}));for(let t=0;t<4;t++)for(let i=0;i<16;i++)this.objects.push(new j(e,{positionX:2+i,positionY:2+t,growing:{stage:k.FullyGrown,itemType:E.WheatSeeds}}));for(let t=0;t<6;t++)for(let i=0;i<3;i++)this.objects.push(new j(e,{positionX:6+i,positionY:10+t,growing:{stage:k.FullyGrown,itemType:E.WheatSeeds}}));for(let t=0;t<4;t++)for(let i=0;i<4;i++)this.objects.push(new j(e,{positionX:21+i,positionY:6+t,growing:{stage:k.FullyGrown,itemType:E.WheatSeeds}}));for(let t=0;t<6;t++)for(let i=0;i<13;i++)this.objects.push(new j(e,{positionX:12+i,positionY:10+t,growing:{stage:k.FullyGrown,itemType:E.WheatSeeds}}));for(let t=0;t<8;t++)for(let i=0;i<1;i++){let s=7===t||0===t?Ye.FencePost:Ye.MiddleVertical;this.objects.push(new Le(e,{positionX:4+i,positionY:7+t,type:s}))}for(let t=0;t<19;t++)for(let i=0;i<1;i++){let i=18===t?Ye.FencePost:Ye.MiddleVertical;this.objects.push(new Le(e,{positionX:27,positionY:0+t,type:i}))}for(let t=0;t<1;t++)for(let t=0;t<28;t++){let i=27===t?Ye.BottomRight:Ye.MiddleHorizontal;this.objects.push(new Le(e,{positionX:0+t,positionY:18,type:i}))}this.objects.push(new Le(e,{positionX:25,positionY:0,type:Ye.MiddleVertical}),new Le(e,{positionX:26,positionY:0,type:Ye.FencePost})),this.objects.push(new Le(e,{positionX:25,positionY:2,type:Ye.MiddleVertical})),this.objects.push(new Le(e,{positionX:25,positionY:1,type:Ye.MiddleVertical})),this.objects.push(new Le(e,{positionX:19,positionY:3,type:Ye.TopLeft}),new Le(e,{positionX:20,positionY:3,type:Ye.MiddleHorizontal}),new Le(e,{positionX:21,positionY:3,type:Ye.MiddleHorizontal}),new Le(e,{positionX:22,positionY:3,type:Ye.MiddleHorizontal}),new Le(e,{positionX:23,positionY:3,type:Ye.MiddleHorizontal}),new Le(e,{positionX:24,positionY:3,type:Ye.MiddleHorizontal}),new Le(e,{positionX:25,positionY:3,type:Ye.BottomRight})),this.objects.push(new Le(e,{positionX:19,positionY:4,type:Ye.MiddleVertical})),this.objects.push(new Le(e,{positionX:19,positionY:5,type:Ye.MiddleVertical})),this.objects.push(new Le(e,{positionX:19,positionY:6,type:Ye.MiddleVertical})),this.objects.push(new Le(e,{positionX:4,positionY:7,type:Ye.TopLeft}),new Le(e,{positionX:5,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:6,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:7,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:8,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:9,positionY:7,type:Ye.RightHorizontal}),new Le(e,{positionX:11,positionY:7,type:Ye.LeftHorizontal}),new Le(e,{positionX:12,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:13,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:14,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:15,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:16,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:17,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:18,positionY:7,type:Ye.MiddleHorizontal}),new Le(e,{positionX:19,positionY:7,type:Ye.BottomRight})),this.objects.push(),this.objects.push(),this.objects.push(),this.objects.push(),this.objects.push(),this.objects.push(),this.objects.push(new Le(e,{positionX:0,positionY:14,type:Ye.MiddleHorizontal}),new Le(e,{positionX:1,positionY:14,type:Ye.MiddleHorizontal}),new Le(e,{positionX:2,positionY:14,type:Ye.MiddleHorizontal}),new Le(e,{positionX:3,positionY:14,type:Ye.MiddleHorizontal})),this.objects.push(),this.objects.push(new Le(e,{positionX:0,positionY:16,type:Ye.FencePost})),this.objects.push(new Le(e,{positionX:0,positionY:17,type:Ye.FencePost})),this.objects.push(new Le(e,{positionX:0,positionY:18,type:Ye.FencePost})),this.objects.push(),this.objects.push(),this.objects.push(new ie(e,{positionX:25,positionY:1.5,height:4})),this.objects.push(new ie(e,{positionX:19,positionY:5.5,height:4})),this.objects.push(new ie(e,{positionX:22.5,positionY:4,width:6})),this.objects.push(new ie(e,{positionX:6.5,positionY:8,width:6})),this.objects.push(new ie(e,{positionX:15,positionY:8,width:9})),this.objects.push(new ie(e,{positionX:4,positionY:11.5,height:6})),this.objects.push(new ie(e,{positionX:2.25,positionY:15,width:4.5})),this.objects.push(new We(e,{object:t})),this.objects.push(new Ae(e,{animationCenterX:t.transform.position.local.x,animationCenterY:t.transform.position.local.y,animationType:"circle",animationLength:3})),this.objects.push(new Pe(this.scene,{duration:4.5,onInterval:()=>{let e=v.randomIntFromRange(19,28),t=v.randomIntFromRange(0,2),i="",s=0,o=0;0===t||1===t?(i="tileset_egg",s=1,o=0):(i="tileset_chicken",s=0,o=-.25),this.scene.addObject(new w(this.scene,{positionX:40,positionY:e,targetX:-1,targetY:e,tileset:i,spriteX:s,spriteY:o,destroyAtTarget:!0}))}}))}}class ze{constructor(e){this.client=e,this.backgroundLayersAnimationTimer={},this.objects=new Map,this.globals={camera:{startX:0,startY:0,endX:0,endY:0}},this.flaggedForMapChange=void 0,this.renderingContext={background:[],objects:[]},this.backgroundLayerAnimationFrame={},this.renderContext=this.client.renderContext,this.displayContext=this.client.displayContext}frame(e){var t;this.awake(),this.background(e),this.update(e),this.render(e),this.customRenderer?this.customRenderer(this.renderingContext):((t=this).globals.camera.startX=0,t.globals.camera.startY=0,t.globals.camera.endX=0,t.globals.camera.endY=0,t.renderingContext.background.forEach((e=>{t.renderContext.drawImage(e.canvas,0,0)})),t.renderingContext.objects.forEach((e=>{t.renderContext.drawImage(e.canvas,0,0)}))),this.destroy(e)}awake(){this.client.debug.timing.frameUpdate&&console.time("[frame] awake");for(let[,e]of this.objects)e.awake();this.client.debug.timing.frameUpdate&&console.timeEnd("[frame] awake")}background(e){this.client.debug.timing.frameBackground&&console.time("[frame] background"),this.backgroundLayers.forEach(((i,s)=>{let o=this.renderingContext.background[s];t.clearCanvas(o);for(let s=0;s<this.map.width+1;s++)for(let n=0;n<this.map.height+1;n++){let r,a=i.tiles[s]?i.tiles[s][n]:void 0;if(void 0!==a){if(1===a.animationFrames.length)r=a.animationFrames[0];else{let t;void 0===this.backgroundLayersAnimationTimer[i.index]&&(this.backgroundLayersAnimationTimer[i.index]={}),void 0===this.backgroundLayersAnimationTimer[i.index][s]&&(this.backgroundLayersAnimationTimer[i.index][s]={}),t=void 0===this.backgroundLayersAnimationTimer[i.index][s][n]?0:this.backgroundLayersAnimationTimer[i.index][s][n]+e,t>a.animationFrameDuration&&(t%=a.animationFrameDuration);for(let e=0;e<a.animationMap.length;e++)if(t<=a.animationMap[e]){r=a.animationFrames[e];break}this.backgroundLayersAnimationTimer[i.index][s][n]=t}t.renderSprite(o,u.images[a.tileset],r.spriteX,r.spriteY,s-.5,n-.5)}}})),this.client.debug.timing.frameBackground&&console.timeEnd("[frame] background")}update(e){this.client.debug.timing.frameUpdate&&console.time("[frame] update");for(let[,t]of this.objects)t.update(e);this.client.debug.timing.frameUpdate&&console.timeEnd("[frame] update")}render(e){this.client.debug.timing.frameRender&&console.time("[frame] render"),this.renderingContext.objects.forEach((e=>{t.clearCanvas(e)}));for(let[,e]of this.objects)this.client.debug.object.renderBackground&&e.debuggerRenderBackground(this.renderingContext.objects[e.renderer.layer]),e.render(this.renderingContext.objects[e.renderer.layer]),this.client.debug.object.renderBoundary&&e.debuggerRenderBoundary(this.renderingContext.objects[e.renderer.layer]);this.client.debug.timing.frameRender&&console.timeEnd("[frame] render")}destroy(e){this.client.debug.timing.frameDestroy&&console.time("[frame] destroy");for(let[,e]of this.objects)e.flags.destroy&&this.removeObjectById(e.id);this.client.debug.timing.frameDestroy&&console.timeEnd("[frame] destroy")}addObject(e){this.objects.set(e.id,e)}removeObjectById(e){const t=this.objects.get(e);void 0!==t&&(t.onDestroy&&t.onDestroy(),this.objects.delete(e),t.parent&&t.parent.children.delete(t.id))}getObjectsByType(e){const t=[];return this.objects.forEach((i=>{i instanceof e&&t.push(i)})),t}hasCollisionAtPosition(e,t,i){for(const[,s]of this.objects)if(s.collision.enabled&&s!==i&&e<s.boundingBox.world.right&&e>s.boundingBox.world.left&&t<s.boundingBox.world.bottom&&t>s.boundingBox.world.top)return!0;return!1}hasCollisionAtBoundingBox(e,t){for(const[,i]of this.objects)if(i.collision.enabled&&i!==t&&e.left<i.boundingBox.world.right&&e.right>i.boundingBox.world.left&&e.top<i.boundingBox.world.bottom&&e.bottom>i.boundingBox.world.top)return i}isOutOfBounds(e,t){return e>this.map.width-1||t>this.map.height-1||e<0||t<0}getObjectAtPosition(t,i,s){for(const[,o]of this.objects)if(o!==s&&o.collision.layer!==e.UI_COLLISION_LAYER&&t<o.boundingBox.world.right&&t>o.boundingBox.world.left&&i<o.boundingBox.world.bottom&&i>o.boundingBox.world.top)return o}getAllObjectsAtPosition(t,i,s){const o=[];for(const[,s]of this.objects)s.transform.position.local.x===t&&s.transform.position.local.y===i&&s.collision.layer===e.UI_COLLISION_LAYER&&o.push(s);return o}removeAllObjects(){for(const[e]of this.objects)this.removeObjectById(e)}removeAllBackgroundLayers(){this.backgroundLayers=[]}setUpRenderingContexts(){this.renderingContext={background:[],objects:[]};for(let e=0;e<this.backgroundLayers.length;e++){let i=this.createCanvas();this.renderingContext.background[e]=t.getContext(i)}for(let i=0;i<e.OBJECT_RENDERING_LAYERS;i++){let e=this.createCanvas();this.renderingContext.objects[i]=t.getContext(e)}}createCanvas(){let e=t.createCanvas(this.map.width,this.map.height);return this.client.debug.ui.canvasLayers&&this.client.container.append(e),e}flagForMapChange(e){this.flaggedForMapChange=e}changeMap(e){void 0!==this.map&&this.map.destroy(),this.removeAllObjects(),this.removeAllBackgroundLayers(),console.log("[Scene] changing map to",e),this.map=Reflect.construct(e,[this]),this.backgroundLayers.push(...this.map.backgroundLayers),this.map.objects.forEach((e=>this.objects.set(e.id,e))),this.setUpRenderingContexts(),this.flaggedForMapChange=void 0}changeScene(e){this.client.changeScene(e)}setCustomRenderer(e){this.customRenderer=e}removeCustomerRenderer(){this.customRenderer=void 0}addEventListener(e,t){console.log("addEventListener is deprecated. refactor your code.")}removeEventListener(e,t){console.log("removeEventListener is deprecated. refactor your code.")}dispatchEvent(e,t){console.log("dispatchEvent is deprecated. refactor your code.")}}class Ve extends ze{constructor(e){super(e),this.globals={...this.globals,inventory:[new fe(this,{type:E.Hoe}),new fe(this,{type:E.WateringCan}),new fe(this,{type:E.WheatSeeds,currentStackSize:5}),void 0,void 0,new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken}),new fe(this,{type:E.Chicken})],inventory_size:25,hotbar_size:5,hotbar_selected_index:0,disable_player_inputs:!1,gold:999},this.changeMap(Ge)}inventoryFirstStackWithRoom(e){for(let t=0;t<this.globals.inventory_size;t++){const i=this.globals.inventory[t];if(void 0!==i&&i.type===e&&!(i.currentStackSize>=i.maxStackSize))return t}}inventoryFirstFreeSlot(){for(let e=0;e<this.globals.inventory_size;e++)if(void 0===this.globals.inventory[e])return e}addToInventory(e){const t=this.inventoryFirstStackWithRoom(e);if(void 0!==t){const e=this.globals.inventory[t];return e.currentStackSize++,e}const i=this.inventoryFirstFreeSlot();if(void 0!==i){const t=new fe(this,{type:e});return this.globals.inventory[i]=t,t}}inventoryHasRoom(e){return!!this.inventoryFirstStackWithRoom(e)||!!this.inventoryFirstFreeSlot()}removeFromInventoryByIndex(e,t){const i=this.globals.inventory[e];if(void 0!==i&&!(i.currentStackSize<t))return i.currentStackSize-=t,0===i.currentStackSize&&(this.globals.inventory[e]=void 0),i}get selectedInventoryItem(){return this.globals.inventory[this.globals.hotbar_selected_index]}get selectedInventoryIndex(){return this.globals.hotbar_selected_index}}class Ue extends l{constructor(e,t){super(e,t),this.scene=e,this.width=6,this.height=2,this.clicked=!1,this.renderer.enabled=!0}onUpdate(e){this.updateClickStart(),this.updateClickEnd()}onRender(e){this.renderStartButton(e)}renderStartButton(e){t.renderSprite(e,u.images.tileset_button,this.clicked?6:0,2,this.transform.position.local.x,this.transform.position.local.y,this.width,this.height,{centered:!0})}updateClickStart(){o.wasObjectClicked(this)&&(this.clicked=!0)}updateClickEnd(){!0!==s.mouse.click.left&&!1!==this.clicked&&(o.isMouseWithinObject(this)?this.scene.changeScene(Ve):this.clicked=!1)}}const Ze=e.CANVAS_TILE_HEIGHT,Ke=e.CANVAS_TILE_WIDTH;class $e extends n{constructor(e){super(e),this.scene=e,this.height=Ze,this.width=Ke,this.backgroundLayers=[y],this.objects=[],o.setCursor(this.scene.displayContext.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.objects.push(new Ue(e,{renderLayer:15,positionX:16,positionY:9})),this.objects.push(new I(e,{}))}}class Je extends ze{constructor(e){super(e),this.client=e,this.changeMap($e)}}!function(){var e;const t=new URLSearchParams(window.location.search).get("scene"),i=null!==(e={"main-menu":Je,game:Ve}[t])&&void 0!==e?e:Je;u.initialise({images:{tileset_sample:"assets/16x16.png",tileset_grass:"assets/sample/Tilesets/Grass.png",tileset_hills:"assets/sample/Tilesets/Hills.png",tileset_water:"assets/sample/Tilesets/Water.png",tileset_player:"assets/sample/Characters/Basic Charakter Spritesheet.png",tileset_chicken:"assets/sample/Characters/Free Chicken Sprites.png",tileset_fence:"assets/sample/Tilesets/Fences.png",tileset_egg:"assets/sample/Characters/Egg_And_Nest.png",tileset_house:"assets/sample/Tilesets/Wooden House.png",tileset_dirt:"assets/sample/Tilesets/Tilled_Dirt.png",tileset_button:"assets/sample/UI Big Play Button.png",tileset_ui:"assets/sample/Sprite sheet for Basic Pack.png",tileset_wood_bridge:"assets/sample/Objects/Wood_Bridge.png",tileset_chest:"assets/sample/Objects/Chest.png",tileset_plants:"assets/sample/Objects/Basic_Plants.png",tileset_dialogue_box:"assets/sample/Dialouge UI/dialog box.png",tileset_tools:"assets/sample/Characters/Tools.png",tileset_fullscreen:"assets/custom/fullscreen.png"},audio:{}}),c.initHelpers(),window.engine=new p(document.getElementById("render-area"),i,c.engineMapList,c.engineObjectList,c.engineObjectDetails,c.engineControls)}()})();