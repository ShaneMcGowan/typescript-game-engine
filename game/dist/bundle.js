(()=>{"use strict";class t{static get CANVAS_HEIGHT(){return t.TILE_SIZE*t.CANVAS_TILE_HEIGHT}static get CANVAS_WIDTH(){return t.TILE_SIZE*t.CANVAS_TILE_WIDTH}static get ASPECT_RATIO(){return t.CANVAS_TILE_HEIGHT/t.CANVAS_TILE_WIDTH}static get UI_RENDER_LAYER(){return t.OBJECT_RENDERING_LAYERS-1}static get UI_COLLISION_LAYER(){return t.OBJECT_COLLISION_LAYERS-1}static get CANVAS_CENTER_TILE_Y(){return this.CANVAS_TILE_HEIGHT/2}static get CANVAS_CENTER_TILE_X(){return this.CANVAS_TILE_WIDTH/2}static get CANVAS_CENTER_PIXEL_X(){return t.CANVAS_WIDTH/2}static get CANVAS_CENTER_PIXEL_Y(){return t.CANVAS_HEIGHT/2}}t.CANVAS_TILE_HEIGHT=18,t.CANVAS_TILE_WIDTH=32,t.TILE_SIZE=16,t.OBJECT_RENDERING_LAYERS=16,t.OBJECT_COLLISION_LAYERS=16,t.CONTEXT_IMAGE_SMOOTHING_ENABLED=!1;class e{static renderSprite(e,i,s,n,o,r,a,h,d={}){var l,c;let p=a?a*t.TILE_SIZE:t.TILE_SIZE,u=h?h*t.TILE_SIZE:t.TILE_SIZE,g=null!==(l=d.scale)&&void 0!==l?l:1,m=null!==(c=d.rotation)&&void 0!==c?c:0,b=d.opacity&&d.opacity<1,y=0!==m,v=b||y;if(v&&(e.save(),b&&(e.globalAlpha=Math.max(0,d.opacity)),y)){let i=Math.floor((o+a/2)*t.TILE_SIZE)+.5,s=Math.floor((r+h/2)*t.TILE_SIZE)+.5;e.translate(i,s),e.rotate(m*Math.PI/180),e.translate(-i,-s)}let f=Math.floor(p/2),x=Math.floor(u/2);d.centered&&e.translate(-f,-x),e.drawImage(i,s*t.TILE_SIZE,n*t.TILE_SIZE,p,u,Math.floor(o*t.TILE_SIZE),Math.floor(r*t.TILE_SIZE),p*g,u*g),d.centered&&e.translate(f,x),v&&e.restore()}static renderSubsection(e,i,s,n,o,r){let a=Math.floor(s*t.TILE_SIZE),h=Math.floor(n*t.TILE_SIZE),d=Math.floor(o*t.TILE_SIZE),l=Math.floor(r*t.TILE_SIZE);i.drawImage(e.canvas,a,h,d-a,l-h,0,0,i.canvas.width,i.canvas.height)}static renderCircle(e,i,s,n={}){e.beginPath(),e.arc(i*t.TILE_SIZE+t.TILE_SIZE/2,s*t.TILE_SIZE+t.TILE_SIZE/2,t.TILE_SIZE/2,0,2*Math.PI),e.stroke(),e.fillStyle=n.colour||"saddlebrown",e.fill()}static fillRectangle(e,i,s,n,o,r={}){e.strokeStyle=r.colour?r.colour:"black",e.fillStyle=r.colour?r.colour:"black",e.beginPath(),e.rect(Math.floor(i*t.TILE_SIZE)+.5,Math.floor(s*t.TILE_SIZE)+.5,n*("tile"===r.type?t.TILE_SIZE:1)-1,o*("tile"===r.type?t.TILE_SIZE:1)-1),e.stroke(),e.fill()}static strokeRectangle(e,i,s,n,o,r={}){var a;e.strokeStyle=null!==(a=r.colour)&&void 0!==a?a:"black",e.lineWidth=1;let h="tile"===r.type?Math.floor(i*t.TILE_SIZE):i,d="tile"===r.type?Math.floor(s*t.TILE_SIZE):s,l="tile"===r.type?Math.floor(n*t.TILE_SIZE):n,c="tile"===r.type?Math.floor(o*t.TILE_SIZE):o;e.strokeRect(h+.5,d+.5,l-1,c-1)}static clearCanvas(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}static createCanvas(e,i){const s=document.createElement("canvas");return s.width=e?e*t.TILE_SIZE:t.CANVAS_WIDTH,s.height=i?i*t.TILE_SIZE:t.CANVAS_HEIGHT,s}static getContext(e){let i=e.getContext("2d");return i.imageSmoothingEnabled=t.CONTEXT_IMAGE_SMOOTHING_ENABLED,i}static positionToPixelPosition(e){return e*t.TILE_SIZE}static renderText(e,i,s,n,o={}){let r=o.size?o.size:16,a=o.colour?o.colour:"black",h=o.font?o.font:"Helvetica";e.font=`${r}px ${h}`,e.fillStyle=`${a}`,e.fillText(i,s*t.TILE_SIZE,n*t.TILE_SIZE)}static textToArray(t,e,i={}){var s,n;let o=null!==(s=i.size)&&void 0!==s?s:16,r=null!==(n=i.colour)&&void 0!==n?n:"black",a=i.font?i.font:"Helvetica",h=document.createElement("canvas").getContext("2d");h.font=`${o}px ${a}`,h.fillStyle=`${r}`;let d=t.split(" "),l="",c=[];for(let t=0;t<d.length;t++){let i=`${l} ${d[t]}`;h.measureText(i).width>=e?(c.push(i),l=""):d.length-1!==t?l=i.trim():c.push(i)}return c}}var i;!function(t){t.Left="left",t.Middle="middle",t.Right="right"}(i||(i={}));class s{static isKeyPressed(t){Array.isArray(t)||(t=[t]);for(const e of t)if(!0===this.keyboard[e])return!0;return!1}static setKeyPressed(t){Array.isArray(t)||(t=[t]);for(const e of t)this.keyboard[e]=!0}static clearKeyPressed(t){Array.isArray(t)||(t=[t]);for(const e of t)this.keyboard[e]=!1}static isMousePressed(t=i.Left){return this.mouse.click[t]}static clearMousePressed(t=i.Left){this.mouse.click[t]=!1}}s.keyboard={},s.mouse={click:{left:!1,middle:!1,right:!1},position:{x:0,y:0,exactX:0,exactY:0},wheel:{event:new WheelEvent("")},latestEvent:new MouseEvent("")};class n{static getMousePosition(e,i){let s,n=e.getBoundingClientRect(),o={height:n.height,width:n.width},r={clientX:i.clientX,clientY:i.clientY};if(e.width>e.height){s=e.width/n.width,o.height=e.height/s;let t=n.height-o.height;r.clientY-=t/2}else{s=e.height/n.height,o.width=e.width/s;let t=n.width-o.width;r.clientX-=t/2}let a=e.width/o.width,h=e.height/o.height,d=(r.clientX-n.left)*a/t.TILE_SIZE,l=(r.clientY-n.top)*h/t.TILE_SIZE;return{x:Math.floor(d),y:Math.floor(l),exactX:d,exactY:l}}static setCursor(t,e){t.style.cursor=`url("${e}"), auto`}static get isFullscreen(){return null!==document.fullscreenElement}static isMouseWithinBoundary(t,e,i,s,n){return t.exactX>=e&&t.exactX<=e+s&&t.exactY>=i&&t.exactY<=i+n}static isMouseWithinObject(t){return!!this.isMouseWithinBoundary(s.mouse.position,t.boundingBox.left,t.boundingBox.top,t.width,t.height)}static wasObjectClicked(t){return!!s.mouse.click.left&&!!this.isMouseWithinObject(t)}}class o{constructor(t){this.scene=t,this.globals={},this.context=this.scene.context,this.assets=this.scene.assets}destroy(){}}class r{constructor(t,e){this.x=t,this.y=e}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){let t=this.magnitude;return 0===t?new r(0,0):new r(this.x/t,this.y/t)}add(t){return new r(this.x+t.x,this.y+t.y)}subtract(t){return new r(this.x-t.x,this.y-t.y)}multiply(t){return new r(this.x*t,this.y*t)}divide(t){return new r(this.x/t,this.y/t)}}class a{get positionX(){return this.transform.position.x}get positionY(){return this.transform.position.y}get boundingBox(){return a.calculateBoundingBox(this.transform.position.x,this.transform.position.y,this.width,this.height)}constructor(t,e){var i,s,n,o,a,h;this.scene=t,this.id=crypto.randomUUID(),this.transform={position:new r(0,0),scale:1,rotation:1},this.collision={enabled:!1,layer:0},this.width=1,this.height=1,this.flaggedForRender=!0,this.flaggedForUpdate=!0,this.flaggedForDestroy=!1,this.children=new Array,this.parent=void 0,this.awakeRan=!1,this.mainContext=this.scene.context,this.assets=this.scene.assets,void 0!==e.positionX&&(this.transform.position.x=e.positionX),void 0!==e.positionY&&(this.transform.position.y=e.positionY),void 0!==e.width&&(this.width=e.width),void 0!==e.height&&(this.height=e.height),this.isRenderable=null!==(i=e.isRenderable)&&void 0!==i&&i,this.renderLayer=null!==(s=e.renderLayer)&&void 0!==s?s:0,this.renderOpacity=null!==(n=e.renderOpacity)&&void 0!==n?n:1,this.collision.enabled=null!==(o=e.collisionEnabled)&&void 0!==o&&o,this.collision.layer=null!==(a=e.collisionLayer)&&void 0!==a?a:0,this.renderScale=null!==(h=e.renderScale)&&void 0!==h?h:1}debuggerRenderBoundary(t){e.strokeRectangle(t,this.boundingBox.left,this.boundingBox.top,this.width,this.height,{colour:"red",type:"tile"})}debuggerRenderBackground(i){e.fillRectangle(i,this.boundingBox.left,this.boundingBox.top,Math.floor(this.width*t.TILE_SIZE),Math.floor(this.height*t.TILE_SIZE),{colour:"red"})}get cameraRelativePositionX(){return this.transform.position.x+this.scene.globals.camera.startX}get cameraRelativePositionY(){return this.transform.position.y+this.scene.globals.camera.startY}get pixelWidth(){return this.width*t.TILE_SIZE}get pixelHeight(){return this.height*t.TILE_SIZE}isCollidingWith(t){return this.isWithinHorizontalBounds(t)&&this.isWithinVerticalBounds(t)}isWithinHorizontalBounds(t){return t.boundingBox.left>=this.boundingBox.left&&t.boundingBox.left<=this.boundingBox.right||t.boundingBox.right>=this.boundingBox.left&&t.boundingBox.right<=this.boundingBox.right}isWithinVerticalBounds(t){return t.boundingBox.top>=this.boundingBox.top&&t.boundingBox.top<=this.boundingBox.bottom||t.boundingBox.bottom>=this.boundingBox.top&&t.boundingBox.bottom<=this.boundingBox.bottom}static calculateBoundingBox(t,e,i,s){let n=i/2,o=s/2;return{top:e-o,right:t+n,bottom:e+o,left:t-n}}}class h extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.width=1,this.height=1,this.isColliding=!1,e.width&&(this.width=e.width),e.height&&(this.height=e.height)}update(t){this.updateCollision()}render(t){let i=this.isColliding?"green":"red";e.fillRectangle(t,this.boundingBox.left,this.boundingBox.top,this.width,this.height,{colour:i,type:"tile"})}updateCollision(){if(this.collision.enabled){for(const t of this.scene.objects)if(t!==this&&this.boundingBox.left<t.boundingBox.right&&this.boundingBox.right>t.boundingBox.left&&this.boundingBox.top<t.boundingBox.bottom&&this.boundingBox.bottom>t.boundingBox.top)return void(this.isColliding=!0);this.isColliding=!1}}}class d{static get engineMapList(){return document.getElementById("map-list")||null}static get engineObjectList(){return document.getElementById("object-list")||null}static get engineObjectDetails(){return document.getElementById("object-details")||null}static get engineControls(){return{gridLines:document.getElementById("btnGridLines"),gridNumbers:document.getElementById("btnGridNumbers"),breakpoint:document.getElementById("btnBreakpoint"),fps:document.getElementById("btnFps"),objectCount:document.getElementById("btnObjectCount"),timingFrame:document.getElementById("btnTimingFrame"),timingFrameBackground:document.getElementById("btnTimingFrameBackground"),timingFrameRender:document.getElementById("btnTimingFrameRender"),timingFrameUpdate:document.getElementById("btnTimingFrameUpdate"),canvasLayers:document.getElementById("btnCanvasLayers"),fullscreen:document.getElementById("btnFullscreen"),renderBoundary:document.getElementById("btnRenderBoundary"),renderBackground:document.getElementById("btnRenderBackground")}}static initHelpers(){window.o=t=>window.engine.currentScene.objects.find((e=>e.id===t))}static changeScene(t){window.engine.changeScene(t)}static changeMap(t){window.engine.currentScene.changeMap(t)}}d.TEST_MAPS=[{name:"collision test",map:class extends o{constructor(t){super(t),this.scene=t,this.height=18,this.width=30,this.backgroundLayers=[],this.objects=[],this.initialiseNotColliding(),this.initialiseColliding()}initialiseNotColliding(){this.objects.push(new h(this.scene,{positionX:1.5,positionY:1.5})),this.objects.push(new h(this.scene,{positionX:2.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:1.5,positionY:2.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:4.5,positionY:1.5})),this.objects.push(new h(this.scene,{positionX:5.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:5.5,positionY:2.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:1.5,positionY:4.5})),this.objects.push(new h(this.scene,{positionX:2.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:1.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:5.5,positionY:4.5})),this.objects.push(new h(this.scene,{positionX:4.5,positionY:5.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:5.5,positionY:5.5,collisionEnabled:!0}))}initialiseColliding(){this.objects.push(new h(this.scene,{positionX:7.5,positionY:1.5})),this.objects.push(new h(this.scene,{positionX:8,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:7.5,positionY:2,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:11,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:11.5,positionY:1.5})),this.objects.push(new h(this.scene,{positionX:11.5,positionY:2,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:7.5,positionY:5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:8,positionY:5.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:7.5,positionY:5.5})),this.objects.push(new h(this.scene,{positionX:11.5,positionY:5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:11,positionY:5.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:11.5,positionY:5.5})),this.objects.push(new h(this.scene,{positionX:1.5,positionY:7.5})),this.objects.push(new h(this.scene,{positionX:2,positionY:7.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:3.5,positionY:7.5})),this.objects.push(new h(this.scene,{positionX:3.5,positionY:8,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:5.001,positionY:7.501,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:6,positionY:8.5})),this.objects.push(new h(this.scene,{positionX:8.499,positionY:7.501,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:7.5,positionY:8.5})),this.objects.push(new h(this.scene,{positionX:5.001,positionY:10.999,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:6,positionY:10})),this.objects.push(new h(this.scene,{positionX:8.499,positionY:10.999,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:7.5,positionY:10})),this.objects.push(new h(this.scene,{positionX:18,positionY:5,width:6,height:6,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:14.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:21.5,positionY:1.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:14.5,positionY:5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:5})),this.objects.push(new h(this.scene,{positionX:21.5,positionY:5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:14.5,positionY:8.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:8.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:21.5,positionY:8.5,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:14,width:6,height:6})),this.objects.push(new h(this.scene,{positionX:14.501,positionY:10.501,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18.001,positionY:10.501,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:21.499,positionY:10.501,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:14.501,positionY:14,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:14,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:21.499,positionY:14,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:14.501,positionY:17.499,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:18,positionY:17.499,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:21.499,positionY:17.499,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:3.5,positionY:15,width:5,height:1,collisionEnabled:!0})),this.objects.push(new h(this.scene,{positionX:3.5,positionY:15,width:1,height:5})),this.objects.push(new h(this.scene,{positionX:9.5,positionY:15,width:5,height:1})),this.objects.push(new h(this.scene,{positionX:9.5,positionY:15,width:1,height:5,collisionEnabled:!0}))}}}];class l{constructor(i,s,n,o,r,a,h){this.container=i,this.engineMapList=o,this.engineObjectList=r,this.engineObjectDetails=a,this.engineControls=h,this.CANVAS_HEIGHT=t.CANVAS_HEIGHT,this.CANVAS_WIDTH=t.CANVAS_WIDTH,this.delta=0,this.lastRenderTimestamp=0,this.assets={images:{},audio:{}},this.debug={enabled:!0,stats:{fps:!1,fpsCounter:0,objectCount:!1},breakpoint:{frame:!1},timing:{frame:!1,frameBackground:!1,frameUpdate:!1,frameRender:!1,frameDestroy:!1},ui:{grid:{lines:!1,numbers:!1},canvasLayers:!1},object:{renderBoundary:!1,renderBackground:!1}},this.gamepad=void 0,this.editorTimer=0,Object.keys(n.images).forEach((t=>{this.assets.images[t]=new Image,this.assets.images[t].src=n.images[t]})),Object.keys(n.audio).forEach((t=>{this.assets.audio[t]=new Audio(n.audio[t])})),this.debug.enabled&&(this.initialiseDebuggerState(),this.initialiseDebuggerListeners()),this.canvas=this.createCanvas(),this.context=e.getContext(this.canvas),i.append(this.canvas),document.addEventListener("visibilitychange",(t=>{"visible"===document.visibilityState?console.log("tab is active"):console.log("tab is inactive")})),this.initialiseMouseListeners(),this.initialiseKeyboardListeners(),this.intialiseGamepadListeners(),this.changeScene(s),this.frame(0)}createCanvas(){const t=e.createCanvas();return t.addEventListener("contextmenu",(t=>{t.preventDefault()})),t}changeScene(t){this.currentScene=Reflect.construct(t,[this])}frame(t){this.debug.breakpoint.frame,this.debug.timing.frame&&console.log(`[frame] ${this.delta}`),this.setDelta(t),e.clearCanvas(this.context),this.currentScene.frame(this.delta),this.debug.stats.fps&&(this.debug.stats.fpsCounter&&this.renderStats(0,"FPS",`${Math.round(1e3/(performance.now()-this.debug.stats.fpsCounter))} FPS`),this.debug.stats.fpsCounter=t),this.debug.stats.objectCount&&this.renderStats(1,"Objects",`${this.currentScene.objects.length} objects`),this.renderGrid(),this.currentScene.flaggedForMapChange&&this.currentScene.changeMap(this.currentScene.flaggedForMapChange),this.editorTimer+=this.delta,this.editorTimer>1&&(this.editor(),this.editorTimer=0),window.requestAnimationFrame(this.frame.bind(this))}setDelta(t){this.delta=(t-this.lastRenderTimestamp)/1e3,this.lastRenderTimestamp=t}renderStats(e,i,s){this.context.fillStyle="red",this.context.font="12px serif",this.context.fillText(s,this.CANVAS_WIDTH-50,(e+1)*t.TILE_SIZE)}renderGrid(){if((this.debug.ui.grid.lines||this.debug.ui.grid.numbers)&&e.fillRectangle(this.context,0,0,this.CANVAS_WIDTH,this.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.25)"}),this.debug.ui.grid.lines)for(let i=0;i<this.CANVAS_WIDTH;i+=t.TILE_SIZE)for(let s=0;s<this.CANVAS_HEIGHT;s+=t.TILE_SIZE)e.strokeRectangle(this.context,i,s,t.TILE_SIZE,t.TILE_SIZE,{colour:"black"});if(this.debug.ui.grid.numbers)for(let e=0;e<t.CANVAS_TILE_WIDTH;e++)for(let i=0;i<t.CANVAS_TILE_HEIGHT;i++)this.context.fillStyle="black",this.context.font="8px helvetica",this.context.fillText(`${e}`,e*t.TILE_SIZE+1,i*t.TILE_SIZE+8),this.context.fillText(`${i}`,e*t.TILE_SIZE+6,i*t.TILE_SIZE+14)}initialiseDebuggerState(){if(void 0!==this.engineControls&&this.engineControls.renderBoundary){const t=JSON.parse(localStorage.getItem("object.renderBoundary"));this.engineControls.renderBoundary.checked=t,this.debug.object.renderBoundary=t}}initialiseDebuggerListeners(){void 0!==this.engineControls&&(this.engineControls.gridLines&&this.engineControls.gridLines.addEventListener("click",(()=>{this.debug.ui.grid.lines=!this.debug.ui.grid.lines})),this.engineControls.gridNumbers&&this.engineControls.gridNumbers.addEventListener("click",(()=>{this.debug.ui.grid.numbers=!this.debug.ui.grid.numbers})),this.engineControls.breakpoint&&this.engineControls.breakpoint.addEventListener("click",(()=>{this.debug.breakpoint.frame=!this.debug.breakpoint.frame})),this.engineControls.fps&&this.engineControls.fps.addEventListener("click",(()=>{this.debug.stats.fps=!this.debug.stats.fps})),this.engineControls.objectCount&&this.engineControls.objectCount.addEventListener("click",(()=>{this.debug.stats.objectCount=!this.debug.stats.objectCount})),this.engineControls.timingFrame&&this.engineControls.timingFrame.addEventListener("click",(()=>{this.debug.timing.frame=!this.debug.timing.frame})),this.engineControls.timingFrameBackground&&this.engineControls.timingFrameBackground.addEventListener("click",(()=>{this.debug.timing.frameBackground=!this.debug.timing.frameBackground})),this.engineControls.timingFrameRender&&this.engineControls.timingFrameRender.addEventListener("click",(()=>{this.debug.timing.frameRender=!this.debug.timing.frameRender})),this.engineControls.timingFrameUpdate&&this.engineControls.timingFrameUpdate.addEventListener("click",(()=>{this.debug.timing.frameUpdate=!this.debug.timing.frameUpdate})),this.engineControls.canvasLayers&&this.engineControls.canvasLayers.addEventListener("click",(()=>{this.debug.ui.canvasLayers=!this.debug.ui.canvasLayers})),this.engineControls.renderBoundary&&this.engineControls.renderBoundary.addEventListener("click",(()=>{this.debug.object.renderBoundary=!this.debug.object.renderBoundary,localStorage.setItem("object.renderBoundary",JSON.stringify(this.debug.object.renderBoundary))})),this.engineControls.renderBackground&&this.engineControls.renderBackground.addEventListener("click",(()=>{this.debug.object.renderBackground=!this.debug.object.renderBackground})),this.engineControls.fullscreen&&this.engineControls.fullscreen.addEventListener("click",(()=>{this.canvas.requestFullscreen().catch((t=>{throw new Error(t)}))})))}initialiseKeyboardListeners(){console.log("[listener added] keydown"),document.addEventListener("keydown",(t=>{if(t.repeat)return;console.log("[keydown]",t);let e=t.key.toLocaleLowerCase();s.setKeyPressed(e)})),console.log("[listener added] keyup"),document.addEventListener("keyup",(t=>{if(t.repeat)return;console.log("[keyup]",t);let e=t.key.toLocaleLowerCase();s.clearKeyPressed(e)}))}initialiseMouseListeners(){console.log("[listener added] mousemove"),this.canvas.addEventListener("mousemove",(t=>{s.mouse.position=n.getMousePosition(this.canvas,t),s.mouse.latestEvent=t})),console.log("[listener added] mousedown"),this.canvas.addEventListener("mousedown",(t=>{switch(console.log("[mousedown]",t),t.button){case 0:s.mouse.click.left=!0;break;case 1:s.mouse.click.middle=!0;break;case 2:s.mouse.click.right=!0}})),console.log("[listener added] mouseup"),this.canvas.addEventListener("mouseup",(t=>{switch(console.log("[mouseup]",t),t.button){case 0:s.mouse.click.left=!1;break;case 1:s.mouse.click.middle=!1;break;case 2:s.mouse.click.right=!1}})),console.log("[listener added] touchstart"),this.canvas.addEventListener("touchstart",(t=>{console.log("[touchstart]",t),s.mouse.click.left=!0})),console.log("[listener added] touchend"),this.canvas.addEventListener("touchend",(t=>{console.log("[touchend]",t),s.mouse.click.left=!1})),console.log("[listener added] wheel"),this.canvas.addEventListener("wheel",(t=>{console.log("[wheel]",t),s.mouse.wheel.event=t}))}intialiseGamepadListeners(){window.addEventListener("gamepadconnected",(t=>{console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",t.gamepad.index,t.gamepad.id,t.gamepad.buttons.length,t.gamepad.axes.length),this.gamepad=t.gamepad})),window.addEventListener("gamepaddisconnected",(t=>{this.gamepad=void 0}))}editor(){if(null===this.engineObjectList||null===this.engineMapList)return;let t=document.createElement("ul");this.engineMapList.innerHTML="",this.engineMapList.appendChild(t),[...d.TEST_MAPS].forEach((e=>{let i=document.createElement("li");i.innerHTML=e.name,t.appendChild(i),i.addEventListener("click",(()=>{d.changeMap(e.map)}))}));let e=document.createElement("ul");this.engineObjectList.innerHTML="",this.engineObjectList.appendChild(e),this.currentScene.objects.forEach((t=>{let i=document.createElement("li");i.innerHTML=t.constructor.name,e.appendChild(i),i.addEventListener("click",(()=>{this.engineSelectedObjectId=t.id,this.updateEngineObjectDetails()}))}))}updateEngineObjectDetails(){if(void 0===this.engineSelectedObjectId)return;if(null===this.engineObjectDetails)return;let t=this.currentScene.objects.find((t=>t.id===this.engineSelectedObjectId));if(void 0===t)return;const e=this.engineObjectDetails.querySelector("#object-details-header"),i=this.engineObjectDetails.querySelector("#object-details-content");e.innerHTML=`<h3>${t.constructor.name}</h3>`,i.innerHTML="",Object.keys(t).forEach((e=>{"transform"===e?(i.innerHTML+=c(t.transform.position,"x"),i.innerHTML+=c(t.transform.position,"y")):i.innerHTML+=c(t,e)})),console.log(t)}}function c(t,e){let i="";return i+='<div style="display:flex; padding: 0.25rem 0;">',i+=`<span style="margin-right: auto;">${e}</span>`,i+=`<code>${t[e]}</code>`,i+="</div>",i}const p={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},u=[p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p],g={index:0,tiles:[u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u,u]};class m{static randomIntFromRange(t,e){return Math.floor(this.randomNumberFromRange(t,e))}static randomNumberFromRange(t,e){return Math.random()*(e-t+1)+t}static randomStartingDelta(t){return Math.random()*(null!=t?t:1)}}class b{get position(){return{x:this.targetX,y:this.targetY}}get target(){return{x:this.targetX,y:this.targetY}}constructor(t,e,i,s){this.positionX=t,this.positionY=e,this.targetX=i,this.targetY=s}}class y{static moveTowardsPosition(t,e){return t.targetX>t.positionX?(t.positionX+=e,t.targetX<t.positionX&&(t.positionX=t.targetX)):t.targetX<t.positionX?(t.positionX-=e,t.targetX>t.positionX&&(t.positionX=t.targetX)):t.targetY>t.positionY?(t.positionY+=e,t.targetY<t.positionY&&(t.positionY=t.targetY)):t.targetY<t.positionY&&(t.positionY-=e,t.targetY>t.positionY&&(t.positionY=t.targetY)),new b(t.positionX,t.positionY,t.targetX,t.targetY)}static moveTowardsOtherEntity(t,e){return e.positionX>t.positionX?t.targetX+=1:e.positionX<t.positionX?t.targetX-=1:e.positionY>t.positionY?t.targetY+=1:e.positionY<t.positionY&&(t.targetY-=1),new b(t.positionX,t.positionY,t.targetX,t.targetY)}static moveInRandomDirection(t){switch(m.randomIntFromRange(1,4)){case 1:t.targetX+=1;break;case 2:t.targetX-=1;break;case 3:t.targetY+=1;break;case 4:t.targetY-=1}return new b(t.positionX,t.positionY,t.targetX,t.targetY)}static frameSpeed(t,e){return t*e}static MoveTowards(t,e,i){let s=e.subtract(t),n=s.normalized.multiply(i);return n.magnitude>s.magnitude&&(n=s),n}}class v extends a{constructor(t,e){var i,s;super(t,e),this.scene=t,this.isRenderable=!0,this.width=1,this.height=1,this.targetX=-1,this.targetY=-1,this.movementSpeed=.5,void 0!==e.isRenderable&&(this.isRenderable=e.isRenderable),this.tileset=e.tileset,this.spriteX=e.spriteX,this.spriteY=e.spriteY,this.spriteHeight=e.spriteHeight,this.spriteWidth=e.spriteWidth,this.destroyAtTarget=null!==(i=e.destroyAtTarget)&&void 0!==i&&i,this.movementSpeed=null!==(s=e.movementSpeed)&&void 0!==s?s:.5}update(t){this.updatePosition(t)}updatePosition(t){if(this.transform.position.x===this.targetX&&this.transform.position.y===this.targetY)return void(this.destroyAtTarget&&this.scene.removeObjectById(this.id));let e=new b(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),i=this.movementSpeed*t,s=y.moveTowardsPosition(e,i);this.transform.position.x=s.positionX,this.transform.position.y=s.positionY}render(t){e.renderSprite(t,this.assets.images[this.tileset],this.spriteX,this.spriteY,this.transform.position.x,this.transform.position.y,this.spriteWidth,this.spriteWidth,{centered:!0})}}class f extends a{constructor(t,e){super(t,e),this.scene=t,this.newItemTimer=0}update(t){this.updateGenerateNewItem(t)}updateGenerateNewItem(e){if(this.newItemTimer+=e,this.newItemTimer<3)return;if(this.scene.objects.length>15)return;let i=m.randomIntFromRange(0,this.scene.map.height);this.scene.addObject(new v(this.scene,{positionX:t.CANVAS_TILE_WIDTH,positionY:i,targetX:-1,targetY:i,tileset:"tileset_egg",spriteX:1,spriteY:0,destroyAtTarget:!0})),this.newItemTimer=0}}var x,I,E;!function(t){t.Chicken="Chicken",t.Egg="Egg",t.WheatSeeds="WheatSeeds",t.Wheat="Wheat",t.TomatoSeeds="TomatoSeeds",t.Tomato="Tomato",t.Hoe="Hoe",t.WateringCan="WateringCan",t.Chest="Chest"}(x||(x={})),function(t){t.Player="Player",t.Anywhere="Anywhere",t.None="None"}(I||(I={})),function(t){t.Confirm="e",t.ConfirmAlt=" "}(E||(E={}));const S="tileset_dialogue_box",T=()=>{};class w extends a{constructor(e,i){var s,n,o,r,a;super(e,i),this.scene=e,this.isRenderable=!0,this.height=3,this.width=t.CANVAS_TILE_WIDTH,this.renderLayer=t.UI_RENDER_LAYER,this.textboxWidth=t.CANVAS_TILE_WIDTH-8,this.textboxBorder=2,this.textSize=10,this.textSegments=[],this.textIndex=0,this.characterIndex=0,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.completionTimer=0,void 0===i.positionX&&(this.transform.position.x=0),void 0===i.positionY&&(this.transform.position.y=t.CANVAS_TILE_HEIGHT-this.height),this.showOverlay=null===(s=i.showOverlay)||void 0===s||s,this.text=null!==(n=i.text)&&void 0!==n?n:"...",this.onComplete=null!==(o=i.onComplete)&&void 0!==o?o:T,this.portrait=i.portrait,this.name=i.name,this.completionDuration=i.completionDuration,this.scrollText=null===(r=i.scrollText)||void 0===r||r,this.scrollSpeed=null!==(a=i.scrollSpeed)&&void 0!==a?a:48,this.initText()}initText(){this.textSegments=e.textToArray(this.text,(this.textboxWidth-4)*t.TILE_SIZE,{size:this.textSize})}update(t){void 0!==this.completionDuration?this.updateTimer(t):this.updateConfirm(),this.scrollText&&this.updateScrollText(t),this.updatePortraitAnimation(t)}render(t){this.showOverlay&&this.renderOverlay(t),this.hasPortrait&&this.renderPortrait(t),this.generateTextbox(t),this.hasNamePlate&&this.renderNamePlate(t),this.renderText(t)}updateTimer(t){this.completionTimer+=t,this.completionTimer>=this.completionDuration&&(this.onComplete&&this.onComplete(),this.scene.removeObjectById(this.id))}updateScrollText(t){this.currentText.length>this.characterIndex&&(this.characterIndex+=this.scrollSpeed*t)}updateConfirm(){if(s.isKeyPressed([E.Confirm,E.ConfirmAlt])||s.isMousePressed(i.Left)){if(this.scrollText&&this.currentText.length>this.characterIndex)return this.characterIndex=this.currentText.length,s.clearKeyPressed([E.Confirm,E.ConfirmAlt]),void s.clearMousePressed(i.Left);this.textIndex+=2,this.characterIndex=0,this.textSegments.length<=this.textIndex&&(this.onComplete&&this.onComplete(),this.scene.removeObjectById(this.id)),s.clearKeyPressed([E.Confirm,E.ConfirmAlt]),s.clearMousePressed(i.Left)}}renderOverlay(i){e.fillRectangle(i,0,0,t.CANVAS_WIDTH,t.CANVAS_HEIGHT,{colour:"rgba(0, 0, 0, 0.5)"})}generateTextbox(i){let s=this.textboxWidth,n=(t.CANVAS_TILE_WIDTH-s)/2;e.renderSprite(i,this.assets.images[S],0,0,n,t.CANVAS_TILE_HEIGHT-4),e.renderSprite(i,this.assets.images[S],0,1,n,t.CANVAS_TILE_HEIGHT-3),e.renderSprite(i,this.assets.images[S],0,1,n,t.CANVAS_TILE_HEIGHT-2),e.renderSprite(i,this.assets.images[S],0,2,n,t.CANVAS_TILE_HEIGHT-1);for(let o=1;o<s-1;o++)e.renderSprite(i,this.assets.images[S],1,0,n+o,t.CANVAS_TILE_HEIGHT-4),e.renderSprite(i,this.assets.images[S],1,1,n+o,t.CANVAS_TILE_HEIGHT-3),e.renderSprite(i,this.assets.images[S],1,1,n+o,t.CANVAS_TILE_HEIGHT-2),e.renderSprite(i,this.assets.images[S],1,2,n+o,t.CANVAS_TILE_HEIGHT-1);e.renderSprite(i,this.assets.images[S],2,0,n+s-1,t.CANVAS_TILE_HEIGHT-4),e.renderSprite(i,this.assets.images[S],2,1,n+s-1,t.CANVAS_TILE_HEIGHT-3),e.renderSprite(i,this.assets.images[S],2,1,n+s-1,t.CANVAS_TILE_HEIGHT-2),e.renderSprite(i,this.assets.images[S],2,2,n+s-1,t.CANVAS_TILE_HEIGHT-1)}renderText(i){if(this.textLine1){let s=this.scrollText?this.textLine1.substring(0,this.characterIndex):this.textLine1;e.renderText(i,s,(t.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,t.CANVAS_TILE_HEIGHT-2-.25,{size:this.textSize})}if(this.textLine2){let s=this.scrollText?this.textLine2.substring(0,this.characterIndex-this.textLine1.length):this.textLine2;e.renderText(i,s,(t.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,t.CANVAS_TILE_HEIGHT-1-.25,{size:this.textSize})}}renderPortrait(t){e.renderSprite(t,this.assets.images[this.portrait.tileset],this.portrait.x,this.portrait.y,3,9,void 0,void 0,{scale:8})}renderNamePlate(i){e.fillRectangle(i,(t.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1,t.CANVAS_TILE_HEIGHT-4,6*t.TILE_SIZE,1*t.TILE_SIZE,{colour:"#e8cfa6"}),e.renderText(i,this.name,(t.CANVAS_TILE_WIDTH-this.textboxWidth)/2+1.25,t.CANVAS_TILE_HEIGHT-3-.25,{size:this.textSize})}updatePortraitAnimation(t){this.animationTimer=(this.animationTimer+t)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}get hasPortrait(){return void 0!==this.portrait}get hasNamePlate(){return void 0!==this.name}get textLine1(){return this.textSegments[this.textIndex]}get textLine2(){return this.textSegments[this.textIndex+1]}get currentText(){let t="";return this.textLine1&&(t+=this.textLine1),this.textLine2&&(t+=this.textLine2),t}}const _={x:1,y:1},C=[x.TomatoSeeds,x.WheatSeeds];var L;!function(t){t[t.Empty=0]="Empty",t[t.Watered=1]="Watered",t[t.Growing=2]="Growing",t[t.FullyGrown=3]="FullyGrown",t[t.Spoiled=4]="Spoiled"}(L||(L={}));const Y={[x.WheatSeeds]:{[L.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:0},[L.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:0},[L.Spoiled]:void 0},[x.TomatoSeeds]:{[L.Growing]:{tileset:"tileset_plants",spriteX:1,spriteY:1},[L.FullyGrown]:{tileset:"tileset_plants",spriteX:4,spriteY:1},[L.Spoiled]:void 0}};class X extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.renderLayer=6,this.spriteX=_.x,this.spriteY=_.y,this.counterDry=0,this.counterGrow=0,this.counterSpoil=0,this.currentlyGrowing=void 0,this.cropStage=L.Empty}onDirtPlaced(t){let e=this.scene.getAllObjectsAtPosition(this.transform.position.x-1,this.transform.position.y),i=this.scene.getAllObjectsAtPosition(this.transform.position.x+1,this.transform.position.y),s=(e.filter((t=>t instanceof X)).length,i.filter((t=>t instanceof X)).length,_);this.spriteX=s.x,this.spriteY=s.y}interact(){switch(this.cropStage){case L.Empty:return void this.interactStageEmpty();case L.FullyGrown:return void this.interactStageFullyGrown()}}interactStageEmpty(){this.scene.globals.disable_player_inputs=!0;let t=new w(this.scene,{text:"It's a beautiful patch of dirt, brimming with potential.",onComplete:()=>this.scene.globals.disable_player_inputs=!1});this.scene.addObject(t)}interactStageFullyGrown(){switch(console.log(`harvesting fully grown ${this.currentlyGrowing}`),this.currentlyGrowing){case x.TomatoSeeds:this.scene.addToInventory(x.Tomato);break;case x.WheatSeeds:this.scene.addToInventory(x.Wheat)}this.scene.removeObjectById(this.id)}get isEmpty(){return void 0===this.currentlyGrowing}update(t){this.cropStage===L.Empty||this.cropStage===L.Watered?this.counterDry+=t:this.cropStage===L.Growing?this.counterGrow+=t:this.cropStage===L.FullyGrown&&(this.counterSpoil+=t),this.isEmpty&&this.counterDry>15?this.scene.removeObjectById(this.id):this.cropStage===L.Growing&&this.counterGrow>5?this.cropStage=L.FullyGrown:this.cropStage===L.FullyGrown&&this.counterSpoil>86400&&(this.cropStage=L.Spoiled)}render(t){this.renderDirt(t),this.renderCrop(t)}destroy(){}renderDirt(t){let i=(this.cropStage,L.Empty,"tileset_dirt");e.renderSprite(t,this.scene.assets.images[i],this.spriteX,this.spriteY,this.transform.position.x,this.transform.position.y,1,1,{centered:!0})}renderCrop(t){if(this.cropStage===L.Empty||this.cropStage===L.Watered)return;if(this.currentlyGrowing!==x.TomatoSeeds&&this.currentlyGrowing!==x.WheatSeeds)return;let i=Y[this.currentlyGrowing][this.cropStage];void 0!==i&&e.renderSprite(t,this.scene.assets.images[i.tileset],i.spriteX,i.spriteY,this.transform.position.x,this.transform.position.y,1,1,{centered:!0})}actionWater(){this.cropStage===L.Empty&&(this.counterDry=0,this.cropStage=L.Watered)}actionPlant(){let t=this.scene.selectedInventoryItem;void 0!==t&&C.includes(t.type)&&this.cropStage===L.Watered&&(this.collision.enabled=!0,this.currentlyGrowing=t.type,this.cropStage=L.Growing,this.scene.removeFromInventory(this.scene.globals.hotbar_selected_index))}}const k=t.UI_RENDER_LAYER,j=t.UI_COLLISION_LAYER,A=[{x:11,y:15},{x:13,y:15},{x:15,y:15},{x:17,y:15},{x:19,y:15},{x:11,y:6},{x:13,y:6},{x:15,y:6},{x:17,y:6},{x:19,y:6},{x:11,y:8},{x:13,y:8},{x:15,y:8},{x:17,y:8},{x:19,y:8},{x:11,y:10},{x:13,y:10},{x:15,y:10},{x:17,y:10},{x:19,y:10},{x:11,y:12},{x:13,y:12},{x:15,y:12},{x:17,y:12},{x:19,y:12}],B=[{x:7,y:1},{x:9,y:1},{x:11,y:1},{x:13,y:1},{x:15,y:1},{x:17,y:1},{x:19,y:1},{x:21,y:1},{x:23,y:1},{x:7,y:3},{x:9,y:3},{x:11,y:3},{x:13,y:3},{x:15,y:3},{x:17,y:3},{x:19,y:3},{x:21,y:3},{x:23,y:3},{x:7,y:5},{x:9,y:5},{x:11,y:5},{x:13,y:5},{x:15,y:5},{x:17,y:5},{x:19,y:5},{x:21,y:5},{x:23,y:5}];var O;!function(t){t.Close="tab"}(O||(O={}));class H extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.renderLayer=k,this.collisionLayer=j,this.showInventory=!0,this.showHotbar=!0,this.chest=void 0,this.itemHolding=void 0,this.scene.globals.disable_player_inputs=!0,this.chest=e.chest}update(t){this.updatePickUpItem(),this.updateDropItem(),this.updateClose()}render(t){if(this.showHotbar){let e=11,i=15;this.renderInventoryBackground(t,e,i),this.renderInventoryContainers(t,e,i),this.renderInventoryItems(t,e,i,this.inventory.slice(0,this.hotbarSize)),this.showInventory||this.renderHotbarSelector(t)}if(this.chest){this.renderChestHeader(t,7,0);for(let e=0;e<3;e++){let i=7,s=1+2*e;this.renderInventoryBackground(t,i,s),this.renderInventoryContainers(t,i,s),this.renderInventoryItems(t,i,s,this.chest.inventory.slice(this.hotbarSize*e,this.hotbarSize*(e+1)))}}if(this.showInventory){this.renderInventoryHeader(t,11,5);for(let e=0;e<4;e++){let i=11,s=6+2*e;this.renderInventoryBackground(t,i,s),this.renderInventoryContainers(t,i,s),this.renderInventoryItems(t,i,s,this.inventory.slice(this.hotbarSize*(e+1),this.hotbarSize*(e+2)))}this.renderInventoryItemGrabbed(t)}}destroy(){this.scene.globals.disable_player_inputs=!1,this.chest&&this.chest.actionClose()}renderHotbarSelector(t){const i=11+2*this.hotbarSelectedIndex;e.renderSprite(t,this.assets.images.tileset_ui,9,9,i,15,2,2)}renderInventoryHeader(i,s,n){let o=4*t.TILE_SIZE,r=2*t.TILE_SIZE;e.fillRectangle(i,s,n,o,r,{colour:"saddlebrown"}),e.renderText(i,"Inventory",s+.4,n+.75,{size:12,colour:"white"})}renderChestHeader(i,s,n){let o=4*t.TILE_SIZE,r=2*t.TILE_SIZE;e.fillRectangle(i,s,n,o,r,{colour:"saddlebrown"}),e.renderText(i,"Chest",s+.9,n+.75,{size:12,colour:"white"})}renderInventoryBackground(i,s,n){let o=2*t.TILE_SIZE*this.scene.globals.hotbar_size,r=2*t.TILE_SIZE;e.fillRectangle(i,s,n,o,r,{colour:"saddlebrown"})}renderInventoryContainers(t,i,s){for(let n=0;n<this.scene.globals.hotbar_size;n++)e.renderSprite(t,this.assets.images.tileset_ui,.5,3.5,i+2*n,s,2,2)}renderInventoryItems(t,e,i,s){for(let n=0;n<9;n++){let o=s[n];void 0!==o&&this.renderInventoryItem(t,o.sprite.tileset,o.currentStackSize,o.maxStackSize,o.sprite.spriteX,o.sprite.spriteY,e+.5+2*n,i+.5)}}renderInventoryItemGrabbed(t){if(void 0===this.itemHolding)return;let e=this.itemHolding.item;this.renderInventoryItem(t,e.sprite.tileset,e.currentStackSize,e.maxStackSize,e.sprite.spriteX,e.sprite.spriteY,s.mouse.position.exactX-.5,s.mouse.position.exactY-.5)}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}get hotbarSize(){return this.scene.globals.hotbar_size}get hotbarSelectedIndex(){return this.scene.globals.hotbar_selected_index}updatePickUpItem(){if(void 0!==this.itemHolding)return;let t=this.getIndexFromPositionMap(s.mouse.position,A);if(void 0===t){if(void 0!==this.chest){let t=this.getIndexFromPositionMap(s.mouse.position,B);if(void 0!==t){let e=this.chest.inventory[t];if(void 0===e)return;return void(this.itemHolding={location:"chest",item:e,index:t})}}this.itemHolding=void 0}else{let e=this.inventory[t];if(void 0===e)return;this.itemHolding={location:"inventory",item:e,index:t}}}updateDropItem(){if(void 0===this.itemHolding)return;if(!0===s.mouse.click.left)return;let t=this.getIndexFromPositionMap(s.mouse.position,A);if(void 0!==t){let e=this.inventory[t];return"inventory"===this.itemHolding.location?(this.inventory[t]=this.itemHolding.item,this.inventory[this.itemHolding.index]=e):"chest"===this.itemHolding.location&&(this.inventory[t]=this.itemHolding.item,this.chest.inventory[this.itemHolding.index]=e),void(this.itemHolding=void 0)}if(void 0!==this.chest){let t=this.getIndexFromPositionMap(s.mouse.position,B);if(void 0!==t){let e=this.chest.inventory[t];return"inventory"===this.itemHolding.location?(this.chest.inventory[t]=this.itemHolding.item,this.inventory[this.itemHolding.index]=e):"chest"===this.itemHolding.location&&(this.chest.inventory[t]=this.itemHolding.item,this.chest.inventory[this.itemHolding.index]=e),void(this.itemHolding=void 0)}}this.itemHolding=void 0}updateClose(){s.isKeyPressed(O.Close)&&(s.clearKeyPressed(O.Close),this.scene.removeObjectById(this.id))}renderInventoryItem(t,i,s,n,o,r,a,h){e.renderSprite(t,this.assets.images[i],o,r,a,h),n>1&&e.renderText(t,`${s}`,a+.75,h+1,{size:8,colour:"black"})}getIndexFromPositionMap(t,e){for(let i=0;i<e.length;i++){let s=e[i];if(t.x>=s.x&&t.x<=s.x+1&&t.y>=s.y&&t.y<=s.y+1)return i}}}const M={tileset:"tileset_chicken",x:0,y:0},R="tileset_chest";class N extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.renderLayer=8,this.width=1,this.height=1,this.isOpen=!1,this.inventory=[],this.collision.enabled=!0}render(t){this.renderSprite(t)}interact(){this.actionOpen()}actionOpen(){this.isOpen=!0,this.scene.addObject(new H(this.scene,{positionX:0,positionY:0,chest:this}))}actionClose(){this.isOpen=!1}renderSprite(t){this.isOpen?e.renderSprite(t,this.scene.assets.images[R],13,.5,this.transform.position.x,this.transform.position.y-.5,1,2,{centered:!0}):e.renderSprite(t,this.scene.assets.images[R],1,.5,this.transform.position.x,this.transform.position.y-.5,1,2,{centered:!0})}}var P,D;!function(t){t.UP="w",t.DOWN="s",t.LEFT="a",t.RIGHT="d"}(P||(P={})),function(t){t.Inventory="tab",t.Interact="e",t.InteractAlt=" "}(D||(D={}));class W extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.renderLayer=10,this.width=1,this.height=1,this.targetX=-1,this.targetY=-1,this.movementSpeed=4,this.animations={[P.RIGHT]:[{x:7,y:10},{x:10,y:10}],[P.LEFT]:[{x:7,y:7},{x:10,y:7}],[P.UP]:[{x:7,y:4},{x:10,y:4}],[P.DOWN]:[{x:7,y:1},{x:10,y:1}]},this.animationsIdle={[P.RIGHT]:[{x:1,y:10},{x:4,y:10}],[P.LEFT]:[{x:1,y:7},{x:4,y:7}],[P.UP]:[{x:1,y:4},{x:4,y:4}],[P.DOWN]:[{x:1,y:1},{x:4,y:1}]},this.direction=P.DOWN,this.directionTime=0,this.directionTimer=0,this.animationIndex=0,this.isIdle=!0,this.movementEnabled=!1,this.hotbarEnabled=!1,this.leftClickEnabled=!1,this.inventoryEnabled=!1,this.interactButtonEnabled=!1,this.collision.enabled=!0,this.targetX=this.positionX,this.targetY=this.positionY,this.enableMovement(),this.enableInteractKeys(),this.enableInventoryKeys(),this.enableOtherKeys()}enableMovement(){this.movementEnabled=!0}enableOtherKeys(){this.hotbarEnabled=!0,this.leftClickEnabled=!0}enableInventoryKeys(){this.inventoryEnabled=!0}enableInteractKeys(){this.interactButtonEnabled=!0}update(t){this.updateMovement(t),this.updateAnimations(t),this.updateHotbarViaKey(),this.updateHotbarViaWheel(),this.updateLeftClick(),this.updateButtonInteract(),this.updateOpenInventory(),this.latestScrollTimestamp=s.mouse.wheel.event.timeStamp}render(t){this.renderSprite(t),this.renderCursor(t)}updateMovement(t){!0!==this.scene.globals.disable_player_inputs&&!1!==this.movementEnabled&&(this.determineNextMovement(t),this.processMovement(t))}determineNextMovement(t){if(this.targetX!==this.transform.position.x||this.targetY!==this.transform.position.y)return;if(!s.isKeyPressed([P.RIGHT,P.LEFT,P.UP,P.DOWN]))return;let e,i=new b(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY);if(s.isKeyPressed(P.RIGHT)?(i.targetX+=1,e=P.RIGHT):s.isKeyPressed(P.LEFT)?(i.targetX-=1,e=P.LEFT):s.isKeyPressed(P.UP)?(i.targetY-=1,e=P.UP):s.isKeyPressed(P.DOWN)&&(i.targetY+=1,e=P.DOWN),this.direction!==e?(this.direction=e,this.directionTime=0,this.directionTimer=0):this.directionTimer+=t,this.directionTimer<.05)return;console.log(i);const n=a.calculateBoundingBox(i.target.x,i.target.y,this.width,this.height);console.log(n),this.scene.hasCollisionAtBoundingBox(n,this)||this.scene.isOutOfBounds(i.targetX,i.targetY)||(this.targetX=i.targetX,this.targetY=i.targetY)}updateAnimations(t){this.targetX!==this.transform.position.x||this.targetY!==this.transform.position.y?this.isIdle=!1:this.isIdle=!0,this.isIdle?this.directionTime<.5?this.animationIndex=0:this.animationIndex=1:this.directionTime<.25?this.animationIndex=0:this.directionTime<.5?this.animationIndex=1:this.directionTime<.75?this.animationIndex=0:this.animationIndex=1,this.directionTime=(this.directionTime+t)%1}processMovement(t){if(this.targetX!==this.transform.position.x||this.targetY!==this.transform.position.y){let e=new b(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),i=y.moveTowardsPosition(e,y.frameSpeed(this.movementSpeed,t));this.transform.position.x=i.positionX,this.transform.position.y=i.positionY}}updateButtonInteract(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.interactButtonEnabled)return;if(!s.isKeyPressed([D.Interact,D.InteractAlt]))return;s.clearKeyPressed([D.Interact,D.InteractAlt]);let t=this.transform.position.x+this.scene.globals.camera.startX,e=this.transform.position.y+this.scene.globals.camera.startY;switch(this.direction){case P.UP:e-=1;break;case P.RIGHT:t+=1;break;case P.DOWN:e+=1;break;case P.LEFT:t-=1}let i=this.scene.getObjectAtPosition(t,e,this);void 0!==i&&function(t){return"interact"in t}(i)&&i.interact()}destroy(){}getPositionFacing(){let t=Math.floor(this.transform.position.x),e=Math.floor(this.transform.position.y);return this.direction===P.RIGHT?{x:t+1,y:e}:this.direction===P.LEFT?{x:t-1,y:e}:this.direction===P.UP?{x:t,y:e-1}:this.direction===P.DOWN?{x:t,y:e+1}:void 0}updateHotbarViaKey(){!0!==this.scene.globals.disable_player_inputs&&!1!==this.hotbarEnabled&&(!0!==s.isKeyPressed("1")?!0!==s.isKeyPressed("2")?!0!==s.isKeyPressed("3")?!0!==s.isKeyPressed("4")?!0!==s.isKeyPressed("5")||(this.scene.globals.hotbar_selected_index=4):this.scene.globals.hotbar_selected_index=3:this.scene.globals.hotbar_selected_index=2:this.scene.globals.hotbar_selected_index=1:this.scene.globals.hotbar_selected_index=0)}updateHotbarViaWheel(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.hotbarEnabled)return;if(this.latestScrollTimestamp===s.mouse.wheel.event.timeStamp)return;const t=this.scene.globals.hotbar_selected_index;s.mouse.wheel.event.deltaY>0?t===this.scene.globals.hotbar_size-1?this.scene.globals.hotbar_selected_index=0:this.scene.globals.hotbar_selected_index++:s.mouse.wheel.event.deltaY<0&&(0===t?this.scene.globals.hotbar_selected_index=this.scene.globals.hotbar_size-1:this.scene.globals.hotbar_selected_index--)}updateOpenInventory(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.inventoryEnabled)return;let t=[D.Inventory];!1!==s.isKeyPressed(t)&&(this.scene.addObject(new H(this.scene,{positionX:0,positionY:0})),s.clearKeyPressed(t))}updateLeftClick(){if(!0===this.scene.globals.disable_player_inputs)return;if(!1===this.leftClickEnabled)return;if(!s.isMousePressed(i.Left))return;s.clearMousePressed(i.Left);let t=this.scene.selectedInventoryItem;if(void 0===t)return;let e=this.scene.getObjectAtPosition(s.mouse.position.x,s.mouse.position.y,this);if(void 0===e)switch(t.type){case x.Hoe:return void function(t,e){const i=Math.floor(e.positionX),n=Math.floor(e.positionY),o=s.mouse.position.x,r=s.mouse.position.y;if(console.log({x:Math.abs(o-i),y:Math.abs(r-n)}),Math.abs(o-i)>1||Math.abs(r-n)>1)return;const a=new X(t,{positionX:o,positionY:r});t.addObject(a)}(this.scene,this);case x.WateringCan:return(n=this.scene).globals.disable_player_inputs=!0,void n.addObject(new w(n,{text:"There is nothing to water...",onComplete:()=>{n.globals.disable_player_inputs=!1}}));case x.Chicken:return void function(t){let e=s.mouse.position,i=new z(t,{positionX:e.x,positionY:e.y});t.addObject(i),t.removeFromInventory(t.selectedInventoryIndex)}(this.scene);case x.Egg:return void function(t){let e=s.mouse.position,i=new F(t,{positionX:e.x,positionY:e.y});t.addObject(i),t.removeFromInventory(t.selectedInventoryIndex)}(this.scene);case x.TomatoSeeds:case x.WheatSeeds:return void function(t){t.globals.disable_player_inputs=!0,t.addObject(new w(t,{text:"Seeds can only be placed in dirt.",onComplete:()=>{t.globals.disable_player_inputs=!1}}))}(this.scene);case x.Chest:return void function(t){const e=s.mouse.position.x,i=s.mouse.position.y,n=new N(t,{positionX:e,positionY:i});t.addObject(n),t.removeFromInventory(t.selectedInventoryIndex)}(this.scene);default:return}else switch(t.type){case x.WateringCan:switch(!0){case e instanceof X:return void function(t,e){e.actionWater()}(this.scene,e);case e instanceof z:return void function(t,e){t.globals.disable_player_inputs=!0,t.addObject(new w(t,{text:"Hey could you not water me please...",portrait:M,name:"Chicken",onComplete:()=>{t.globals.disable_player_inputs=!1}}))}(this.scene);default:return}case x.TomatoSeeds:case x.WheatSeeds:return 1==e instanceof X?void function(t,e){e.actionPlant()}(this.scene,e):void 0;case x.Tomato:case x.Wheat:return 1==e instanceof z?void function(t,e){e.actionGiveItem()}(this.scene,e):void 0;default:return}var n}renderSprite(t){let i=this.isIdle?this.animationsIdle:this.animations;e.renderSprite(t,this.assets.images.tileset_player,i[this.direction][this.animationIndex].x,i[this.direction][this.animationIndex].y,this.transform.position.x,this.transform.position.y,void 0,void 0,{centered:!0})}renderCursor(t){if(!this.leftClickEnabled)return;let i=s.mouse.position.x+this.scene.globals.camera.startX,n=s.mouse.position.y+this.scene.globals.camera.startY,o=this.scene.selectedInventoryItem;void 0!==o&&o.radius!==I.None&&(i===Math.floor(this.transform.position.x)&&n===Math.floor(this.transform.position.y)||o.radius===I.Player&&(Math.abs(i-Math.floor(this.transform.position.x))>1||Math.abs(n-Math.floor(this.transform.position.y))>1)||e.fillRectangle(t,i,n,1,1,{colour:"#ff000033",type:"tile"}))}calculateRelativeMousePosition(){let t,e=s.mouse.position.x-this.transform.position.x;t=0===e?0:e>0?1:-1;let i,n=s.mouse.position.y-this.transform.position.y;return i=0===n?0:n>0?1:-1,{x:this.transform.position.x+t,y:this.transform.position.y+i}}}class F extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.renderLayer=7,this.width=1,this.height=1,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=0,this.animationIndex=0,this.hatchTimer=0,this.hatchTimerMax=7,this.collision.enabled=!0}update(t){this.updateAnimation(t),this.updateHatch(t)}render(t){e.renderSprite(t,this.assets.images.tileset_egg,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.x,this.transform.position.y,1,1,{centered:!0})}destroy(){}updateAnimation(t){this.animationTimer=(this.animationTimer+t)%1,this.animationIndex=0}updateHatch(t){if(this.hatchTimer+=t,this.hatchTimer<this.hatchTimerMax)return;let e=this.scene.getObjectsByType(W)[0],i=new z(this.scene,{positionX:this.transform.position.x,positionY:this.transform.position.y,follows:e});this.scene.removeObjectById(this.id),this.scene.addObject(i)}interact(){this.scene.addToInventory(x.Egg),this.scene.removeObjectById(this.id)}}const G={tileset:"tileset_chicken",x:0,y:0};class z extends a{constructor(t,e){var i,s;console.log("[ChickenObject] created"),super(t,e),this.scene=t,this.isRenderable=!0,this.renderLayer=8,this.width=1,this.height=1,this.targetX=-1,this.targetY=-1,this.animations={idle:[{x:0,y:0},{x:1,y:0}]},this.animationTimer=m.randomStartingDelta(4),this.animationIndex=0,this.movementSpeed=2,this.movementTimer=m.randomStartingDelta(2),this.movementDelay=2,this.eggTimer=m.randomStartingDelta(2),this.eggTimerMax=7,this.eggMax=200,this.isMovingThisFrame=!1,this.isEdgyTeen=!1,this.collision.enabled=!0,this.targetX=this.positionX,this.targetY=this.positionY,this.canLayEggs=null!==(i=e.canLayEggs)&&void 0!==i&&i,this.isEdgyTeen=3===m.randomIntFromRange(0,3),this.canMove=null!==(s=e.canMove)&&void 0!==s&&s,this.following=e.follows}update(t){this.isMovingThisFrame=!1,this.updateMovement(t),this.updateAnimation(t),this.updateEgg(t)}render(t){e.renderSprite(t,this.assets.images.tileset_chicken,this.animations.idle[this.animationIndex].x,this.animations.idle[this.animationIndex].y,this.transform.position.x,this.transform.position.y,void 0,void 0,{centered:!0})}destroy(){console.log("[ChickenObject] destroyed")}updateAnimation(t){this.animationTimer=(this.animationTimer+t)%4,this.animationTimer<3.5?this.animationIndex=0:this.animationIndex=1}updateMovement(t){this.canMove&&(this.movementTimer+=t,this.movementTimer>this.movementDelay&&this.determineNextMovement(t),this.processMovement(t))}determineNextMovement(t){let e;this.movementTimer=0,e=this.following?y.moveTowardsOtherEntity(new b(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),{positionX:this.following.positionX,positionY:this.following.positionY}):y.moveInRandomDirection(new b(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY)),this.scene.hasCollisionAtPosition(e.targetX,e.targetY,this)||this.scene.isOutOfBounds(e.targetX,e.targetY)||(this.targetX=e.targetX,this.targetY=e.targetY)}processMovement(t){if(this.targetX!==this.transform.position.x||this.targetY!==this.transform.position.y){let e=new b(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),i=y.moveTowardsPosition(e,y.frameSpeed(this.movementSpeed,t));this.transform.position.x=i.positionX,this.transform.position.y=i.positionY,this.isMovingThisFrame=!0}}updateEgg(t){if(!this.canLayEggs)return;if(this.eggTimer+=t,this.eggTimer<this.eggTimerMax)return;if(!this.isMovingThisFrame)return;let e;this.scene.getObjectsByType(z).length+this.scene.getObjectsByType(F).length>this.eggMax||(e=this.transform.position.x>this.targetX||this.transform.position.y>this.targetY?Math.ceil:Math.floor,this.scene.addObject(new F(this.scene,{positionX:e(this.transform.position.x),positionY:e(this.transform.position.y)})),this.eggTimer=0)}interact(){this.interactDefault()}interactDefault(){this.scene.globals.disable_player_inputs=!0;let t=new w(this.scene,{text:this.isEdgyTeen?"GET OUT OF MY ROOM MOM! GODDDD!!!!":"bock bock... can i help you? ... cluck cluck ...",portrait:G,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(t)}actionGiveItem(){switch(this.scene.selectedInventoryItem.type){case x.Tomato:return void this.actionGiveTomato();case x.Wheat:return void this.actionGiveWheat()}}actionGiveTomato(){this.scene.globals.disable_player_inputs=!0;let t=new w(this.scene,{text:"I LOooOooOoOooOoOVE TOMATOES!",portrait:G,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}),e=this.scene.globals.inventory.indexOf(this.scene.selectedInventoryItem);this.scene.removeFromInventory(e),this.scene.addObject(t)}actionGiveWheat(){this.scene.globals.disable_player_inputs=!0;let t=new w(this.scene,{text:"I HAAAAAAAAAAAAAAAATE WHEAT!",portrait:G,name:"Chicken",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}});this.scene.addObject(t)}}const V={tileset:"tileset_water",animationFrameDuration:1,animationFrames:[{spriteX:0,spriteY:0},{spriteX:1,spriteY:0},{spriteX:2,spriteY:0},{spriteX:3,spriteY:0}],animationMap:[.25,.5,.75,1]},Z=[V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V,V],U={index:0,tiles:[[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z],[...Z]]},K={tileset:"tileset_hills",animationFrameDuration:1,animationFrames:[],animationMap:[1]},$={...K,animationFrames:[{spriteX:2,spriteY:1}]},J={...K,animationFrames:[{spriteX:1,spriteY:2}]},q={...K,animationFrames:[{spriteX:2,spriteY:2}]},Q={...K,animationFrames:[{spriteX:5,spriteY:1}]},tt={...K,animationFrames:[{spriteX:9,spriteY:4}]},et={...K,animationFrames:[{spriteX:9,spriteY:5}]},it={...K,animationFrames:[{spriteX:10,spriteY:5}]},st={index:1,tiles:[[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Q,$,$,$,$,$,$,q],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,tt,et,{...K,animationFrames:[{spriteX:9,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,tt,it,{...K,animationFrames:[{spriteX:10,spriteY:6}]}],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,void 0,void 0,$,$,q],[void 0,void 0,void 0,void 0,void 0,q],[void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,J],[void 0,void 0,void 0,void 0,J],[$,$,$,$,q]]};class nt extends a{constructor(t,e){super(t,e),this.scene=t,this.collision.enabled=!0}}const ot={tileset:"tileset_grass",animationFrameDuration:1,animationFrames:[],animationMap:[1]},rt={...ot,animationFrames:[{spriteX:1,spriteY:1}]},at=[rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,{...ot,animationFrames:[{spriteX:1,spriteY:2}]}],ht={index:1,tiles:[at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at]};class dt extends a{constructor(i,s){super(i,s),this.scene=i,this.customerRenderer=i=>{let s=this.object.positionX-this.cameraOffsetX,n=this.object.positionY-this.cameraOffsetY,o=this.object.positionX+(this.cameraOffsetX+1),r=this.object.positionY+(this.cameraOffsetY+1);s<0?(s=0,o=s+t.CANVAS_TILE_WIDTH):o>this.scene.map.width&&(o=this.scene.map.width,s=o-t.CANVAS_TILE_WIDTH),n<0?(n=0,r=n+t.CANVAS_TILE_HEIGHT):r>this.scene.map.height&&(r=this.scene.map.height,n=r-t.CANVAS_TILE_HEIGHT),this.scene.globals.camera.startX=s,this.scene.globals.camera.startY=n,this.scene.globals.camera.endX=o,this.scene.globals.camera.endY=r,i.background.forEach((t=>{e.renderSubsection(t,this.mainContext,s,n,o,r)})),i.objects.forEach(((i,a)=>{a===t.UI_RENDER_LAYER?e.renderSubsection(i,this.mainContext,0,0,t.CANVAS_TILE_WIDTH,t.CANVAS_TILE_HEIGHT):e.renderSubsection(i,this.mainContext,s,n,o,r)}))};let n=t.CANVAS_TILE_WIDTH/2-.5,o=t.CANVAS_TILE_HEIGHT/2-.5;this.cameraOffsetX=s.zoom?n/s.zoom:n,this.cameraOffsetY=s.zoom?o/s.zoom:o,this.object=s.object,this.scene.setCustomRenderer(this.customerRenderer)}destroy(){this.scene.removeCustomerRenderer()}}const lt=t.UI_RENDER_LAYER,ct=t.UI_COLLISION_LAYER;class pt extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.renderLayer=lt,this.collisionLayer=ct,this.height=2,this.width=10}update(t){}render(t){this.renderBackground(t),this.renderContainers(t),this.renderItems(t,this.inventory.slice(0,this.hotbarSize)),this.renderHotbarSelector(t)}renderHotbarSelector(t){const i=this.boundingBox.left+1+2*this.hotbarSelectedIndex,s=this.boundingBox.top+1;e.renderSprite(t,this.assets.images.tileset_ui,9,9,i,s,2,2,{centered:!0})}renderBackground(t){e.fillRectangle(t,this.boundingBox.left,this.boundingBox.top,this.width,this.height,{colour:"saddlebrown",type:"tile"})}renderContainers(t){for(let i=0;i<5;i++)e.renderSprite(t,this.assets.images.tileset_ui,.5,3.5,this.boundingBox.left+1+2*i,this.boundingBox.top+1,2,2,{centered:!0})}renderItems(t,e){for(let i=0;i<5;i++){let s=e[i];void 0!==s&&this.renderInventoryItem(t,s.sprite.tileset,s.currentStackSize,s.maxStackSize,s.sprite.spriteX,s.sprite.spriteY,this.boundingBox.left+1+2*i,this.boundingBox.top+1)}}renderInventoryItem(t,i,s,n,o,r,a,h){e.renderSprite(t,this.assets.images[i],o,r,a,h,1,1,{centered:!0}),n>1&&e.renderText(t,`${s}`,a+.75,h+1,{size:8,colour:"black"})}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}get hotbarSize(){return this.scene.globals.hotbar_size}get hotbarSelectedIndex(){return this.scene.globals.hotbar_selected_index}}class ut{constructor(t,e){this.tileset=t,this.frames=e,this.duration=e.reduce(((t,e)=>t+e.duration),0)}currentFrame(t){let e=t%this.duration,i=0;for(let t=0;t<this.frames.length;t++)if(i+=this.frames[t].duration,e<i)return this.frames[t];return this.frames[0]}}const gt={tileset:"tileset_chicken",x:0,y:0},mt={idle:new ut("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}]),moving:new ut("tileset_chicken",[{spriteX:0,spriteY:0,duration:3.5},{spriteX:1,spriteY:0,duration:.5}])};class bt extends a{constructor(t,e){var i,s,n,o,r;super(t,e),this.scene=t,this.state="idle",this.targetX=-1,this.targetY=-1,this.isRenderable=!0,this.renderLayer=8,this.width=1,this.height=1,this.animation={index:0,timer:0},this.movementTimer=m.randomStartingDelta(2),this.targetX=this.positionX,this.targetY=this.positionY,this.collision.enabled=!0,this.canMove=null!==(i=e.canMove)&&void 0!==i&&i,this.following=e.follows,this.dialogue=e.dialogue,this.animations=null!==(s=e.animations)&&void 0!==s?s:mt,this.movementSpeed=null!==(n=e.movementSpeed)&&void 0!==n?n:2,this.movementDelay=null!==(o=e.movementDelay)&&void 0!==o?o:void 0,this.name=null!==(r=e.name)&&void 0!==r?r:"???"}update(t){this.updateMovement(t),this.updateAnimationTimer(t)}render(t){let i=this.animations[this.state],s=i.currentFrame(this.animation.timer);e.renderSprite(t,this.assets.images[i.tileset],s.spriteX,s.spriteY,this.transform.position.x,this.transform.position.y,void 0,void 0,{opacity:this.renderOpacity,scale:this.renderScale,centered:!0})}destroy(){console.log("[NpcObject#destroy]",this)}updateAnimationTimer(t){this.animation.timer=(this.animation.timer+t)%this.animations[this.state].duration}updateMovement(t){this.canMove&&(this.movementTimer+=t,(void 0===this.movementDelay&&this.movementTimer>this.movementSpeed||this.movementTimer>this.movementDelay)&&this.determineNextMovement(t),this.processMovement(t))}determineNextMovement(t){let e;this.movementTimer=0,e=this.following?y.moveTowardsOtherEntity(new b(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),{positionX:this.following.positionX,positionY:this.following.positionY}):y.moveInRandomDirection(new b(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY)),this.scene.hasCollisionAtPosition(e.targetX,e.targetY,this)||this.scene.isOutOfBounds(e.targetX,e.targetY)||(this.targetX=e.targetX,this.targetY=e.targetY)}processMovement(t){if(this.targetX!==this.transform.position.x||this.targetY!==this.transform.position.y){let e=new b(this.transform.position.x,this.transform.position.y,this.targetX,this.targetY),i=y.moveTowardsPosition(e,y.frameSpeed(this.movementSpeed,t));this.transform.position.x=i.positionX,this.transform.position.y=i.positionY}}interact(){if(console.log("[NpcObject#interact]"),void 0===this.dialogue)return;let t=new w(this.scene,{text:this.dialogue,portrait:gt,name:this.name});this.scene.addObject(t)}}const yt={[x.Chicken]:1,[x.Egg]:9,[x.WheatSeeds]:9,[x.Wheat]:9,[x.TomatoSeeds]:9,[x.Tomato]:9,[x.Hoe]:1,[x.WateringCan]:1,[x.Chest]:1},vt={tileset:"tileset_ui",spriteX:15,spriteY:5},ft={[x.Chicken]:{tileset:"tileset_chicken",spriteX:0,spriteY:0},[x.Egg]:{tileset:"tileset_egg",spriteX:0,spriteY:0},[x.WheatSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:0},[x.Wheat]:{tileset:"tileset_plants",spriteX:5,spriteY:0},[x.TomatoSeeds]:{tileset:"tileset_plants",spriteX:0,spriteY:1},[x.Tomato]:{tileset:"tileset_plants",spriteX:5,spriteY:1},[x.Hoe]:{tileset:"tileset_tools",spriteX:4,spriteY:4},[x.WateringCan]:{tileset:"tileset_tools",spriteX:0,spriteY:0},[x.Chest]:{tileset:"tileset_chest",spriteX:1,spriteY:1}},xt=I.None,It={[x.Chicken]:I.Anywhere,[x.Egg]:I.Anywhere,[x.WheatSeeds]:I.Player,[x.Wheat]:I.None,[x.TomatoSeeds]:I.Player,[x.Tomato]:I.None,[x.Hoe]:I.Player,[x.WateringCan]:I.Player,[x.Chest]:I.Anywhere},Et={[x.Chicken]:0,[x.Egg]:0,[x.WheatSeeds]:5,[x.Wheat]:10,[x.TomatoSeeds]:5,[x.Tomato]:10,[x.Hoe]:0,[x.WateringCan]:0,[x.Chest]:0};class St extends a{constructor(t,e){var i,s,n;super(t,e),this.scene=t,this.type=e.type,this.maxStackSize=null!==(i=yt[this.type])&&void 0!==i?i:1,this.sprite=null!==(s=ft[this.type])&&void 0!==s?s:vt,this.radius=null!==(n=It[this.type])&&void 0!==n?n:xt,void 0!==e.currentStackSize?this.currentStackSize=e.currentStackSize>this.maxStackSize?this.maxStackSize:e.currentStackSize:this.currentStackSize=1}}const Tt=t.UI_RENDER_LAYER;class wt extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.renderLayer=Tt,this.width=2,this.height=2,this.price=e.price,this.type=e.type}update(t){this.updateClicked()}render(t){this.renderContainer(t),this.renderItem(t),this.renderPrice(t)}updateClicked(){s.isMousePressed()&&(console.log("updateClicked"),n.isMouseWithinObject(this)&&(console.log("updateClicked"),s.clearMousePressed(),this.price>this.scene.globals.gold||(console.log("updateClicked"),this.scene.globals.gold-=this.price,console.log("updateClicked"),this.scene.addToInventory(this.type))))}renderContainer(t){e.fillRectangle(t,this.transform.position.x,this.transform.position.y,this.width,this.height,{colour:"white",type:"tile"})}renderItem(t){e.fillRectangle(t,this.transform.position.x,this.transform.position.y,this.width,this.height,{colour:"white",type:"tile"}),e.renderSprite(t,this.assets.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.x,this.transform.position.y,void 0,void 0)}renderPrice(t){e.renderText(t,`$${this.price}`,this.transform.position.x+1,this.transform.position.y+2,{size:12,colour:"black",font:"MS Gothic"})}get sprite(){return ft[this.type]}}const _t=t.UI_RENDER_LAYER;class Ct extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.renderLayer=_t,this.width=2,this.height=2,this.item=e.item,this.index=e.index}update(t){this.updateClicked()}render(t){this.renderContainer(t),this.renderItem(t),this.renderPrice(t),this.renderStackSize(t)}get type(){return this.item.type}get price(){return Et[this.type]}updateClicked(){s.isMousePressed()&&n.isMouseWithinObject(this)&&(s.clearMousePressed(),this.scene.globals.gold+=this.price,console.log(this.scene.globals.gold),console.log(this.item.currentStackSize),this.scene.removeFromInventory(this.index),0===this.item.currentStackSize&&this.scene.removeObjectById(this.id))}renderContainer(t){e.fillRectangle(t,this.boundingBox.left,this.boundingBox.top,this.width,this.height,{colour:"white",type:"tile"})}renderItem(t){e.renderSprite(t,this.assets.images[this.sprite.tileset],this.sprite.spriteX,this.sprite.spriteY,this.transform.position.x,this.transform.position.y,void 0,void 0,{centered:!0})}renderPrice(t){e.renderText(t,`$${this.price}`,this.boundingBox.right-.75,this.boundingBox.bottom,{size:12,colour:"black",font:"MS Gothic"})}renderStackSize(t){e.renderText(t,`${this.item.currentStackSize}`,this.boundingBox.right-.75,this.boundingBox.top+.75,{size:12,colour:"black",font:"MS Gothic"})}get sprite(){return ft[this.type]}}const Lt=t.UI_RENDER_LAYER,Yt=t.UI_COLLISION_LAYER;var Xt;!function(t){t.Close="tab"}(Xt||(Xt={}));const kt=[{type:x.TomatoSeeds,price:5},{type:x.WheatSeeds,price:5}];class jt extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.renderLayer=Lt,this.collisionLayer=Yt,this.items=[],this.onLeave=e.onLeave}awake(){for(let t=0;t<kt.length;t++){const e=kt[t];this.items.push(new wt(this.scene,{positionX:this.transform.position.x+2+2.5*t,positionY:this.transform.position.y+2,price:e.price,type:e.type}))}const t=this.scene.globals.hotbar_size;for(let e=0;e<5;e++)for(let i=0;i<4;i++){const s=e+5*i+t,n=this.inventory[s];void 0!==n&&this.items.push(new Ct(this.scene,{positionX:this.transform.position.x+19+2.5*e,positionY:this.transform.position.y+3+2.5*i,item:n,index:s}))}this.items.forEach((t=>this.scene.addObject(t)))}update(t){this.updateButtonClose(),this.updateClickClose()}render(t){this.renderBackground(t),this.renderShopBackground(t),this.renderShopTitle(t),this.renderInventoryBackground(t),this.renderInventoryTitle(t),this.renderTotalGold(t),this.renderLeaveButton(t)}destroy(){this.items.forEach((t=>this.scene.removeObjectById(t.id)))}get inventory(){return this.scene.globals.inventory}get inventorySize(){return this.scene.globals.inventory_size}updateButtonClose(){s.isKeyPressed(Xt.Close)&&(s.clearKeyPressed(Xt.Close),this.close())}updateClickClose(){s.isMousePressed(i.Left)&&n.isMouseWithinBoundary(s.mouse.position,21.5,12,4.5,1.5)&&(s.clearMousePressed(i.Left),this.close())}close(){this.scene.removeObjectById(this.id),this.onLeave&&this.onLeave()}renderBackground(t){e.fillRectangle(t,0,0,32,18,{colour:"#00000055",type:"tile"})}renderShopBackground(t){e.fillRectangle(t,1,1,14,10,{colour:"brown",type:"tile"})}renderShopTitle(t){e.fillRectangle(t,4,.25,8,1.5,{colour:"goldenrod",type:"tile"}),e.renderText(t,"Shop (buy)",6,1.25,{size:12,colour:"black",font:"MS Gothic"})}renderInventoryBackground(t){e.fillRectangle(t,17,1,14,11.75,{colour:"brown",type:"tile"})}renderInventoryTitle(t){e.fillRectangle(t,20,.25,8,1.5,{colour:"goldenrod",type:"tile"}),e.renderText(t,"Inventory (sell)",21,1.25,{size:12,colour:"black",font:"MS Gothic"})}renderTotalGold(t){e.fillRectangle(t,26.5,12,4.5,1.5,{colour:"goldenrod",type:"tile"}),e.renderText(t,`Gold: ${this.scene.globals.gold}`,27,13,{size:12,colour:"black",font:"MS Gothic"})}renderLeaveButton(t){e.fillRectangle(t,21.5,12,4.5,1.5,{colour:"grey",type:"tile"}),e.renderText(t,"Leave",22.5,13,{size:12,colour:"black",font:"MS Gothic"})}}const At={tileset:"tileset_player",x:1,y:1},Bt={idle:new ut("tileset_player",[{spriteX:1,spriteY:1,duration:.5},{spriteX:4,spriteY:1,duration:.5}]),moving:new ut("tileset_player",[])};class Ot extends bt{constructor(t,e){e.animations=Bt,super(t,e),this.scene=t,this.firstConversation=!0}update(t){super.update(t)}interact(){this.scene.globals.disable_player_inputs=!0,console.log("[ShopKeeperObject#interact]"),this.firstConversation?this.startStageFirstConversation():this.startStageGreeting()}startStageFirstConversation(){this.scene.addObject(new w(this.scene,{text:"Hi, I don't think we've met. I'm the shop keeper. I have farming supplies for sale and will buy most things you grow.",portrait:At,name:"???",onComplete:()=>{this.firstConversation=!1,this.startStageGreeting()}}))}startStageGreeting(){this.scene.globals.disable_player_inputs=!0,this.scene.addObject(new w(this.scene,{text:"Welcome to my shop, how can I help?",portrait:At,name:"Shopkeeper",onComplete:()=>{this.scene.addObject(new jt(this.scene,{positionX:0,positionY:0,onLeave:this.leaveShopCallback}))}}))}leaveShopCallback(){this.scene.addObject(new w(this.scene,{text:"Thanks, come again any time!",portrait:At,name:"Shopkeeper",onComplete:()=>{this.scene.globals.disable_player_inputs=!1}}))}}class Ht{}Ht.TopLeft={x:1,y:0},Ht.TopRight={x:3,y:0},Ht.BottomLeft={x:1,y:2},Ht.BottomRight={x:3,y:2},Ht.MiddleHorizontal={x:2,y:3},Ht.MiddleVertical={x:0,y:1},Ht.FencePost={x:0,y:3},Ht.Open={x:.5,y:3};class Mt extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.width=1,this.height=1,this.type=Ht.FencePost,this.open=!1,this.collision.enabled=!0,e.type&&(this.type=e.type)}render(t){e.renderSprite(t,this.assets.images.tileset_fence,this.open?Ht.Open.x:this.type.x,this.open?Ht.Open.y:this.type.y,this.transform.position.x,this.transform.position.y,1,1,{centered:!0})}interact(){this.open?(this.open=!1,this.collision.enabled=!0):(this.open=!0,this.collision.enabled=!1)}}class Rt extends o{constructor(t){super(t),this.scene=t,this.height=100,this.width=100,this.backgroundLayers=[U,ht,st],this.objects=[],n.setCursor(this.context.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.objects.push(new pt(t,{positionX:16,positionY:16}));let e=new W(t,{positionX:4,positionY:4.5});this.objects.push(e),this.objects.push(new Ot(t,{positionX:4,positionY:5.5})),this.objects.push(new z(t,{positionX:17,positionY:11,follows:e,canLayEggs:!0,canMove:!0})),this.objects.push(new nt(t,{positionX:6.5,positionY:8.5,width:6})),this.objects.push(new nt(t,{positionX:15,positionY:8.5,width:9})),this.objects.push(new nt(t,{positionX:4,positionY:9})),this.objects.push(new nt(t,{positionX:4,positionY:10})),this.objects.push(new nt(t,{positionX:4,positionY:11})),this.objects.push(new nt(t,{positionX:4,positionY:12})),this.objects.push(new nt(t,{positionX:4,positionY:13})),this.objects.push(new nt(t,{positionX:4,positionY:14})),this.objects.push(new nt(t,{positionX:0,positionY:15})),this.objects.push(new nt(t,{positionX:1,positionY:15})),this.objects.push(new nt(t,{positionX:2,positionY:15})),this.objects.push(new nt(t,{positionX:3,positionY:15})),this.objects.push(new nt(t,{positionX:4,positionY:15})),this.objects.push(new Mt(t,{positionX:0,positionY:16,type:Ht.FencePost})),this.objects.push(new Mt(t,{positionX:0,positionY:17,type:Ht.FencePost})),this.objects.push(new Mt(t,{positionX:0,positionY:18,type:Ht.FencePost})),this.objects.push(new nt(t,{positionX:0,positionY:18})),this.objects.push(new nt(t,{positionX:1,positionY:18})),this.objects.push(new nt(t,{positionX:2,positionY:18})),this.objects.push(new nt(t,{positionX:3,positionY:18})),this.objects.push(new nt(t,{positionX:4,positionY:18})),this.objects.push(new nt(t,{positionX:5,positionY:18})),this.objects.push(new nt(t,{positionX:6,positionY:18})),this.objects.push(new nt(t,{positionX:7,positionY:18})),this.objects.push(new nt(t,{positionX:8,positionY:18})),this.objects.push(new nt(t,{positionX:9,positionY:18})),this.objects.push(new nt(t,{positionX:10,positionY:18})),this.objects.push(new nt(t,{positionX:11,positionY:18})),this.objects.push(new nt(t,{positionX:12,positionY:18})),this.objects.push(new nt(t,{positionX:13,positionY:18})),this.objects.push(new nt(t,{positionX:14,positionY:18})),this.objects.push(new nt(t,{positionX:15,positionY:18})),this.objects.push(new nt(t,{positionX:16,positionY:18})),this.objects.push(new nt(t,{positionX:17,positionY:18})),this.objects.push(new nt(t,{positionX:18,positionY:18})),this.objects.push(new nt(t,{positionX:19,positionY:18})),this.objects.push(new nt(t,{positionX:20,positionY:18})),this.objects.push(new nt(t,{positionX:21,positionY:18})),this.objects.push(new nt(t,{positionX:22,positionY:18})),this.objects.push(new dt(t,{object:e}))}}class Nt{constructor(t){this.client=t,this.backgroundLayersAnimationTimer={},this.objects=[],this.globals={camera:{startX:0,startY:0,endX:0,endY:0}},this.flaggedForMapChange=void 0,this.renderingContext={background:[],objects:[]},this.eventEmitter=document.createElement("eventEmitter"),this.eventTypes={},this.backgroundLayerAnimationFrame={},this.context=this.client.context,this.assets=this.client.assets}frame(t){this.awakeObjects(),this.renderBackground(t),this.updateObjects(t),this.renderObjects(t),this.customRenderer?this.customRenderer(this.renderingContext):this.defaultRenderer(),this.destroyObjects(t)}awakeObjects(){this.client.debug.timing.frameUpdate&&console.time("[frame] awake"),this.objects.forEach((t=>{t.awake&&!t.awakeRan&&(t.awake(),t.awakeRan=!0)})),this.client.debug.timing.frameUpdate&&console.timeEnd("[frame] awake")}renderBackground(t){this.client.debug.timing.frameBackground&&console.time("[frame] background"),this.backgroundLayers.forEach(((i,s)=>{let n=this.renderingContext.background[s];e.clearCanvas(n);for(let s=0;s<this.map.width;s++)for(let o=0;o<this.map.height;o++){let r,a=i.tiles[s]?i.tiles[s][o]:void 0;if(void 0!==a){if(1===a.animationFrames.length)r=a.animationFrames[0];else{let e;void 0===this.backgroundLayersAnimationTimer[i.index]&&(this.backgroundLayersAnimationTimer[i.index]={}),void 0===this.backgroundLayersAnimationTimer[i.index][s]&&(this.backgroundLayersAnimationTimer[i.index][s]={}),e=void 0===this.backgroundLayersAnimationTimer[i.index][s][o]?0:this.backgroundLayersAnimationTimer[i.index][s][o]+t,e>a.animationFrameDuration&&(e%=a.animationFrameDuration);for(let t=0;t<a.animationMap.length;t++)if(e<=a.animationMap[t]){r=a.animationFrames[t];break}this.backgroundLayersAnimationTimer[i.index][s][o]=e}e.renderSprite(n,this.assets.images[a.tileset],r.spriteX,r.spriteY,s,o)}}})),this.client.debug.timing.frameBackground&&console.timeEnd("[frame] background")}updateObjects(t){this.client.debug.timing.frameUpdate&&console.time("[frame] update"),this.objects.forEach((e=>{e.update&&e.update(t)})),this.client.debug.timing.frameUpdate&&console.timeEnd("[frame] update")}renderObjects(t){this.client.debug.timing.frameRender&&console.time("[frame] render"),this.renderingContext.objects.forEach((t=>{e.clearCanvas(t)})),this.objects.forEach((t=>{this.client.debug.object.renderBackground&&t.debuggerRenderBackground(this.renderingContext.objects[t.renderLayer]),t.render&&t.isRenderable&&t.render(this.renderingContext.objects[t.renderLayer]),this.client.debug.object.renderBoundary&&t.debuggerRenderBoundary(this.renderingContext.objects[t.renderLayer])})),this.client.debug.timing.frameRender&&console.timeEnd("[frame] render")}destroyObjects(t){this.client.debug.timing.frameDestroy&&console.time("[frame] destroy"),this.objects.forEach((t=>{t.flaggedForDestroy&&this.removeObjectById(t.id)})),this.client.debug.timing.frameDestroy&&console.timeEnd("[frame] destroy")}defaultRenderer(){this.globals.camera.startX=0,this.globals.camera.startY=0,this.globals.camera.endX=0,this.globals.camera.endY=0,this.renderingContext.background.forEach((t=>{this.context.drawImage(t.canvas,0,0)})),this.renderingContext.objects.forEach((t=>{this.context.drawImage(t.canvas,0,0)}))}addObject(t){this.objects.push(t)}removeObjectById(t){let e=this.objects.find((e=>e.id===t));void 0!==e&&(e.destroy&&e.destroy(),this.objects.splice(this.objects.indexOf(e),1))}getObjectsByType(t){return this.objects.filter((e=>e instanceof t))}hasCollisionAtPosition(t,e,i){for(const s of this.objects)if(s.collision.enabled&&s!==i&&t<s.boundingBox.right&&t>s.boundingBox.left&&e<s.boundingBox.bottom&&e>s.boundingBox.top)return!0;return!1}hasCollisionAtBoundingBox(t,e){for(const i of this.objects)if(i.collision.enabled&&i!==e&&t.left<i.boundingBox.right&&t.right>i.boundingBox.left&&t.top<i.boundingBox.bottom&&t.bottom>i.boundingBox.top)return i}isOutOfBounds(t,e){return t>this.map.width-1||e>this.map.height-1||t<0||e<0}getObjectAtPosition(t,e,i){for(const s of this.objects)if(s!==i&&t<s.boundingBox.right&&t>s.boundingBox.left&&e<s.boundingBox.bottom&&e>s.boundingBox.top)return s}getAllObjectsAtPosition(e,i,s){return this.objects.filter((s=>s.positionX===e&&s.positionY===i&&s.collision.layer!==t.UI_COLLISION_LAYER))}removeAllObjects(){for(;this.objects.length>0;)this.removeObjectById(this.objects[0].id)}removeAllBackgroundLayers(){this.backgroundLayers=[]}setUpRenderingContexts(){this.renderingContext={background:[],objects:[]};for(let t=0;t<this.backgroundLayers.length;t++){let i=this.createCanvas();this.renderingContext.background[t]=e.getContext(i)}for(let i=0;i<t.OBJECT_RENDERING_LAYERS;i++){let t=this.createCanvas();this.renderingContext.objects[i]=e.getContext(t)}}createCanvas(){let t=e.createCanvas(this.map.width,this.map.height);return this.client.debug.ui.canvasLayers&&this.client.container.append(t),t}flagForMapChange(t){this.flaggedForMapChange=t}changeMap(t){void 0!==this.map&&this.map.destroy(),this.removeAllObjects(),this.removeAllBackgroundLayers(),console.log("[Scene] changing map to",t),this.map=Reflect.construct(t,[this]),this.backgroundLayers.push(...this.map.backgroundLayers),this.objects.push(...this.map.objects),this.setUpRenderingContexts(),this.flaggedForMapChange=void 0}changeScene(t){this.client.changeScene(t)}setCustomRenderer(t){this.customRenderer=t}removeCustomerRenderer(){this.customRenderer=void 0}addEventListener(t,e){console.log("addEventListener is deprecated. refactor your code.")}removeEventListener(t,e){console.log("removeEventListener is deprecated. refactor your code.")}dispatchEvent(t,e){console.log("dispatchEvent is deprecated. refactor your code.")}}const Pt={DIRT_PLACED:"DIRT_PLACED",DIRT_REMOVED:"DIRT_REMOVED"};class Dt extends Nt{constructor(t){super(t),this.globals={...this.globals,inventory:[new St(this,{type:x.Hoe}),new St(this,{type:x.WateringCan}),new St(this,{type:x.TomatoSeeds,currentStackSize:10}),new St(this,{type:x.WheatSeeds,currentStackSize:10}),void 0,new St(this,{type:x.Chicken}),new St(this,{type:x.Egg}),new St(this,{type:x.Tomato,currentStackSize:10}),new St(this,{type:x.Wheat,currentStackSize:10}),new St(this,{type:x.Chest,currentStackSize:1}),new St(this,{type:x.Chicken}),new St(this,{type:x.Egg}),new St(this,{type:x.Tomato,currentStackSize:10}),new St(this,{type:x.Wheat,currentStackSize:10}),new St(this,{type:x.Chest,currentStackSize:1}),new St(this,{type:x.Chicken}),new St(this,{type:x.Egg}),new St(this,{type:x.Tomato,currentStackSize:10}),new St(this,{type:x.Wheat,currentStackSize:10}),new St(this,{type:x.Chest,currentStackSize:1}),new St(this,{type:x.Chicken}),new St(this,{type:x.Egg}),new St(this,{type:x.Tomato,currentStackSize:10}),new St(this,{type:x.Wheat,currentStackSize:10}),new St(this,{type:x.Chest,currentStackSize:1})],inventory_size:25,hotbar_size:5,hotbar_selected_index:0,disable_player_inputs:!1,gold:999},this.eventTypes=Pt,this.changeMap(Rt)}get firstFreeInventorySpaceIndex(){for(let t=0;t<this.globals.inventory_size;t++)if(void 0===this.globals.inventory[t])return t}getFirstInventoryItemWithRoomInStack(t){for(let e=0;e<this.globals.inventory_size;e++){let i=this.globals.inventory[e];if(void 0!==i&&i.type===t&&i.currentStackSize<i.maxStackSize)return i}}addToInventory(t){let e=this.getFirstInventoryItemWithRoomInStack(t);if(void 0!==e)return void e.currentStackSize++;let i=this.firstFreeInventorySpaceIndex;if(void 0===i)return;let s=new St(this,{type:t});this.globals.inventory[i]=s}removeFromInventory(t){let e=this.globals.inventory[t];void 0!==e&&(e.currentStackSize--,e.currentStackSize<=0&&(this.globals.inventory[t]=void 0))}get selectedInventoryItem(){return this.globals.inventory[this.globals.hotbar_selected_index]}get selectedInventoryIndex(){return this.globals.hotbar_selected_index}}class Wt extends a{constructor(t,e){super(t,e),this.scene=t,this.isRenderable=!0,this.width=6,this.height=2,this.clicked=!1}update(t){this.updateClickStart(),this.updateClickEnd()}render(t){this.renderStartButton(t)}renderStartButton(t){e.renderSprite(t,this.assets.images.tileset_button,this.clicked?6:0,2,this.transform.position.x,this.transform.position.y,this.width,this.height,{centered:!0})}updateClickStart(){n.wasObjectClicked(this)&&(this.clicked=!0)}updateClickEnd(){!0!==s.mouse.click.left&&!1!==this.clicked&&(n.isMouseWithinObject(this)?this.scene.changeScene(Dt):this.clicked=!1)}}const Ft=t.CANVAS_TILE_HEIGHT,Gt=t.CANVAS_TILE_WIDTH;class zt extends o{constructor(t){super(t),this.scene=t,this.height=Ft,this.width=Gt,this.backgroundLayers=[g],this.objects=[],n.setCursor(this.context.canvas,"/assets/sample/Mouse sprites/Triangle Mouse icon 1.png"),this.objects.push(new Wt(t,{renderLayer:15,positionX:16,positionY:9})),this.objects.push(new f(t,{}))}}class Vt extends Nt{constructor(t){super(t),this.client=t,this.changeMap(zt)}}!function(){var t;const e=new URLSearchParams(window.location.search).get("scene"),i=null!==(t={"main-menu":Vt,game:Dt}[e])&&void 0!==t?t:Vt;d.initHelpers(),window.engine=new l(document.getElementById("render-area"),i,{images:{tileset_sample:"assets/16x16.png",tileset_grass:"assets/sample/Tilesets/Grass.png",tileset_hills:"assets/sample/Tilesets/Hills.png",tileset_water:"assets/sample/Tilesets/Water.png",tileset_player:"assets/sample/Characters/Basic Charakter Spritesheet.png",tileset_chicken:"assets/sample/Characters/Free Chicken Sprites.png",tileset_fence:"assets/sample/Tilesets/Fences.png",tileset_egg:"assets/sample/Characters/Egg_And_Nest.png",tileset_house:"assets/sample/Tilesets/Wooden House.png",tileset_dirt:"assets/sample/Tilesets/Tilled_Dirt.png",tileset_button:"assets/sample/UI Big Play Button.png",tileset_ui:"assets/sample/Sprite sheet for Basic Pack.png",tileset_wood_bridge:"assets/sample/Objects/Wood_Bridge.png",tileset_chest:"assets/sample/Objects/Chest.png",tileset_plants:"assets/sample/Objects/Basic_Plants.png",tileset_dialogue_box:"assets/sample/Dialouge UI/dialog box.png",tileset_tools:"assets/sample/Characters/Tools.png"},audio:{}},d.engineMapList,d.engineObjectList,d.engineObjectDetails,d.engineControls)}()})();